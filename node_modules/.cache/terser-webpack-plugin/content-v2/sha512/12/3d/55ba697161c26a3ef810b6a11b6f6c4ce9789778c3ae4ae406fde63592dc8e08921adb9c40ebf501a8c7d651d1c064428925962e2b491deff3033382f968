{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{606:function(r,o,e){\"use strict\";e.r(o);var n=e(6),t=Object(n.a)({},(function(){var r=this,o=r.$createElement,e=r._self._c||o;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":r.$parent.slotKey}},[e(\"blockquote\",[e(\"p\",[r._v(\"https://www.cnblogs.com/huxi2b/p/6223228.html\")])]),r._v(\" \"),e(\"h2\",{attrs:{id:\"æ¶ˆè´¹è€…ç»„\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#æ¶ˆè´¹è€…ç»„\"}},[r._v(\"#\")]),r._v(\" æ¶ˆè´¹è€…ç»„\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"1 ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„\")])]),r._v(\" \"),e(\"p\",[r._v(\"å…¶å®å¯¹äºè¿™äº›åŸºæœ¬æ¦‚å¿µçš„æ™®åŠï¼Œç½‘ä¸Šèµ„æ–™å®åœ¨å¤ªå¤šäº†ã€‚æˆ‘æœ¬ä¸åº”è¯¥å†ç”»è›‡æ·»è¶³äº†ï¼Œä½†ä¸ºäº†æœ¬æ–‡çš„å®Œæ•´æ€§ï¼Œæˆ‘è¿˜æ˜¯è¦èŠ±ä¸€äº›ç¯‡å¹…æ¥é‡è°ˆconsumer groupï¼Œè‡³å°‘å¯ä»¥è¯´è¯´æˆ‘çš„ç†è§£ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬ä»Šå¤©åŸºæœ¬ä¸Šåªæ¢è®¨consumer groupï¼Œå¯¹äºå•ç‹¬çš„æ¶ˆè´¹è€…ä¸åšè¿‡å¤šè®¨è®ºã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"ä»€ä¹ˆæ˜¯consumer group? ä¸€è¨€ä»¥è”½ä¹‹ï¼Œconsumer groupæ˜¯kafkaæä¾›çš„å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹è€…æœºåˆ¶ã€‚æ—¢ç„¶æ˜¯ä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆç»„å†…å¿…ç„¶å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…æˆ–æ¶ˆè´¹è€…å®ä¾‹(consumer instance)ï¼Œå®ƒä»¬å…±äº«ä¸€ä¸ªå…¬å…±çš„IDï¼Œå³group IDã€‚ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåœ¨ä¸€èµ·æ¥æ¶ˆè´¹è®¢é˜…ä¸»é¢˜(subscribed topics)çš„æ‰€æœ‰åˆ†åŒº(partition)ã€‚å½“ç„¶ï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½ç”±åŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„ä¸€ä¸ªconsumeræ¥æ¶ˆè´¹ã€‚ï¼ˆç½‘ä¸Šæ–‡ç« ä¸­è¯´åˆ°æ­¤å¤„å„ç§ç‚«ç›®å¤šå½©çš„å›¾å°±ä¼šç´§è·Ÿç€æŠ›å‡ºæ¥ï¼Œæˆ‘è¿™é‡Œå°±ä¸ç”»äº†ï¼Œè¯·åŸè°…ï¼‰ã€‚ä¸ªäººè®¤ä¸ºï¼Œç†è§£consumer groupè®°ä½ä¸‹é¢è¿™ä¸‰ä¸ªç‰¹æ€§å°±å¥½äº†ï¼š\")]),r._v(\" \"),e(\"ul\",[e(\"li\",[r._v(\"consumer groupä¸‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªconsumer instanceï¼Œconsumer instanceå¯ä»¥æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªçº¿ç¨‹\")]),r._v(\" \"),e(\"li\",[r._v(\"group.idæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå”¯ä¸€æ ‡è¯†ä¸€ä¸ªconsumer group\")]),r._v(\" \"),e(\"li\",[r._v(\"consumer groupä¸‹è®¢é˜…çš„topicä¸‹çš„æ¯ä¸ªåˆ†åŒºåªèƒ½åˆ†é…ç»™æŸä¸ªgroupä¸‹çš„ä¸€ä¸ªconsumer(å½“ç„¶è¯¥åˆ†åŒºè¿˜å¯ä»¥è¢«åˆ†é…ç»™å…¶ä»–group)\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"2 æ¶ˆè´¹è€…ä½ç½®(consumer position)\")])]),r._v(\" \"),e(\"p\",[r._v(\"æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹çš„è¿‡ç¨‹ä¸­éœ€è¦è®°å½•è‡ªå·±æ¶ˆè´¹äº†å¤šå°‘æ•°æ®ï¼Œå³æ¶ˆè´¹ä½ç½®ä¿¡æ¯ã€‚åœ¨Kafkaä¸­è¿™ä¸ªä½ç½®ä¿¡æ¯æœ‰ä¸ªä¸“é—¨çš„æœ¯è¯­ï¼šä½ç§»(offset)ã€‚å¾ˆå¤šæ¶ˆæ¯å¼•æ“éƒ½æŠŠè¿™éƒ¨åˆ†ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯(brokerç«¯)ã€‚è¿™æ ·åšçš„å¥½å¤„å½“ç„¶æ˜¯å®ç°ç®€å•ï¼Œä½†ä¼šæœ‰ä¸‰ä¸ªä¸»è¦çš„é—®é¢˜ï¼š1. brokerä»æ­¤å˜æˆæœ‰çŠ¶æ€çš„ï¼Œä¼šå½±å“ä¼¸ç¼©æ€§ï¼›2. éœ€è¦å¼•å…¥åº”ç­”æœºåˆ¶(acknowledgement)æ¥ç¡®è®¤æ¶ˆè´¹æˆåŠŸã€‚3. ç”±äºè¦ä¿å­˜å¾ˆå¤šconsumerçš„offsetä¿¡æ¯ï¼Œå¿…ç„¶å¼•å…¥å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚è€ŒKafkaé€‰æ‹©äº†ä¸åŒçš„æ–¹å¼ï¼šæ¯ä¸ªconsumer groupä¿å­˜è‡ªå·±çš„ä½ç§»ä¿¡æ¯ï¼Œé‚£ä¹ˆåªéœ€è¦ç®€å•çš„ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºä½ç½®å°±å¤Ÿäº†ï¼›åŒæ—¶å¯ä»¥å¼•å…¥checkpointæœºåˆ¶å®šæœŸæŒä¹…åŒ–ï¼Œç®€åŒ–äº†åº”ç­”æœºåˆ¶çš„å®ç°ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"3 ä½ç§»ç®¡ç†(offset management)\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"3.1 è‡ªåŠ¨VSæ‰‹åŠ¨\")])]),r._v(\" \"),e(\"p\",[r._v(\"Kafkaé»˜è®¤æ˜¯å®šæœŸå¸®ä½ è‡ªåŠ¨æäº¤ä½ç§»çš„(enable.auto.commit = true)ï¼Œä½ å½“ç„¶å¯ä»¥é€‰æ‹©æ‰‹åŠ¨æäº¤ä½ç§»å®ç°è‡ªå·±æ§åˆ¶ã€‚å¦å¤–kafkaä¼šå®šæœŸæŠŠgroupæ¶ˆè´¹æƒ…å†µä¿å­˜èµ·æ¥ï¼Œåšæˆä¸€ä¸ªoffset mapï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226175429711-638862783.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"ä¸Šå›¾ä¸­è¡¨æ˜äº†test-groupè¿™ä¸ªç»„å½“å‰çš„æ¶ˆè´¹æƒ…å†µã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"3.2 ä½ç§»æäº¤\")])]),r._v(\" \"),e(\"p\",[r._v(\"è€ç‰ˆæœ¬çš„ä½ç§»æ˜¯æäº¤åˆ°zookeeperä¸­çš„ï¼Œå›¾å°±ä¸ç”»äº†ï¼Œæ€»ä¹‹ç›®å½•ç»“æ„æ˜¯ï¼š/consumers/<\"),e(\"a\",{attrs:{href:\"http://group.id/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[r._v(\"group.id\"),e(\"OutboundLink\")],1),r._v(\">/offsets/\"),e(\"topic\",[r._v(\"/\"),e(\"partitionId\",[r._v(\"ï¼Œä½†æ˜¯zookeeperå…¶å®å¹¶ä¸é€‚åˆè¿›è¡Œå¤§æ‰¹é‡çš„è¯»å†™æ“ä½œï¼Œå°¤å…¶æ˜¯å†™æ“ä½œã€‚å› æ­¤kafkaæä¾›äº†å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šå¢åŠ __consumeroffsets topicï¼Œå°†offsetä¿¡æ¯å†™å…¥è¿™ä¸ªtopicï¼Œæ‘†è„±å¯¹zookeeperçš„ä¾èµ–(æŒ‡ä¿å­˜offsetè¿™ä»¶äº‹æƒ…)ã€‚__consumer_offsetsä¸­çš„æ¶ˆæ¯ä¿å­˜äº†æ¯ä¸ªconsumer groupæŸä¸€æ—¶åˆ»æäº¤çš„offsetä¿¡æ¯ã€‚ä¾ç„¶ä»¥ä¸Šå›¾ä¸­çš„consumer groupä¸ºä¾‹ï¼Œæ ¼å¼å¤§æ¦‚å¦‚ä¸‹ï¼š\")])],1)],1),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226175522507-1842910668.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"__consumers_offsets topicé…ç½®äº†compactç­–ç•¥ï¼Œä½¿å¾—å®ƒæ€»æ˜¯èƒ½å¤Ÿä¿å­˜æœ€æ–°çš„ä½ç§»ä¿¡æ¯ï¼Œæ—¢æ§åˆ¶äº†è¯¥topicæ€»ä½“çš„æ—¥å¿—å®¹é‡ï¼Œä¹Ÿèƒ½å®ç°ä¿å­˜æœ€æ–°offsetçš„ç›®çš„ã€‚compactçš„å…·ä½“åŸç†è¯·å‚è§ï¼š\"),e(\"a\",{attrs:{href:\"https://kafka.apache.org/documentation/#compaction\",target:\"_blank\",rel:\"noopener noreferrer\"}},[r._v(\"Log Compaction\"),e(\"OutboundLink\")],1)]),r._v(\" \"),e(\"p\",[r._v(\"è‡³äºæ¯ä¸ªgroupä¿å­˜åˆ°__consumers_offsetsçš„å“ªä¸ªåˆ†åŒºï¼Œå¦‚ä½•æŸ¥çœ‹çš„é—®é¢˜è¯·å‚è§è¿™ç¯‡æ–‡ç« ï¼š\"),e(\"a\",{attrs:{href:\"http://www.cnblogs.com/huxi2b/p/6061110.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[r._v(\"Kafka å¦‚ä½•è¯»å–offset topicå†…å®¹ (__consumer_offsets)\"),e(\"OutboundLink\")],1)]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4 Rebalance\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.1 ä»€ä¹ˆæ˜¯rebalanceï¼Ÿ\")])]),r._v(\" \"),e(\"p\",[r._v(\"rebalanceæœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ªconsumer groupä¸‹çš„æ‰€æœ‰consumerå¦‚ä½•è¾¾æˆä¸€è‡´æ¥åˆ†é…è®¢é˜…topicçš„æ¯ä¸ªåˆ†åŒºã€‚æ¯”å¦‚æŸä¸ªgroupä¸‹æœ‰20ä¸ªconsumerï¼Œå®ƒè®¢é˜…äº†ä¸€ä¸ªå…·æœ‰100ä¸ªåˆ†åŒºçš„topicã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒKafkaå¹³å‡ä¼šä¸ºæ¯ä¸ªconsumeråˆ†é…5ä¸ªåˆ†åŒºã€‚è¿™ä¸ªåˆ†é…çš„è¿‡ç¨‹å°±å«rebalanceã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.2 ä»€ä¹ˆæ—¶å€™rebalanceï¼Ÿ\")])]),r._v(\" \"),e(\"p\",[r._v(\"è¿™ä¹Ÿæ˜¯ç»å¸¸è¢«æåŠçš„ä¸€ä¸ªé—®é¢˜ã€‚rebalanceçš„è§¦å‘æ¡ä»¶æœ‰ä¸‰ç§ï¼š\")]),r._v(\" \"),e(\"ul\",[e(\"li\",[r._v(\"ç»„æˆå‘˜å‘ç”Ÿå˜æ›´(æ–°consumeråŠ å…¥ç»„ã€å·²æœ‰consumerä¸»åŠ¨ç¦»å¼€ç»„æˆ–å·²æœ‰consumerå´©æºƒäº†â€”â€”è¿™ä¸¤è€…çš„åŒºåˆ«åé¢ä¼šè°ˆåˆ°)\")]),r._v(\" \"),e(\"li\",[r._v(\"è®¢é˜…ä¸»é¢˜æ•°å‘ç”Ÿå˜æ›´â€”â€”è¿™å½“ç„¶æ˜¯å¯èƒ½çš„ï¼Œå¦‚æœä½ ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼è¿›è¡Œè®¢é˜…ï¼Œé‚£ä¹ˆæ–°å»ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„topicå°±ä¼šè§¦å‘rebalance\")]),r._v(\" \"),e(\"li\",[r._v(\"è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜æ›´\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.3 å¦‚ä½•è¿›è¡Œç»„å†…åˆ†åŒºåˆ†é…ï¼Ÿ\")])]),r._v(\" \"),e(\"p\",[r._v(\"ä¹‹å‰æåˆ°äº†groupä¸‹çš„æ‰€æœ‰consumeréƒ½ä¼šåè°ƒåœ¨ä¸€èµ·å…±åŒå‚ä¸åˆ†é…ï¼Œè¿™æ˜¯å¦‚ä½•å®Œæˆçš„ï¼ŸKafkaæ–°ç‰ˆæœ¬consumeré»˜è®¤æä¾›äº†ä¸¤ç§åˆ†é…ç­–ç•¥ï¼šrangeå’Œround-robinã€‚å½“ç„¶Kafkaé‡‡ç”¨äº†å¯æ’æ‹”å¼çš„åˆ†é…ç­–ç•¥ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„åˆ†é…å™¨ä»¥å®ç°ä¸åŒçš„åˆ†é…ç­–ç•¥ã€‚å®é™…ä¸Šï¼Œç”±äºç›®å‰rangeå’Œround-robinä¸¤ç§åˆ†é…å™¨éƒ½æœ‰ä¸€äº›å¼Šç«¯ï¼ŒKafkaç¤¾åŒºå·²ç»æå‡ºç¬¬ä¸‰ç§åˆ†é…å™¨æ¥å®ç°æ›´åŠ å…¬å¹³çš„åˆ†é…ç­–ç•¥ï¼Œåªæ˜¯ç›®å‰è¿˜åœ¨å¼€å‘ä¸­ã€‚æˆ‘ä»¬è¿™é‡Œåªéœ€è¦çŸ¥é“consumer groupé»˜è®¤å·²ç»å¸®æˆ‘ä»¬æŠŠè®¢é˜…topicçš„åˆ†åŒºåˆ†é…å·¥ä½œåšå¥½äº†å°±è¡Œäº†ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"ç®€å•ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç›®å‰æŸä¸ªconsumer groupä¸‹æœ‰ä¸¤ä¸ªconsumerï¼š Aå’ŒBï¼Œå½“ç¬¬ä¸‰ä¸ªæˆå‘˜åŠ å…¥æ—¶ï¼Œkafkaä¼šè§¦å‘rebalanceå¹¶æ ¹æ®é»˜è®¤çš„åˆ†é…ç­–ç•¥é‡æ–°ä¸ºAã€Bå’ŒCåˆ†é…åˆ†åŒºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226175710289-1164779517.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.4 è°æ¥æ‰§è¡Œrebalanceå’Œconsumer groupç®¡ç†ï¼Ÿ\")])]),r._v(\" \"),e(\"p\",[r._v(\"Kafkaæä¾›äº†ä¸€ä¸ªè§’è‰²ï¼šcoordinatoræ¥æ‰§è¡Œå¯¹äºconsumer groupçš„ç®¡ç†ã€‚å¦ç‡è¯´kafkaå¯¹äºcoordinatorçš„è®¾è®¡ä¸ä¿®æ”¹æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ•…äº‹ã€‚æœ€æ–°ç‰ˆæœ¬çš„coordinatorä¹Ÿä¸æœ€åˆçš„è®¾è®¡æœ‰äº†å¾ˆå¤§çš„ä¸åŒã€‚è¿™é‡Œæˆ‘åªæƒ³æåŠä¸¤æ¬¡æ¯”è¾ƒå¤§çš„æ”¹å˜ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"é¦–å…ˆæ˜¯0.8ç‰ˆæœ¬çš„coordinatorï¼Œé‚£æ—¶å€™çš„coordinatoræ˜¯ä¾èµ–zookeeperæ¥å®ç°å¯¹äºconsumer groupçš„ç®¡ç†çš„ã€‚Coordinatorç›‘å¬zookeeperçš„/consumers/\"),e(\"group\",[r._v(\"/idsçš„å­èŠ‚ç‚¹å˜åŒ–ä»¥åŠ/brokers/topics/\"),e(\"topic\",[r._v(\"æ•°æ®å˜åŒ–æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œrebalanceã€‚groupä¸‹çš„æ¯ä¸ªconsumeréƒ½è‡ªå·±å†³å®šè¦æ¶ˆè´¹å“ªäº›åˆ†åŒºï¼Œå¹¶æŠŠè‡ªå·±çš„å†³å®šæŠ¢å…ˆåœ¨zookeeperä¸­çš„/consumers/\"),e(\"group\",[r._v(\"/owners/\"),e(\"topic\",[r._v(\"/\"),e(\"partition\",[r._v(\"ä¸‹æ³¨å†Œã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆè¦ä¾èµ–äºzookeeperçš„å¸®åŠ©ï¼Œè€Œä¸”æ¯ä¸ªconsumeræ˜¯å•ç‹¬åšå†³å®šçš„ï¼Œæ²¡æœ‰é‚£ç§â€œå¤§å®¶å±äºä¸€ä¸ªç»„ï¼Œè¦åå•†åšäº‹æƒ…â€çš„ç²¾ç¥ã€‚\")])],1)],1)],1)],1)],1),r._v(\" \"),e(\"p\",[r._v(\"åŸºäºè¿™äº›æ½œåœ¨çš„å¼Šç«¯ï¼Œ0.9ç‰ˆæœ¬çš„kafkaæ”¹è¿›äº†coordinatorçš„è®¾è®¡ï¼Œæå‡ºäº†group coordinatorâ€”â€”æ¯ä¸ªconsumer groupéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªè¿™æ ·çš„coordinatorç”¨äºç»„ç®¡ç†å’Œä½ç§»ç®¡ç†ã€‚è¿™ä¸ªgroup coordinatoræ¯”åŸæ¥æ‰¿æ‹…äº†æ›´å¤šçš„è´£ä»»ï¼Œæ¯”å¦‚ç»„æˆå‘˜ç®¡ç†ã€ä½ç§»æäº¤ä¿æŠ¤æœºåˆ¶ç­‰ã€‚å½“æ–°ç‰ˆæœ¬consumer groupçš„ç¬¬ä¸€ä¸ªconsumerå¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šå»å’Œkafka serverç¡®å®šè°æ˜¯å®ƒä»¬ç»„çš„coordinatorã€‚ä¹‹åè¯¥groupå†…çš„æ‰€æœ‰æˆå‘˜éƒ½ä¼šå’Œè¯¥coordinatorè¿›è¡Œåè°ƒé€šä¿¡ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ç§coordinatorè®¾è®¡ä¸å†éœ€è¦zookeeperäº†ï¼Œæ€§èƒ½ä¸Šå¯ä»¥å¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚åé¢çš„æ‰€æœ‰éƒ¨åˆ†æˆ‘ä»¬éƒ½å°†è®¨è®ºæœ€æ–°ç‰ˆæœ¬çš„coordinatorè®¾è®¡ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.5 å¦‚ä½•ç¡®å®šcoordinatorï¼Ÿ\")])]),r._v(\" \"),e(\"p\",[r._v(\"ä¸Šé¢ç®€å•è®¨è®ºäº†æ–°ç‰ˆcoordinatorçš„è®¾è®¡ï¼Œé‚£ä¹ˆconsumer groupå¦‚ä½•ç¡®å®šè‡ªå·±çš„coordinatoræ˜¯è°å‘¢ï¼Ÿ ç®€å•æ¥è¯´åˆ†ä¸ºä¸¤æ­¥ï¼š\")]),r._v(\" \"),e(\"ul\",[e(\"li\",[r._v(\"ç¡®å®šconsumer groupä½ç§»ä¿¡æ¯å†™å…¥__consumers_offsetsçš„å“ªä¸ªåˆ†åŒºã€‚å…·ä½“è®¡ç®—å…¬å¼ï¼š\\n\"),e(\"ul\",[e(\"li\",[r._v(\"__consumers_offsets partition# = Math.abs(groupId.hashCode() % groupMetadataTopicPartitionCount)  æ³¨æ„ï¼šgroupMetadataTopicPartitionCountç”±offsets.topic.num.partitionsæŒ‡å®šï¼Œé»˜è®¤æ˜¯50ä¸ªåˆ†åŒºã€‚\")])])]),r._v(\" \"),e(\"li\",[r._v(\"è¯¥åˆ†åŒºleaderæ‰€åœ¨çš„brokerå°±æ˜¯è¢«é€‰å®šçš„coordinator\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.6 Rebalance Generation\")])]),r._v(\" \"),e(\"p\",[r._v(\"JVM GCçš„åˆ†ä»£æ”¶é›†å°±æ˜¯è¿™ä¸ªè¯(ä¸¥æ ¼æ¥è¯´æ˜¯generational)ï¼Œæˆ‘è¿™é‡ŒæŠŠå®ƒç¿»è¯‘æˆâ€œå±Šâ€å¥½äº†ï¼Œå®ƒè¡¨ç¤ºäº†rebalanceä¹‹åçš„ä¸€å±Šæˆå‘˜ï¼Œä¸»è¦æ˜¯ç”¨äºä¿æŠ¤consumer groupï¼Œéš”ç¦»æ— æ•ˆoffsetæäº¤çš„ã€‚æ¯”å¦‚ä¸Šä¸€å±Šçš„consumeræˆå‘˜æ˜¯æ— æ³•æäº¤ä½ç§»åˆ°æ–°ä¸€å±Šçš„consumer groupä¸­ã€‚æˆ‘ä»¬æœ‰æ—¶å€™å¯ä»¥çœ‹åˆ°ILLEGAL_GENERATIONçš„é”™è¯¯ï¼Œå°±æ˜¯kafkaåœ¨æŠ±æ€¨è¿™ä»¶äº‹æƒ…ã€‚æ¯æ¬¡groupè¿›è¡Œrebalanceä¹‹åï¼Œgenerationå·éƒ½ä¼šåŠ 1ï¼Œè¡¨ç¤ºgroupè¿›å…¥åˆ°äº†ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Generation 1æ—¶groupæœ‰3ä¸ªæˆå‘˜ï¼Œéšåæˆå‘˜2é€€å‡ºç»„ï¼Œcoordinatorè§¦å‘rebalanceï¼Œconsumer groupè¿›å…¥Generation 2ï¼Œä¹‹åæˆå‘˜4åŠ å…¥ï¼Œå†æ¬¡è§¦å‘rebalanceï¼Œgroupè¿›å…¥Generation 3.\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226175822570-898409869.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.7 åè®®(protocol)\")])]),r._v(\" \"),e(\"p\",[r._v(\"å‰é¢è¯´è¿‡äº†ï¼Œ rebalanceæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„åè®®ã€‚groupä¸coordinatorå…±åŒä½¿ç”¨å®ƒæ¥å®Œæˆgroupçš„rebalanceã€‚ç›®å‰kafkaæä¾›äº†5ä¸ªåè®®æ¥å¤„ç†ä¸consumer group coordinationç›¸å…³çš„é—®é¢˜ï¼š\")]),r._v(\" \"),e(\"ul\",[e(\"li\",[r._v(\"Heartbeatè¯·æ±‚ï¼šconsumeréœ€è¦å®šæœŸç»™coordinatorå‘é€å¿ƒè·³æ¥è¡¨æ˜è‡ªå·±è¿˜æ´»ç€\")]),r._v(\" \"),e(\"li\",[r._v(\"LeaveGroupè¯·æ±‚ï¼šä¸»åŠ¨å‘Šè¯‰coordinatoræˆ‘è¦ç¦»å¼€consumer group\")]),r._v(\" \"),e(\"li\",[r._v(\"SyncGroupè¯·æ±‚ï¼šgroup leaderæŠŠåˆ†é…æ–¹æ¡ˆå‘Šè¯‰ç»„å†…æ‰€æœ‰æˆå‘˜\")]),r._v(\" \"),e(\"li\",[r._v(\"JoinGroupè¯·æ±‚ï¼šæˆå‘˜è¯·æ±‚åŠ å…¥ç»„\")]),r._v(\" \"),e(\"li\",[r._v(\"DescribeGroupè¯·æ±‚ï¼šæ˜¾ç¤ºç»„çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆå‘˜ä¿¡æ¯ï¼Œåè®®åç§°ï¼Œåˆ†é…æ–¹æ¡ˆï¼Œè®¢é˜…ä¿¡æ¯ç­‰ã€‚é€šå¸¸è¯¥è¯·æ±‚æ˜¯ç»™ç®¡ç†å‘˜ä½¿ç”¨\")])]),r._v(\" \"),e(\"p\",[r._v(\"Coordinatoråœ¨rebalanceçš„æ—¶å€™ä¸»è¦ç”¨åˆ°äº†å‰é¢4ç§è¯·æ±‚ã€‚\\n\"),e(\"strong\",[r._v(\"4.8 liveness\")])]),r._v(\" \"),e(\"p\",[r._v(\"consumerå¦‚ä½•å‘coordinatorè¯æ˜è‡ªå·±è¿˜æ´»ç€ï¼Ÿ é€šè¿‡å®šæ—¶å‘coordinatorå‘é€Heartbeatè¯·æ±‚ã€‚å¦‚æœè¶…è¿‡äº†è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆcoordinatorå°±è®¤ä¸ºè¿™ä¸ªconsumerå·²ç»æŒ‚äº†ã€‚ä¸€æ—¦coordinatorè®¤ä¸ºæŸä¸ªconsumeræŒ‚äº†ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå¼€å¯æ–°ä¸€è½®rebalanceï¼Œå¹¶ä¸”åœ¨å½“å‰å…¶ä»–consumerçš„å¿ƒè·³responseä¸­æ·»åŠ â€œREBALANCE_IN_PROGRESSâ€ï¼Œå‘Šè¯‰å…¶ä»–consumerï¼šä¸å¥½æ„æ€å„ä½ï¼Œä½ ä»¬é‡æ–°ç”³è¯·åŠ å…¥ç»„å§ï¼\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.9 Rebalanceè¿‡ç¨‹\")])]),r._v(\" \"),e(\"p\",[r._v(\"ç»ˆäºè¯´åˆ°consumer groupæ‰§è¡Œrebalanceçš„å…·ä½“æµç¨‹äº†ã€‚å¾ˆå¤šç”¨æˆ·ä¼°è®¡å¯¹consumerå†…éƒ¨çš„å·¥ä½œæœºåˆ¶ä¹Ÿå¾ˆæ„Ÿå…´è¶£ã€‚ä¸‹é¢å°±è·Ÿå¤§å®¶ä¸€èµ·è®¨è®ºä¸€ä¸‹ã€‚å½“ç„¶æˆ‘å¿…é¡»è¦æ˜ç¡®è¡¨ç¤ºï¼Œrebalanceçš„å‰ææ˜¯coordinatorå·²ç»ç¡®å®šäº†ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"æ€»ä½“è€Œè¨€ï¼Œrebalanceåˆ†ä¸º2æ­¥ï¼šJoinå’ŒSync\")]),r._v(\" \"),e(\"p\",[r._v(\"1 Joinï¼Œ é¡¾åæ€ä¹‰å°±æ˜¯åŠ å…¥ç»„ã€‚è¿™ä¸€æ­¥ä¸­ï¼Œæ‰€æœ‰æˆå‘˜éƒ½å‘coordinatorå‘é€JoinGroupè¯·æ±‚ï¼Œè¯·æ±‚å…¥ç»„ã€‚ä¸€æ—¦æ‰€æœ‰æˆå‘˜éƒ½å‘é€äº†JoinGroupè¯·æ±‚ï¼Œcoordinatorä¼šä»ä¸­é€‰æ‹©ä¸€ä¸ªconsumeræ‹…ä»»leaderçš„è§’è‰²ï¼Œå¹¶æŠŠç»„æˆå‘˜ä¿¡æ¯ä»¥åŠè®¢é˜…ä¿¡æ¯å‘ç»™leaderâ€”â€”æ³¨æ„leaderå’Œcoordinatorä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚leaderè´Ÿè´£æ¶ˆè´¹åˆ†é…æ–¹æ¡ˆçš„åˆ¶å®šã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"2 Syncï¼Œè¿™ä¸€æ­¥leaderå¼€å§‹åˆ†é…æ¶ˆè´¹æ–¹æ¡ˆï¼Œå³å“ªä¸ªconsumerè´Ÿè´£æ¶ˆè´¹å“ªäº›topicçš„å“ªäº›partitionã€‚ä¸€æ—¦å®Œæˆåˆ†é…ï¼Œleaderä¼šå°†è¿™ä¸ªæ–¹æ¡ˆå°è£…è¿›SyncGroupè¯·æ±‚ä¸­å‘ç»™coordinatorï¼Œéleaderä¹Ÿä¼šå‘SyncGroupè¯·æ±‚ï¼Œåªæ˜¯å†…å®¹ä¸ºç©ºã€‚coordinatoræ¥æ”¶åˆ°åˆ†é…æ–¹æ¡ˆä¹‹åä¼šæŠŠæ–¹æ¡ˆå¡è¿›SyncGroupçš„responseä¸­å‘ç»™å„ä¸ªconsumerã€‚è¿™æ ·ç»„å†…çš„æ‰€æœ‰æˆå‘˜å°±éƒ½çŸ¥é“è‡ªå·±åº”è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºäº†ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"è¿˜æ˜¯æ‹¿å‡ å¼ å›¾æ¥è¯´æ˜å§ï¼Œé¦–å…ˆæ˜¯åŠ å…¥ç»„çš„è¿‡ç¨‹:\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226175922086-1237318351.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ åœ¨coordinatoræ”¶é›†åˆ°æ‰€æœ‰æˆå‘˜è¯·æ±‚å‰ï¼Œå®ƒä¼šæŠŠå·²æ”¶åˆ°è¯·æ±‚æ”¾å…¥ä¸€ä¸ªå«purgatory(ç‚¼ç‹±)çš„åœ°æ–¹ã€‚è®°å¾—å›½å†…æœ‰ç¯‡æ–‡ç« ä»¥æ­¤æ¥è¯æ˜kafkaå¼€å‘äººå‘˜éƒ½æ˜¯å¾ˆæœ‰æ–‡è‰ºèŒƒçš„ï¼Œå†™å¾—ä¹Ÿæ˜¯æ¯”è¾ƒæœ‰è¶£ï¼Œæœ‰å…´è¶£å¯ä»¥å»æœæœã€‚\\nç„¶åæ˜¯åˆ†å‘åˆ†é…æ–¹æ¡ˆçš„è¿‡ç¨‹ï¼Œå³SyncGroupè¯·æ±‚ï¼š\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226180005242-1302422077.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"æ³¨æ„ï¼ï¼ consumer groupçš„åˆ†åŒºåˆ†é…æ–¹æ¡ˆæ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„ï¼Kafkaå°†è¿™ä¸ªæƒåˆ©ä¸‹æ”¾ç»™å®¢æˆ·ç«¯ä¸»è¦æ˜¯å› ä¸ºè¿™æ ·åšå¯ä»¥æœ‰æ›´å¥½çš„çµæ´»æ€§ã€‚æ¯”å¦‚è¿™ç§æœºåˆ¶ä¸‹æˆ‘å¯ä»¥å®ç°ç±»ä¼¼äºHadoopé‚£æ ·çš„æœºæ¶æ„ŸçŸ¥(rack-aware)åˆ†é…æ–¹æ¡ˆï¼Œå³ä¸ºconsumeræŒ‘é€‰åŒä¸€ä¸ªæœºæ¶ä¸‹çš„åˆ†åŒºæ•°æ®ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚Kafkaé»˜è®¤ä¸ºä½ æä¾›äº†ä¸¤ç§åˆ†é…ç­–ç•¥ï¼šrangeå’Œround-robinã€‚ç”±äºè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸å†è¯¦ç»†å±•å¼€äº†ï¼Œä½ åªéœ€è¦è®°ä½ä½ å¯ä»¥è¦†ç›–consumerçš„å‚æ•°ï¼špartition.assignment.strategyæ¥å®ç°è‡ªå·±åˆ†é…ç­–ç•¥å°±å¥½äº†ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4.10 consumer groupçŠ¶æ€æœº\")])]),r._v(\" \"),e(\"p\",[r._v(\"å’Œå¾ˆå¤škafkaç»„ä»¶ä¸€æ ·ï¼Œgroupä¹Ÿåšäº†ä¸ªçŠ¶æ€æœºæ¥è¡¨æ˜ç»„çŠ¶æ€çš„æµè½¬ã€‚coordinatoræ ¹æ®è¿™ä¸ªçŠ¶æ€æœºä¼šå¯¹consumer groupåšä¸åŒçš„å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º(å®Œå…¨æ˜¯æ ¹æ®ä»£ç æ³¨é‡Šæ‰‹åŠ¨ç”»çš„ï¼Œå¤šè§è°…å§)\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161226180046945-1657832046.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"ç®€å•è¯´æ˜ä¸‹å›¾ä¸­çš„å„ä¸ªçŠ¶æ€ï¼š\")]),r._v(\" \"),e(\"ul\",[e(\"li\",[r._v(\"Deadï¼šç»„å†…å·²ç»æ²¡æœ‰ä»»ä½•æˆå‘˜çš„æœ€ç»ˆçŠ¶æ€ï¼Œç»„çš„å…ƒæ•°æ®ä¹Ÿå·²ç»è¢«coordinatorç§»é™¤äº†ã€‚è¿™ç§çŠ¶æ€å“åº”å„ç§è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªresponseï¼š UNKNOWN_MEMBER_ID\")]),r._v(\" \"),e(\"li\",[r._v(\"Emptyï¼šç»„å†…æ— æˆå‘˜ï¼Œä½†æ˜¯ä½ç§»ä¿¡æ¯è¿˜æ²¡æœ‰è¿‡æœŸã€‚è¿™ç§çŠ¶æ€åªèƒ½å“åº”JoinGroupè¯·æ±‚\")]),r._v(\" \"),e(\"li\",[r._v(\"PreparingRebalanceï¼šç»„å‡†å¤‡å¼€å¯æ–°çš„rebalanceï¼Œç­‰å¾…æˆå‘˜åŠ å…¥\")]),r._v(\" \"),e(\"li\",[r._v(\"AwaitingSyncï¼šæ­£åœ¨ç­‰å¾…leader consumerå°†åˆ†é…æ–¹æ¡ˆä¼ ç»™å„ä¸ªæˆå‘˜\")]),r._v(\" \"),e(\"li\",[r._v(\"Stableï¼šrebalanceå®Œæˆï¼å¯ä»¥å¼€å§‹æ¶ˆè´¹äº†~\")])]),r._v(\" \"),e(\"p\",[r._v(\"è‡³äºå„ä¸ªçŠ¶æ€ä¹‹é—´çš„æµç¨‹æ¡ä»¶ä»¥åŠactionï¼Œè¿™é‡Œå°±ä¸å…·ä½“å±•å¼€äº†ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"ä¸‰ã€rebalanceåœºæ™¯å‰–æ\")])]),r._v(\" \"),e(\"p\",[r._v(\"ä¸Šé¢è¯¦ç»†é˜è¿°äº†consumer groupæ˜¯å¦‚ä½•æ‰§è¡Œrebalanceçš„ï¼Œå¯èƒ½ä¾ç„¶æœ‰äº›äº‘é‡Œé›¾é‡Œã€‚è¿™éƒ¨åˆ†å¯¹å…¶ä¸­çš„ä¸‰ä¸ªé‡è¦çš„åœºæ™¯åšè¯¦å°½çš„æ—¶åºå±•å¼€ï¼Œè¿›ä¸€æ­¥åŠ æ·±å¯¹äºconsumer groupå†…éƒ¨åŸç†çš„ç†è§£ã€‚ç”±äºå›¾æ¯”è¾ƒç›´è§‚ï¼Œæ‰€æœ‰çš„æè¿°éƒ½å°†ä»¥å›¾çš„æ–¹å¼ç»™å‡ºï¼Œä¸åšè¿‡å¤šçš„æ–‡å­—åŒ–æè¿°äº†ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"1 æ–°æˆå‘˜åŠ å…¥ç»„(member join)\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[e(\"img\",{attrs:{src:\"https://images2017.cnblogs.com/blog/735367/201801/735367-20180122172838209-863721577.png\",alt:\"img\"}})])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"2 ç»„æˆå‘˜å´©æºƒ(member failure)\")])]),r._v(\" \"),e(\"p\",[r._v(\"å‰é¢è¯´è¿‡äº†ï¼Œç»„æˆå‘˜å´©æºƒå’Œç»„æˆå‘˜ä¸»åŠ¨ç¦»å¼€æ˜¯ä¸¤ä¸ªä¸åŒçš„åœºæ™¯ã€‚å› ä¸ºåœ¨å´©æºƒæ—¶æˆå‘˜å¹¶ä¸ä¼šä¸»åŠ¨åœ°å‘ŠçŸ¥coordinatoræ­¤äº‹ï¼Œcoordinatoræœ‰å¯èƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„session.timeoutå‘¨æœŸæ‰èƒ½æ£€æµ‹åˆ°è¿™ç§å´©æºƒï¼Œè¿™å¿…ç„¶ä¼šé€ æˆconsumerçš„æ»åã€‚å¯ä»¥è¯´ç¦»å¼€ç»„æ˜¯ä¸»åŠ¨åœ°å‘èµ·rebalanceï¼›è€Œå´©æºƒåˆ™æ˜¯è¢«åŠ¨åœ°å‘èµ·rebalanceã€‚okayï¼Œç›´æ¥ä¸Šå›¾ï¼š\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2017.cnblogs.com/blog/735367/201801/735367-20180122172921209-2006292699.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"3 ç»„æˆå‘˜ä¸»åŠ¨ç¦»ç»„ï¼ˆmember leave group)\")])]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2017.cnblogs.com/blog/735367/201801/735367-20180122172958600-838820663.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"4 æäº¤ä½ç§»(member commit offset)\")])]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2017.cnblogs.com/blog/735367/201801/735367-20180122173024959-506110104.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"æ€»ç»“ä¸€ä¸‹ï¼Œæœ¬æ–‡ç€é‡è®¨è®ºäº†ä¸€ä¸‹æ–°ç‰ˆæœ¬çš„consumer groupçš„å†…éƒ¨è®¾è®¡åŸç†ï¼Œç‰¹åˆ«æ˜¯consumer groupä¸coordinatorä¹‹é—´çš„äº¤äº’è¿‡ç¨‹ï¼Œå¸Œæœ›å¯¹å„ä½æœ‰æ‰€å¸®åŠ©\")]),r._v(\" \"),e(\"blockquote\",[e(\"p\",[r._v(\"https://www.cnblogs.com/huxi2b/p/6124937.html\")]),r._v(\" \"),e(\"p\",[r._v(\"https://www.cnblogs.com/huxi2b/p/7089854.html\")])]),r._v(\" \"),e(\"p\",[r._v(\"Kafka 0.9ç‰ˆæœ¬å¼€å§‹æ¨å‡ºäº†Javaç‰ˆæœ¬çš„consumerï¼Œä¼˜åŒ–äº†coordinatorçš„è®¾è®¡ä»¥åŠæ‘†è„±äº†å¯¹zookeeperçš„ä¾èµ–ã€‚ç¤¾åŒºæœ€è¿‘ä¹Ÿåœ¨æ¢è®¨æ­£å¼ç”¨è¿™å¥—consumer APIæ›¿æ¢Scalaç‰ˆæœ¬çš„consumerçš„è®¡åˆ’ã€‚é‰´äºç›®å‰è¿™æ–¹é¢çš„èµ„æ–™å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæœ¬æ–‡å°†å°è¯•ç»™å‡ºä¸€ä¸ªåˆ©ç”¨KafkaConsumerç¼–å†™çš„å¤šçº¿ç¨‹æ¶ˆè´¹è€…å®ä¾‹ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"è¿™å¥—APIæœ€é‡è¦çš„å…¥å£å°±æ˜¯KafkaConsumer(o.a.k.clients.consumer.KafkaConsumer)ï¼Œæ™®é€šçš„å•çº¿ç¨‹ä½¿ç”¨æ–¹æ³•å®˜ç½‘APIå·²æœ‰ä»‹ç»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç›´å¥”ä¸»é¢˜â€”â€”è®¨è®ºä¸€ä¸‹å¦‚ä½•åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼æ¥ä½¿ç”¨KafkaConsumerã€‚KafkaConsumerå’ŒKafkaProducerä¸åŒï¼Œåè€…æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æˆ‘ä»¬é¼“åŠ±ç”¨æˆ·åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ä¸€ä¸ªKafkaProducerå®ä¾‹ï¼Œè¿™æ ·é€šå¸¸éƒ½è¦æ¯”æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªKafkaProducerå®ä¾‹æ•ˆç‡è¦é«˜ã€‚ä½†å¯¹äºKafkaConsumerè€Œè¨€ï¼Œå®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å®ç°å¤šçº¿ç¨‹æ—¶é€šå¸¸ç”±ä¸¤ç§å®ç°æ–¹æ³•ï¼š\")]),r._v(\" \"),e(\"p\",[r._v(\"1 æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªKafkaConsumer\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161202105906443-1609157006.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"2 ç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªKafkaConsumerï¼ŒåŒæ—¶ç»´æŠ¤å¤šä¸ªäº‹ä»¶å¤„ç†çº¿ç¨‹(worker thread)\")]),r._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:\"https://images2015.cnblogs.com/blog/735367/201612/735367-20161202110008787-550483601.png\",alt:\"img\"}})]),r._v(\" \"),e(\"p\",[r._v(\"å½“ç„¶ï¼Œè¿™ç§æ–¹æ³•è¿˜å¯ä»¥æœ‰å¤šä¸ªå˜ç§ï¼šæ¯”å¦‚æ¯ä¸ªworkerçº¿ç¨‹æœ‰è‡ªå·±çš„å¤„ç†é˜Ÿåˆ—ã€‚consumeræ ¹æ®æŸç§è§„åˆ™æˆ–é€»è¾‘å°†æ¶ˆæ¯æ”¾å…¥ä¸åŒçš„é˜Ÿåˆ—ã€‚ä¸è¿‡æ€»ä½“æ€æƒ³è¿˜æ˜¯ç›¸åŒçš„ï¼Œæ•…è¿™é‡Œä¸åšè¿‡å¤šå±•å¼€è®¨è®ºäº†ã€‚\")]),r._v(\" \"),e(\"p\",[r._v(\"ä¸‹è¡¨æ€»ç»“äº†ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼š\")]),r._v(\" \"),e(\"table\",[e(\"thead\",[e(\"tr\",[e(\"th\"),r._v(\" \"),e(\"th\",[r._v(\"ä¼˜ç‚¹\")]),r._v(\" \"),e(\"th\",[r._v(\"ç¼ºç‚¹\")])])]),r._v(\" \"),e(\"tbody\",[e(\"tr\",[e(\"td\",[r._v(\"æ–¹æ³•1(æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªKafkaConsumer)\")]),r._v(\" \"),e(\"td\",[r._v(\"æ–¹ä¾¿å®ç° é€Ÿåº¦è¾ƒå¿«ï¼Œå› ä¸ºä¸éœ€è¦ä»»ä½•çº¿ç¨‹é—´äº¤äº’ æ˜“äºç»´æŠ¤åˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåº\")]),r._v(\" \"),e(\"td\",[r._v(\"æ›´å¤šçš„TCPè¿æ¥å¼€é”€(æ¯ä¸ªçº¿ç¨‹éƒ½è¦ç»´æŠ¤è‹¥å¹²ä¸ªTCPè¿æ¥) consumeræ•°å—é™äºtopicåˆ†åŒºæ•°ï¼Œæ‰©å±•æ€§å·® é¢‘ç¹è¯·æ±‚å¯¼è‡´ååé‡ä¸‹é™ çº¿ç¨‹è‡ªå·±å¤„ç†æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯å¯èƒ½ä¼šå¯¼è‡´è¶…æ—¶ï¼Œä»è€Œé€ æˆrebalance\")])]),r._v(\" \"),e(\"tr\",[e(\"td\",[r._v(\"æ–¹æ³•2 (å•ä¸ª(æˆ–å¤šä¸ª)consumerï¼Œå¤šä¸ªworkerçº¿ç¨‹)\")]),r._v(\" \"),e(\"td\",[r._v(\"å¯ç‹¬ç«‹æ‰©å±•consumeræ•°å’Œworkeræ•°ï¼Œä¼¸ç¼©æ€§å¥½\")]),r._v(\" \"),e(\"td\",[r._v(\"å®ç°éº»çƒ¦é€šå¸¸éš¾äºç»´æŠ¤åˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåºå¤„ç†é“¾è·¯å˜é•¿ï¼Œå¯¼è‡´éš¾ä»¥ä¿è¯æäº¤ä½ç§»çš„è¯­ä¹‰æ­£ç¡®æ€§\")])])])]),r._v(\" \"),e(\"p\",[r._v(\"ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«å®ç°è¿™ä¸¤ç§æ–¹æ³•ã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œä¸‹é¢çš„ä»£ç éƒ½æ˜¯æœ€åŸºæœ¬çš„å®ç°ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å¾ˆå¤šç¼–ç¨‹ç»†èŠ‚ï¼Œæ¯”å¦‚å¦‚ä½•å¤„ç†é”™è¯¯ç­‰ã€‚\")]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"æ–¹æ³•1\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"ConsumerRunnableç±»\")])]),r._v(\" \"),e(\"p\",[r._v(\"[\"),e(\"img\",{attrs:{src:\"https://common.cnblogs.com/images/copycode.gif\",alt:\"å¤åˆ¶ä»£ç \"}}),r._v(\"](javascript:void(0)ğŸ˜‰\")]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(' 1 import org.apache.kafka.clients.consumer.ConsumerRecord;\\n 2 import org.apache.kafka.clients.consumer.ConsumerRecords;\\n 3 import org.apache.kafka.clients.consumer.KafkaConsumer;\\n 4 \\n 5 import java.util.Arrays;\\n 6 import java.util.Properties;\\n 7 \\n 8 public class ConsumerRunnable implements Runnable {\\n 9 \\n10     // æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ç§æœ‰çš„KafkaConsumerå®ä¾‹\\n11     private final KafkaConsumer<String, String> consumer;\\n12 \\n13     public ConsumerRunnable(String brokerList, String groupId, String topic) {\\n14         Properties props = new Properties();\\n15         props.put(\"bootstrap.servers\", brokerList);\\n16         props.put(\"group.id\", groupId);\\n17         props.put(\"enable.auto.commit\", \"true\");        //æœ¬ä¾‹ä½¿ç”¨è‡ªåŠ¨æäº¤ä½ç§»\\n18         props.put(\"auto.commit.interval.ms\", \"1000\");\\n19         props.put(\"session.timeout.ms\", \"30000\");\\n20         props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\\n21         props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\\n22         this.consumer = new KafkaConsumer<>(props);\\n23         consumer.subscribe(Arrays.asList(topic));   // æœ¬ä¾‹ä½¿ç”¨åˆ†åŒºå‰¯æœ¬è‡ªåŠ¨åˆ†é…ç­–ç•¥\\n24     }\\n25 \\n26     @Override\\n27     public void run() {\\n28         while (true) {\\n29             ConsumerRecords<String, String> records = consumer.poll(200);   // æœ¬ä¾‹ä½¿ç”¨200msä½œä¸ºè·å–è¶…æ—¶æ—¶é—´\\n30             for (ConsumerRecord<String, String> record : records) {\\n31                 // è¿™é‡Œé¢å†™å¤„ç†æ¶ˆæ¯çš„é€»è¾‘ï¼Œæœ¬ä¾‹ä¸­åªæ˜¯ç®€å•åœ°æ‰“å°æ¶ˆæ¯\\n32                 System.out.println(Thread.currentThread().getName() + \" consumed \" + record.partition() +\\n33                         \"th message with offset: \" + record.offset());\\n34             }\\n35         }\\n36     }\\n37 }\\n')])])]),e(\"p\",[e(\"strong\",[r._v(\"ConsumerGroupç±»\")])]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(\" 1 package com.my.kafka.test;\\n 2 \\n 3 import java.util.ArrayList;\\n 4 import java.util.List;\\n 5 \\n 6 public class ConsumerGroup {\\n 7 \\n 8     private List<ConsumerRunnable> consumers;\\n 9 \\n10     public ConsumerGroup(int consumerNum, String groupId, String topic, String brokerList) {\\n11         consumers = new ArrayList<>(consumerNum);\\n12         for (int i = 0; i < consumerNum; ++i) {\\n13             ConsumerRunnable consumerThread = new ConsumerRunnable(brokerList, groupId, topic);\\n14             consumers.add(consumerThread);\\n15         }\\n16     }\\n17 \\n18     public void execute() {\\n19         for (ConsumerRunnable task : consumers) {\\n20             new Thread(task).start();\\n21         }\\n22     }\\n23 }\\n\")])])]),e(\"p\",[e(\"strong\",[r._v(\"ConsumerMainç±»\")])]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(' 1 public class ConsumerMain {\\n 2 \\n 3     public static void main(String[] args) {\\n 4         String brokerList = \"localhost:9092\";\\n 5         String groupId = \"testGroup1\";\\n 6         String topic = \"test-topic\";\\n 7         int consumerNum = 3;\\n 8 \\n 9         ConsumerGroup consumerGroup = new ConsumerGroup(consumerNum, groupId, topic, brokerList);\\n10         consumerGroup.execute();\\n11     }\\n12 }\\n')])])]),e(\"p\",[e(\"strong\",[r._v(\"æ–¹æ³•2\")])]),r._v(\" \"),e(\"p\",[e(\"strong\",[r._v(\"Workerç±»\")])]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(' 1 import org.apache.kafka.clients.consumer.ConsumerRecord;\\n 2 \\n 3 public class Worker implements Runnable {\\n 4 \\n 5     private ConsumerRecord<String, String> consumerRecord;\\n 6 \\n 7     public Worker(ConsumerRecord record) {\\n 8         this.consumerRecord = record;\\n 9     }\\n10 \\n11     @Override\\n12     public void run() {\\n13         // è¿™é‡Œå†™ä½ çš„æ¶ˆæ¯å¤„ç†é€»è¾‘ï¼Œæœ¬ä¾‹ä¸­åªæ˜¯ç®€å•åœ°æ‰“å°æ¶ˆæ¯\\n14         System.out.println(Thread.currentThread().getName() + \" consumed \" + consumerRecord.partition()\\n15             + \"th message with offset: \" + consumerRecord.offset());\\n16     }\\n17 }\\n')])])]),e(\"p\",[e(\"strong\",[r._v(\"ConsumerHandlerç±»\")])]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(' 1 import org.apache.kafka.clients.consumer.ConsumerRecord;\\n 2 import org.apache.kafka.clients.consumer.ConsumerRecords;\\n 3 import org.apache.kafka.clients.consumer.KafkaConsumer;\\n 4 \\n 5 import java.util.Arrays;\\n 6 import java.util.Properties;\\n 7 import java.util.concurrent.ArrayBlockingQueue;\\n 8 import java.util.concurrent.ExecutorService;\\n 9 import java.util.concurrent.ThreadPoolExecutor;\\n10 import java.util.concurrent.TimeUnit;\\n11 \\n12 public class ConsumerHandler {\\n13 \\n14     // æœ¬ä¾‹ä¸­ä½¿ç”¨ä¸€ä¸ªconsumerå°†æ¶ˆæ¯æ”¾å…¥åç«¯é˜Ÿåˆ—ï¼Œä½ å½“ç„¶å¯ä»¥ä½¿ç”¨å‰ä¸€ç§æ–¹æ³•ä¸­çš„å¤šå®ä¾‹æŒ‰ç…§æŸå¼ è§„åˆ™åŒæ—¶æŠŠæ¶ˆæ¯æ”¾å…¥åç«¯é˜Ÿåˆ—\\n15     private final KafkaConsumer<String, String> consumer;\\n16     private ExecutorService executors;\\n17 \\n18     public ConsumerHandler(String brokerList, String groupId, String topic) {\\n19         Properties props = new Properties();\\n20         props.put(\"bootstrap.servers\", brokerList);\\n21         props.put(\"group.id\", groupId);\\n22         props.put(\"enable.auto.commit\", \"true\");\\n23         props.put(\"auto.commit.interval.ms\", \"1000\");\\n24         props.put(\"session.timeout.ms\", \"30000\");\\n25         props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\\n26         props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\");\\n27         consumer = new KafkaConsumer<>(props);\\n28         consumer.subscribe(Arrays.asList(topic));\\n29     }\\n30 \\n31     public void execute(int workerNum) {\\n32         executors = new ThreadPoolExecutor(workerNum, workerNum, 0L, TimeUnit.MILLISECONDS,\\n33                 new ArrayBlockingQueue<>(1000), new ThreadPoolExecutor.CallerRunsPolicy());\\n34 \\n35         while (true) {\\n36             ConsumerRecords<String, String> records = consumer.poll(200);\\n37             for (final ConsumerRecord record : records) {\\n38                 executors.submit(new Worker(record));\\n39             }\\n40         }\\n41     }\\n42 \\n43     public void shutdown() {\\n44         if (consumer != null) {\\n45             consumer.close();\\n46         }\\n47         if (executors != null) {\\n48             executors.shutdown();\\n49         }\\n50         try {\\n51             if (!executors.awaitTermination(10, TimeUnit.SECONDS)) {\\n52                 System.out.println(\"Timeout.... Ignore for this case\");\\n53             }\\n54         } catch (InterruptedException ignored) {\\n55             System.out.println(\"Other thread interrupted this shutdown, ignore for this case.\");\\n56             Thread.currentThread().interrupt();\\n57         }\\n58     }\\n59 \\n60 }\\n')])])]),e(\"p\",[e(\"strong\",[r._v(\"Mainç±»\")])]),r._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[r._v(' 1 public class Main {\\n 2 \\n 3     public static void main(String[] args) {\\n 4         String brokerList = \"localhost:9092,localhost:9093,localhost:9094\";\\n 5         String groupId = \"group2\";\\n 6         String topic = \"test-topic\";\\n 7         int workerNum = 5;\\n 8 \\n 9         ConsumerHandler consumers = new ConsumerHandler(brokerList, groupId, topic);\\n10         consumers.execute(workerNum);\\n11         try {\\n12             Thread.sleep(1000000);\\n13         } catch (InterruptedException ignored) {}\\n14         consumers.shutdown();\\n15     }\\n16 }\\n')])])]),e(\"p\",[r._v(\"æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ä¸¤ç§æ–¹æ³•æˆ–æ˜¯æ¨¡å‹éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®è‡ªå·±å®é™…çš„ä¸šåŠ¡ç‰¹ç‚¹æ¥é€‰å–å¯¹åº”çš„æ–¹æ³•ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ¯”è¾ƒæ¨å´‡ç¬¬äºŒç§æ–¹æ³•ä»¥åŠèƒŒåçš„æ€æƒ³ï¼Œå³ä¸è¦å°†å¾ˆé‡çš„å¤„ç†é€»è¾‘æ”¾å…¥æ¶ˆè´¹è€…çš„ä»£ç ä¸­ï¼Œå¾ˆå¤šKafka consumerä½¿ç”¨è€…ç¢°åˆ°çš„å„ç§rebalanceè¶…æ—¶ã€coordinatoré‡æ–°é€‰ä¸¾ã€å¿ƒè·³æ— æ³•ç»´æŒç­‰é—®é¢˜éƒ½æ¥æºäºæ­¤ã€‚\")])])}),[],!1,null,null,null);o.default=t.exports}}]);","extractedComments":[]}