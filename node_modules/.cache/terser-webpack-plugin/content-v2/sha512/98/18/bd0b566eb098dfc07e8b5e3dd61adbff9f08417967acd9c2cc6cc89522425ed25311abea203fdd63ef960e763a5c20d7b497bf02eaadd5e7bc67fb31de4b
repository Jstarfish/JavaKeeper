{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{578:function(_,t,p){\"use strict\";p.r(t);var a=p(6),v=Object(a.a)({},(function(){var _=this,t=_.$createElement,p=_._self._c||t;return p(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":_.$parent.slotKey}},[p(\"h2\",{attrs:{id:\"推荐系统之用户画像基础-大数据时代\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#推荐系统之用户画像基础-大数据时代\"}},[_._v(\"#\")]),_._v(\" 推荐系统之用户画像基础——大数据时代\")]),_._v(\" \"),p(\"blockquote\",[p(\"p\",[_._v(\"在互联网步入大数据时代后，用户行为给企业的产品和服务带来了一系列的改变和重塑，其中最大的变化在于，用户的一切行为在企业面前是可“追溯”“分析”的。企业内保存了大量的原始数据和各种业务数据，这是企业经营活动的真实记录，如何更加有效地利用这些数据进行分析和评估，成为企业基于更大数据量背景的问题所在。随着大数据技术的深入研究与应用，企业的关注点日益聚焦在如何利用大数据来为精细化运营和精准营销服务，而要做精细化运营，首先要建立本企业的用户画像。\")])]),_._v(\" \"),p(\"h2\",{attrs:{id:\"画像简介\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#画像简介\"}},[_._v(\"#\")]),_._v(\" 画像简介\")]),_._v(\" \"),p(\"p\",[_._v(\"用户画像，即用户信息标签化，通过收集用户的社会属性、消费习惯、偏好特征等各个维度的数据，进而对用户或者产品特征属性进行刻画，并对这些特征进行分析、统计，挖掘潜在价值信息，从而抽象出用户的信息全貌，如图1-1所示。用户画像可看作企业应用大数据的根基，是定向广告投放与个性化推荐的前置条件，为数据驱动运营奠定了基础。由此看来，如何从海量数据中挖掘出有价值的信息越发重要。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpTpUfVXDSfibTbvS7tCuiappvNj35twj1ZibMCx0W6dfcFibFVyCSRLVicQg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-1　某用户标签化\"}})]),_._v(\" \"),p(\"p\",[_._v(\"大数据已经兴起多年，其对于互联网公司的应用来说已经如水、电、空气对于人们的生活一样，成为不可或缺的重要组成部分。从基础设施建设到应用层面，主要有数据平台搭建及运维管理、数据仓库开发、上层应用的统计分析、报表生成及可视化、用户画像建模、个性化推荐与精准营销等应用方向。\")]),_._v(\" \"),p(\"p\",[_._v(\"很多公司在大数据基础建设上投入很多，也做了不少报表，但业务部门觉得大数据和传统报表没什么区别，也没能体会大数据对业务有什么帮助和价值，究其原因，其实是“数据静止在数据仓库，是死的”。\")]),_._v(\" \"),p(\"p\",[_._v(\"而用户画像可以帮助大数据“走出”数据仓库，针对用户进行个性化推荐、精准营销、个性化服务等多样化服务，是大数据落地应用的一个重要方向。数据应用体系的层级划分如图1-2所示。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpaPuUNSibZqNyWibpYpNG1Xp40zKZsZEd9mzEHezPfticyG1nR9YgKXJzA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-2　数据应用体系的层级划分\"}})]),_._v(\" \"),p(\"h3\",{attrs:{id:\"标签类型\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#标签类型\"}},[_._v(\"#\")]),_._v(\" 标签类型：\")]),_._v(\" \"),p(\"p\",[_._v(\"用户画像建模其实就是对用户“打标签”，从对用户打标签的方式来看，一般分为3种类型（如图1-3所示）：①统计类标签；②规则类标签；③机器学习挖掘类标签。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp4TQDdvTUze7YPI0L5gh1CB6jlUfyurzePUGpFqfzq0QSN1ubkibsTUg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-3　标签类型\"}})]),_._v(\" \"),p(\"p\",[_._v(\"下面我们介绍这3种类型的标签的区别：\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"① 统计类标签\")])]),_._v(\" \"),p(\"p\",[_._v(\"这类标签是最为基础也最为常见的标签类型，例如，对于某个用户来说，其性别、年龄、城市、星座、近7日活跃时长、近7日活跃天数、近7日活跃次数等字段可以从用户注册数据、用户访问、消费数据中统计得出。该类标签构成了用户画像的基础。\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"② 规则类标签\")])]),_._v(\" \"),p(\"p\",[_._v(\"该类标签基于用户行为及确定的规则产生。例如，对平台上“消费活跃”用户这一口径的定义为“近30天交易次数≥2”。在实际开发画像的过程中，由于运营人员对业务更为熟悉，而数据人员对数据的结构、分布、特征更为熟悉，因此规则类标签的规则由运营人员和数据人员共同协商确定；\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"③ 机器学习挖掘类标签\")])]),_._v(\" \"),p(\"p\",[_._v(\"该类标签通过机器学习挖掘产生，用于对用户的某些属性或某些行为进行预测判断。例如，根据一个用户的行为习惯判断该用户是男性还是女性、根据一个用户的消费习惯判断其对某商品的偏好程度。该类标签需要通过算法挖掘产生。\")]),_._v(\" \"),p(\"p\",[_._v(\"在项目工程实践中，一般统计类和规则类的标签即可以满足应用需求，在开发中占有较大比例。机器学习挖掘类标签多用于预测场景，如判断用户性别、用户购买商品偏好、用户流失意向等。一般地，机器学习标签开发周期较长，开发成本较高，因此其开发所占比例较小。\")]),_._v(\" \"),p(\"h2\",{attrs:{id:\"数据架构\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据架构\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"数据架构\")])]),_._v(\" \"),p(\"p\",[_._v(\"在整个工程化方案中，系统依赖的基础设施包括Spark、Hive、HBase、Airflow、MySQL、Redis、Elasticsearch。除去基础设施外，系统主体还包括Spark Streaming、ETL、产品端3个重要组成部分。图1-4所示是用户画像数仓架构图，下面对其进行详细介绍。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp2TKMOXBhDvHAsk8MSrxduyprWjDvTEZee8rN8Xj4CxAdFq814k0kAg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-4　用户画像数仓架构\"}})]),_._v(\" \"),p(\"p\",[_._v(\"图1-4下方虚线框中为常见的数据仓库ETL加工流程，也就是将每日的业务数据、日志数据、埋点数据等经过ETL过程，加工到数据仓库对应的ODS层、DW层、DM层中。\")]),_._v(\" \"),p(\"p\",[_._v(\"中间的虚线框即为用户画像建模的主要环节，用户画像不是产生数据的源头，而是对基于数据仓库ODS层、DW层、DM层中与用户相关数据的二次建模加工。在ETL过程中将用户标签计算结果写入Hive，由于不同数据库有不同的应用场景，后续需要进一步将数据同步到MySQL、HBase、Elasticsearch等数据库中。\")]),_._v(\" \"),p(\"ul\",[p(\"li\",[_._v(\"Hive：存储用户标签计算结果、用户人群计算结果、用户特征库计算结果。\")]),_._v(\" \"),p(\"li\",[_._v(\"MySQL：存储标签元数据，监控相关数据，导出到业务系统的数据。\")]),_._v(\" \"),p(\"li\",[_._v(\"HBase：存储线上接口实时调用类数据。\")]),_._v(\" \"),p(\"li\",[_._v(\"Elasticsearch：支持海量数据的实时查询分析，用于存储用户人群计算、用户群透视分析所需的用户标签数据（由于用户人群计算、用户群透视分析的条件转化成的SQL语句多条件嵌套较为复杂，使用Impala执行也需花费大量时间）。\")])]),_._v(\" \"),p(\"p\",[_._v(\"用户标签数据在Hive中加工完成后，部分标签通过Sqoop同步到MySQL数据库，提供用于BI报表展示的数据、多维透视分析数据、圈人服务数据；另一部分标签同步到HBase数据库用于产品的线上个性化推荐。\")]),_._v(\" \"),p(\"h2\",{attrs:{id:\"主要覆盖模块\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#主要覆盖模块\"}},[_._v(\"#\")]),_._v(\" 主要覆盖模块\")]),_._v(\" \"),p(\"p\",[_._v(\"搭建一套用户画像方案整体来说需要考虑8个模块的建设，如图1-5所示。\")]),_._v(\" \"),p(\"ul\",[p(\"li\",[_._v(\"用户画像基础：需要了解、明确用户画像是什么，包含哪些模块，数据仓库架构是什么样子，开发流程，表结构设计，ETL设计等。这些都是框架，大方向的规划，只有明确了方向后续才能做好项目的排期和人员投入预算。这对于评估每个开发阶段重要指标和关键产出非常重要，重点可看1.4节。\")]),_._v(\" \"),p(\"li\",[_._v(\"数据指标体系：根据业务线梳理，包括用户属性、用户行为、用户消费、风险控制等维度的指标体系。\")]),_._v(\" \"),p(\"li\",[_._v(\"标签数据存储：标签相关数据可存储在Hive、MySQL、HBase、Elasticsearch等数据库中，不同存储方式适用于不同的应用场景。\")]),_._v(\" \"),p(\"li\",[_._v(\"标签数据开发：用户画像工程化的重点模块，包含统计类、规则类、挖掘类、流式计算类标签的开发，以及人群计算功能的开发，打通画像数据和各业务系统之间的通路，提供接口服务等开发内容。\")])]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp4NkIeMicco9SeWrz14feew70WcEVREcicckVTrJos40icCIy9KshQK87Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-5　用户画像主要覆盖模块\"}})]),_._v(\" \"),p(\"ul\",[p(\"li\",[_._v(\"开发性能调优：标签加工、人群计算等脚本上线调度后，为了缩短调度时间、保障数据的稳定性等，需要对开发的脚本进行迭代重构、调优。\")]),_._v(\" \"),p(\"li\",[_._v(\"作业流程调度：标签加工、人群计算、同步数据到业务系统、数据监控预警等脚本开发完成后，需要调度工具把整套流程调度起来。本书讲解了Airflow这款开源ETL工具在调度画像相关任务脚本上的应用。\")]),_._v(\" \"),p(\"li\",[_._v(\"用户画像产品化：为了能让用户数据更好地服务于业务方，需要以产品化的形态应用在业务上。产品化的模块主要包括标签视图、用户标签查询、用户分群、透视分析等。\")]),_._v(\" \"),p(\"li\",[_._v(\"用户画像应用：画像的应用场景包括用户特征分析、短信、邮件、站内信、Push消息的精准推送、客服针对用户的不同话术、针对高价值用户的极速退货退款等VIP服务应用。\")])]),_._v(\" \"),p(\"h2\",{attrs:{id:\"开发阶段流程\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#开发阶段流程\"}},[_._v(\"#\")]),_._v(\" 开发阶段流程\")]),_._v(\" \"),p(\"p\",[_._v(\"本节主要介绍画像系统开发上线的流程以及各阶段的关键产出。\")]),_._v(\" \"),p(\"h3\",{attrs:{id:\"_1-开发上线流程\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-开发上线流程\"}},[_._v(\"#\")]),_._v(\" 1. 开发上线流程\")]),_._v(\" \"),p(\"p\",[_._v(\"用户画像建设项目流程，如图1-6所示。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpcfpqNsE9sT17YPdxlia8ibFpQian868ianT5aianlqUZrPChknIiaLJ7OvNg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"img\"}})]),_._v(\" \"),p(\"p\",[_._v(\"图1-6　用户画像建设项目流程\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第一阶段-目标解读\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第一阶段-目标解读\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"第一阶段：目标解读\")])]),_._v(\" \"),p(\"p\",[_._v(\"在建立用户画像前，首先需要明确用户画像服务于企业的对象，再根据业务方需求，明确未来产品建设目标和用户画像分析之后的预期效果。\")]),_._v(\" \"),p(\"p\",[_._v(\"一般而言，用户画像的服务对象包括运营人员和数据分析人员。不同业务方对用户画像的需求有不同的侧重点，就运营人员来说，他们需要分析用户的特征、定位用户行为偏好，做商品或内容的个性化推送以提高点击转化率，所以画像的侧重点就落在了用户个人行为偏好上；就数据分析人员来说，他们需要分析用户行为特征，做好用户的流失预警工作，还可根据用户的消费偏好做更有针对性的精准营销。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第二阶段-任务分解与需求调研\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第二阶段-任务分解与需求调研\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"第二阶段：任务分解与需求调研\")])]),_._v(\" \"),p(\"p\",[_._v(\"经过第一阶段的需求调研和目标解读，我们已经明确了用户画像的服务对象与应用场景，接下来需要针对服务对象的需求侧重点，结合产品现有业务体系和“数据字典”规约实体和标签之间的关联关系，明确分析维度。就后文将要介绍的案例而言，需要从用户属性画像、用户行为画像、用户偏好画像、用户群体偏好画像等角度去进行业务建模。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第三阶段-需求场景讨论与明确\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第三阶段-需求场景讨论与明确\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"第三阶段：需求场景讨论与明确\")])]),_._v(\" \"),p(\"p\",[_._v(\"在本阶段，数据运营人员需要根据与需求方的沟通结果，输出产品用户画像需求文档，在该文档中明确画像应用场景、最终开发出的标签内容与应用方式，并就该文档与需求方反复沟通并确认无误。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第四阶段-应用场景与数据口径确认\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第四阶段-应用场景与数据口径确认\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"第四阶段：应用场景与数据口径确认\")])]),_._v(\" \"),p(\"p\",[_._v(\"经过第三个阶段明确了需求场景与最终实现的标签维度、标签类型后，数据运营人员需要结合业务与数据仓库中已有的相关表，明确与各业务场景相关的数据口径。在该阶段中，数据运营方需要输出产品用户画像开发文档，该文档需要明确应用场景、标签开发的模型、涉及的数据库与表以及应用实施流程。该文档不需要再与运营方讨论，只需面向数据运营团队内部就开发实施流程达成一致意见即可。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第五阶段-特征选取与模型数据落表\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第五阶段-特征选取与模型数据落表\"}},[_._v(\"#\")]),_._v(\" 第五阶段：特征选取与模型数据落表\")]),_._v(\" \"),p(\"p\",[_._v(\"本阶段中数据分析挖掘人员需要根据前面明确的需求场景进行业务建模，写好HQL逻辑，将相应的模型逻辑写入临时表中，并抽取数据校验是否符合业务场景需求。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第六阶段-线下模型数据验收与测试\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第六阶段-线下模型数据验收与测试\"}},[_._v(\"#\")]),_._v(\" 第六阶段：线下模型数据验收与测试\")]),_._v(\" \"),p(\"p\",[_._v(\"数据仓库团队的人员将相关数据落表后，设置定时调度任务，定期增量更新数据。数据运营人员需要验收数仓加工的HQL逻辑是否符合需求，根据业务需求抽取表中数据查看其是否在合理范围内，如果发现问题要及时反馈给数据仓库人员调整代码逻辑和行为权重的数值。\")]),_._v(\" \"),p(\"h4\",{attrs:{id:\"第七阶段-线上模型发布与效果追踪\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第七阶段-线上模型发布与效果追踪\"}},[_._v(\"#\")]),_._v(\" 第七阶段：线上模型发布与效果追踪\")]),_._v(\" \"),p(\"p\",[_._v(\"经过第六阶段，数据通过验收之后，会通过Git进行版本管理，部署上线。使用Git进行版本管理，上线后通过持续追踪标签应用效果及业务方反馈，调整优化模型及相关权重配置。\")]),_._v(\" \"),p(\"h3\",{attrs:{id:\"_2-各阶段关键产出\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-各阶段关键产出\"}},[_._v(\"#\")]),_._v(\" 2. 各阶段关键产出\")]),_._v(\" \"),p(\"p\",[_._v(\"为保证程序上线的准时性和稳定性，需要规划好各阶段的任务排期和关键产出。画像体系的开发分为几个主要阶段，包括前期指标体系梳理、用户标签开发、ETL调度开发、打通数据服务层、画像产品端开发、面向业务方推广应用、为业务方提供营销策略的解决方案等，如表1-1所示。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp0jJTYd2gzWVpeUGTZDUgd7JYRJaC9RROKXwmBophBXStoJlEfBXI1g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"\"}})]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpAHB1mTebJEYNyyOFm14GLVYTND1JUGgKib84naFia1xAfM6xAHrRFY2Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-1　用户画像项目各阶段关键产出\"}})]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpVUuPIfqyzAubkeHWgcicNyIpfkmVSkibUyQBlibSGKBcBIaCGgnPYs3fw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"img\"}})]),_._v(\" \"),p(\"ul\",[p(\"li\",[_._v(\"标签开发：根据业务需求和应用场景梳理标签指标体系，调研业务上定义的数据口径，确认数据来源，开发相应的标签。标签开发在整个画像项目周期中占有较大比重。\")]),_._v(\" \"),p(\"li\",[_._v(\"ETL调度开发：梳理需要调度的各任务之间的依赖关系，开发调度脚本及调度监控告警脚本，上线调度系统。\")]),_._v(\" \"),p(\"li\",[_._v(\"打通服务层接口：为了让画像数据走出数据仓库，应用到用户身上，需要打通数据仓库和各业务系统的接口。\")]),_._v(\" \"),p(\"li\",[_._v(\"画像产品化：需要产品经理与业务人员、技术开发人员一起对接业务需求点和产品功能实现形式，画产品原型，确定工作排期。Java Web端开发完成后，需要数据开发人员向对应的库表中灌入数据。\")]),_._v(\" \"),p(\"li\",[_._v(\"开发调优：在画像的数据和产品端搭建好架构、能提供稳定服务的基础上，为了让调度任务执行起来更加高效、提供服务更加稳健，需要对标签计算脚本、调度脚本、数据同步脚本等相关计算任务进行重构优化。\")]),_._v(\" \"),p(\"li\",[_._v(\"面向业务方推广应用：用户画像最终的价值产出点是业务方应用画像数据进行用户分析，多渠道触达运营用户，分析ROI，提升用户活跃度或营收。因此，面向业务人员推广画像系统的使用方式、提供针对具体业务场景的解决方案显得尤为重要。在该阶段，相关人员需要撰写画像的使用文档，提供业务支持。\")])]),_._v(\" \"),p(\"h2\",{attrs:{id:\"画像应用的落地\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#画像应用的落地\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"画像应用的落地\")])]),_._v(\" \"),p(\"p\",[_._v(\"用户画像最终的价值还是要落地运行，为业务带来实际价值。这里需要开发标签的数据工程师和需求方相互协作，将标签应用到业务中。否则开发完标签后，数据还是只停留在数据仓库中，没有为业务决策带来积极作用。\")]),_._v(\" \"),p(\"p\",[_._v(\"画像开发过程中，还需要开发人员组织数据分析、运营、客服等团队的人员进行画像应用上的推广。对于数据分析人员来说，可能会关注用户画像开发了哪些表、哪些字段以及字段的口径定义；对运营、客服等业务人员来说，可能更关注用户标签定义的口径，如何在Web端使用画像产品进行分析、圈定用户进行定向营销，以及应用在业务上数据的准确性和及时性。\")]),_._v(\" \"),p(\"p\",[_._v(\"只有业务人员在日常工作中真正应用画像数据、画像产品，才能更好地推动画像标签的迭代优化，带来流量提升和营收增长，产出业绩价值。\")]),_._v(\" \"),p(\"h2\",{attrs:{id:\"某用户画像案例\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#某用户画像案例\"}},[_._v(\"#\")]),_._v(\" 某用户画像案例\")]),_._v(\" \"),p(\"p\",[_._v(\"这里通过一个实践案例来将大家更好地带入实际开发画像、应用画像标签的场景中。本节主要介绍案例背景及相关的元数据，以及开发标签中可以设计的表结构样式。\")]),_._v(\" \"),p(\"p\",[_._v(\"在本案例的开发工作中，基于Spark计算引擎，主要涉及的语言包括HiveQL、Python、Scala、Shell等。\")]),_._v(\" \"),p(\"h3\",{attrs:{id:\"_1-案例背景介绍\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-案例背景介绍\"}},[_._v(\"#\")]),_._v(\" 1. 案例背景介绍\")]),_._v(\" \"),p(\"p\",[_._v(\"某图书电商网站拥有超过千万的网购用户群体，所售各品类图书100余万种。用户在平台上可进行浏览、搜索、收藏、下单、购买等行为。商城的运营需要解决两个问题：一方面在企业产品线逐渐扩张、信息资源过载的背景下，如何在兼顾自身商业目标的同时更好地满足消费者的需求，为用户带来更个性化的购物体验，通过内容的精准推荐，更好地提高用户的点击转化率；另一方面在用户规模不断增长的背景下，运营方考虑建立用户流失预警机制，及时识别将要流失的用户群体，采取运营措施挽回用户。\")]),_._v(\" \"),p(\"p\",[_._v(\"商城自建立以来，数据仓库中积累着大量的业务数据、日志数据及埋点数据。如何充分挖掘沉淀在数据仓库中的数据的价值，有效支持用户画像的建设，成为当前的重要工作。\")]),_._v(\" \"),p(\"h3\",{attrs:{id:\"_2-相关元数据\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-相关元数据\"}},[_._v(\"#\")]),_._v(\" 2. 相关元数据\")]),_._v(\" \"),p(\"p\",[_._v(\"在本案例中，可以获取的数据按其类型分为：业务类数据和用户行为数据。其中业务类数据是指用户在平台上下单、购买、收藏物品、货物配送等与业务相关的数据；用户行为数据是指用户搜索某条信息、访问某个页面、点击某个按钮、提交某个表单等通过操作行为产生（在解析日志的埋点表中）的数据。\")]),_._v(\" \"),p(\"p\",[_._v(\"涉及数据仓库中的表主要包括用户信息表、商品订单表、图书信息表、图书类目表、App端日志表、Web端日志表、商品评论表等。下面就用户画像建模过程中会用到的一些数据表做详细介绍。\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"① 用户信息表\")])]),_._v(\" \"),p(\"p\",[_._v(\"用户信息表（见表1-2）存放有关用户的各种信息，如用户姓名、年龄、性别、电话号码、归属地等信息。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVppfm8eJYIV7hgzbSjl6Q77g2PHIBPA5TksO2icYXH5taogN9iaaZ3908A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-2　用户信息表（dim.user_basic_info）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"② 商品订单表\")])]),_._v(\" \"),p(\"p\",[_._v(\"商品订单表（见表1-3）存放商品订单的各类信息，包括订单编号、用户id、用户姓名、订单生成时间、订单状态等信息。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpRcDWcJic2G9BnuP9e2WwrbeiciblSrvzZQpjArEvUZo8daVs6qorSIAhA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-3　商品订单表（dw.order_info_fact）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"③ 埋点日志表\")])]),_._v(\" \"),p(\"p\",[_._v(\"埋点日志表（见表1-4）存放用户访问App时点击相关控件的打点记录。通过在客户端做埋点，从日志数据中解析出来。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp2aMbDUGibicZJoPQLhs0lm9zBrzicxDSnT28DrxQk0Xia25aAhKjBSicq0w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-4　埋点日志表（ods.page_event_log）\"}})]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp7XEFMHAaqB08qH21WVID1p4gQfuicKG0GyFpx2z3HHLLXwla0C6PboA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"img\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"④ 访问日志表\")])]),_._v(\" \"),p(\"p\",[_._v(\"访问日志表（见表1-5）存放用户访问App的相关信息及用户的LBS相关信息，通过在客户端埋点，从日志数据中解析出来。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpfqsB5PI3DVZXSib7MPuqsuQDxXOykrMLhc5S6s9PMfzL10vBLgM2jhw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-5　访问日志表（ods.page_view_log）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"⑤ 商品评论表\")])]),_._v(\" \"),p(\"p\",[_._v(\"商品评论表（见表1-6）存放用户对商品的评论信息。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpiawexfHaricV4A8fib6rhLSReYmp2ibqpaFK6O2CZLiaiagiaxC1gQm4LaSzg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-6　商品评论表（dw.book_comment）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"⑥ 搜索日志表\")])]),_._v(\" \"),p(\"p\",[_._v(\"搜索日志表（见表1-7）存放用户在App端搜索相关的日志数据。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpIdInicOXMTwLuEY8zuzuRiclvCUiaibg7iaFLQFZ73Lxv80FuEtibEK71eFg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-7　搜索日志表（dw.app_search_log）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"⑦ 用户收藏表\")])]),_._v(\" \"),p(\"p\",[_._v(\"用户收藏表（见表1-8）记录用户收藏图书的数据。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVp9mNAPicfIDmabvYSdgh0nw8QUpib3PnemxibIPeHdLnSPyQdHjibPekP9A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-8　用户收藏表（dw.book_collection_df）\"}})]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"⑧ 购物车信息表\")])]),_._v(\" \"),p(\"p\",[_._v(\"购物车信息表（见表1-9）记录用户将图书加入购物车的数据。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpscGQ28EKumicicbo81WaavCCskjkZyEdAurwx8ck3TvahH3cLIXGuCLw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-9　购物车信息表（dw.shopping_cart_df）\"}})]),_._v(\" \"),p(\"h3\",{attrs:{id:\"_3-画像表结构设计\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-画像表结构设计\"}},[_._v(\"#\")]),_._v(\" 3. 画像表结构设计\")]),_._v(\" \"),p(\"p\",[_._v(\"表结构设计也是画像开发过程中需要解决的一个重要问题。\")]),_._v(\" \"),p(\"p\",[_._v(\"表结构设计的重点是要考虑存储哪些信息、如何存储（数据分区）、如何应用（如何抽取标签）这3个方面的问题。\")]),_._v(\" \"),p(\"p\",[_._v(\"不同业务背景有不同的设计方式，这里提供两种设计思路：一是每日全量数据的表结构；二是每日增量数据的表结构。\")]),_._v(\" \"),p(\"p\",[_._v(\"Hive需要对输入进行全盘扫描来满足查询条件，通过使用分区可以优化查询。对于用户标签这种日加工数据，随着时间的推移，分区数量的变动也是均匀的。\")]),_._v(\" \"),p(\"p\",[_._v(\"每日全量数据，即该表的日期分区中记录着截止到当天的全量用户数据。例如，“select  count(*)  from userprofile  where data='20180701'”这条语句查询的是userprofile表截止到2018年7月1日的全量用户数据。日全量数据的优势是方便查询，缺点是不便于探查更细粒度的用户行为。\")]),_._v(\" \"),p(\"p\",[_._v(\"每日增量数据，即该表的日期分区中记录着当日的用户行为数据。例如，同样是“select count(*) from userprofile where data='20180701'”，这条语句查询的是userprofile表在2018年7月1日记录的当日用户行为数据。日增量数据可视为ODS层的用户行为画像，在应用时还需要基于该增量数据做进一步的建模加工。\")]),_._v(\" \"),p(\"p\",[_._v(\"下面详细介绍这两种表结构的设计方法。\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"① 日全量数据\")])]),_._v(\" \"),p(\"p\",[_._v(\"日全量数据表中，在每天对应的日期分区中插入截止到当天为止的全量数据，用户进行查询时，只需查询最近一天的数据即可获得最新全量数据。下面以一个具体的日全量表结构的例子来进行说明。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpiaxzH9qcfqQYUk3WEM1VBTUWEIk1QejuZx9hY4fU44mDQJAJyxnYMYg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"\"}})]),_._v(\" \"),p(\"p\",[_._v(\"这里userid表示用户id，labelweight表示标签权重，theme表示标签归属的二级主题，labelid表示一个标签id。通过“日期 +标签归属的二级主题+标签id”的方式进行分区，设置三个分区字段更便于开发和查询数据。该表结构下的标签权重仅考虑统计类型标签的权重，如：历史购买金额标签对应的权重为金额数量，用户近30日访问天数为对应的天数，该权重值的计算未考虑较为复杂的用户行为次数、行为类型、行为距今时间等复杂情况。\")]),_._v(\" \"),p(\"p\",[_._v(\"通过表名末尾追加“_all”的规范化命名形式，可直观看出这是一张日全量表。\")]),_._v(\" \"),p(\"p\",[_._v(\"例如，对于主题类型为“会员”的标签，插入“20190101”日的全量数据，可通过语句：\")]),_._v(\" \"),p(\"p\",[_._v(\"insert overwrite table dw. userprofile_userlabel_all partition(data_date= '20190101', theme= 'member', labelid='ATTRITUBE_U_05_001')来实现。\")]),_._v(\" \"),p(\"p\",[_._v(\"查询截止到“20190101”日的被打上会员标签的用户量，可通过语句：\")]),_._v(\" \"),p(\"p\",[_._v(\"select count(distinct userid) from dw.userprofile_userlabel_all where data_date='20190101'来实现。\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"② 日增量数据\")])]),_._v(\" \"),p(\"p\",[_._v(\"日增量数据表，即在每天的日期分区中插入当天业务运行产生的数据，用户进行查询时通过限制查询的日期范围，就可以找出在特定时间范围内被打上特定标签的用户。下面以一个具体的日增量表结构的例子来说明。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpXZ9SVNMN9zkrsJ2kxAibPjgD1x0uohVp2KM4fIcI2LZxVcq5gSSBZ0Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"img\"}})]),_._v(\" \"),p(\"p\",[_._v(\"这里，labelid表示标签名称；cookieid表示用户id；act_cnt表示用户当日行为次数，如用户当日浏览某三级品类商品3次，则打上次数为3；tag_type_id为标签类型,如母婴、3C、数码等不同类型；act_type_id表示行为类型，如浏览、搜索、收藏、下单等行为。分区方式为按日期分区，插入当日数据。\")]),_._v(\" \"),p(\"p\",[_._v(\"通过表名末尾追加“_append”的规范化命名形式，可直观看出这是一张日增量表。\")]),_._v(\" \"),p(\"p\",[_._v(\"例如，某用户在“20180701”日浏览某3C电子商品4次（act_cnt），即给该用户（userid）打上商品对应的三级品类标签（tagid），标签类型（tag_type_id）为3C电子商品，行为类型（act_type_id）为浏览。这里可以通过对标签类型和行为类型两个字段配置维度表的方式，对数据进行管理。例如对于行为类型（act_type_id）字段，可以设定1为购买行为、2为浏览行为、3为收藏行为等，在行为标签表中以数值定义用户行为类型，在维度表中维护每个数值对应的具体含义。\")]),_._v(\" \"),p(\"p\",[_._v(\"该日增量数据表可视为ODS层用户行为标签明细。在查询过程中，例如对于某用户id为001的用户，查询其在“20180701”日到“20180707”日被打上的标签，可通过命令：\")]),_._v(\" \"),p(\"p\",[_._v(\"select * from dw.userprofile_act_feature_append where userid = '001' and data_date>='20180701' and data_date<= '20180707'查询。\")]),_._v(\" \"),p(\"p\",[_._v(\"该日增量的表结构记录了用户每天的行为带来的标签，但未计算打在用户身上标签的权重，计算权重时还需做进一步建模加工。标签权重算法详见4.6节的内容。\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"③ 关于宽表设计\")])]),_._v(\" \"),p(\"p\",[_._v(\"用户画像表结构如何设计，没有一定要遵循的固定的格式，符合业务需要、能满足应用即可。下面通过两个宽表设计的案例，提供另一种解决方案的思路。\")]),_._v(\" \"),p(\"p\",[_._v(\"用户属性宽表设计（见表1-10），主要记录用户基本属性信息。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpkNDibfGT0pSyqjNbfVwM2PSeKAY4n26sFypntGAo5l85yaGUzazwOBQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-10　用户属性宽表设计\"}})]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpwh1DVqY6Fs99cS0vrBqLlYfmSD8cPuforHIhM9ghBFTibLgAAibghWJw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"img\"}})]),_._v(\" \"),p(\"p\",[_._v(\"用户日活跃宽表设计（见表1-11），主要记录用户每天访问的信息。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpqI1iaop228U8kFh3jH8135hetKYbCY43TUxW0xyMatXoESMIKNLx3zQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"表1-11　用户日活跃宽表设计\"}})]),_._v(\" \"),p(\"h2\",{attrs:{id:\"定性类画像\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#定性类画像\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"定性类画像\")])]),_._v(\" \"),p(\"p\",[_._v(\"本书重点讲解如何运用大数据定量刻画用户画像，然而对于用户的刻画除了定量维度外，定性刻画也是常见手段。定性类画像多见于用户研究等运营类岗位，通过电话调研、网络调研问卷、当面深入访谈、网上第三方权威数据等方式收集用户信息，帮助其理解用户。这种定性类调研相比大数据定量刻画用户来说，可以更精确地了解用户需求和行为特征，但这个样本量是有限的，得出的结论也不一定能代表大部分用户的观点。\")]),_._v(\" \"),p(\"p\",[_._v(\"通过制定调研问卷表，我们可以收集用户基本信息以及设置一个或多个场景，专访用户或网络回收调研问卷，在分析问卷数据后获取用户的画像特征。目前市场上“问卷星”等第三方问卷调查平台可提供用户问卷设计、链接发放、采集数据和信息、调研结果分析等一系列功能，如图1-7所示。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpGLgsz12LW3fsKuAavTmUTNNZNzm4AEJ2jb6ehTN6dnfVLIT29MeIjA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-7　某调研问卷示例（截图自“问卷星”）\"}})]),_._v(\" \"),p(\"p\",[_._v(\"根据回收的调研问卷，可结合统计数据进一步分析用户画像特征（如图1-8所示）。\")]),_._v(\" \"),p(\"p\",[p(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/zHbzQPKIBPh4WJCtSFtGYXlpCqDmKJVpQtmS6NNeV81wP7uuzjuRcJzznrCPPq5Inic0UvBwbL6aCLyT295YlJA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图1-8　回收的调研问卷（截图自“问卷星”）\"}})]),_._v(\" \"),p(\"h2\",{attrs:{id:\"小结\"}},[p(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#小结\"}},[_._v(\"#\")]),_._v(\" \"),p(\"strong\",[_._v(\"小结\")])]),_._v(\" \"),p(\"p\",[_._v(\"本文主要介绍了用户画像的一些基础知识，包括画像的简介、标签类型、整个画像系统的数据架构，开发画像系统主要覆盖的8个模块，以及开发过程中的各阶段关键产出。初步介绍了画像系统的轮廓概貌，帮助读者对于如何设计画像系统、开发周期、画像的应用方式等有宏观的初步的了解。\")]),_._v(\" \"),p(\"p\",[_._v(\"——本文摘自机械工业出版社华章图书\")]),_._v(\" \"),p(\"p\",[_._v(\"《用户画像方法论与工程化解决方案》\")]),_._v(\" \"),p(\"p\",[p(\"strong\",[_._v(\"作者介绍：\")])]),_._v(\" \"),p(\"p\",[_._v(\"赵宏田，资深大数据技术专家。擅长Hadoop、Spark等大数据技术，以及业务数据分析、数据仓库开发、爬虫、用户画像系统搭建等。著有畅销书《数据化运营：系统方法与实践案例》 《用户画像：方法论与工程化解决方案》。\")])])}),[],!1,null,null,null);t.default=v.exports}}]);","extractedComments":[]}