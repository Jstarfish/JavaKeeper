{"remainingRequest":"/Users/starfish/workspace/tech/node_modules/babel-loader/lib/index.js??ref--3-1!/Users/starfish/workspace/tech/node_modules/@vuepress/core/lib/client/root-mixins/updateMeta.js","dependencies":[{"path":"/Users/starfish/workspace/tech/node_modules/@vuepress/core/lib/client/root-mixins/updateMeta.js","mtime":499162500000},{"path":"/Users/starfish/workspace/tech/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/starfish/workspace/tech/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvc3RhcmZpc2gvd29ya3NwYWNlL3RlY2gvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9Vc2Vycy9zdGFyZmlzaC93b3Jrc3BhY2UvdGVjaC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCB1bmlvbkJ5IGZyb20gJ2xvZGFzaC91bmlvbkJ5JzsKZXhwb3J0IGRlZmF1bHQgewogIC8vIGNyZWF0ZWQgd2lsbCBiZSBjYWxsZWQgb24gYm90aCBjbGllbnQgYW5kIHNzcgogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnNpdGVNZXRhID0gdGhpcy4kc2l0ZS5oZWFkVGFncy5maWx0ZXIoZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMSksCiAgICAgICAgICBoZWFkZXJUeXBlID0gX3JlZjJbMF07CgogICAgICByZXR1cm4gaGVhZGVyVHlwZSA9PT0gJ21ldGEnOwogICAgfSkubWFwKGZ1bmN0aW9uIChfcmVmMykgewogICAgICB2YXIgX3JlZjQgPSBfc2xpY2VkVG9BcnJheShfcmVmMywgMiksCiAgICAgICAgICBfID0gX3JlZjRbMF0sCiAgICAgICAgICBoZWFkZXJWYWx1ZSA9IF9yZWY0WzFdOwoKICAgICAgcmV0dXJuIGhlYWRlclZhbHVlOwogICAgfSk7CgogICAgaWYgKHRoaXMuJHNzckNvbnRleHQpIHsKICAgICAgdmFyIG1lcmdlZE1ldGFJdGVtcyA9IHRoaXMuZ2V0TWVyZ2VkTWV0YVRhZ3MoKTsKICAgICAgdGhpcy4kc3NyQ29udGV4dC50aXRsZSA9IHRoaXMuJHRpdGxlOwogICAgICB0aGlzLiRzc3JDb250ZXh0LmxhbmcgPSB0aGlzLiRsYW5nOwogICAgICB0aGlzLiRzc3JDb250ZXh0LnBhZ2VNZXRhID0gcmVuZGVyUGFnZU1ldGEobWVyZ2VkTWV0YUl0ZW1zKTsKICAgIH0KICB9LAogIC8vIE90aGVyIGxpZmUgY3ljbGVzIHdpbGwgb25seSBiZSBjYWxsZWQgYXQgY2xpZW50CiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIC8vIGluaXQgY3VycmVudE1ldGFUYWdzIGZyb20gRE9NCiAgICB0aGlzLmN1cnJlbnRNZXRhVGFncyA9IF90b0NvbnN1bWFibGVBcnJheShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdtZXRhJykpOyAvLyB1cGRhdGUgdGl0bGUgLyBtZXRhIHRhZ3MKCiAgICB0aGlzLnVwZGF0ZU1ldGEoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHVwZGF0ZU1ldGE6IGZ1bmN0aW9uIHVwZGF0ZU1ldGEoKSB7CiAgICAgIGRvY3VtZW50LnRpdGxlID0gdGhpcy4kdGl0bGU7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5sYW5nID0gdGhpcy4kbGFuZzsKICAgICAgdmFyIG5ld01ldGFUYWdzID0gdGhpcy5nZXRNZXJnZWRNZXRhVGFncygpOwogICAgICB0aGlzLmN1cnJlbnRNZXRhVGFncyA9IHVwZGF0ZU1ldGFUYWdzKG5ld01ldGFUYWdzLCB0aGlzLmN1cnJlbnRNZXRhVGFncyk7CiAgICB9LAogICAgZ2V0TWVyZ2VkTWV0YVRhZ3M6IGZ1bmN0aW9uIGdldE1lcmdlZE1ldGFUYWdzKCkgewogICAgICB2YXIgcGFnZU1ldGEgPSB0aGlzLiRwYWdlLmZyb250bWF0dGVyLm1ldGEgfHwgW107IC8vIHBhZ2VNZXRhVGFncyBoYXZlIGhpZ2hlciBwcmlvcml0eSB0aGFuIHNpdGVNZXRhVGFncwogICAgICAvLyBkZXNjcmlwdGlvbiBuZWVkcyBzcGVjaWFsIGF0dGVudGlvbiBhcyBpdCBoYXMgdG9vIG1hbnkgZW50cmllcwoKICAgICAgcmV0dXJuIHVuaW9uQnkoW3sKICAgICAgICBuYW1lOiAnZGVzY3JpcHRpb24nLAogICAgICAgIGNvbnRlbnQ6IHRoaXMuJGRlc2NyaXB0aW9uCiAgICAgIH1dLCBwYWdlTWV0YSwgdGhpcy5zaXRlTWV0YSwgbWV0YUlkZW50aWZpZXIpOwogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgICRwYWdlOiBmdW5jdGlvbiAkcGFnZSgpIHsKICAgICAgdGhpcy51cGRhdGVNZXRhKCk7CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdXBkYXRlTWV0YVRhZ3MobnVsbCwgdGhpcy5jdXJyZW50TWV0YVRhZ3MpOwogIH0KfTsKLyoqCiAqIFJlcGxhY2UgY3VycmVudE1ldGFUYWdzIHdpdGggbmV3TWV0YVRhZ3MKICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSBuZXdNZXRhVGFncwogKiBAcGFyYW0ge0FycmF5PEhUTUxFbGVtZW50Pn0gY3VycmVudE1ldGFUYWdzCiAqIEByZXR1cm5zIHtBcnJheTxIVE1MRWxlbWVudD59CiAqLwoKZnVuY3Rpb24gdXBkYXRlTWV0YVRhZ3MobmV3TWV0YVRhZ3MsIGN1cnJlbnRNZXRhVGFncykgewogIGlmIChjdXJyZW50TWV0YVRhZ3MpIHsKICAgIF90b0NvbnN1bWFibGVBcnJheShjdXJyZW50TWV0YVRhZ3MpLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gYy5wYXJlbnROb2RlID09PSBkb2N1bWVudC5oZWFkOwogICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gZG9jdW1lbnQuaGVhZC5yZW1vdmVDaGlsZChjKTsKICAgIH0pOwogIH0KCiAgaWYgKG5ld01ldGFUYWdzKSB7CiAgICByZXR1cm4gbmV3TWV0YVRhZ3MubWFwKGZ1bmN0aW9uIChtKSB7CiAgICAgIHZhciB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdtZXRhJyk7CiAgICAgIE9iamVjdC5rZXlzKG0pLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoa2V5LCBtW2tleV0pOwogICAgICB9KTsKICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0YWcpOwogICAgICByZXR1cm4gdGFnOwogICAgfSk7CiAgfQp9Ci8qKgogKiBUcnkgdG8gaWRlbnRpZnkgYSBtZXRhIHRhZyBieSBuYW1lLCBwcm9wZXJ0eSBvciBpdGVtcHJvcAogKgogKiBSZXR1cm4gYSBjb21wbGV0ZSBzdHJpbmcgaWYgbm9uZSBwcm92aWRlZAogKiBAcGFyYW0ge09iamVjdH0gdGFnIGZyb20gZnJvbnRtYXR0ZXIgb3Igc2l0ZU1ldGFUYWdzCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqLwoKCmZ1bmN0aW9uIG1ldGFJZGVudGlmaWVyKHRhZykgewogIGZvciAodmFyIF9pID0gMCwgX2FyciA9IFsnbmFtZScsICdwcm9wZXJ0eScsICdpdGVtcHJvcCddOyBfaSA8IF9hcnIubGVuZ3RoOyBfaSsrKSB7CiAgICB2YXIgaXRlbSA9IF9hcnJbX2ldOwogICAgaWYgKHRhZy5oYXNPd25Qcm9wZXJ0eShpdGVtKSkgcmV0dXJuIHRhZ1tpdGVtXSArIGl0ZW07CiAgfQoKICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGFnKTsKfQovKioKICogUmVuZGVyIG1ldGEgdGFncwogKgogKiBAcGFyYW0ge0FycmF5fSBtZXRhCiAqIEByZXR1cm5zIHtTdHJpbmd9CiAqLwoKCmZ1bmN0aW9uIHJlbmRlclBhZ2VNZXRhKG1ldGEpIHsKICBpZiAoIW1ldGEpIHJldHVybiAnJzsKICByZXR1cm4gbWV0YS5tYXAoZnVuY3Rpb24gKG0pIHsKICAgIHZhciByZXMgPSAiPG1ldGEiOwogICAgT2JqZWN0LmtleXMobSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHJlcyArPSAiICIuY29uY2F0KGtleSwgIj1cIiIpLmNvbmNhdChtW2tleV0sICJcIiIpOwogICAgfSk7CiAgICByZXR1cm4gcmVzICsgIj4iOwogIH0pLmpvaW4oJ1xuICAgICcpOwp9"},{"version":3,"sources":["/Users/starfish/workspace/tech/node_modules/@vuepress/core/lib/client/root-mixins/updateMeta.js"],"names":["unionBy","created","siteMeta","$site","headTags","filter","headerType","map","_","headerValue","$ssrContext","mergedMetaItems","getMergedMetaTags","title","$title","lang","$lang","pageMeta","renderPageMeta","mounted","currentMetaTags","document","querySelectorAll","updateMeta","methods","documentElement","newMetaTags","updateMetaTags","$page","frontmatter","meta","name","content","$description","metaIdentifier","watch","beforeDestroy","c","parentNode","head","forEach","removeChild","m","tag","createElement","Object","keys","key","setAttribute","appendChild","item","hasOwnProperty","JSON","stringify","res","join"],"mappings":"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","sourcesContent":["import unionBy from 'lodash/unionBy'\n\nexport default {\n  // created will be called on both client and ssr\n  created () {\n    this.siteMeta = this.$site.headTags\n      .filter(([headerType]) => headerType === 'meta')\n      .map(([_, headerValue]) => headerValue)\n\n    if (this.$ssrContext) {\n      const mergedMetaItems = this.getMergedMetaTags()\n\n      this.$ssrContext.title = this.$title\n      this.$ssrContext.lang = this.$lang\n      this.$ssrContext.pageMeta = renderPageMeta(mergedMetaItems)\n    }\n  },\n  // Other life cycles will only be called at client\n  mounted () {\n    // init currentMetaTags from DOM\n    this.currentMetaTags = [...document.querySelectorAll('meta')]\n\n    // update title / meta tags\n    this.updateMeta()\n  },\n\n  methods: {\n    updateMeta () {\n      document.title = this.$title\n      document.documentElement.lang = this.$lang\n\n      const newMetaTags = this.getMergedMetaTags()\n      this.currentMetaTags = updateMetaTags(newMetaTags, this.currentMetaTags)\n    },\n\n    getMergedMetaTags () {\n      const pageMeta = this.$page.frontmatter.meta || []\n      // pageMetaTags have higher priority than siteMetaTags\n      // description needs special attention as it has too many entries\n      return unionBy([{ name: 'description', content: this.$description }],\n        pageMeta, this.siteMeta, metaIdentifier)\n    }\n  },\n\n  watch: {\n    $page () {\n      this.updateMeta()\n    }\n  },\n\n  beforeDestroy () {\n    updateMetaTags(null, this.currentMetaTags)\n  }\n}\n\n/**\n * Replace currentMetaTags with newMetaTags\n * @param {Array<Object>} newMetaTags\n * @param {Array<HTMLElement>} currentMetaTags\n * @returns {Array<HTMLElement>}\n */\nfunction updateMetaTags (newMetaTags, currentMetaTags) {\n  if (currentMetaTags) {\n    [...currentMetaTags]\n          .filter(c => c.parentNode === document.head)\n          .forEach(c => document.head.removeChild(c))\n  }\n  if (newMetaTags) {\n    return newMetaTags.map(m => {\n      const tag = document.createElement('meta')\n      Object.keys(m).forEach(key => {\n        tag.setAttribute(key, m[key])\n      })\n      document.head.appendChild(tag)\n      return tag\n    })\n  }\n}\n\n/**\n * Try to identify a meta tag by name, property or itemprop\n *\n * Return a complete string if none provided\n * @param {Object} tag from frontmatter or siteMetaTags\n * @returns {String}\n */\nfunction metaIdentifier (tag) {\n  for (const item of ['name', 'property', 'itemprop']) {\n    if (tag.hasOwnProperty(item)) return tag[item] + item\n  }\n  return JSON.stringify(tag)\n}\n\n/**\n * Render meta tags\n *\n * @param {Array} meta\n * @returns {String}\n */\n\nfunction renderPageMeta (meta) {\n  if (!meta) return ''\n  return meta.map(m => {\n    let res = `<meta`\n    Object.keys(m).forEach(key => {\n      res += ` ${key}=\"${m[key]}\"`\n    })\n    return res + `>`\n  }).join('\\n    ')\n}\n"]}]}