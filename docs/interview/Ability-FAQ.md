### 如果线上一个服务无法对外提供请求，但是服务没有挂，怎么排查

当线上服务无法对外提供请求，但服务本身没有挂（即服务仍然在运行），你可以按照以下步骤进行排查：

1. **检查服务日志**

   首先检查服务的日志文件。日志文件通常包含关于服务运行状态、请求处理情况和错误信息的详细记录。

   - **访问日志**: 检查是否有请求到达服务。如果没有请求到达，问题可能在于请求路由或网络。

   - **错误日志**: 查看是否有错误日志记录。错误日志可以帮助你识别代码中的异常情况或第三方服务的问题。

   - **应用日志**: 检查是否有异常或警告信息。

2. **检查网络和防火墙设置**

   服务无法对外提供请求可能是由于网络问题或防火墙配置导致的。

   - **网络连接**: 使用 `ping` 或 `traceroute` 命令检查服务所在机器与外部网络的连接情况。

   - **防火墙设置**: 确保防火墙允许外部请求访问服务的端口。

3. **检查负载均衡和反向代理配置**

   如果服务是通过负载均衡器或反向代理进行访问的，检查这些组件的配置。

   - **负载均衡器**: 确保负载均衡器正确地将请求转发到服务实例。检查负载均衡器的健康检查配置。

   - **反向代理**: 确保反向代理配置正确，能够将请求转发到服务。

4. 检查服务依赖

   服务可能依赖其他服务、数据库或外部 API。如果这些依赖服务不可用，可能导致服务无法正常提供请求。

   - **依赖服务健康状况**: 检查依赖服务的运行状态和健康状况。

   - **数据库连接**: 检查服务是否能够连接到数据库，并且数据库是否正常运行。

   - **外部 API**: 检查外部 API 是否可用。

5. **检查线程和连接池**

   服务无法处理请求可能是由于线程池或连接池耗尽。

   - **线程池**: 检查服务的线程池配置和使用情况，确保没有线程泄漏或线程池耗尽的情况。

   - **连接池**: 检查数据库连接池或 HTTP 连接池的使用情况，确保没有连接泄漏或连接池耗尽的情况。

6. **检查内存和 CPU 使用情况**

   内存不足或 CPU 过载可能导致服务无法处理请求。

   - **内存使用情况**: 使用 `jstat`、`jmap` 等工具检查 JVM 的堆内存使用情况。

   - **CPU 使用情况**: 使用 `top` 或 `htop` 命令检查服务所在机器的 CPU 使用情况。

7. **检查应用程序代码**

   如果以上检查未发现问题，可能需要深入检查应用程序代码。

   - **死锁**: 检查代码是否存在线程死锁的情况。

   - **高延迟操作**: 检查代码是否有高延迟操作，导致请求处理超时。

   - **异常处理**: 检查代码中的异常处理逻辑，确保不会因未捕获的异常导致请求处理失败。

8. **检查监控和报警系统**

   使用监控工具（如 Prometheus、Grafana）和报警系统检查服务的运行状态。

   - **监控指标**: 查看服务的关键性能指标，如请求率、错误率、响应时间、CPU 使用率、内存使用情况等。

   - **报警信息**: 检查是否有任何报警信息提示服务异常。





### 你了解 Java 应用开发中的注入攻击吗？

注入式（Inject）攻击是一类非常常见的攻击方式，其基本特征是程序允许攻击者将不可信的动态内容注入到程序中，并将其执行，这就可能完全改变最初预计的执行过程，产生恶意效果。

下面是几种主要的注入式攻击途径，原则上提供动态执行能力的语言特性，都需要提防发生注入攻击的可能。

首先，就是最常见的 SQL 注入攻击。一个典型的场景就是 Web 系统的用户登录功能，根据用户输入的用户名和密码，我们需要去后端数据库核实信息。

假设应用逻辑是，后端程序利用界面输入动态生成类似下面的 SQL，然后让 JDBC 执行。

```
Select * from use_info where username = “input_usr_name” and password = “input_pwd”
```

但是，如果我输入的 input_pwd 是类似下面的文本，

```
“ or “”=”
```

那么，拼接出的 SQL 字符串就变成了下面的条件，OR 的存在导致输入什么名字都是复合条件的。

```
Select * from use_info where username = “input_usr_name” and password = “” or “” = “”
```

这里只是举个简单的例子，它是利用了期望输入和可能输入之间的偏差。上面例子中，期望用户输入一个数值，但实际输入的则是 SQL 语句片段。类似场景可以利用注入的不同 SQL 语句，进行各种不同目的的攻击，甚至还可以加上“;delete xxx”之类语句，如果数据库权限控制不合理，攻击效果就可能是灾难性的。

第二，操作系统命令注入。Java 语言提供了类似 Runtime.exec(…) 的 API，可以用来执行特定命令，假设我们构建了一个应用，以输入文本作为参数，执行下面的命令：

```
ls –la input_file_name
```

但是如果用户输入是 “input_file_name;rm –rf /*”，这就有可能出现问题了。当然，这只是个举例，Java 标准类库本身进行了非常多的改进，所以类似这种编程错误，未必可以真的完成攻击，但其反映的一类场景是真实存在的。

第三，XML 注入攻击。Java 核心类库提供了全面的 XML 处理、转换等各种 API，而 XML 自身是可以包含动态内容的，例如 XPATH，如果使用不当，可能导致访问恶意内容。

还有类似 LDAP 等允许动态内容的协议，都是可能利用特定命令，构造注入式攻击的，包括 XSS（Cross-site Scripting）攻击，虽然并不和 Java 直接相关，但也可能在 JSP 等动态页面中发生。





### 日志分析工具用了哪些？

在面试中被问到日志分析工具时，可以从以下几个方面进行回答：所用的工具、它们的主要功能、你是如何使用这些工具的，以及它们在你的项目中带来的具体好处。以下是一些常用的日志分析工具及其特点：

**常用日志分析工具**

1. **ELK Stack (Elasticsearch, Logstash, Kibana)**
   - **Elasticsearch**: 一个强大的搜索引擎，用于存储和查询日志数据。
   - **Logstash**: 一个数据处理管道工具，用于收集、解析和存储日志数据。
   - **Kibana**: 一个数据可视化工具，用于展示和分析 Elasticsearch 中的数据。
   - **使用场景**: 大量日志数据的集中管理和实时分析。
   - **个人经验**: 可以提到如何设置 Logstash 管道、创建 Kibana 仪表盘来监控特定的日志模式或异常。
2. **Graylog**
   - **特点**: 基于 Elasticsearch 的日志管理工具，具有强大的日志聚合、搜索和分析功能。
   - **使用场景**: 实时日志监控和警报。
   - **个人经验**: 可以提到如何配置 Graylog 采集日志、设置警报规则，以及如何利用 Graylog 的搜索功能进行故障排除。
3. **Splunk**
   - **特点**: 商业化的日志管理和分析工具，提供强大的搜索、监控和可视化功能。
   - **使用场景**: 复杂的企业级日志分析和安全监控。
   - **个人经验**: 可以提到如何利用 Splunk 进行实时日志分析、创建报告和仪表盘，以及如何使用 Splunk 的机器学习功能进行异常检测。
4. **Fluentd**
   - **特点**: 一个开源的数据收集器，用于统一日志数据。
   - **使用场景**: 日志数据的收集和转发。
   - **个人经验**: 可以提到如何配置 Fluentd 插件、收集和转发日志到不同的存储系统（如 Elasticsearch、MongoDB）。
5. **Loggly**
   - **特点**: 基于云的日志管理和分析服务，提供实时日志监控和警报。
   - **使用场景**: 云环境中的日志管理。
   - **个人经验**: 可以提到如何将应用日志发送到 Loggly、配置日志搜索和警报，以及利用 Loggly 的仪表盘进行日志可视化。
6. **Prometheus 和 Grafana**
   - **特点**: Prometheus 用于监控和告警，Grafana 用于数据可视化。虽然主要用于度量和监控，但也可以用于日志分析。
   - **使用场景**: 系统和应用的监控。
   - **个人经验**: 可以提到如何配置 Prometheus 采集日志指标、设置警报规则，以及如何利用 Grafana 创建可视化面板。

我们使用 ELK Stack 来集中管理和分析日志数据。通过 Logstash 我们收集来自不同服务的日志，并将其存储在 Elasticsearch 中，然后使用 Kibana 创建了多个仪表盘来监控系统的健康状况和性能



