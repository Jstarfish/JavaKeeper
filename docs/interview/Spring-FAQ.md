---
title: Springæ¡†æ¶é¢è¯•é¢˜å¤§å…¨
date: 2024-12-15
tags: 
 - Spring
 - Interview
categories: Interview

---

![](https://img.starfish.ink/common/faq-banner.png)

> Springæ¡†æ¶ä½œä¸ºJavaç”Ÿæ€ç³»ç»Ÿçš„**æ ¸å¿ƒåŸºç¡€è®¾æ–½**ï¼Œæ˜¯æ¯ä¸ªJavaå¼€å‘è€…å¿…é¡»æŒæ¡çš„æŠ€æœ¯æ ˆã€‚ä»ç®€å•çš„IOCå®¹å™¨åˆ°å¤æ‚çš„å¾®æœåŠ¡æ¶æ„ï¼Œä»ä¼ ç»Ÿçš„SSMåˆ°ç°ä»£çš„å“åº”å¼ç¼–ç¨‹ï¼ŒSpringæŠ€æœ¯æ ˆçš„æ·±åº¦å’Œå¹¿åº¦å†³å®šäº†å¼€å‘è€…çš„èŒä¸šé«˜åº¦ã€‚æœ¬æ–‡æ¡£ç³»ç»Ÿæ¢³ç†Springé¢è¯•ä¸­çš„**é«˜é¢‘è€ƒç‚¹**ï¼Œä¸ä»…æä¾›æ ‡å‡†ç­”æ¡ˆï¼Œæ›´æ³¨é‡**åŸç†è§£æ**å’Œ**å®æˆ˜åº”ç”¨**ã€‚
>
>
> Spring é¢è¯•ï¼Œå›´ç»•ç€è¿™ä¹ˆå‡ ä¸ªæ ¸å¿ƒæ–¹å‘å‡†å¤‡ï¼š
>
> - **Spring Frameworkæ ¸å¿ƒ**ï¼ˆIOCå®¹å™¨ã€ä¾èµ–æ³¨å…¥ã€Beanç”Ÿå‘½å‘¨æœŸã€AOPç¼–ç¨‹ï¼‰
> - **Spring Bootè‡ªåŠ¨é…ç½®**ï¼ˆStarteræœºåˆ¶ã€æ¡ä»¶è£…é…ã€å¤–éƒ¨åŒ–é…ç½®ã€Actuatorç›‘æ§ï¼‰  
> - **Spring MVCè¯·æ±‚å¤„ç†**ï¼ˆDispatcherServletã€HandlerMappingã€è§†å›¾è§£æã€å¼‚å¸¸å¤„ç†ï¼‰
> - **Springäº‹åŠ¡ç®¡ç†**ï¼ˆå£°æ˜å¼äº‹åŠ¡ã€ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€äº‹åŠ¡å¤±æ•ˆé—®é¢˜ï¼‰
> - **Spring Dataæ•°æ®è®¿é—®**ï¼ˆRepositoryæ¨¡å¼ã€åˆ†é¡µæŸ¥è¯¢ã€äº‹åŠ¡ç®¡ç†ã€å¤šæ•°æ®æºï¼‰
> - **Spring Securityå®‰å…¨æ¡†æ¶**ï¼ˆè®¤è¯æˆæƒã€JWTé›†æˆã€CSRFé˜²æŠ¤ã€æ–¹æ³•çº§å®‰å…¨ï¼‰
> - **Spring Cloudå¾®æœåŠ¡**ï¼ˆæœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒã€ç†”æ–­é™çº§ã€ç½‘å…³è·¯ç”±ï¼‰



## ğŸ—ºï¸ çŸ¥è¯†å¯¼èˆª

### ğŸ·ï¸ æ ¸å¿ƒçŸ¥è¯†åˆ†ç±»

1. **ğŸ—ï¸ Spring Frameworkæ ¸å¿ƒ**ï¼šIOCå®¹å™¨ã€ä¾èµ–æ³¨å…¥ã€Beanç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸã€å¾ªç¯ä¾èµ–ã€BeanFactory vs ApplicationContext
2. **ğŸ¯ AOPé¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼šAOPæ¦‚å¿µã€ä»£ç†æ¨¡å¼ã€é€šçŸ¥ç±»å‹ã€åˆ‡ç‚¹è¡¨è¾¾å¼ã€AspectJé›†æˆã€åŠ¨æ€ä»£ç† vs CGLIB
3. **ğŸŒ Spring MVCæ¶æ„**ï¼šè¯·æ±‚å¤„ç†æµç¨‹ã€DispatcherServletã€HandlerMappingã€è§†å›¾è§£æã€å‚æ•°ç»‘å®šã€å¼‚å¸¸å¤„ç†
4. **ğŸš€ Spring Bootæ ¸å¿ƒç‰¹æ€§**ï¼šè‡ªåŠ¨é…ç½®åŸç†ã€Starteræœºåˆ¶ã€æ¡ä»¶è£…é…ã€å¤–éƒ¨åŒ–é…ç½®ã€Actuatorç›‘æ§ã€æ‰“åŒ…éƒ¨ç½²
5. **ğŸ’¾ æ•°æ®è®¿é—®ä¸äº‹åŠ¡**ï¼šSpring Dataã€äº‹åŠ¡ç®¡ç†ã€ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€äº‹åŠ¡å¤±æ•ˆã€å¤šæ•°æ®æºã€åˆ†é¡µæŸ¥è¯¢
6. **ğŸ”’ Spring Securityå®‰å…¨**ï¼šè®¤è¯æˆæƒæµç¨‹ã€SecurityContextã€JWTé›†æˆã€CSRFé˜²æŠ¤ã€æ–¹æ³•çº§å®‰å…¨ã€OAuth2é›†æˆ
7. **â˜ï¸ Spring Cloudå¾®æœåŠ¡**ï¼šæœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒã€ç†”æ–­é™çº§ã€APIç½‘å…³ã€é“¾è·¯è¿½è¸ªã€åˆ†å¸ƒå¼äº‹åŠ¡
8. **ğŸ“ æ³¨è§£ä¸é…ç½®**ï¼šå¸¸ç”¨æ³¨è§£ã€JavaConfigã€Profileç®¡ç†ã€å±æ€§æ³¨å…¥ã€æ¡ä»¶è£…é…ã€è‡ªå®šä¹‰æ³¨è§£
9. **ğŸ”§ é«˜çº§ç‰¹æ€§ä¸å®è·µ**ï¼šäº‹ä»¶æœºåˆ¶ã€å›½é™…åŒ–ã€ç¼“å­˜æŠ½è±¡ã€ä»»åŠ¡è°ƒåº¦ã€WebSocketã€å“åº”å¼ç¼–ç¨‹
10. **ğŸ¯ é¢è¯•é‡ç‚¹ä¸å®è·µ**ï¼šè®¾è®¡æ¨¡å¼ã€æ€§èƒ½ä¼˜åŒ–ã€æœ€ä½³å®è·µã€å¸¸è§é™·é˜±ã€Spring vs SpringBootã€æ•´ä½“æ¶æ„è®¾è®¡

### ğŸ”‘ é¢è¯•è¯æœ¯æ¨¡æ¿

| **é—®é¢˜ç±»å‹** | **å›ç­”æ¡†æ¶**                          | **å…³é”®è¦ç‚¹**                 | **æ·±å…¥æ‰©å±•**                     |
| ------------ | ------------------------------------- | ---------------------------- | -------------------------------- |
| **æ¦‚å¿µè§£é‡Š** | å®šä¹‰â†’æ ¸å¿ƒç‰¹æ€§â†’å·¥ä½œåŸç†â†’åº”ç”¨åœºæ™¯       | å‡†ç¡®å®šä¹‰ï¼Œçªå‡ºæ ¸å¿ƒä»·å€¼       | æºç åˆ†æï¼Œè®¾è®¡æ€æƒ³ï¼Œæœ€ä½³å®è·µ     |
| **åŸç†åˆ†æ** | èƒŒæ™¯é—®é¢˜â†’è§£å†³æ–¹æ¡ˆâ†’å®ç°æœºåˆ¶â†’ä¼˜åŠ¿åŠ£åŠ¿   | å›¾è§£æµç¨‹ï¼Œå…³é”®æ­¥éª¤           | åº•å±‚å®ç°ï¼Œæ€§èƒ½è€ƒé‡ï¼Œæ‰©å±•æœºåˆ¶     |
| **æŠ€æœ¯å¯¹æ¯”** | ç›¸åŒç‚¹â†’å·®å¼‚ç‚¹â†’é€‚ç”¨åœºæ™¯â†’é€‰æ‹©å»ºè®®       | å¤šç»´åº¦å¯¹æ¯”ï¼Œå®é™…åœºæ™¯         | æ€§èƒ½å·®å¼‚ï¼Œå®ç°å¤æ‚åº¦ï¼Œç»´æŠ¤æˆæœ¬   |
| **å®è·µåº”ç”¨** | ä¸šåŠ¡åœºæ™¯â†’æŠ€æœ¯é€‰å‹â†’å…·ä½“å®ç°â†’è¸©å‘ç»éªŒ   | å®é™…é¡¹ç›®æ¡ˆä¾‹ï¼Œä»£ç ç¤ºä¾‹       | æ€§èƒ½ä¼˜åŒ–ï¼Œç›‘æ§è¿ç»´ï¼Œæ•…éšœå¤„ç†     |
| **æ¶æ„è®¾è®¡** | éœ€æ±‚åˆ†æâ†’æŠ€æœ¯é€‰å‹â†’æ¶æ„è®¾è®¡â†’å®æ–½æ–¹æ¡ˆ   | ç³»ç»Ÿæ€è€ƒï¼Œå…¨å±€è§†è§’           | å¯æ‰©å±•æ€§ï¼Œé«˜å¯ç”¨ï¼Œä¸€è‡´æ€§ä¿è¯     |

---

## ğŸ—ï¸ ä¸€ã€Spring Frameworkæ ¸å¿ƒ

**æ ¸å¿ƒç†å¿µ**ï¼šé€šè¿‡IOCæ§åˆ¶åè½¬å’ŒAOPé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ç°æ¾è€¦åˆã€é«˜å†…èšçš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ã€‚

### ğŸ¯ ä½¿ç”¨ **Spring** æ¡†æ¶èƒ½å¸¦æ¥å“ªäº›å¥½å¤„?

1. **ç®€åŒ–å¼€å‘**ï¼šSpring æ¡†æ¶é€šè¿‡é«˜åº¦çš„ **æŠ½è±¡** å’Œ **è‡ªåŠ¨åŒ–é…ç½®**ï¼Œå¤§å¤§ç®€åŒ–äº† Java å¼€å‘ï¼Œå‡å°‘äº†å¼€å‘è€…æ‰‹åŠ¨ç¼–å†™å¤§é‡é…ç½®ä»£ç çš„éœ€è¦ã€‚
   - **ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰**ï¼šSpring æä¾›äº† **ä¾èµ–æ³¨å…¥**ï¼ˆDIï¼‰æœºåˆ¶ï¼Œé€šè¿‡ `@Autowired` æˆ–æ„é€ å™¨æ³¨å…¥ï¼Œè‡ªåŠ¨ç®¡ç†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå‡å°‘äº†ä»£ç çš„è€¦åˆæ€§ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§ã€‚

   - **é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰**ï¼šSpring æä¾›äº† **AOP** åŠŸèƒ½ï¼Œä½¿å¾—æ—¥å¿—è®°å½•ã€å®‰å…¨æ§åˆ¶ã€äº‹åŠ¡ç®¡ç†ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä»£ç èƒ½å¤Ÿä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚

2. **æ¾è€¦åˆæ¶æ„**ï¼šSpring æä¾›äº† **æ¾è€¦åˆçš„æ¶æ„**ï¼Œé€šè¿‡ **ä¾èµ–æ³¨å…¥** å’Œ **æ¥å£/æŠ½è±¡ç±»**ï¼Œè®©ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¾æ•£ï¼Œæ–¹ä¾¿äº†æ¨¡å—çš„è§£è€¦å’Œæ‰©å±•ã€‚

   - é€šè¿‡ **ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰**ï¼Œç»„ä»¶ä¹‹é—´çš„ä¾èµ–ä¸å†é€šè¿‡ç¡¬ç¼–ç è¿æ¥ï¼Œè€Œæ˜¯ç”± Spring å®¹å™¨ç®¡ç†ï¼Œä¾èµ–å…³ç³»åœ¨è¿è¡Œæ—¶é€šè¿‡é…ç½®æ³¨å…¥ã€‚

   - Spring æä¾›äº†ä¸°å¯Œçš„ **æ¥å£** å’Œ **æŠ½è±¡**ï¼Œè®©å¼€å‘è€…å¯ä»¥è½»æ¾æ›¿æ¢å’Œæ‰©å±•åŠŸèƒ½ã€‚

3. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§**

   - **ä¾èµ–æ³¨å…¥**ï¼šä½¿å¾—ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»é€šè¿‡å®¹å™¨è¿›è¡Œç®¡ç†ï¼Œä»è€Œæ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚å¯ä»¥é€šè¿‡ **Mocking** æˆ– **Stubbing** æ¥æ¨¡æ‹Ÿä¾èµ–é¡¹ï¼Œæ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

   - **åˆ†å±‚æ¶æ„æ”¯æŒ**ï¼šSpring æä¾›çš„æœåŠ¡å’Œ DAO å±‚å¯ä»¥æ›´åŠ æ¸…æ™°åœ°è¿›è¡Œåˆ†å±‚ï¼Œä½¿å¾—ç³»ç»Ÿç»“æ„æ›´åŠ æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤ã€‚

   - **äº‹åŠ¡ç®¡ç†**ï¼šSpring æä¾›äº†å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œæ–¹ä¾¿è¿›è¡Œæ•°æ®åº“æ“ä½œçš„äº‹åŠ¡æ§åˆ¶ï¼Œé™ä½äº†ç¼–ç å¤æ‚åº¦ï¼ŒåŒæ—¶æé«˜äº†äº‹åŠ¡ç®¡ç†çš„çµæ´»æ€§ã€‚

4. **é›†æˆæ€§å¼º**ï¼šSpring çš„å¦ä¸€ä¸ªå…³é”®ä¼˜åŠ¿æ˜¯å…¶ **è‰¯å¥½çš„é›†æˆèƒ½åŠ›**ã€‚Spring æä¾›äº†è®¸å¤šä¸å¸¸è§æŠ€æœ¯æ¡†æ¶çš„é›†æˆï¼ŒåŒ…æ‹¬ï¼š

   - **JPAã€Hibernateã€MyBatis** ç­‰æŒä¹…åŒ–æ¡†æ¶çš„é›†æˆã€‚

   - **Spring Security**ï¼šæä¾›å¼ºå¤§çš„å®‰å…¨æ¡†æ¶ï¼Œæ”¯æŒèº«ä»½éªŒè¯ã€æˆæƒæ§åˆ¶ç­‰åŠŸèƒ½ã€‚

   - **Spring MVC**ï¼šå¯ä»¥ä¸ä¸åŒçš„ Web æ¡†æ¶ï¼ˆå¦‚ JSPã€Freemarkerã€Thymeleafï¼‰ä»¥åŠ RESTful é£æ ¼çš„æ¥å£è¿›è¡Œé›†æˆã€‚

   - **Spring Boot**ï¼šè®©æ„å»ºã€éƒ¨ç½² Spring åº”ç”¨æ›´åŠ ä¾¿æ·ï¼Œç®€åŒ–äº† Spring é¡¹ç›®çš„é…ç½®å’Œå¯åŠ¨ã€‚

5. **äº‹åŠ¡ç®¡ç†**ï¼šSpring æä¾›äº† **å£°æ˜å¼äº‹åŠ¡ç®¡ç†**ï¼Œå¯ä»¥é€šè¿‡ `@Transactional` æ³¨è§£æ¥å®ç°äº‹åŠ¡çš„ç®¡ç†ï¼Œé¿å…äº†æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡çš„éº»çƒ¦ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶å’Œéš”ç¦»çº§åˆ«ã€‚

6. **Spring Boot æå‡å¼€å‘æ•ˆç‡**ï¼šSpring Boot æ˜¯ Spring çš„å­é¡¹ç›®ï¼Œæ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„é…ç½®å’Œéƒ¨ç½²ã€‚å®ƒæä¾›äº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š

   - **è‡ªåŠ¨é…ç½®**ï¼šSpring Boot è‡ªåŠ¨é…ç½®äº†å¾ˆå¤šå¸¸è§çš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€Web é…ç½®ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼Œå‡å°‘äº†æ‰‹åŠ¨é…ç½®çš„å·¥ä½œé‡ã€‚

   - **å†…åµŒ Web å®¹å™¨**ï¼šSpring Boot æä¾›äº†å†…åµŒçš„ Tomcatã€Jetty ç­‰ Web å®¹å™¨ï¼Œå¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆç‹¬ç«‹çš„ JAR æˆ– WAR æ–‡ä»¶ï¼Œä¾¿äºéƒ¨ç½²å’Œè¿è¡Œã€‚

   - **å¿«é€Ÿå¼€å‘**ï¼šSpring Boot æä¾›äº†å¤§é‡çš„é»˜è®¤é…ç½®å’Œå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å¿«é€Ÿå¯åŠ¨é¡¹ç›®ï¼Œå¹¶å‡å°‘äº†é…ç½®å’Œå¼€å‘çš„æ—¶é—´ã€‚



### ğŸ¯ Springæœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ

- **è½»é‡çº§**ï¼šSpringåœ¨å¤§å°å’Œé€æ˜æ€§æ–¹é¢ç»å¯¹å±äºè½»é‡çº§çš„ï¼ŒåŸºç¡€ç‰ˆæœ¬çš„Springæ¡†æ¶å¤§çº¦åªæœ‰2MBã€‚
- **æ§åˆ¶åè½¬(IOC)**ï¼šSpringä½¿ç”¨æ§åˆ¶åè½¬æŠ€æœ¯å®ç°äº†æ¾è€¦åˆã€‚ä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ï¼Œè€Œä¸æ˜¯åˆ›å»ºæˆ–å¯»æ‰¾ä¾èµ–å¯¹è±¡ã€‚
- **é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)**ï¼šSpringæ”¯æŒé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒåŒæ—¶æŠŠåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘ä¸ç³»ç»Ÿçš„æœåŠ¡åˆ†ç¦»å¼€æ¥ã€‚
- **å®¹å™¨**ï¼šSpringåŒ…å«å¹¶ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡çš„é…ç½®åŠç”Ÿå‘½å‘¨æœŸã€‚
- **MVCæ¡†æ¶**ï¼šSpringçš„webæ¡†æ¶æ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜è‰¯çš„web MVCæ¡†æ¶ï¼Œå¾ˆå¥½çš„å–ä»£äº†ä¸€äº›webæ¡†æ¶ã€‚
- **äº‹åŠ¡ç®¡ç†**ï¼šSpringå¯¹ä¸‹è‡³æœ¬åœ°ä¸šåŠ¡ä¸Šè‡³å…¨å±€ä¸šåŠ¡(JAT)æä¾›äº†ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†æ¥å£ã€‚
- **å¼‚å¸¸å¤„ç†**ï¼šSpringæä¾›ä¸€ä¸ªæ–¹ä¾¿çš„APIå°†ç‰¹å®šæŠ€æœ¯çš„å¼‚å¸¸(ç”±JDBC, Hibernate, æˆ–JDOæŠ›å‡º)è½¬åŒ–ä¸ºä¸€è‡´çš„ã€Uncheckedå¼‚å¸¸ã€‚



### ğŸ¯ ä»€ä¹ˆæ˜¯Springæ¡†æ¶ï¼Ÿæ ¸å¿ƒç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ

Springæ˜¯ä¸€ä¸ªå¼€æºçš„ä¼ä¸šçº§Javaåº”ç”¨å¼€å‘æ¡†æ¶ï¼Œç”±Rod Johnsonåˆ›å»ºï¼Œç›®æ ‡æ˜¯ç®€åŒ–ä¼ä¸šçº§åº”ç”¨å¼€å‘ã€‚

**æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬**ï¼š

**1. IOCæ§åˆ¶åè½¬**ï¼š
- å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»ç®¡ç†äº¤ç»™Springå®¹å™¨
- é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°æ¾è€¦åˆæ¶æ„
- æé«˜äº†ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§

**2. AOPé¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼š
- å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»
- æ”¯æŒå£°æ˜å¼äº‹åŠ¡ã€æ—¥å¿—ã€å®‰å…¨ç­‰
- åŸºäºåŠ¨æ€ä»£ç†å’ŒCGLIBå®ç°

**3. è½»é‡çº§å®¹å™¨**ï¼š
- éä¾µå…¥å¼è®¾è®¡ï¼ŒPOJOå³å¯
- å®¹å™¨å¯åŠ¨å¿«ï¼Œå†…å­˜å ç”¨å°‘
- å¯ä»¥é€‰æ‹©æ€§ä½¿ç”¨æ¡†æ¶åŠŸèƒ½

**4. ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ**ï¼š
- æä¾›å®Œæ•´çš„ä¼ä¸šçº§æŠ€æœ¯æ ˆ
- è‰¯å¥½çš„æ¡†æ¶é›†æˆèƒ½åŠ›
- Spring Bootã€Spring Cloudç­‰ç”Ÿæ€ä¸°å¯Œ

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// IOCå®¹å™¨åŸºæœ¬ä½¿ç”¨
@Component
public class UserService {
    @Autowired
    private UserRepository userRepository;
    
    public User findById(Long id) {
        return userRepository.findById(id);
    }
}

// AOPåˆ‡é¢ç¤ºä¾‹  
@Aspect
@Component
public class LoggingAspect {
    @Around("@annotation(Log)")
    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
        long start = System.currentTimeMillis();
        Object result = joinPoint.proceed();
        long executionTime = System.currentTimeMillis() - start;
        System.out.println("Method executed in: " + executionTime + "ms");
        return result;
    }
}
```

### ğŸ¯ ä»€ä¹ˆæ˜¯IOCï¼Ÿä¾èµ–æ³¨å…¥çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

IoCï¼ˆInverse of Control:æ§åˆ¶åè½¬ï¼‰æ˜¯ä¸€ç§**è®¾è®¡æ€æƒ³**ï¼Œå°±æ˜¯ **å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±Springæ¡†æ¶æ¥ç®¡ç†ã€‚** IoC åœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰åº”ç”¨ï¼Œå¹¶é Spring ç‰¹æœ‰ã€‚ **IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ªMapï¼ˆkeyï¼Œvalueï¼‰,Map ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚**

å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚è¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åº”ç”¨çš„å¼€å‘ï¼ŒæŠŠåº”ç”¨ä»å¤æ‚çš„ä¾èµ–å…³ç³»ä¸­è§£æ”¾å‡ºæ¥ã€‚ **IoC å®¹å™¨å°±åƒæ˜¯ä¸€ä¸ªå·¥å‚ä¸€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®æ–‡ä»¶/æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚** åœ¨å®é™…é¡¹ç›®ä¸­ä¸€ä¸ª Service ç±»å¯èƒ½æœ‰å‡ ç™¾ç”šè‡³ä¸Šåƒä¸ªç±»ä½œä¸ºå®ƒçš„åº•å±‚ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–è¿™ä¸ª Serviceï¼Œä½ å¯èƒ½è¦æ¯æ¬¡éƒ½è¦ææ¸…è¿™ä¸ª Service æ‰€æœ‰åº•å±‚ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæŠŠäººé€¼ç–¯ã€‚å¦‚æœåˆ©ç”¨ IoC çš„è¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹å¼•ç”¨å°±è¡Œäº†ï¼Œè¿™å¤§å¤§å¢åŠ äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¸”é™ä½äº†å¼€å‘éš¾åº¦ã€‚

"IOCå…¨ç§°Inversion of Controlï¼Œå³æ§åˆ¶åè½¬ï¼Œæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³ï¼š

**ä¼ ç»Ÿæ¨¡å¼ vs IOCæ¨¡å¼**ï¼š

- **ä¼ ç»Ÿæ¨¡å¼**ï¼šå¯¹è±¡ä¸»åŠ¨åˆ›å»ºå’Œç®¡ç†ä¾èµ–å¯¹è±¡ï¼ˆæˆ‘æ‰¾ä½ ï¼‰
- **IOCæ¨¡å¼**ï¼šå¯¹è±¡è¢«åŠ¨æ¥å—å¤–éƒ¨æ³¨å…¥çš„ä¾èµ–ï¼ˆä½ æ‰¾æˆ‘ï¼‰
- **æ§åˆ¶æƒåè½¬**ï¼šä»å¯¹è±¡å†…éƒ¨è½¬ç§»åˆ°å¤–éƒ¨å®¹å™¨

**IOCå®ç°åŸç†**ï¼š

**1. å®¹å™¨åˆå§‹åŒ–é˜¶æ®µ**ï¼š

- åŠ è½½é…ç½®æ–‡ä»¶æˆ–æ‰«ææ³¨è§£
- è§£æBeanå®šä¹‰ä¿¡æ¯ï¼Œåˆ›å»ºBeanDefinition
- æ³¨å†ŒBeanDefinitionåˆ°BeanDefinitionRegistry

**2. Beanå®ä¾‹åŒ–é˜¶æ®µ**ï¼š

- æ ¹æ®BeanDefinitionåˆ›å»ºBeanå®ä¾‹
- é€šè¿‡åå°„è°ƒç”¨æ„é€ å™¨æˆ–å·¥å‚æ–¹æ³•
- æ‰§è¡Œå±æ€§æ³¨å…¥å’Œä¾èµ–è§£æ

**3. ä¾èµ–æ³¨å…¥æ–¹å¼**ï¼š
- **æ„é€ å™¨æ³¨å…¥**ï¼šé€šè¿‡æ„é€ æ–¹æ³•å‚æ•°æ³¨å…¥ï¼ˆæ¨èï¼‰
- **Setteræ³¨å…¥**ï¼šé€šè¿‡setteræ–¹æ³•æ³¨å…¥
- **å­—æ®µæ³¨å…¥**ï¼šé€šè¿‡@Autowiredç›´æ¥æ³¨å…¥å­—æ®µï¼ˆä¸æ¨èï¼‰"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// æ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
@Service
public class OrderService {
    private final PaymentService paymentService;
    private final InventoryService inventoryService;
    
    public OrderService(PaymentService paymentService, 
                       InventoryService inventoryService) {
        this.paymentService = paymentService;
        this.inventoryService = inventoryService;
    }
}

// Setteræ³¨å…¥
@Service
public class UserService {
    private EmailService emailService;
    
    @Autowired
    public void setEmailService(EmailService emailService) {
        this.emailService = emailService;
    }
}
```



### ğŸ¯ ä»€ä¹ˆæ˜¯ Spring IOC å®¹å™¨ï¼Ÿ

Spring IoCï¼ˆInverse of Controlï¼Œæ§åˆ¶åè½¬ï¼‰å®¹å™¨æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ï¼ˆç§°ä¸ºBeanï¼‰ã€‚IoCå®¹å™¨é€šè¿‡æ§åˆ¶åè½¬çš„æ–¹å¼ï¼Œå°†ç»„ä»¶çš„åˆ›å»ºã€é…ç½®å’Œä¾èµ–å…³ç³»ç®¡ç†ä»åº”ç”¨ç¨‹åºä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œç”±å®¹å™¨æ¥å¤„ç†ã€‚

IoCå®¹å™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1. **ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰**ï¼šIoCå®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨æ³¨å…¥Beançš„ä¾èµ–é¡¹ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºæˆ–æŸ¥æ‰¾è¿™äº›ä¾èµ–é¡¹ã€‚
2. **é…ç½®ç®¡ç†**ï¼šIoCå®¹å™¨ä½¿ç”¨é…ç½®å…ƒæ•°æ®ï¼ˆå¦‚XMLã€æ³¨è§£æˆ–Javaé…ç½®ç±»ï¼‰æ¥åˆ›å»ºå’Œç®¡ç†Beanã€‚
3. **Beanç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šIoCå®¹å™¨ç®¡ç†Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å®ä¾‹åŒ–ã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œé”€æ¯ã€‚
4. **ä½œç”¨åŸŸæ§åˆ¶**ï¼šIoCå®¹å™¨æ”¯æŒä¸åŒçš„Beanä½œç”¨åŸŸï¼Œå¦‚å•ä¾‹ï¼ˆSingletonï¼‰ã€åŸå‹ï¼ˆPrototypeï¼‰ã€è¯·æ±‚ï¼ˆRequestï¼‰ã€ä¼šè¯ï¼ˆSessionï¼‰ç­‰ã€‚
5. **ä¾èµ–å…³ç³»è§£æ**ï¼šIoCå®¹å™¨èƒ½å¤Ÿè§£æBeanä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶æ ¹æ®é…ç½®è‡ªåŠ¨ç»„è£…è¿™äº›Beanã€‚
6. **äº‹ä»¶å‘å¸ƒå’Œç›‘å¬**ï¼šIoCå®¹å™¨æ”¯æŒäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œå…è®¸Beanå‘å¸ƒäº‹ä»¶å’Œç›‘å¬å…¶ä»–Beançš„äº‹ä»¶ã€‚
7. **ç±»å‹è½¬æ¢å’Œæ•°æ®ç»‘å®š**ï¼šIoCå®¹å™¨æä¾›ç±»å‹è½¬æ¢æœåŠ¡ï¼Œèƒ½å¤Ÿå°†é…ç½®æ•°æ®ç»‘å®šåˆ°Beançš„å±æ€§ä¸Šã€‚
8. **è‡ªåŠ¨è£…é…**ï¼šIoCå®¹å™¨èƒ½å¤Ÿæ ¹æ®Beançš„ç±»å‹å’Œåç§°è‡ªåŠ¨è£…é…ä¾èµ–å…³ç³»ï¼Œå‡å°‘æ˜¾å¼é…ç½®çš„éœ€è¦ã€‚
9. **æ‰©å±•ç‚¹**ï¼šIoCå®¹å™¨æä¾›äº†å¤šä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚BeanFactoryPostProcessorå’ŒBeanPostProcessorï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰å®¹å™¨çš„è¡Œä¸ºã€‚

é€šè¿‡ä½¿ç”¨Spring IoCå®¹å™¨ï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸å¿…å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–ç®¡ç†ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œçµæ´»æ€§ã€‚

> â€œSpring IoC å®¹å™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬å¯¹è±¡çš„åˆ›å»ºä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ã€è‡ªåŠ¨è£…é…ã€bean çš„ä½œç”¨åŸŸç®¡ç†ã€AOP æ”¯æŒã€äº‹ä»¶æœºåˆ¶ã€èµ„æºç®¡ç†ä¸å¤–éƒ¨é…ç½®é›†æˆç­‰ã€‚é€šè¿‡è¿™äº›åŠŸèƒ½ï¼ŒSpring IoC å®¹å™¨ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ çµæ´»ã€é«˜æ•ˆåœ°ç®¡ç†åº”ç”¨ä¸­çš„å¯¹è±¡å’Œå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œå®ç°è§£è€¦ã€æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚â€



### ğŸ¯ ä»€ä¹ˆæ˜¯ IoCï¼ŸIoC çš„å®ç°åŸç†ï¼Ÿ

**IoCï¼ˆæ§åˆ¶åè½¬ï¼ŒInversion of Controlï¼‰** æ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œç›®çš„æ˜¯å°†æ§åˆ¶æƒä»ä¼ ç»Ÿçš„ç¨‹åºé€»è¾‘ä¸­åè½¬åˆ°å¤–éƒ¨å®¹å™¨ä¸­ï¼Œä½¿å¾—å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†äº¤ç»™å¤–éƒ¨ç³»ç»Ÿæ¥å¤„ç†ï¼Œä»è€Œå‡è½»å¯¹è±¡é—´çš„è€¦åˆã€‚ç®€å•æ¥è¯´ï¼ŒIoC é€šè¿‡è®©å¤–éƒ¨å®¹å™¨æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„æ³¨å…¥ï¼Œé¿å…äº†ç¨‹åºä»£ç ä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„å·¥ä½œã€‚

**IoC çš„æ ¸å¿ƒæ€æƒ³**

åœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹ä¸­ï¼Œç¨‹åºä¸­ä¼šæœ‰æ˜¾å¼çš„ä»£ç æ¥åˆ›å»ºå¯¹è±¡å¹¶ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚IoC åˆ™é€šè¿‡å°†è¿™äº›æ§åˆ¶æƒäº¤ç»™å®¹å™¨ï¼Œè®©å®¹å™¨åœ¨é€‚å½“çš„æ—¶æœºåˆ›å»ºå¯¹è±¡ï¼Œå¹¶æ ¹æ®éœ€è¦æ³¨å…¥å¯¹è±¡çš„ä¾èµ–é¡¹ã€‚

**IoC çš„å®ç°åŸç†**

IoC çš„å®ç°æ–¹å¼é€šå¸¸æœ‰å‡ ç§ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ **ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰**ã€‚

1. **ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰**ï¼šIoC çš„å®ç°é€šå¸¸æ˜¯é€šè¿‡ä¾èµ–æ³¨å…¥æ¥å®Œæˆçš„ã€‚ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†å¯¹è±¡çš„ä¾èµ–å…³ç³»ä»å¤–éƒ¨ä¼ å…¥ï¼Œè€Œä¸æ˜¯ç”±å¯¹è±¡æœ¬èº«æ¥åˆ›å»ºæˆ–æŸ¥æ‰¾ä¾èµ–çš„å¯¹è±¡ã€‚

   - **æ„é€ å™¨æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°å°†ä¾èµ–é¡¹ä¼ é€’ç»™å¯¹è±¡ã€‚
   - **Setter æ³¨å…¥**ï¼šé€šè¿‡è®¾ç½®å™¨æ–¹æ³•ä¼ é€’ä¾èµ–é¡¹ã€‚
   - **æ¥å£æ³¨å…¥**ï¼šå¯¹è±¡å®ç°æŸä¸ªæ¥å£ï¼Œå®¹å™¨é€šè¿‡è¯¥æ¥å£æä¾›ä¾èµ–é¡¹ã€‚

   **ä¾èµ–æ³¨å…¥ï¼ˆDI,Dependency Injectionï¼‰æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°šæœªçŸ¥æ‰€éœ€çš„åŠŸèƒ½æ˜¯æ¥è‡ªå“ªä¸ªçš„ç±»çš„æƒ…å†µä¸‹ï¼Œå°†å…¶ä»–å¯¹è±¡æ‰€ä¾èµ–çš„åŠŸèƒ½å¯¹è±¡å®ä¾‹åŒ–çš„æ¨¡å¼**ã€‚

2. **æ§åˆ¶åè½¬å®¹å™¨**ï¼šIoC é€šå¸¸é€šè¿‡å®¹å™¨æ¥å®ç°ï¼Œå®¹å™¨è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ã€ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨éœ€è¦æ—¶æ³¨å…¥ä¾èµ–é¡¹ã€‚å¸¸è§çš„ IoC å®¹å™¨æœ‰ Springï¼ˆJavaï¼‰ã€Unityï¼ˆ.NETï¼‰ã€Guiceï¼ˆJavaï¼‰ã€Daggerï¼ˆJava/Kotlinï¼‰ç­‰ã€‚

**IoC çš„å¥½å¤„**ã€Œåˆ—ä¸¾ IoC çš„ä¸€äº›å¥½å¤„ã€

- **è§£è€¦**ï¼šå¯¹è±¡ä¹‹é—´ä¸éœ€è¦ç›´æ¥ä¾èµ–ï¼Œå¯ä»¥è®©ç³»ç»Ÿæ›´å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤ã€‚
- **æ˜“äºæµ‹è¯•**ï¼šé€šè¿‡å®¹å™¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ›¿æ¢ä¾èµ–é¡¹ï¼Œè¿›è¡Œå•å…ƒæµ‹è¯•æ—¶å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡ï¼ˆMock Objectï¼‰æ¥æ›¿ä»£çœŸå®å¯¹è±¡ã€‚
- **çµæ´»æ€§**ï¼šIoC å®¹å™¨æä¾›äº†é…ç½®å’Œç®¡ç†å¯¹è±¡ä¾èµ–å…³ç³»çš„èƒ½åŠ›ï¼Œå¯ä»¥çµæ´»é…ç½®ä¾èµ–é¡¹ï¼Œè€Œä¸éœ€è¦æ”¹å˜ä»£ç ã€‚

> **IoCï¼ˆæ§åˆ¶åè½¬ï¼‰** æ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†äº¤ç»™å¤–éƒ¨å®¹å™¨æ¥æ§åˆ¶ï¼Œé¿å…ç¨‹åºå†…éƒ¨ç›´æ¥åˆ›å»ºå’Œç®¡ç†ä¾èµ–å¯¹è±¡ï¼Œä»è€Œè§£è€¦ç³»ç»Ÿä¸­çš„å„ä¸ªç»„ä»¶ã€‚å¸¸è§çš„ IoC å®ç°æ–¹å¼æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Œé€šè¿‡æ„é€ å™¨æ³¨å…¥ã€Setter æ³¨å…¥æˆ–æ¥å£æ³¨å…¥ç­‰æ–¹å¼æ¥å®ç°å¯¹è±¡çš„ä¾èµ–å…³ç³»æ³¨å…¥ã€‚IoC å®¹å™¨è´Ÿè´£ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–æ³¨å…¥ï¼Œå¸¸è§çš„æ¡†æ¶å¦‚ Spring åœ¨ Java ä¸­å°±ä½¿ç”¨äº† IoC åŸç†æ¥å®ç°æ¾è€¦åˆçš„ç³»ç»Ÿè®¾è®¡ã€‚IoC å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ï¼Œæ˜¯ç°ä»£è½¯ä»¶æ¶æ„ä¸­å¸¸ç”¨çš„è®¾è®¡æ€æƒ³ã€‚



### ğŸ¯ ä»€ä¹ˆæ˜¯ JavaConfigï¼Ÿ

â€œJavaConfig æ˜¯ Spring æä¾›çš„ä¸€ç§åŸºäº Java ç±»çš„é…ç½®æ–¹å¼ï¼Œå®ƒé€šè¿‡ `@Configuration` æ³¨è§£æ ‡è¯†é…ç½®ç±»ï¼Œé€šè¿‡ `@Bean` æ³¨è§£å£°æ˜ Beanã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„ XML é…ç½®ï¼ŒJavaConfig æä¾›äº†ç±»å‹å®‰å…¨ã€çµæ´»çš„é…ç½®æ–¹å¼ï¼Œæ”¯æŒæ³¨è§£å’Œ Java è¯­è¨€çš„ä¼˜åŠ¿ï¼Œä½¿å¾—é…ç½®æ›´åŠ ç®€æ´ã€å¯ç»´æŠ¤ï¼Œå¹¶ä¸”ä¸å…¶ä»–æ¡†æ¶é›†æˆæ›´åŠ æ–¹ä¾¿ã€‚â€



### ğŸ¯ Spring ä¸­æœ‰å¤šå°‘ç§ IOC å®¹å™¨ï¼Ÿ

Spring ä¸­çš„ org.springframework.beans åŒ…å’Œ org.springframework.context åŒ…æ„æˆäº† Spring æ¡†æ¶ IoC å®¹å™¨çš„åŸºç¡€ã€‚

åœ¨ Spring IOC å®¹å™¨è¯»å– Bean é…ç½®åˆ›å»º Bean å®ä¾‹ä¹‹å‰ï¼Œå¿…é¡»å¯¹å®ƒè¿›è¡Œå®ä¾‹åŒ–ã€‚åªæœ‰åœ¨å®¹å™¨å®ä¾‹åŒ–åï¼Œ æ‰å¯ä»¥ä» IOC å®¹å™¨é‡Œè·å– Bean å®ä¾‹å¹¶ä½¿ç”¨

Spring æä¾›äº†ä¸¤ç§ç±»å‹çš„ IOC å®¹å™¨å®ç°

- BeanFactoryï¼šIOC å®¹å™¨çš„åŸºæœ¬å®ç°

- ApplicationContextï¼šæä¾›äº†æ›´å¤šçš„é«˜çº§ç‰¹æ€§ï¼Œæ˜¯ BeanFactory çš„å­æ¥å£

BeanFactory æ˜¯ Spring æ¡†æ¶çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘ Spring æœ¬èº«ï¼›ApplicationContext é¢å‘ä½¿ç”¨ Spring æ¡†æ¶çš„å¼€å‘è€…ï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨åœºåˆéƒ½ç›´æ¥ä½¿ç”¨ ApplicationContext è€Œéåº•å±‚çš„ BeanFactoryï¼›

æ— è®ºä½¿ç”¨ä½•ç§æ–¹å¼, é…ç½®æ–‡ä»¶æ˜¯ç›¸åŒçš„ã€‚



###  ğŸ¯ BeanFactory å’Œ ApplicationContext åŒºåˆ«

åœ¨ Spring æ¡†æ¶ä¸­ï¼Œ`BeanFactory` å’Œ `ApplicationContext` éƒ½æ˜¯ IoC å®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬éƒ½è´Ÿè´£ç®¡ç†å’Œåˆ›å»º Beanï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚äº†è§£è¿™äº›åŒºåˆ«å¯ä»¥å¸®åŠ©ä½ é€‰æ‹©åˆé€‚çš„å®¹å™¨ç±»å‹ï¼Œå¹¶æ­£ç¡®ä½¿ç”¨å®ƒä»¬ã€‚

- **BeanFactory**ï¼šæ˜¯ Spring æœ€åŸºç¡€çš„å®¹å™¨ï¼Œè´Ÿè´£ç®¡ç† Bean çš„ç”Ÿå‘½å‘¨æœŸä»¥åŠä¾èµ–æ³¨å…¥ã€‚å®ƒæä¾›äº†æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œé€šå¸¸ç”¨äºå†…å­˜æˆ–èµ„æºè¾ƒä¸ºæœ‰é™çš„ç¯å¢ƒä¸­ã€‚
- **ApplicationContext**ï¼šæ˜¯ `BeanFactory` çš„ä¸€ä¸ªå­æ¥å£ï¼Œæ‰©å±•äº† `BeanFactory` çš„åŠŸèƒ½ï¼Œæä¾›äº†æ›´å¤šçš„ä¼ä¸šçº§ç‰¹æ€§ï¼Œå¦‚äº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–æ”¯æŒã€AOP æ”¯æŒç­‰ã€‚`ApplicationContext` æ˜¯ä¸€ä¸ªåŠŸèƒ½æ›´ä¸ºä¸°å¯Œçš„å®¹å™¨ï¼Œé€šå¸¸åœ¨å¤§å¤šæ•° Spring åº”ç”¨ä¸­ä½¿ç”¨ã€‚

| åŠŸèƒ½/ç‰¹æ€§                  | **BeanFactory**                        | **ApplicationContext**                                       |
| -------------------------- | -------------------------------------- | ------------------------------------------------------------ |
| **ç»§æ‰¿å…³ç³»**               | `BeanFactory` æ˜¯æœ€åŸºæœ¬çš„å®¹å™¨æ¥å£ã€‚     | `ApplicationContext` ç»§æ‰¿è‡ª `BeanFactory`ï¼Œå¹¶æ‰©å±•äº†æ›´å¤šåŠŸèƒ½ã€‚ |
| **æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰** | é»˜è®¤æ‡’åŠ è½½                             | æ”¯æŒæ‡’åŠ è½½ï¼Œå®¹å™¨å¯åŠ¨æ—¶ä¸ä¼šç«‹å³åˆå§‹åŒ–æ‰€æœ‰çš„ Beanï¼Œç›´åˆ°çœŸæ­£éœ€è¦å®ƒä»¬æ—¶æ‰åˆå§‹åŒ–ã€‚ |
| **å›½é™…åŒ–æ”¯æŒ**             | ä¸æ”¯æŒå›½é™…åŒ–ã€‚                         | æä¾›å›½é™…åŒ–æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ `MessageSource` è¿›è¡Œæ¶ˆæ¯çš„æœ¬åœ°åŒ–ã€‚  |
| **äº‹ä»¶æœºåˆ¶**               | ä¸æ”¯æŒäº‹ä»¶å‘å¸ƒä¸ç›‘å¬ã€‚                 | æä¾›äº‹ä»¶å‘å¸ƒä¸ç›‘å¬æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ `ApplicationEventPublisher` å‘å¸ƒå’Œç›‘å¬äº‹ä»¶ã€‚ |
| **AOP æ”¯æŒ**               | ä¸æ”¯æŒ AOP                             | æ”¯æŒ AOPï¼ˆå¦‚äº‹åŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ã€‚                         |
| **æ³¨è§£é©±åŠ¨é…ç½®**           | ä¸æ”¯æŒè‡ªåŠ¨æ‰«æå’Œæ³¨è§£é©±åŠ¨é…ç½®           | æ”¯æŒæ³¨è§£é©±åŠ¨é…ç½®ï¼Œæ”¯æŒ `@ComponentScan` è‡ªåŠ¨æ‰«æç»„ä»¶ã€‚       |
| **Bean å®šä¹‰çš„é…ç½®**        | ä»…æ”¯æŒé€šè¿‡ XML æˆ– Java é…ç½®æ¥å®šä¹‰ Bean | æ”¯æŒé€šè¿‡ XMLã€JavaConfig æˆ–æ³¨è§£é…ç½®æ¥å®šä¹‰ Beanã€‚             |
| **åˆ·æ–°å®¹å™¨åŠŸèƒ½**           | æ²¡æœ‰åˆ·æ–°å®¹å™¨çš„åŠŸèƒ½                     | æä¾› `refresh()` æ–¹æ³•ï¼Œå¯ä»¥åˆ·æ–°å®¹å™¨ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å’Œ Beanã€‚ |

**å¸¸ç”¨çš„å®ç°ç±»**

- **BeanFactory çš„å®ç°ç±»**ï¼š
  - `XmlBeanFactory`ï¼ˆå·²åºŸå¼ƒï¼‰
  - `SimpleBeanFactory`
  - `DefaultListableBeanFactory`ï¼ˆæœ€å¸¸ç”¨ï¼‰
- **ApplicationContext çš„å®ç°ç±»**ï¼š
  - `ClassPathXmlApplicationContext`ï¼šåŸºäº XML é…ç½®æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ã€‚
  - `AnnotationConfigApplicationContext`ï¼šåŸºäºæ³¨è§£é…ç½®çš„ä¸Šä¸‹æ–‡ã€‚
  - `GenericWebApplicationContext`ï¼šé€‚ç”¨äº Web åº”ç”¨çš„ä¸Šä¸‹æ–‡ã€‚

> â€œ`BeanFactory` æ˜¯ Spring æœ€åŸºæœ¬çš„å®¹å™¨æ¥å£ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç† Beanï¼Œä½†å®ƒåŠŸèƒ½è¾ƒä¸ºç®€æ´ï¼Œé€šå¸¸ç”¨äºèµ„æºæœ‰é™çš„ç¯å¢ƒã€‚è€Œ `ApplicationContext` ç»§æ‰¿äº† `BeanFactory`ï¼Œå¹¶æä¾›äº†æ›´å¤šä¼ä¸šçº§åŠŸèƒ½ï¼Œå¦‚å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶æœºåˆ¶å’Œ AOP ç­‰ã€‚`ApplicationContext` æ˜¯å¤§å¤šæ•° Spring åº”ç”¨ä¸­ä½¿ç”¨çš„å®¹å™¨ï¼Œå®ƒå…·æœ‰æ›´å¼ºçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚é€šå¸¸æ¨èä½¿ç”¨ `ApplicationContext`ï¼Œé™¤éä½ æœ‰ç‰¹å®šçš„æ€§èƒ½æˆ–èµ„æºè¦æ±‚ã€‚â€



### ğŸ¯ Spring IoC çš„å®ç°æœºåˆ¶

Spring ä¸­çš„ IoC çš„å®ç°åŸç†å°±æ˜¯å·¥å‚æ¨¡å¼åŠ åå°„æœºåˆ¶ï¼Œç¤ºä¾‹ï¼š

```java
interface Fruit {
     public abstract void eat();
}
class Apple implements Fruit {
    public void eat(){
        System.out.println("Apple");
    }
}
class Orange implements Fruit {
    public void eat(){
        System.out.println("Orange");
    }
}
class Factory {
    public static Fruit getInstance(String ClassName) {
        Fruit f = null;
        try {
            f=(Fruit)Class.forName(ClassName).newInstance();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return f;
    }
}
class Client {
    public static void main(String[] a) {
        Fruit f=Factory.getInstance("priv.starfish.spring.Apple");
        if(f!=null){
            f.eat();
        }
    }
}
```



### ğŸ¯ è¯·ä¸¾ä¾‹è¯´æ˜å¦‚ä½•åœ¨ **Spring** ä¸­æ³¨å…¥ä¸€ä¸ª **Java Collection**?

Spring æä¾›äº†ä»¥ä¸‹å››ç§é›†åˆç±»çš„é…ç½®å…ƒç´ :

- `<list>` : è¯¥æ ‡ç­¾ç”¨æ¥è£…é…å¯é‡å¤çš„ list å€¼ã€‚
- `<set>` : è¯¥æ ‡ç­¾ç”¨æ¥è£…é…æ²¡æœ‰é‡å¤çš„ set å€¼ã€‚
- `<map>`: è¯¥æ ‡ç­¾å¯ç”¨æ¥æ³¨å…¥é”®å’Œå€¼å¯ä»¥ä¸ºä»»ä½•ç±»å‹çš„é”®å€¼å¯¹ã€‚
- `<props>` : è¯¥æ ‡ç­¾æ”¯æŒæ³¨å…¥é”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„é”®å€¼å¯¹ã€‚

```xml
<beans>
<!-- Definition for javaCollection -->
<bean id="javaCollection" class="com.howtodoinjava.JavaCollection">
      <!-- java.util.List -->
      <property name="customList">
        <list>
           <value>INDIA</value>
           <value>Pakistan</value>
           <value>USA</value>
           <value>UK</value>
        </list>
      </property>
     <!-- java.util.Set -->
     <property name="customSet">
        <set>
           <value>INDIA</value>
           <value>Pakistan</value>
           <value>USA</value>
           <value>UK</value>
        </set>
      </property>
     <!-- java.util.Map -->
     <property name="customMap">
        <map>
           <entry key="1" value="INDIA"/>
           <entry key="2" value="Pakistan"/>
           <entry key="3" value="USA"/>
           <entry key="4" value="UK"/>
</map>
    </property>
    <!-- java.util.Properties -->
    <property name="customProperies">
        <props>
            <prop key="admin">admin@nospam.com</prop>
            <prop key="support">support@nospam.com</prop>
        </props>
</property>
   </bean>
</beans>
```



### ğŸ¯ ä»€ä¹ˆæ˜¯ Spring Beansï¼Ÿ

- å®ƒä»¬æ˜¯æ„æˆç”¨æˆ·åº”ç”¨ç¨‹åºä¸»å¹²çš„å¯¹è±¡
- Bean ç”± Spring IoC å®¹å™¨ç®¡ç†
- å®ƒä»¬ç”± Spring IoC å®¹å™¨å®ä¾‹åŒ–ï¼Œé…ç½®ï¼Œè£…é…å’Œç®¡ç†
- Bean æ˜¯åŸºäºç”¨æˆ·æä¾›ç»™å®¹å™¨çš„é…ç½®å…ƒæ•°æ®åˆ›å»º



### ğŸ¯ Spring æä¾›äº†å“ªäº›é…ç½®æ–¹å¼ï¼Ÿ

- åŸºäº xml é…ç½®

  bean æ‰€éœ€çš„ä¾èµ–é¡¹å’ŒæœåŠ¡åœ¨ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šã€‚è¿™äº›é…ç½®æ–‡ä»¶é€šå¸¸åŒ…å«è®¸å¤š bean å®šä¹‰å’Œç‰¹å®šäºåº”ç”¨ç¨‹åºçš„é…ç½®é€‰é¡¹ã€‚å®ƒä»¬é€šå¸¸ä»¥ bean æ ‡ç­¾å¼€å¤´ã€‚ä¾‹å¦‚ï¼š

  ```xml
  <bean id="studentbean" class="org.edureka.firstSpring.StudentBean">
   <property name="name" value="Edureka"></property>
  </bean>
  ```

- åŸºäºæ³¨è§£é…ç½®

  æ‚¨å¯ä»¥é€šè¿‡åœ¨ç›¸å…³çš„ç±»ï¼Œæ–¹æ³•æˆ–å­—æ®µå£°æ˜ä¸Šä½¿ç”¨æ³¨è§£ï¼Œå°† bean é…ç½®ä¸ºç»„ä»¶ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ XML æ¥æè¿° bean è£…é…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å®¹å™¨ä¸­æœªæ‰“å¼€æ³¨è§£è£…é…ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦åœ¨ä½¿ç”¨å®ƒä¹‹å‰åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¯ç”¨å®ƒã€‚ä¾‹å¦‚ï¼š

  ```xml
  <beans>
  <context:annotation-config/>
  <!-- bean definitions go here -->
  </beans>
  ```

- åŸºäº Java API é…ç½®

  Spring çš„ Java é…ç½®æ˜¯é€šè¿‡ä½¿ç”¨ @Bean å’Œ @Configuration æ¥å®ç°ã€‚

  1. @Bean æ³¨è§£æ‰®æ¼”ä¸ `<bean/>` å…ƒç´ ç›¸åŒçš„è§’è‰²ã€‚
  2. @Configuration ç±»å…è®¸é€šè¿‡ç®€å•åœ°è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»– @Bean æ–¹æ³•æ¥å®šä¹‰ bean é—´ä¾èµ–å…³ç³»ã€‚

  ```java
  @Configuration
  public class StudentConfig {
      @Bean
      public StudentBean myStudent() {
          return new StudentBean();
      }
  }
  ```




### ğŸ¯ é€šè¿‡æ³¨è§£çš„æ–¹å¼é…ç½®bean | ä»€ä¹ˆæ˜¯åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®

**ç»„ä»¶æ‰«æ**(component scanning): Spring èƒ½å¤Ÿä» classpathä¸‹è‡ªåŠ¨æ‰«æ, ä¾¦æµ‹å’Œå®ä¾‹åŒ–å…·æœ‰ç‰¹å®šæ³¨è§£çš„ç»„ä»¶ã€‚

ç‰¹å®šç»„ä»¶åŒ…æ‹¬:

- **@Component**ï¼šåŸºæœ¬æ³¨è§£ï¼Œæ ‡è¯†äº†ä¸€ä¸ªå— Spring ç®¡ç†çš„ç»„ä»¶
- **@Respository**ï¼šæ ‡è¯†æŒä¹…å±‚ç»„ä»¶
- **@Service**ï¼šæ ‡è¯†æœåŠ¡å±‚(ä¸šåŠ¡å±‚)ç»„ä»¶
- **@Controller**ï¼š æ ‡è¯†è¡¨ç°å±‚ç»„ä»¶

å¯¹äºæ‰«æåˆ°çš„ç»„ä»¶ï¼ŒSpring æœ‰é»˜è®¤çš„å‘½åç­–ç•¥ï¼šä½¿ç”¨éé™å®šç±»åï¼Œç¬¬ä¸€ä¸ªå­—æ¯å°å†™ã€‚ä¹Ÿå¯ä»¥åœ¨æ³¨è§£ä¸­é€šè¿‡ value å±æ€§å€¼æ ‡è¯†ç»„ä»¶çš„åç§°ã€‚

å½“åœ¨ç»„ä»¶ç±»ä¸Šä½¿ç”¨äº†ç‰¹å®šçš„æ³¨è§£ä¹‹åï¼Œè¿˜éœ€è¦åœ¨ Spring çš„é…ç½®æ–‡ä»¶ä¸­å£°æ˜ `<context:component-scan>`ï¼š

- `base-package` å±æ€§æŒ‡å®šä¸€ä¸ªéœ€è¦æ‰«æçš„åŸºç±»åŒ…ï¼ŒSpring å®¹å™¨å°†ä¼šæ‰«æè¿™ä¸ªåŸºç±»åŒ…é‡ŒåŠå…¶å­åŒ…ä¸­çš„æ‰€æœ‰ç±»

- å½“éœ€è¦æ‰«æå¤šä¸ªåŒ…æ—¶, å¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”

- å¦‚æœä»…å¸Œæœ›æ‰«æç‰¹å®šçš„ç±»è€ŒéåŸºåŒ…ä¸‹çš„æ‰€æœ‰ç±»ï¼Œå¯ä½¿ç”¨ `resource-pattern` å±æ€§è¿‡æ»¤ç‰¹å®šçš„ç±»ï¼Œç¤ºä¾‹ï¼š

  ```xml
  <context:component-scan base-package="priv.starfish.front.web.controller"
  	annotation-config="true" resource-pattern="autowire/*.class"/>
  ```

  

### ğŸ¯ Spring Beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„ï¼Ÿ

Springçš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€æ˜¯**ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰å’Œæ§åˆ¶åè½¬ï¼ˆInversion of Control, IoCï¼‰**ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µå¸®åŠ©ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»ã€‚

åœ¨Springä¸­ï¼Œ**Bean**æŒ‡çš„æ˜¯ç”±Spring IoCå®¹å™¨ç®¡ç†çš„å¯¹è±¡ã€‚Beançš„ç”Ÿå‘½å‘¨æœŸä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µæ„æˆï¼š

1. **å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ï¼š**Springå®¹å™¨é¦–å…ˆæ ¹æ®Beanå®šä¹‰åˆ›å»ºBeançš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ã€å·¥å‚æ–¹æ³•ç­‰æ–¹å¼åˆ›å»ºã€‚
2. **å±æ€§èµ‹å€¼ï¼ˆPopulating Propertiesï¼‰ï¼š**åœ¨Beanå®ä¾‹åŒ–åï¼ŒSpringä¼šè¿›è¡Œ**ä¾èµ–æ³¨å…¥**ã€‚Springæ ¹æ®Beançš„å®šä¹‰ï¼Œä¸ºè¿™ä¸ªå®ä¾‹æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ï¼Œä¾‹å¦‚ä¸ºå±æ€§èµ‹å€¼ã€è°ƒç”¨`@Autowired`æ³¨è§£çš„æ–¹æ³•ç­‰ã€‚
3. **åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼š**
   - åœ¨å®Œæˆå±æ€§èµ‹å€¼åï¼ŒSpringä¼šè°ƒç”¨Beançš„åˆå§‹åŒ–æ–¹æ³•ã€‚å¦‚æœBeanå®ç°äº†`InitializingBean`æ¥å£ï¼ŒSpringä¼šè°ƒç”¨å…¶`afterPropertiesSet()`æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨Beanå®šä¹‰ä¸­æŒ‡å®šäº†`init-method`ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚
   - æ­¤å¤–ï¼Œå¦‚æœBeanè¢«å£°æ˜ä¸ºéœ€è¦æŸä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ï¼Œæ¯”å¦‚`@PostConstruct`æ³¨è§£çš„å›è°ƒæ–¹æ³•ï¼Œä¹Ÿä¼šåœ¨æ­¤é˜¶æ®µæ‰§è¡Œã€‚
4. **ä½¿ç”¨ï¼ˆUsing the Beanï¼‰ï¼š**åœ¨Beanå®Œæˆåˆå§‹åŒ–åï¼Œå®ƒå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚æ­¤æ—¶ï¼ŒBeanå¤„äºSpringå®¹å™¨çš„æ§åˆ¶ä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥è·å–å¹¶ä½¿ç”¨è¯¥Beanã€‚
5. **é”€æ¯ï¼ˆDestructionï¼‰ï¼š**
   - å½“Springå®¹å™¨å…³é—­æ—¶ï¼ˆä¾‹å¦‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è¢«å…³é—­ï¼‰ï¼ŒSpringä¼šé”€æ¯Beanã€‚å¦‚æœBeanå®ç°äº†`DisposableBean`æ¥å£ï¼ŒSpringä¼šè°ƒç”¨å…¶`destroy()`æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨Beanå®šä¹‰ä¸­æŒ‡å®šäº†`destroy-method`ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚
   - å¦‚æœBeanä½¿ç”¨äº†`@PreDestroy`æ³¨è§£ï¼ŒSpringä¹Ÿä¼šåœ¨æ­¤é˜¶æ®µæ‰§è¡Œç›¸åº”çš„æ–¹æ³•ã€‚

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
@Component
public class LifecycleDemo implements BeanNameAware, InitializingBean, DisposableBean {
    
    private String beanName;
    
    public LifecycleDemo() {
        System.out.println("1. æ„é€ å™¨æ‰§è¡Œ");
    }
    
    @Autowired
    public void setDependency(SomeDependency dependency) {
        System.out.println("2. å±æ€§æ³¨å…¥");
    }
    
    @Override
    public void setBeanName(String name) {
        this.beanName = name;
        System.out.println("3. BeanNameAwareå›è°ƒï¼š" + name);
    }
    
    @PostConstruct
    public void postConstruct() {
        System.out.println("4. @PostConstructæ‰§è¡Œ");
    }
    
    @Override
    public void afterPropertiesSet() {
        System.out.println("5. InitializingBean.afterPropertiesSet()");
    }
    
    @PreDestroy
    public void preDestroy() {
        System.out.println("6. @PreDestroyæ‰§è¡Œ");
    }
    
    @Override
    public void destroy() {
        System.out.println("7. DisposableBean.destroy()");
    }
}
```



### ğŸ¯ ä»€ä¹ˆæ˜¯ Spring è£…é…?

åœ¨ Spring æ¡†æ¶ä¸­ï¼Œ**è£…é…ï¼ˆWiringï¼‰**æ˜¯æŒ‡å°†ä¸€ä¸ªå¯¹è±¡çš„ä¾èµ–å…³ç³»æ³¨å…¥åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„è¿‡ç¨‹ã€‚é€šè¿‡è£…é…ï¼ŒSpring å®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œå‡å°‘äº†åº”ç”¨ç¨‹åºä¸­æ˜¾å¼åœ°åˆ›å»ºå’Œç®¡ç†å¯¹è±¡çš„ä»£ç ã€‚è£…é…æ˜¯ Spring IoCï¼ˆæ§åˆ¶åè½¬ï¼‰å®¹å™¨çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œå®ƒä½¿å¾— Spring åº”ç”¨èƒ½å¤Ÿè½»æ¾åœ°å°†ä¸åŒçš„ç»„ä»¶è¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚

**Spring è£…é…çš„ç±»å‹**

Spring æä¾›äº†å‡ ç§ä¸åŒçš„æ–¹å¼æ¥è£…é… Beanï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š

1. **æ„é€ å™¨æ³¨å…¥ï¼ˆConstructor Injectionï¼‰**
2. **Setter æ³¨å…¥ï¼ˆSetter Injectionï¼‰**
3. **å­—æ®µæ³¨å…¥ï¼ˆField Injectionï¼‰**
4. **è‡ªåŠ¨è£…é…ï¼ˆAutowiringï¼‰**
5. **åŸºäº XML é…ç½®çš„è£…é…**

> ä¾èµ–æ³¨å…¥çš„æœ¬è´¨å°±æ˜¯è£…é…ï¼Œè£…é…æ˜¯ä¾èµ–æ³¨å…¥çš„å…·ä½“è¡Œä¸ºã€‚



### ğŸ¯ ä»€ä¹ˆæ˜¯beanè‡ªåŠ¨è£…é…ï¼Ÿ

**Bean è‡ªåŠ¨è£…é…ï¼ˆBean Autowiringï¼‰** æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€é¡¹é‡è¦åŠŸèƒ½ï¼Œç”¨äºè‡ªåŠ¨æ»¡è¶³ä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä»–å¯¹è±¡çš„ä¾èµ–ã€‚é€šè¿‡è‡ªåŠ¨è£…é…ï¼ŒSpring å®¹å™¨èƒ½å¤Ÿæ ¹æ®é…ç½®çš„è§„åˆ™ï¼Œå°†æ‰€éœ€çš„ä¾èµ–å¯¹è±¡è‡ªåŠ¨æ³¨å…¥åˆ°ç›®æ ‡ Bean ä¸­ï¼Œè€Œæ— éœ€æ‰‹åŠ¨æ˜¾å¼å®šä¹‰ä¾èµ–å…³ç³»ã€‚è¿™ç§æœºåˆ¶æå¤§åœ°ç®€åŒ–äº†ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚

åœ¨Springæ¡†æ¶æœ‰å¤šç§è‡ªåŠ¨è£…é…ï¼Œè®©æˆ‘ä»¬é€ä¸€åˆ†æ

1. **no**ï¼šè¿™æ˜¯Springæ¡†æ¶çš„é»˜è®¤è®¾ç½®ï¼Œåœ¨è¯¥è®¾ç½®ä¸‹è‡ªåŠ¨è£…é…æ˜¯å…³é—­çš„ï¼Œå¼€å‘è€…éœ€è¦è‡ªè¡Œåœ¨beanautowireå±æ€§é‡ŒæŒ‡å®šè‡ªåŠ¨è£…é…çš„æ¨¡å¼

2. **byName**ï¼š**æŒ‰åç§°è‡ªåŠ¨è£…é…ï¼ˆç»“åˆ `@Qualifier` æ³¨è§£ï¼‰**å¦‚æœå®¹å™¨ä¸­æœ‰å¤šä¸ªç›¸åŒç±»å‹çš„ Beanï¼Œå¯ä»¥ä½¿ç”¨ `@Qualifier` æ³¨è§£ç»“åˆ `@Autowired` æ¥æŒ‰åç§°æŒ‡å®šå…·ä½“çš„ Beanã€‚

3. **byType**ï¼šæŒ‰ç±»å‹è‡ªåŠ¨è£…é… (`@Autowired` é»˜è®¤æ–¹å¼)

4. **constructor**ï¼šé€šè¿‡åœ¨æ„é€ å™¨ä¸Šæ·»åŠ  `@Autowired` æ³¨è§£ï¼ŒSpring ä¼šæ ¹æ®æ„é€ å™¨å‚æ•°çš„ç±»å‹è‡ªåŠ¨æ³¨å…¥å¯¹åº”çš„ Beanã€‚è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿åœ¨å¯¹è±¡åˆ›å»ºæ—¶ï¼Œæ‰€æœ‰ä¾èµ–é¡¹éƒ½å·²å®Œå…¨æ³¨å…¥ã€‚

5. **autodetect**ï¼šSpringé¦–å…ˆå°è¯•é€šè¿‡ *constructor* ä½¿ç”¨è‡ªåŠ¨è£…é…æ¥è¿æ¥ï¼Œå¦‚æœå®ƒä¸æ‰§è¡Œï¼ŒSpring å°è¯•é€šè¿‡ *byType* æ¥è‡ªåŠ¨è£…é…ã€Spring 4.x ä¸­å·²ç»è¢«åºŸå¼ƒã€‘

åœ¨è‡ªåŠ¨è£…é…æ—¶ï¼ŒSpring ä¼šæ£€æŸ¥å®¹å™¨ä¸­çš„æ‰€æœ‰ Beanï¼Œå¹¶æ ¹æ®è§„åˆ™é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ Bean æ¥æ»¡è¶³ä¾èµ–ã€‚å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ Bean æˆ–æ‰¾åˆ°å¤šä¸ªå€™é€‰ Beanï¼Œå¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚



### ğŸ¯ è‡ªåŠ¨è£…é…æœ‰ä»€ä¹ˆå±€é™ï¼Ÿ

- åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€å­—ç¬¦ä¸²å­—é¢é‡ã€ç±»å­—é¢é‡æ— æ³•ä½¿ç”¨è‡ªåŠ¨è£…é…æ¥æ³¨å…¥ã€‚
- è£…é…ä¾èµ–ä¸­è‹¥æ˜¯å‡ºç°åŒ¹é…åˆ°å¤šä¸ªbeanï¼ˆå‡ºç°æ­§ä¹‰æ€§ï¼‰ï¼Œè£…é…å°†ä¼šå¤±è´¥



### ğŸ¯ Spring Beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿå¦‚ä½•é€‰æ‹©ï¼Ÿ

"Springæ”¯æŒå¤šç§Beanä½œç”¨åŸŸï¼Œç”¨äºæ§åˆ¶Beançš„åˆ›å»ºç­–ç•¥å’Œç”Ÿå‘½å‘¨æœŸï¼š

**æ ¸å¿ƒä½œç”¨åŸŸ**ï¼š

**1. singletonï¼ˆå•ä¾‹ï¼Œé»˜è®¤ï¼‰**ï¼š
- æ•´ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªBeanå®ä¾‹
- çº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€æ³¨æ„å¹¶å‘è®¿é—®
- é€‚ç”¨äºæ— çŠ¶æ€çš„æœåŠ¡å±‚ç»„ä»¶

**2. prototypeï¼ˆåŸå‹ï¼‰**ï¼š
- æ¯æ¬¡getBean()éƒ½åˆ›å»ºæ–°å®ä¾‹
- Springä¸ç®¡ç†prototype Beançš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- é€‚ç”¨äºæœ‰çŠ¶æ€çš„Bean

**Webç¯å¢ƒä½œç”¨åŸŸ**ï¼š

**3. requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰**ï¼š
- æ¯ä¸ªHTTPè¯·æ±‚åˆ›å»ºä¸€ä¸ªBeanå®ä¾‹
- è¯·æ±‚ç»“æŸåå®ä¾‹è¢«é”€æ¯
- ç”¨äºå­˜å‚¨è¯·æ±‚ç›¸å…³æ•°æ®

**4. sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰**ï¼š
- æ¯ä¸ªHTTP Sessionåˆ›å»ºä¸€ä¸ªå®ä¾‹
- Sessionå¤±æ•ˆåå®ä¾‹è¢«é”€æ¯
- ç”¨äºå­˜å‚¨ç”¨æˆ·ä¼šè¯æ•°æ®

**5. applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰**ï¼š
- æ•´ä¸ªWebåº”ç”¨åªæœ‰ä¸€ä¸ªå®ä¾‹
- ç»‘å®šåˆ°ServletContextç”Ÿå‘½å‘¨æœŸ

**é€‰æ‹©åŸåˆ™**ï¼š
- æ— çŠ¶æ€Bean â†’ singleton
- æœ‰çŠ¶æ€Bean â†’ prototype  
- Webæ•°æ® â†’ request/session
- å…¨å±€å…±äº« â†’ application"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// å•ä¾‹Beanï¼ˆé»˜è®¤ï¼‰
@Component
public class SingletonService {
    private int counter = 0; // çº¿ç¨‹ä¸å®‰å…¨ï¼
    
    public void increment() {
        counter++;
    }
}

// åŸå‹Bean
@Component
@Scope("prototype") 
public class PrototypeBean {
    private int counter = 0; // æ¯ä¸ªå®ä¾‹ç‹¬ç«‹
}

// è¯·æ±‚ä½œç”¨åŸŸ
@Component
@RequestScope
public class RequestBean {
    private String requestId = UUID.randomUUID().toString();
}

// ä¼šè¯ä½œç”¨åŸŸ  
@Component
@SessionScope
public class UserSession {
    private String userId;
    private Map<String, Object> attributes = new HashMap<>();
}
```



### ğŸ¯ Spring æ¡†æ¶ä¸­çš„å•ä¾‹ **Beans** æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¹ˆ?

> Spring å®¹å™¨ä¸­çš„Beanæ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Œå®¹å™¨æœ¬èº«å¹¶æ²¡æœ‰æä¾›Beançš„çº¿ç¨‹å®‰å…¨ç­–ç•¥ï¼Œå› æ­¤å¯ä»¥è¯´Springå®¹å™¨ä¸­çš„Beanæœ¬èº«ä¸å…·å¤‡çº¿ç¨‹å®‰å…¨çš„ç‰¹æ€§ï¼Œä½†æ˜¯å…·ä½“è¿˜æ˜¯è¦ç»“åˆå…·ä½“scopeçš„Beanå»ç ”ç©¶ã€‚
>
> çº¿ç¨‹å®‰å…¨è¿™ä¸ªé—®é¢˜ï¼Œè¦ä»å•ä¾‹ä¸åŸå‹Beanåˆ†åˆ«è¿›è¡Œè¯´æ˜ã€‚
>
> **ã€ŒåŸå‹Beanã€**å¯¹äºåŸå‹Bean,æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¹‹é—´å¹¶ä¸å­˜åœ¨Beanå…±äº«ï¼Œè‡ªç„¶æ˜¯ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚
>
> **ã€Œå•ä¾‹Beanã€**å¯¹äºå•ä¾‹Bean,æ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«ä¸€ä¸ªå•ä¾‹å®ä¾‹Bean,å› æ­¤æ˜¯å­˜åœ¨èµ„æºçš„ç«äº‰ã€‚

åœ¨ Spring æ¡†æ¶ä¸­ï¼Œå•ä¾‹ï¼ˆ**Singleton**ï¼‰Beans é»˜è®¤æ˜¯**çº¿ç¨‹ä¸å®‰å…¨çš„**ï¼Œè¿™å–å†³äº Bean çš„å†…éƒ¨çŠ¶æ€ä»¥åŠæ˜¯å¦å¯¹å…¶è¿›è¡Œäº†é€‚å½“çš„åŒæ­¥å’Œç®¡ç†ã€‚å…·ä½“æ¥è¯´ï¼ŒSpring çš„ **å•ä¾‹ä½œç”¨åŸŸ** è¡¨ç¤ºå®¹å™¨åªä¼šåˆ›å»ºè¯¥ Bean çš„å•ä¸€å®ä¾‹å¹¶å…±äº«ï¼Œä½†å®ƒå¹¶æ²¡æœ‰è‡ªåŠ¨ä¿è¯ Bean å®ä¾‹æœ¬èº«çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚

1. å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨é—®é¢˜çš„åŸå› 

   - **å•ä¾‹æ¨¡å¼**æ„å‘³ç€ Spring å®¹å™¨ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºè¯¥ Bean çš„å”¯ä¸€å®ä¾‹ï¼Œå¹¶ä¸”æ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¼šä½¿ç”¨è¿™ä¸ªå®ä¾‹ã€‚å› æ­¤ï¼Œå¦‚æœè¯¥ Bean è¢«å¤šä¸ªçº¿ç¨‹å…±äº«å¹¶ä¸”å†…éƒ¨çŠ¶æ€æ˜¯å¯å˜çš„ï¼ˆå³ Bean çš„å±æ€§å€¼å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œåˆ™å¿…é¡»å°å¿ƒå¤„ç†ï¼Œä»¥é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

   - **çº¿ç¨‹ä¸å®‰å…¨çš„å®ä¾‹**ï¼šå¦‚æœå•ä¾‹ Bean ä¸­çš„å­—æ®µæ˜¯å¯å˜çš„ä¸”æ²¡æœ‰æ­£ç¡®åŒæ­¥ï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹è®¿é—®è¯¥ Bean æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç«æ€æ¡ä»¶ã€è„è¯»ã€å†™å†²çªç­‰é—®é¢˜ã€‚

2. å•ä¾‹ Bean çº¿ç¨‹å®‰å…¨çš„å‡ ç§æƒ…å†µ

- æ— çŠ¶æ€çš„å•ä¾‹ Beanï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

  å¦‚æœå•ä¾‹ Bean æ²¡æœ‰ä»»ä½•å¯å˜çš„æˆå‘˜å˜é‡ï¼Œæˆ–è€…æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆä¾‹å¦‚ `final` ç±»å‹æˆ– `@Value` æ³¨å…¥çš„å¸¸é‡ï¼‰ï¼Œåˆ™å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸åŒçº¿ç¨‹åœ¨è®¿é—®è¯¥ Bean æ—¶ä¸ä¼šä¿®æ”¹å…¶çŠ¶æ€ã€‚

  ```java
  @Component
  public class MyService {
      public String greet(String name) {
          return "Hello, " + name;
      }
  }
  ```

  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`MyService` æ˜¯æ— çŠ¶æ€çš„ï¼Œæ–¹æ³•å†…éƒ¨æ²¡æœ‰ä»»ä½•æˆå‘˜å˜é‡ï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè€Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

- æœ‰çŠ¶æ€çš„å•ä¾‹ Beanï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰

  å¦‚æœå•ä¾‹ Bean çš„æŸäº›å­—æ®µæ˜¯å¯å˜çš„ï¼Œæˆ–è€…å®ƒä»¬ä¼šéšç€æ–¹æ³•è°ƒç”¨è€Œå˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œå®ä¾‹å˜é‡ä¾èµ–äºè¯·æ±‚å‚æ•°æˆ–å…¶ä»–å¤–éƒ¨å› ç´ ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¼šå˜å¾—çº¿ç¨‹ä¸å®‰å…¨ã€‚

  ```java
  @Component
  public class CounterService {
      private int counter = 0;
  
      public void increment() {
          counter++;  // éçº¿ç¨‹å®‰å…¨æ“ä½œ
      }
  
      public int getCounter() {
          return counter;
      }
  }
  ```

  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`CounterService` æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå› ä¸º `counter` å­—æ®µçš„å€¼ä¼šæ ¹æ® `increment()` æ–¹æ³•çš„è°ƒç”¨è€Œå˜åŒ–ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ `increment()` æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç«æ€æ¡ä»¶ï¼ˆrace conditionï¼‰ï¼Œä»è€Œå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

- æœ‰çŠ¶æ€çš„å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨å¤„ç†

  å¦‚æœä½ çš„å•ä¾‹ Bean æ˜¯æœ‰çŠ¶æ€çš„ï¼Œä¸”ä½ éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥è‡ªå·±æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼šæ¯”å¦‚åŒæ­¥æ–¹æ³•ã€åŸå­ç±»ç­‰

> - **æ— çŠ¶æ€çš„å•ä¾‹ Bean**ï¼šå¦‚æœå•ä¾‹ Bean æ²¡æœ‰å¯å˜çŠ¶æ€ï¼ˆå³æ²¡æœ‰å®ä¾‹å­—æ®µæˆ–è€…æ‰€æœ‰å­—æ®µéƒ½æ˜¯ `final` çš„ï¼‰ï¼Œé‚£ä¹ˆå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
> - **æœ‰çŠ¶æ€çš„å•ä¾‹ Bean**ï¼šå¦‚æœå•ä¾‹ Bean çš„å­—æ®µæ˜¯å¯å˜çš„ï¼Œä¸”åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯èƒ½ä¼šè¢«åŒæ—¶è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒæ˜¯**çº¿ç¨‹ä¸å®‰å…¨çš„**ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»é€šè¿‡åŒæ­¥ã€åŸå­ç±»ã€æˆ–è€… `ThreadLocal` ç­‰æŠ€æœ¯æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚
> - **Spring ä¸ä¼šè‡ªåŠ¨ä¸ºå•ä¾‹ Bean æä¾›çº¿ç¨‹å®‰å…¨æœºåˆ¶**ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚

> â€œSpring æ¡†æ¶ä¸­çš„å•ä¾‹ Bean é»˜è®¤æƒ…å†µä¸‹å¹¶ä¸ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚å•ä¾‹æ¨¡å¼æ„å‘³ç€åŒä¸€ä¸ª Bean å®ä¾‹ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œå› æ­¤å¦‚æœ Bean æœ‰å¯å˜çš„çŠ¶æ€ï¼ˆä¾‹å¦‚æˆå‘˜å˜é‡ä¼šåœ¨æ–¹æ³•è°ƒç”¨ä¸­å‘ç”Ÿå˜åŒ–ï¼‰ï¼Œå°±å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒæ­¥æœºåˆ¶ã€åŸå­ç±»æˆ–è€… `ThreadLocal` æ¥ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨è®¿é—®ã€‚å¦‚æœ Bean æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚â€



### ğŸ¯ ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–ï¼ŸSpringå¦‚ä½•è§£å†³ï¼Ÿ

"å¾ªç¯ä¾èµ–æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªBeanç›¸äº’ä¾èµ–çš„æƒ…å†µï¼ŒSpringé€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶å·§å¦™è§£å†³ï¼š

**å¾ªç¯ä¾èµ–åœºæ™¯**ï¼š
- Aä¾èµ–Bï¼ŒBä¾èµ–Açš„ç›¸äº’ä¾èµ–
- Aâ†’Bâ†’Câ†’Açš„ç¯å½¢ä¾èµ–é“¾
- æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼ˆæ— æ³•è§£å†³ï¼‰

**ä¸‰çº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ**ï¼š

**1. ä¸€çº§ç¼“å­˜(singletonObjects)**ï¼š
- å­˜å‚¨å®Œå…¨åˆå§‹åŒ–å®Œæˆçš„Beanå®ä¾‹
- æœ€ç»ˆå¯ä»¥è¢«å¤–éƒ¨ä½¿ç”¨çš„Bean

**2. äºŒçº§ç¼“å­˜(earlySingletonObjects)**ï¼š
- å­˜å‚¨æ—©æœŸæš´éœ²çš„Beanå®ä¾‹
- å·²å®ä¾‹åŒ–ä½†æœªå®Œæˆå±æ€§æ³¨å…¥çš„Bean

**3. ä¸‰çº§ç¼“å­˜(singletonFactories)**ï¼š
- å­˜å‚¨Beanå·¥å‚å¯¹è±¡
- ç”¨äºç”Ÿæˆæ—©æœŸBeanå¼•ç”¨ï¼Œæ”¯æŒAOP

**è§£å†³æµç¨‹ï¼ˆAä¾èµ–Bï¼ŒBä¾èµ–Aï¼‰**ï¼š
1. åˆ›å»ºAå®ä¾‹ï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜
2. Aæ³¨å…¥Bæ—¶ï¼Œè§¦å‘Bçš„åˆ›å»º
3. Bæ³¨å…¥Aæ—¶ï¼Œä»ä¸‰çº§ç¼“å­˜è·å–Açš„æ—©æœŸå¼•ç”¨
4. Bå®Œæˆåˆ›å»ºï¼ŒAç»§ç»­å®Œæˆåˆå§‹åŒ–

**æ³¨æ„é™åˆ¶**ï¼š
- åªèƒ½è§£å†³setteræ³¨å…¥çš„å¾ªç¯ä¾èµ–
- æ„é€ å™¨å¾ªç¯ä¾èµ–ä¼šæŠ›å‡ºBeanCurrentlyInCreationException
- prototypeä½œç”¨åŸŸçš„å¾ªç¯ä¾èµ–æ— æ³•è§£å†³"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// å¯ä»¥è§£å†³çš„setteræ³¨å…¥å¾ªç¯ä¾èµ–
@Component
public class ServiceA {
    @Autowired
    private ServiceB serviceB; // setteræ³¨å…¥
}

@Component  
public class ServiceB {
    @Autowired
    private ServiceA serviceA; // setteræ³¨å…¥
}

// æ— æ³•è§£å†³çš„æ„é€ å™¨å¾ªç¯ä¾èµ–
@Component
public class ServiceC {
    private final ServiceD serviceD;
    
    public ServiceC(ServiceD serviceD) { // æ„é€ å™¨æ³¨å…¥
        this.serviceD = serviceD;
    }
}

@Component
public class ServiceD {
    private final ServiceC serviceC;
    
    public ServiceD(ServiceC serviceC) { // æ„é€ å™¨æ³¨å…¥ - ä¼šæŠ¥é”™ï¼
        this.serviceC = serviceC;
    }
}
```

### ğŸ¯ BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«ï¼Ÿ



"BeanFactoryå’ŒApplicationContextéƒ½æ˜¯Springçš„IOCå®¹å™¨ï¼Œä½†åŠŸèƒ½å’Œç‰¹æ€§æœ‰é‡è¦åŒºåˆ«ï¼š

**BeanFactoryï¼ˆåŸºç¡€å®¹å™¨ï¼‰**ï¼š
- Springæœ€åŸå§‹çš„å®¹å™¨æ¥å£
- æä¾›åŸºæœ¬çš„IOCåŠŸèƒ½å’ŒBeanç®¡ç†
- æ‡’åŠ è½½ï¼šä½¿ç”¨æ—¶æ‰åˆ›å»ºBean
- åŠŸèƒ½ç®€å•ï¼Œå†…å­˜å ç”¨å°
- é¢å‘Springå†…éƒ¨ä½¿ç”¨

**ApplicationContextï¼ˆé«˜çº§å®¹å™¨ï¼‰**ï¼š
- BeanFactoryçš„å­æ¥å£ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§
- ç»§æ‰¿å¤šä¸ªæ¥å£ï¼Œæä¾›ä¼ä¸šçº§ç‰¹æ€§
- é¥¿åŠ è½½ï¼šå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºæ‰€æœ‰Bean
- åŠŸèƒ½ä¸°å¯Œï¼Œä½†å†…å­˜å ç”¨è¾ƒå¤§
- é¢å‘åº”ç”¨å¼€å‘è€…ä½¿ç”¨

**åŠŸèƒ½å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | BeanFactory | ApplicationContext |
|------|-------------|-------------------|
| BeanåŠ è½½ | æ‡’åŠ è½½ | é¥¿åŠ è½½ |
| å›½é™…åŒ– | ä¸æ”¯æŒ | æ”¯æŒMessageSource |
| äº‹ä»¶æœºåˆ¶ | ä¸æ”¯æŒ | æ”¯æŒApplicationEvent |
| AOPæ”¯æŒ | ä¸æ”¯æŒ | å®Œæ•´æ”¯æŒ |
| æ³¨è§£é…ç½® | éƒ¨åˆ†æ”¯æŒ | å®Œæ•´æ”¯æŒ |
| èµ„æºè®¿é—® | ä¸æ”¯æŒ | æ”¯æŒResourceLoader |

**å¸¸ç”¨å®ç°ç±»**ï¼š
- ClassPathXmlApplicationContext
- AnnotationConfigApplicationContext  
- GenericWebApplicationContext"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// BeanFactoryåŸºç¡€ç”¨æ³•
DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();
XmlBeanDefinitionReader reader = new XmlBeanDefinitionReader(beanFactory);
reader.loadBeanDefinitions("applicationContext.xml");
UserService userService = beanFactory.getBean(UserService.class);

// ApplicationContextç”¨æ³•ï¼ˆæ¨èï¼‰
ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
UserService userService = context.getBean(UserService.class);

// åˆ©ç”¨ApplicationContextçš„é«˜çº§ç‰¹æ€§
@Component
public class EventPublisher implements ApplicationContextAware {
    private ApplicationContext applicationContext;
    
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
    }
    
    public void publishEvent(String message) {
        applicationContext.publishEvent(new CustomEvent(this, message));
    }
}
```

---

## ğŸ¯ äºŒã€AOPé¢å‘åˆ‡é¢ç¼–ç¨‹

**æ ¸å¿ƒç†å¿µ**ï¼šå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–ç¨‹åº¦ã€‚

### ğŸ¯ ä»€ä¹ˆæ˜¯AOPï¼Ÿæ ¸å¿ƒæ¦‚å¿µæœ‰å“ªäº›ï¼Ÿ

"AOPå…¨ç§°Aspect Oriented Programmingï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯å¯¹OOPçš„è¡¥å……å’Œæ‰©å±•ï¼š

**AOPæ ¸å¿ƒæ€æƒ³**ï¼š
- å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨ï¼‰ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»
- é€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°æ–¹æ³•å¢å¼º
- æé«˜ä»£ç çš„æ¨¡å—åŒ–ç¨‹åº¦å’Œå¯ç»´æŠ¤æ€§

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

**1. åˆ‡é¢ï¼ˆAspectï¼‰**ï¼š
- æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–å°è£…
- åŒ…å«åˆ‡ç‚¹å’Œé€šçŸ¥çš„ç»„åˆ
- ä½¿ç”¨@Aspectæ³¨è§£å®šä¹‰

**2. è¿æ¥ç‚¹ï¼ˆJoinPointï¼‰**ï¼š
- ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½æ’å…¥åˆ‡é¢çš„ç‚¹
- Spring AOPä¸­ç‰¹æŒ‡æ–¹æ³•æ‰§è¡Œç‚¹
- åŒ…å«æ–¹æ³•ä¿¡æ¯ã€å‚æ•°ã€ç›®æ ‡å¯¹è±¡ç­‰

**3. åˆ‡ç‚¹ï¼ˆPointcutï¼‰**ï¼š
- åŒ¹é…è¿æ¥ç‚¹çš„è¡¨è¾¾å¼
- å®šä¹‰åœ¨å“ªäº›æ–¹æ³•ä¸Šåº”ç”¨é€šçŸ¥
- ä½¿ç”¨AspectJè¡¨è¾¾å¼è¯­è¨€

**4. é€šçŸ¥ï¼ˆAdviceï¼‰**ï¼š
- åœ¨ç‰¹å®šè¿æ¥ç‚¹æ‰§è¡Œçš„ä»£ç 
- åŒ…å«å‰ç½®ã€åç½®ã€ç¯ç»•ã€å¼‚å¸¸ã€æœ€ç»ˆé€šçŸ¥

**5. ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰**ï¼š
- è¢«é€šçŸ¥çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸šåŠ¡é€»è¾‘å¯¹è±¡

**6. ç»‡å…¥ï¼ˆWeavingï¼‰**ï¼š
- å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†çš„è¿‡ç¨‹
- Springé‡‡ç”¨è¿è¡Œæ—¶ç»‡å…¥"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Aspect
@Component
public class LoggingAspect {
    
    // å®šä¹‰åˆ‡ç‚¹
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}
    
    @Pointcut("@annotation(com.example.annotation.Log)")
    public void logAnnotation() {}
    
    // å‰ç½®é€šçŸ¥
    @Before("serviceLayer()")
    public void beforeAdvice(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        Object[] args = joinPoint.getArgs();
        System.out.println("æ–¹æ³•æ‰§è¡Œå‰: " + methodName + ", å‚æ•°: " + Arrays.toString(args));
    }
    
    // ç¯ç»•é€šçŸ¥
    @Around("logAnnotation()")
    public Object aroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        Object result = joinPoint.proceed();
        long endTime = System.currentTimeMillis();
        System.out.println("æ–¹æ³•æ‰§è¡Œè€—æ—¶: " + (endTime - startTime) + "ms");
        return result;
    }
    
    // å¼‚å¸¸é€šçŸ¥
    @AfterThrowing(pointcut = "serviceLayer()", throwing = "ex")
    public void afterThrowingAdvice(JoinPoint joinPoint, Exception ex) {
        System.out.println("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸: " + ex.getMessage());
    }
}
```

### ğŸ¯ Spring AOPçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

"Spring AOPåŸºäºåŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°ï¼Œæ ¹æ®ç›®æ ‡å¯¹è±¡çš„ä¸åŒé‡‡ç”¨ä¸åŒçš„ä»£ç†ç­–ç•¥ï¼š

**åŠ¨æ€ä»£ç†æœºåˆ¶**ï¼š

**1. JDKåŠ¨æ€ä»£ç†**ï¼š
- **é€‚ç”¨æ¡ä»¶**ï¼šç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£
- **å®ç°åŸç†**ï¼šåŸºäºjava.lang.reflect.Proxy
- **ä»£ç†æ–¹å¼**ï¼šç”Ÿæˆæ¥å£çš„å®ç°ç±»ä½œä¸ºä»£ç†
- **ä¼˜ç‚¹**ï¼šJDKå†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–
- **ç¼ºç‚¹**ï¼šåªèƒ½ä»£ç†æ¥å£æ–¹æ³•

**2. CGLIBåŠ¨æ€ä»£ç†**ï¼š
- **é€‚ç”¨æ¡ä»¶**ï¼šç›®æ ‡å¯¹è±¡æœªå®ç°æ¥å£
- **å®ç°åŸç†**ï¼šåŸºäºASMå­—èŠ‚ç æ“ä½œ
- **ä»£ç†æ–¹å¼**ï¼šç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ä½œä¸ºä»£ç†
- **ä¼˜ç‚¹**ï¼šå¯ä»¥ä»£ç†æ™®é€šç±»
- **ç¼ºç‚¹**ï¼šæ— æ³•ä»£ç†finalç±»å’Œæ–¹æ³•

**ä»£ç†åˆ›å»ºæµç¨‹**ï¼š
1. Springæ£€æŸ¥ç›®æ ‡å¯¹è±¡æ˜¯å¦å®ç°æ¥å£
2. æœ‰æ¥å£â†’JDKåŠ¨æ€ä»£ç†ï¼Œæ— æ¥å£â†’CGLIBä»£ç†
3. åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç»‡å…¥åˆ‡é¢é€»è¾‘
4. è¿”å›ä»£ç†å¯¹è±¡ä¾›å®¢æˆ·ç«¯ä½¿ç”¨

**æ–¹æ³•è°ƒç”¨æµç¨‹**ï¼š
1. å®¢æˆ·ç«¯è°ƒç”¨ä»£ç†å¯¹è±¡æ–¹æ³•
2. ä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨
3. æ‰§è¡Œå‰ç½®é€šçŸ¥
4. è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•
5. æ‰§è¡Œåç½®é€šçŸ¥
6. è¿”å›ç»“æœç»™å®¢æˆ·ç«¯

**å¼ºåˆ¶ä½¿ç”¨CGLIB**ï¼š
- @EnableAspectJAutoProxy(proxyTargetClass=true)
- æˆ–é…ç½®spring.aop.proxy-target-class=true"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// ç›®æ ‡æ¥å£å’Œå®ç°ï¼ˆä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼‰
public interface UserService {
    void saveUser(String username);
}

@Service
public class UserServiceImpl implements UserService {
    @Override
    public void saveUser(String username) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + username);
    }
}

// æ— æ¥å£çš„ç±»ï¼ˆä¼šä½¿ç”¨CGLIBä»£ç†ï¼‰
@Service
public class OrderService {
    public void createOrder(String orderId) {
        System.out.println("åˆ›å»ºè®¢å•: " + orderId);
    }
}

// å¼ºåˆ¶ä½¿ç”¨CGLIB
@Configuration
@EnableAspectJAutoProxy(proxyTargetClass = true)
public class AopConfig {
}

// ä»£ç†å·¥å‚ä½¿ç”¨ç¤ºä¾‹
public class ProxyFactoryDemo {
    public void testProxy() {
        ProxyFactory factory = new ProxyFactory();
        factory.setTarget(new UserServiceImpl());
        factory.addAdvice(new MethodInterceptor() {
            @Override
            public Object invoke(MethodInvocation invocation) throws Throwable {
                System.out.println("æ–¹æ³•è°ƒç”¨å‰");
                Object result = invocation.proceed();
                System.out.println("æ–¹æ³•è°ƒç”¨å");
                return result;
            }
        });
        
        UserService proxy = (UserService) factory.getProxy();
        proxy.saveUser("å¼ ä¸‰");
    }
}
```

### ğŸ¯ Spring AOPçš„é€šçŸ¥ç±»å‹æœ‰å“ªäº›ï¼Ÿ

"Spring AOPæä¾›äº†äº”ç§é€šçŸ¥ç±»å‹ï¼Œåˆ†åˆ«åœ¨æ–¹æ³•æ‰§è¡Œçš„ä¸åŒæ—¶æœºç”Ÿæ•ˆï¼š

**é€šçŸ¥ç±»å‹è¯¦è§£**ï¼š

**1. @Before å‰ç½®é€šçŸ¥**ï¼š
- åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ
- ä¸èƒ½é˜»æ­¢ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
- é€‚ç”¨äºå‚æ•°æ ¡éªŒã€æƒé™æ£€æŸ¥

**2. @AfterReturning è¿”å›åé€šçŸ¥**ï¼š
- åœ¨ç›®æ ‡æ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œ
- å¯ä»¥è®¿é—®æ–¹æ³•è¿”å›å€¼
- é€‚ç”¨äºç»“æœå¤„ç†ã€ç¼“å­˜æ›´æ–°

**3. @AfterThrowing å¼‚å¸¸é€šçŸ¥**ï¼š
- åœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œ
- å¯ä»¥è®¿é—®å¼‚å¸¸ä¿¡æ¯
- é€‚ç”¨äºå¼‚å¸¸å¤„ç†ã€é”™è¯¯è®°å½•

**4. @After æœ€ç»ˆé€šçŸ¥**ï¼š
- æ— è®ºæ–¹æ³•æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ
- ç±»ä¼¼finallyå—çš„ä½œç”¨
- é€‚ç”¨äºèµ„æºæ¸…ç†

**5. @Around ç¯ç»•é€šçŸ¥**ï¼š
- åŒ…å›´ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
- åŠŸèƒ½æœ€å¼ºå¤§ï¼Œå¯æ§åˆ¶æ˜¯å¦æ‰§è¡Œç›®æ ‡æ–¹æ³•
- é€‚ç”¨äºæ€§èƒ½ç›‘æ§ã€äº‹åŠ¡æ§åˆ¶

**æ‰§è¡Œé¡ºåº**ï¼š
- æ­£å¸¸æµç¨‹ï¼š@Aroundå‰ â†’ @Before â†’ ç›®æ ‡æ–¹æ³• â†’ @AfterReturning â†’ @After â†’ @Aroundå
- å¼‚å¸¸æµç¨‹ï¼š@Aroundå‰ â†’ @Before â†’ ç›®æ ‡æ–¹æ³• â†’ @AfterThrowing â†’ @After â†’ @Aroundå"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Aspect
@Component
public class AdviceTypeDemo {
    
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}
    
    @Before("serviceLayer()")
    public void beforeAdvice(JoinPoint joinPoint) {
        System.out.println("1. å‰ç½®é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œå‰");
    }
    
    @AfterReturning(pointcut = "serviceLayer()", returning = "result")
    public void afterReturningAdvice(JoinPoint joinPoint, Object result) {
        System.out.println("2. è¿”å›åé€šçŸ¥ï¼šæ–¹æ³•æ­£å¸¸è¿”å›ï¼Œç»“æœ=" + result);
    }
    
    @AfterThrowing(pointcut = "serviceLayer()", throwing = "ex")
    public void afterThrowingAdvice(JoinPoint joinPoint, Exception ex) {
        System.out.println("3. å¼‚å¸¸é€šçŸ¥ï¼šæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸=" + ex.getMessage());
    }
    
    @After("serviceLayer()")
    public void afterAdvice(JoinPoint joinPoint) {
        System.out.println("4. æœ€ç»ˆé€šçŸ¥ï¼šæ— è®ºæ­£å¸¸è¿˜æ˜¯å¼‚å¸¸éƒ½æ‰§è¡Œ");
    }
    
    @Around("serviceLayer()")
    public Object aroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {
        System.out.println("5. ç¯ç»•é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œå‰");
        try {
            Object result = joinPoint.proceed(); // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            System.out.println("6. ç¯ç»•é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œå");
            return result;
        } catch (Exception e) {
            System.out.println("7. ç¯ç»•é€šçŸ¥ï¼šæ•è·å¼‚å¸¸");
            throw e;
        }
    }
}
```

### ğŸ¯ åˆ‡ç‚¹è¡¨è¾¾å¼æ€ä¹ˆå†™ï¼Ÿ

"åˆ‡ç‚¹è¡¨è¾¾å¼ä½¿ç”¨AspectJè¯­æ³•ï¼Œç”¨äºç²¾ç¡®åŒ¹é…è¿æ¥ç‚¹ï¼ŒSpring AOPä¸»è¦æ”¯æŒexecutionè¡¨è¾¾å¼ï¼š

**executionè¡¨è¾¾å¼è¯­æ³•**ï¼š
```
execution([ä¿®é¥°ç¬¦] è¿”å›å€¼ç±»å‹ [ç±»å].æ–¹æ³•å(å‚æ•°åˆ—è¡¨) [throws å¼‚å¸¸])
```

**é€šé…ç¬¦è¯´æ˜**ï¼š
- `*`ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤äº†åŒ…åˆ†éš”ç¬¦.ï¼‰
- `..`ï¼šåŒ¹é…ä»»æ„æ•°é‡çš„å‚æ•°æˆ–åŒ…å±‚çº§
- `+`ï¼šåŒ¹é…å­ç±»å‹

**å¸¸ç”¨è¡¨è¾¾å¼æ¨¡å¼**ï¼š

**1. æ–¹æ³•çº§åˆ«åŒ¹é…**ï¼š
- `execution(* com.example.service.UserService.findById(..))`
- åŒ¹é…UserServiceç±»çš„findByIdæ–¹æ³•

**2. ç±»çº§åˆ«åŒ¹é…**ï¼š
- `execution(* com.example.service.UserService.*(..))`
- åŒ¹é…UserServiceç±»çš„æ‰€æœ‰æ–¹æ³•

**3. åŒ…çº§åˆ«åŒ¹é…**ï¼š
- `execution(* com.example.service.*.*(..))`
- åŒ¹é…serviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•

**4. é€’å½’åŒ…åŒ¹é…**ï¼š
- `execution(* com.example.service..*.*(..))`
- åŒ¹é…serviceåŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•

**å…¶ä»–åˆ‡ç‚¹æŒ‡ç¤ºç¬¦**ï¼š
- `@annotation`ï¼šåŒ¹é…æ ‡æ³¨äº†æŒ‡å®šæ³¨è§£çš„æ–¹æ³•
- `@within`ï¼šåŒ¹é…æ ‡æ³¨äº†æŒ‡å®šæ³¨è§£çš„ç±»
- `args`ï¼šåŒ¹é…å‚æ•°ç±»å‹
- `target`ï¼šåŒ¹é…ç›®æ ‡å¯¹è±¡ç±»å‹
- `this`ï¼šåŒ¹é…ä»£ç†å¯¹è±¡ç±»å‹"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Aspect
@Component
public class PointcutExpressionDemo {
    
    // åŒ¹é…æ‰€æœ‰publicæ–¹æ³•
    @Pointcut("execution(public * *(..))")
    public void publicMethods() {}
    
    // åŒ¹é…Serviceå±‚æ‰€æœ‰æ–¹æ³•
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}
    
    // åŒ¹é…è¿”å›å€¼ä¸ºStringçš„æ–¹æ³•
    @Pointcut("execution(String com.example..*.*(..))")
    public void stringMethods() {}
    
    // åŒ¹é…å•ä¸ªå‚æ•°ä¸ºStringçš„æ–¹æ³•
    @Pointcut("execution(* com.example..*.*(String))")
    public void stringParameterMethods() {}
    
    // åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºStringçš„æ–¹æ³•
    @Pointcut("execution(* com.example..*.*(String,..))")
    public void firstStringParameterMethods() {}
    
    // åŒ¹é…æ ‡æ³¨äº†@Transactionalçš„æ–¹æ³•
    @Pointcut("@annotation(org.springframework.transaction.annotation.Transactional)")
    public void transactionalMethods() {}
    
    // åŒ¹é…Controllerç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•
    @Pointcut("@within(org.springframework.stereotype.Controller)")
    public void controllerMethods() {}
    
    // ç»„åˆåˆ‡ç‚¹è¡¨è¾¾å¼
    @Pointcut("serviceLayer() && !stringMethods()")
    public void serviceLayerExceptString() {}
    
    @Before("publicMethods() && args(username)")
    public void beforePublicMethodWithUsername(String username) {
        System.out.println("è°ƒç”¨publicæ–¹æ³•ï¼Œç”¨æˆ·åå‚æ•°: " + username);
    }
}

// è‡ªå®šä¹‰æ³¨è§£ç¤ºä¾‹
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Log {
    String value() default "";
}

@Service
public class UserService {
    @Log("æŸ¥è¯¢ç”¨æˆ·")
    public User findById(String id) {
        return new User(id);
    }
}
```



### ğŸ¯ AOP æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ

å®ç° AOP çš„æŠ€æœ¯ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

- é™æ€ä»£ç† - æŒ‡ä½¿ç”¨ AOP æ¡†æ¶æä¾›çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œä»è€Œåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ç”Ÿæˆ AOP ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºç¼–è¯‘æ—¶å¢å¼ºï¼›
  - ç¼–è¯‘æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šç¼–è¯‘å™¨å®ç°ï¼‰
  - ç±»åŠ è½½æ—¶ç¼–ç»‡ï¼ˆç‰¹æ®Šçš„ç±»åŠ è½½å™¨å®ç°ï¼‰ã€‚
- åŠ¨æ€ä»£ç† - åœ¨è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­â€œä¸´æ—¶â€ç”Ÿæˆ AOP åŠ¨æ€ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºè¿è¡Œæ—¶å¢å¼ºã€‚
  - JDK åŠ¨æ€ä»£ç†
  - CGLIB



### ğŸ¯ Spring AOP å®ç°åŸç†

Spring AOP çš„å®ç°åŸç†åŸºäº**åŠ¨æ€ä»£ç†**å’Œ**å­—èŠ‚ç å¢å¼º**ï¼Œå…¶æ ¸å¿ƒæ˜¯é€šè¿‡åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå°†æ¨ªåˆ‡é€»è¾‘ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ï¼‰ç»‡å…¥ç›®æ ‡æ–¹æ³•ä¸­ã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°åŸç†çš„è¯¦ç»†è§£æï¼š

> `Spring`çš„`AOP`å®ç°åŸç†å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡**åŠ¨æ€ä»£ç†**å®ç°çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸º`Spring`çš„æŸä¸ª`bean`é…ç½®äº†åˆ‡é¢ï¼Œé‚£ä¹ˆ`Spring`åœ¨åˆ›å»ºè¿™ä¸ª`bean`çš„æ—¶å€™ï¼Œå®é™…ä¸Šåˆ›å»ºçš„æ˜¯è¿™ä¸ª`bean`çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬åç»­å¯¹`bean`ä¸­æ–¹æ³•çš„è°ƒç”¨ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†ç±»é‡å†™çš„ä»£ç†æ–¹æ³•ã€‚è€Œ`Spring`çš„`AOP`ä½¿ç”¨äº†ä¸¤ç§åŠ¨æ€ä»£ç†ï¼Œåˆ†åˆ«æ˜¯**JDKçš„åŠ¨æ€ä»£ç†**ï¼Œä»¥åŠ**CGLibçš„åŠ¨æ€ä»£ç†**ã€‚

ä¸€ã€**æ ¸å¿ƒå®ç°æœºåˆ¶ï¼šåŠ¨æ€ä»£ç†**

Spring AOP é€šè¿‡ä¸¤ç§åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°åˆ‡é¢é€»è¾‘çš„ç»‡å…¥ï¼š

1. **JDK åŠ¨æ€ä»£ç†**

   - **é€‚ç”¨æ¡ä»¶**ï¼šç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ã€‚

   - **å®ç°åŸç†**ï¼šåŸºäº `java.lang.reflect.Proxy` ç±»ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£å¹¶é‡å†™æ–¹æ³•ã€‚

   - å…³é”®æºç ï¼š

     ```java
     Proxy.newProxyInstance(ClassLoader, interfaces, InvocationHandler);
     ```

     åœ¨  `InvocationHandler#invoke()` æ–¹æ³•ä¸­æ‹¦æˆªç›®æ ‡æ–¹æ³•ï¼Œæ‰§è¡Œåˆ‡é¢é€»è¾‘ï¼ˆå¦‚å‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ï¼‰ã€‚

2. **CGLIB åŠ¨æ€ä»£ç†**

   - **é€‚ç”¨æ¡ä»¶**ï¼šç›®æ ‡å¯¹è±¡æœªå®ç°æ¥å£ã€‚

   - **å®ç°åŸç†**ï¼šé€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»ç”Ÿæˆå­ç±»ä»£ç†ï¼Œè¦†ç›–çˆ¶ç±»æ–¹æ³•å¹¶æ’å…¥åˆ‡é¢é€»è¾‘ã€‚

   - å…³é”®æºç ï¼š

     ```java
     Enhancer enhancer = new Enhancer();
     enhancer.setSuperclass(targetClass);
     enhancer.setCallback(MethodInterceptor);
     ```

     åœ¨ `MethodInterceptor#intercept()` æ–¹æ³•ä¸­å®ç°æ–¹æ³•æ‹¦æˆª

äºŒã€æ ¸å¿ƒç»„ä»¶

1. **åˆ‡é¢ï¼ˆAspectï¼‰**ï¼šç”± **é€šçŸ¥ï¼ˆAdviceï¼‰** å’Œ **åˆ‡ç‚¹ï¼ˆPointcutï¼‰** ç»„æˆï¼Œå®šä¹‰æ¨ªåˆ‡é€»è¾‘ã€‚
2. **åˆ‡ç‚¹ï¼ˆPointcutï¼‰**ï¼šé€šè¿‡è¡¨è¾¾å¼ï¼ˆå¦‚ `execution(* com.example.service.*.*(..))`ï¼‰åŒ¹é…éœ€è¦æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•ã€‚
3. **é€šçŸ¥ï¼ˆAdviceï¼‰**
   - ç±»å‹ï¼š
     - `@Before`ï¼šåœ¨ç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œã€‚
     - `@After`ï¼šåœ¨ç›®æ ‡æ–¹æ³•åæ‰§è¡Œã€‚
     - `@Around`ï¼šåŒ…è£¹ç›®æ ‡æ–¹æ³•ï¼Œå¯æ§åˆ¶æ–¹æ³•æ‰§è¡Œã€‚
   - **æ‰§è¡Œé¡ºåº**ï¼šé€šè¿‡æ‹¦æˆªå™¨é“¾æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªé€šçŸ¥ã€‚

ä¸‰ã€ç»‡å…¥ï¼ˆWeavingï¼‰æµç¨‹

1. **ä»£ç†å¯¹è±¡ç”Ÿæˆ**
   - **å…¥å£**ï¼š`DefaultAopProxyFactory` æ ¹æ®ç›®æ ‡å¯¹è±¡é€‰æ‹© JDK æˆ– CGLIB ä»£ç†ã€‚
   - åˆ¤æ–­é€»è¾‘ï¼š
     - ç›®æ ‡ç±»æœ‰æ¥å£ â†’ JDK åŠ¨æ€ä»£ç†ã€‚
     - ç›®æ ‡ç±»æ— æ¥å£ â†’ CGLIB ä»£ç†ã€‚
2. **æ‹¦æˆªå™¨é“¾æ‰§è¡Œ**
   - æµç¨‹ï¼š
     1. é€šè¿‡ `AdvisedSupport` è·å–åŒ¹é…çš„æ‹¦æˆªå™¨é“¾ã€‚
     2. æŒ‰é¡ºåºæ‰§è¡Œæ‹¦æˆªå™¨çš„é€šçŸ¥é€»è¾‘ã€‚
     3. è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚

> | **ç‰¹æ€§**     | **JDK åŠ¨æ€ä»£ç†**                                             | **CGLIB åŠ¨æ€ä»£ç†**                                           |
> | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
> | **åº•å±‚æŠ€æœ¯** | åŸºäº Java åå°„æœºåˆ¶ï¼Œé€šè¿‡ `Proxy` ç±»å’Œ `InvocationHandler` æ¥å£ç”Ÿæˆä»£ç†ç±»ã€‚ | åŸºäº **ASM å­—èŠ‚ç æ¡†æ¶**ï¼Œé€šè¿‡ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»å®ç°ä»£ç†ã€‚      |
> | **ä»£ç†æ–¹å¼** | åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼Œç”Ÿæˆæ¥å£çš„ä»£ç†ç±»ã€‚                   | å¯ä»£ç†æ™®é€šç±»ï¼ˆæ— éœ€æ¥å£ï¼‰ï¼Œç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»è¦†ç›–æ–¹æ³•ã€‚         |
> | **æ€§èƒ½**     | æ–¹æ³•è°ƒç”¨é€šè¿‡åå°„å®ç°ï¼Œæ€§èƒ½è¾ƒä½ã€‚                             | é€šè¿‡ **FastClass æœºåˆ¶** ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œæ€§èƒ½æ›´é«˜ï¼ˆä»¥ç©ºé—´æ¢æ—¶é—´ï¼‰ã€‚ |
> | **ä»£ç ç”Ÿæˆ** | è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç ã€‚                               | ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»å­—èŠ‚ç ï¼Œä¿®æ”¹åŸå§‹ç±»ç»“æ„ã€‚                     |
> | **é€‚ç”¨åœºæ™¯** | ä»£ç†æ¥å£å®ç°ç±»ï¼Œé€‚ç”¨äºè½»é‡çº§åº”ç”¨ã€‚                           | ä»£ç†æ— æ¥å£çš„ç±»ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½éœ€æ±‚åœºæ™¯ï¼ˆå¦‚ Spring AOPï¼‰ã€‚      |
> | **ä¼˜ç‚¹**     | 1. æ— éœ€ç¬¬ä¸‰æ–¹åº“ä¾èµ–ï¼›2. ä»£ç ç®€å•æ˜“ç”¨ã€‚                       | 1. æ”¯æŒä»£ç†æ™®é€šç±»å’Œ final æ–¹æ³•ï¼›2. æ€§èƒ½æ›´é«˜ï¼ˆFastClass æœºåˆ¶ï¼‰ã€‚ |
> | **ç¼ºç‚¹**     | 1. åªèƒ½ä»£ç†æ¥å£ï¼›2. åå°„è°ƒç”¨æ€§èƒ½è¾ƒä½ã€‚                       | 1. ç”Ÿæˆä»£ç†ç±»è€—æ—¶è¾ƒé•¿ï¼›2. å¯èƒ½ç ´åç±»å°è£…æ€§ï¼ˆå¦‚ä»£ç† final æ–¹æ³•éœ€ç‰¹æ®Šå¤„ç†ï¼‰ã€‚ |



### ğŸ¯ Spring AOP and AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- Spring AOP åŸºäºåŠ¨æ€ä»£ç†æ–¹å¼å®ç°ï¼ŒAspectJ åŸºäºé™æ€ä»£ç†æ–¹å¼å®ç°ã€‚
- Spring AOP ä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„ PointCutï¼›æä¾›äº†å®Œå…¨çš„ AOP æ”¯æŒï¼Œå®ƒè¿˜æ”¯æŒå±æ€§çº§åˆ«çš„ PointCutã€‚



### ğŸ¯ ä½ æœ‰æ²¡æœ‰â½¤è¿‡Springçš„AOP? æ˜¯â½¤æ¥â¼²å˜›çš„? â¼¤æ¦‚ä¼šæ€ä¹ˆä½¿â½¤ï¼Ÿ		

Spring AOP ä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **æ—¥å¿—è®°å½•**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åè‡ªåŠ¨è®°å½•æ—¥å¿—ã€‚
2. **æ€§èƒ½ç›‘æ§**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åè®°å½•æ—¶é—´ï¼Œç›‘æ§æ€§èƒ½ã€‚
3. **äº‹åŠ¡ç®¡ç†**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åè‡ªåŠ¨ç®¡ç†äº‹åŠ¡ã€‚
4. **å®‰å…¨æ£€æŸ¥**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰æ£€æŸ¥ç”¨æˆ·æƒé™ã€‚
5. **ç¼“å­˜**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œåç¼“å­˜ç»“æœä»¥æé«˜æ€§èƒ½ã€‚
6. **å¼‚å¸¸å¤„ç†**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œæ—¶ç»Ÿä¸€å¤„ç†å¼‚å¸¸ã€‚



### ğŸ¯ è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„åŒºåˆ«

**è¿‡æ»¤å™¨ï¼ˆFilterï¼‰**

- ä½œç”¨ï¼šè¿‡æ»¤å™¨ä¸»è¦ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ã€‚å®ƒå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾ Servlet ä¹‹å‰å’Œå“åº”è¿”å›å®¢æˆ·ç«¯ä¹‹å‰å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œä¿®æ”¹ã€‚

- ä½¿ç”¨åœºæ™¯

  - **è¯·æ±‚å’Œå“åº”çš„ç¼–ç è½¬æ¢**ï¼šä¾‹å¦‚ï¼Œå°†æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„ç¼–ç è®¾ç½®ä¸º UTF-8ã€‚

  - **æƒé™æ£€æŸ¥**ï¼šä¾‹å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œåˆ™é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚

  - **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ã€‚

  - **è¿‡æ»¤éæ³•è¯·æ±‚**ï¼šä¾‹å¦‚ï¼Œè¿‡æ»¤æ‰ä¸€äº›æ¶æ„çš„è¯·æ±‚ã€‚

- **å®ç°æ–¹å¼**

  è¿‡æ»¤å™¨æ˜¯åŸºäº Servlet API çš„ï¼Œé€šå¸¸éœ€è¦å®ç° `javax.servlet.Filter` æ¥å£ï¼Œå¹¶åœ¨ web.xml æ–‡ä»¶ä¸­é…ç½®æˆ–ä½¿ç”¨æ³¨è§£è¿›è¡Œé…ç½®ã€‚

**æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰**

- **ä½œç”¨**ï¼šæ‹¦æˆªå™¨ç”¨äºåœ¨è¯·æ±‚è¿›å…¥æ§åˆ¶å™¨ï¼ˆControllerï¼‰ä¹‹å‰å’Œç¦»å¼€æ§åˆ¶å™¨ä¹‹åè¿›è¡Œå¤„ç†ã€‚å®ƒä¸»è¦ç”¨äºå¤„ç†æ§åˆ¶å™¨å±‚é¢çš„é€»è¾‘ï¼Œå¦‚æ–¹æ³•è°ƒç”¨ä¹‹å‰çš„éªŒè¯ã€æ–¹æ³•è°ƒç”¨ä¹‹åçš„æ—¥å¿—è®°å½•ç­‰ã€‚

- **ä½¿ç”¨åœºæ™¯**ï¼š

  - **æƒé™éªŒè¯**ï¼šä¾‹å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®æŸä¸ªæ§åˆ¶å™¨æ–¹æ³•çš„æƒé™ã€‚

  - **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯ã€‚

  - **äº‹åŠ¡ç®¡ç†**ï¼šåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•è°ƒç”¨ä¹‹åæäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚

  - **æ•°æ®é¢„å¤„ç†**ï¼šåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰å‡†å¤‡æ•°æ®ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¹‹åå¤„ç†è¿”å›çš„æ•°æ®ã€‚

- **å®ç°æ–¹å¼**

  æ‹¦æˆªå™¨é€šå¸¸ä¸æ¡†æ¶ï¼ˆå¦‚ Spring MVCï¼‰é›†æˆï¼Œä½¿ç”¨æ¡†æ¶æä¾›çš„æ¥å£è¿›è¡Œé…ç½®å’Œå®ç°ã€‚ä¾‹å¦‚ï¼Œåœ¨ Spring MVC ä¸­ï¼Œæ‹¦æˆªå™¨éœ€è¦å®ç° `HandlerInterceptor` æ¥å£ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶æˆ–æ³¨è§£ä¸­è¿›è¡Œé…ç½®ã€‚

| ç‰¹ç‚¹     | è¿‡æ»¤å™¨ï¼ˆFilterï¼‰                            | æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰                                        |
| -------- | ------------------------------------------- | ------------------------------------------------------------ |
| ä½œç”¨èŒƒå›´ | å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†              | å¯¹æ§åˆ¶å™¨æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†                         |
| ä½¿ç”¨åœºæ™¯ | è¯·æ±‚å’Œå“åº”çš„ç¼–ç è½¬æ¢ã€æƒé™æ£€æŸ¥ã€æ—¥å¿—è®°å½•ç­‰  | æƒé™éªŒè¯ã€æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰                               |
| å®ç°æ–¹å¼ | å®ç° `javax.servlet.Filter` æ¥å£            | å®ç°æ¡†æ¶æä¾›çš„æ‹¦æˆªå™¨æ¥å£ï¼ˆå¦‚ Spring çš„ `HandlerInterceptor`ï¼‰ |
| é…ç½®æ–¹å¼ | é…ç½®åœ¨ web.xml æ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ³¨è§£             | é…ç½®åœ¨æ¡†æ¶çš„é…ç½®æ–‡ä»¶æˆ–ä½¿ç”¨æ³¨è§£                               |
| æ‰§è¡Œæ—¶æœº | åœ¨è¯·æ±‚åˆ°è¾¾ Servlet ä¹‹å‰å’Œå“åº”è¿”å›å®¢æˆ·ç«¯ä¹‹å‰ | åœ¨æ§åˆ¶å™¨æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œä¹‹å                                   |



---

## ğŸŒ ä¸‰ã€Spring MVCæ¶æ„

**æ ¸å¿ƒç†å¿µ**ï¼šåŸºäºMVCè®¾è®¡æ¨¡å¼çš„Webæ¡†æ¶ï¼Œæä¾›çµæ´»çš„è¯·æ±‚å¤„ç†å’Œè§†å›¾æ¸²æŸ“æœºåˆ¶ã€‚

### ğŸ¯ Spring MVC æ¡†æ¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

Spring Web MVC æ¡†æ¶æä¾› **æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨** æ¶æ„å’Œéšæ—¶å¯ç”¨çš„ç»„ä»¶ï¼Œç”¨äºå¼€å‘çµæ´»ä¸”æ¾æ•£è€¦åˆçš„ Web åº”ç”¨ç¨‹åºã€‚ MVC æ¨¡å¼æœ‰åŠ©äºåˆ†ç¦»åº”ç”¨ç¨‹åºçš„ä¸åŒæ–¹é¢ï¼Œå¦‚è¾“å…¥é€»è¾‘ï¼Œä¸šåŠ¡é€»è¾‘å’Œ UI é€»è¾‘ï¼ŒåŒæ—¶åœ¨æ‰€æœ‰è¿™äº›å…ƒç´ ä¹‹é—´æä¾›æ¾æ•£è€¦åˆã€‚



### ğŸ¯ Spring MVCçš„ä¼˜ç‚¹

- å¯ä»¥æ”¯æŒå„ç§è§†å›¾æŠ€æœ¯ï¼Œè€Œä¸ä»…ä»…å±€é™äºJSP
- ä¸Springæ¡†æ¶é›†æˆï¼ˆå¦‚IoCå®¹å™¨ã€AOPç­‰ï¼‰
- æ¸…æ™°çš„è§’è‰²åˆ†é…ï¼šå‰ç«¯æ§åˆ¶å™¨(dispatcherServlet) ï¼Œè¯·æ±‚åˆ°å¤„ç†å™¨æ˜ å°„ï¼ˆhandlerMapping)ï¼Œå¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapter)ï¼Œ è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰
- æ”¯æŒå„ç§è¯·æ±‚èµ„æºçš„æ˜ å°„ç­–ç•¥



### ğŸ¯ Spring MVC çš„æ•´ä½“æ¶æ„å’Œæ ¸å¿ƒç»„ä»¶ï¼Ÿ

> Spring MVC çš„æ¶æ„ä»¥ `DispatcherServlet` ä¸ºæ ¸å¿ƒï¼Œè´Ÿè´£è¯·æ±‚çš„è°ƒåº¦å’Œåˆ†å‘ï¼Œé€šè¿‡ `HandlerMapping` æ‰¾åˆ°å…·ä½“çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œåè¿”å› `ModelAndView`ï¼Œå¹¶é€šè¿‡ `ViewResolver` æ¸²æŸ“è§†å›¾ã€‚è¿™æ ·çš„æ¶æ„ä½¿å¾— Web åº”ç”¨ä¸­çš„è¯·æ±‚å¤„ç†è¿‡ç¨‹æ›´åŠ æ¸…æ™°å’Œæ¨¡å—åŒ–ã€‚

**Spring MVC** æ˜¯ä¸€ä¸ªåŸºäº Servlet çš„ Web æ¡†æ¶ï¼Œå®ƒéµå¾ªäº† **MVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼**ï¼Œå°†åº”ç”¨ç¨‹åºçš„ä¸åŒåŠŸèƒ½åˆ†ç¦»ï¼Œå¢å¼ºäº†åº”ç”¨çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œè§£è€¦æ€§ã€‚Spring MVC æ˜¯ Spring Framework ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ä¸ªçµæ´»çš„è¯·æ±‚å¤„ç†æµç¨‹å’Œ Web å±‚çš„è§£å†³æ–¹æ¡ˆã€‚

**Spring MVC çš„æ•´ä½“æ¶æ„**

Spring MVC æ¶æ„æ˜¯åŸºäºè¯·æ±‚é©±åŠ¨çš„æ¨¡å¼ï¼Œå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š

1. **DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰**ï¼š
   - Spring MVC çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæ‰€æœ‰çš„ HTTP è¯·æ±‚éƒ½é¦–å…ˆä¼šè¿›å…¥ `DispatcherServlet`ã€‚å®ƒä½œä¸ºå‰ç«¯æ§åˆ¶å™¨ï¼ˆFront Controllerï¼‰ï¼Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†è¯·æ±‚åˆ†å‘ç»™åˆé€‚çš„å¤„ç†å™¨ã€‚
   - `DispatcherServlet` ä» web.xml ä¸­è¿›è¡Œé…ç½®ï¼Œé€šå¸¸æ˜¯ Web åº”ç”¨çš„å…¥å£ã€‚
2. **HandlerMappingï¼ˆå¤„ç†å™¨æ˜ å°„å™¨ï¼‰**ï¼š
   - `HandlerMapping` çš„ä½œç”¨æ˜¯æ ¹æ®è¯·æ±‚çš„ URL æ‰¾åˆ°ç›¸åº”çš„å¤„ç†å™¨ï¼ˆControllerï¼‰ã€‚
   - å®ƒä¼šå°† URL æ˜ å°„åˆ°ç›¸åº”çš„å¤„ç†æ–¹æ³•ä¸Šï¼Œ`HandlerMapping` é€šè¿‡æŸ¥æ‰¾é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ˜ å°„å…³ç³»æ¥å†³å®šå“ªä¸ªæ§åˆ¶å™¨æ–¹æ³•åº”è¯¥å¤„ç†å½“å‰è¯·æ±‚ã€‚
3. **Controllerï¼ˆæ§åˆ¶å™¨ï¼‰**ï¼š
   - æ§åˆ¶å™¨æ˜¯ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†å…·ä½“çš„è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªè§†å›¾ã€‚
   - `@Controller` æ³¨è§£å®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œè€Œæ–¹æ³•ä¸Šé€šå¸¸ä½¿ç”¨ `@RequestMapping` æˆ–è€…æ›´ç»†ç²’åº¦çš„æ³¨è§£ï¼ˆå¦‚ `@GetMapping`ã€`@PostMapping`ï¼‰æ¥æ˜ å°„è¯·æ±‚ã€‚
4. **HandlerAdapterï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰**ï¼š
   - `HandlerAdapter` çš„ä½œç”¨æ˜¯æ ¹æ® `HandlerMapping` è¿”å›çš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼Œé€‰æ‹©åˆé€‚çš„é€‚é…å™¨æ¥è°ƒç”¨ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚
   - å®ƒæ˜¯ä¸ºäº†æ”¯æŒä¸åŒç±»å‹çš„æ§åˆ¶å™¨è€Œè®¾è®¡çš„ï¼Œé€šå¸¸ä¼šé€‰æ‹©å…·ä½“çš„é€‚é…å™¨ï¼Œå¦‚ `HttpRequestHandlerAdapter` æˆ– `AnnotationMethodHandlerAdapter`ã€‚
5. **ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼‰**ï¼š
   - `ViewResolver` è´Ÿè´£æ ¹æ®æ§åˆ¶å™¨è¿”å›çš„è§†å›¾åï¼ˆä¾‹å¦‚ JSP æ–‡ä»¶åï¼‰è§£æå‡ºå…·ä½“çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ `InternalResourceViewResolver`ï¼‰ã€‚
   - å®ƒæ ¹æ®è§†å›¾åç§°å°†å…¶è§£æä¸ºä¸€ä¸ªå®é™…çš„è§†å›¾ï¼Œæ¯”å¦‚ JSP æˆ– Thymeleaf æ¨¡æ¿ã€‚
6. **ModelAndViewï¼ˆæ¨¡å‹ä¸è§†å›¾ï¼‰**ï¼š
   - `ModelAndView` æ˜¯æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾åç§°ã€‚
   - `Model` å­˜å‚¨æ§åˆ¶å™¨æ‰§è¡Œåçš„æ•°æ®ï¼Œ`View` åˆ™æŒ‡å‘å…·ä½“çš„è§†å›¾æ¨¡æ¿ã€‚
7. **Viewï¼ˆè§†å›¾ï¼‰**ï¼š
   - è§†å›¾ç»„ä»¶è´Ÿè´£å°†æ¨¡å‹æ•°æ®æ¸²æŸ“æˆç”¨æˆ·å¯ä»¥æŸ¥çœ‹çš„é¡µé¢ï¼Œå¸¸è§çš„è§†å›¾æŠ€æœ¯åŒ…æ‹¬ JSPã€Thymeleafã€FreeMarker ç­‰ã€‚



### ğŸ¯ Spring MVC çš„è¿è¡Œæµç¨‹?

åœ¨æ•´ä¸ª Spring MVC æ¡†æ¶ä¸­ï¼Œ DispatcherServlet å¤„äºæ ¸å¿ƒä½ç½®ï¼Œè´Ÿè´£åè°ƒå’Œç»„ç»‡ä¸åŒç»„ä»¶ä»¥å®Œæˆè¯·æ±‚å¤„ç†å¹¶è¿”å›å“åº”çš„å·¥ä½œ

SpringMVC å¤„ç†è¯·æ±‚è¿‡ç¨‹ï¼š

> 1. **DispatcherServlet**æ¥æ”¶è¯·æ±‚ï¼Œå§”æ‰˜ç»™ HandlerMappingï¼›
> 2. HandlerMapping åŒ¹é…å¤„ç†å™¨ï¼ˆControllerï¼‰ï¼Œè¿”å› HandlerExecutionChainï¼›
> 3. è°ƒç”¨ HandlerAdapter æ‰§è¡Œ Controller æ–¹æ³•ï¼Œè¿”å› ModelAndViewï¼›
> 4. ViewResolver è§£æè§†å›¾ï¼Œæ¸²æŸ“å“åº”ç»“æœã€‚

1. **è¯·æ±‚æ¥æ”¶ä¸åˆ†å‘**
   - å…¥å£ï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘é€ HTTP è¯·æ±‚ï¼Œæ‰€æœ‰è¯·æ±‚é¦–å…ˆåˆ°è¾¾ `DispatcherServlet`ï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹çš„ç»Ÿä¸€å…¥å£ã€‚
   - æ ¸å¿ƒä½œç”¨ï¼š`DispatcherServlet` è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶åè°ƒåç»­å¤„ç†æµç¨‹ï¼Œç±»ä¼¼â€œè°ƒåº¦ä¸­å¿ƒâ€ã€‚
2. **å¤„ç†å™¨æ˜ å°„ï¼ˆHandlerMappingï¼‰**
   - æŸ¥æ‰¾å¤„ç†å™¨ï¼š`DispatcherServlet` è°ƒç”¨ `HandlerMapping` ç»„ä»¶ï¼Œæ ¹æ®è¯·æ±‚çš„ URL è·¯å¾„åŒ¹é…å¯¹åº”çš„å¤„ç†å™¨ï¼ˆController æˆ–å…¶æ–¹æ³•ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¸¦æœ‰ `@RequestMapping`æ³¨è§£çš„æ–¹æ³•ä¼šè¢«è¯†åˆ«ä¸º Handlerã€‚
   - è¿”å›æ‰§è¡Œé“¾ï¼š`HandlerMapping` è¿”å› `HandlerExecutionChain`ï¼ŒåŒ…å«ç›®æ ‡å¤„ç†å™¨åŠå…³è”çš„æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ã€‚
3. **å¤„ç†å™¨é€‚é…ï¼ˆHandlerAdapterï¼‰**
   - é€‚é…è°ƒç”¨ï¼š`DispatcherServlet` é€šè¿‡ `HandlerAdapter` è°ƒç”¨å¤„ç†å™¨æ–¹æ³•ã€‚HandlerAdapter è´Ÿè´£å°† Servlet çš„è¯·æ±‚å‚æ•°è½¬æ¢ä¸ºå¤„ç†å™¨æ–¹æ³•çš„è¾“å…¥ï¼Œå¹¶æ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚
   - è¿”å›å€¼å¤„ç†ï¼šå¤„ç†å™¨è¿”å› `ModelAndView` å¯¹è±¡ï¼ŒåŒ…å«æ¨¡å‹æ•°æ®ï¼ˆModelï¼‰å’Œè§†å›¾åç§°ï¼ˆViewï¼‰ã€‚
4. **è§†å›¾è§£æä¸æ¸²æŸ“**
   - è§†å›¾è§£æå™¨ï¼š`DispatcherServlet` å°†é€»è¾‘è§†å›¾åä¼ é€’ç»™ `ViewResolver`ï¼Œè§£æä¸ºå…·ä½“çš„è§†å›¾å¯¹è±¡ï¼ˆå¦‚ JSPã€Thymeleaf æ¨¡æ¿ï¼‰ã€‚
   - æ•°æ®æ¸²æŸ“ï¼šè§†å›¾å¯¹è±¡å°†æ¨¡å‹æ•°æ®å¡«å……åˆ°è¯·æ±‚åŸŸï¼Œç”Ÿæˆå“åº”å†…å®¹ï¼ˆå¦‚ HTMLï¼‰ï¼Œæœ€ç»ˆç”± DispatcherServlet è¿”å›å®¢æˆ·ç«¯ã€‚
5. **å¼‚å¸¸å¤„ç†**
   - **å¼‚å¸¸æ•è·**ï¼šè‹¥å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼ŒDispatcherServlet è°ƒç”¨ **HandlerExceptionResolver** ç»„ä»¶å¤„ç†ï¼Œç”Ÿæˆé”™è¯¯è§†å›¾æˆ– JSON å“åº”



### ğŸ¯ Spring çš„ Controller æ˜¯å•ä¾‹çš„å—ï¼Ÿå¤šçº¿ç¨‹æƒ…å†µä¸‹ Controller æ˜¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ

controlleré»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œä¸è¦ä½¿ç”¨éé™æ€çš„æˆå‘˜å˜é‡ï¼Œå¦åˆ™ä¼šå‘ç”Ÿæ•°æ®é€»è¾‘æ··ä¹±ã€‚æ­£å› ä¸ºå•ä¾‹æ‰€ä»¥ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„

```java
@Controller
//@Scope("prototype")
public class ScopeTestController {

    private int num = 0;

    @RequestMapping("/testScope")
    public void testScope() {
        System.out.println(++num);
    }

    @RequestMapping("/testScope2")
    public void testScope2() {
        System.out.println(++num);
    }

}
```

æˆ‘ä»¬é¦–å…ˆè®¿é—® `http://localhost:8080/testScope`ï¼Œå¾—åˆ°çš„ç­”æ¡ˆæ˜¯`1`ï¼›
ç„¶åæˆ‘ä»¬å†è®¿é—® `http://localhost:8080/testScope2`ï¼Œå¾—åˆ°çš„ç­”æ¡ˆæ˜¯ `2`ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥ç»™`controller`å¢åŠ ä½œç”¨å¤šä¾‹ `@Scope("prototype")`

æˆ‘ä»¬ä¾æ—§é¦–å…ˆè®¿é—® `http://localhost:8080/testScope`ï¼Œå¾—åˆ°çš„ç­”æ¡ˆæ˜¯`1`ï¼›
ç„¶åæˆ‘ä»¬å†è®¿é—® `http://localhost:8080/testScope2`ï¼Œå¾—åˆ°çš„ç­”æ¡ˆè¿˜æ˜¯ `1`ã€‚

**å•ä¾‹æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´å±æ€§é‡å¤ä½¿ç”¨**ã€‚

**è§£å†³æ–¹æ¡ˆ**

1. ä¸è¦åœ¨controllerä¸­å®šä¹‰æˆå‘˜å˜é‡
2. ä¸‡ä¸€å¿…é¡»è¦å®šä¹‰ä¸€ä¸ªéé™æ€æˆå‘˜å˜é‡æ—¶å€™ï¼Œåˆ™é€šè¿‡æ³¨è§£@Scope(â€œprototypeâ€)ï¼Œå°†å…¶è®¾ç½®ä¸ºå¤šä¾‹æ¨¡å¼ã€‚
3. åœ¨Controllerä¸­ä½¿ç”¨ThreadLocalå˜é‡



### ğŸ¯ Spring MVCçš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

"Spring MVCåŸºäºå‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼Œä»¥DispatcherServletä¸ºæ ¸å¿ƒåè°ƒå„ç»„ä»¶å®Œæˆè¯·æ±‚å¤„ç†ï¼š

**å®Œæ•´è¯·æ±‚å¤„ç†æµç¨‹**ï¼š

**1. è¯·æ±‚æ¥æ”¶**ï¼š
- ç”¨æˆ·å‘é€HTTPè¯·æ±‚åˆ°DispatcherServlet
- DispatcherServletä½œä¸ºå‰ç«¯æ§åˆ¶å™¨æ¥æ”¶æ‰€æœ‰è¯·æ±‚
- è¿™æ˜¯æ•´ä¸ªMVCæµç¨‹çš„ç»Ÿä¸€å…¥å£

**2. å¤„ç†å™¨æ˜ å°„**ï¼š
- DispatcherServletæŸ¥è¯¢HandlerMapping
- HandlerMappingæ ¹æ®URLæ‰¾åˆ°å¯¹åº”çš„Handler
- è¿”å›HandlerExecutionChainï¼ˆHandler + æ‹¦æˆªå™¨é“¾ï¼‰

**3. å¤„ç†å™¨é€‚é…**ï¼š
- DispatcherServleté€šè¿‡HandlerAdapterè°ƒç”¨Handler
- HandlerAdapteré€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨
- æ”¯æŒ@Controllerã€Controlleræ¥å£ç­‰å¤šç§å¤„ç†å™¨

**4. ä¸šåŠ¡å¤„ç†**ï¼š
- HandlerAdapterè°ƒç”¨å…·ä½“çš„Controlleræ–¹æ³•
- Controlleræ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨Serviceå±‚
- è¿”å›ModelAndViewæˆ–@ResponseBodyæ•°æ®

**5. å¼‚å¸¸å¤„ç†**ï¼š
- å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸
- HandlerExceptionResolverè¿›è¡Œå¼‚å¸¸å¤„ç†
- è¿”å›é”™è¯¯è§†å›¾æˆ–é”™è¯¯å“åº”

**6. è§†å›¾è§£æ**ï¼š
- ViewResolverè§£æé€»è¾‘è§†å›¾ååˆ°å…·ä½“è§†å›¾
- åˆ›å»ºViewå¯¹è±¡ç”¨äºæ¸²æŸ“
- å¯¹äº@ResponseBodyç›´æ¥è¿”å›ï¼Œè·³è¿‡è§†å›¾è§£æ

**7. è§†å›¾æ¸²æŸ“**ï¼š
- Viewæ¸²æŸ“æ¨¡å‹æ•°æ®ç”Ÿæˆå“åº”å†…å®¹
- å°†æœ€ç»ˆå“åº”è¿”å›ç»™å®¢æˆ·ç«¯

**æ ¸å¿ƒç»„ä»¶**ï¼š
- DispatcherServletï¼šå‰ç«¯æ§åˆ¶å™¨
- HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„å™¨
- HandlerAdapterï¼šå¤„ç†å™¨é€‚é…å™¨
- Controllerï¼šæ§åˆ¶å™¨
- ViewResolverï¼šè§†å›¾è§£æå™¨
- Viewï¼šè§†å›¾"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// 1. æ§åˆ¶å™¨ç¤ºä¾‹
@Controller
@RequestMapping("/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // è¿”å›è§†å›¾
    @GetMapping
    public String listUsers(Model model) {
        List<User> users = userService.findAll();
        model.addAttribute("users", users);
        return "user/list"; // é€»è¾‘è§†å›¾å
    }
    
    // è¿”å›JSONæ•°æ®
    @GetMapping("/api/{id}")
    @ResponseBody
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // å¤„ç†è¡¨å•æäº¤
    @PostMapping
    public String createUser(@ModelAttribute User user, 
                           RedirectAttributes redirectAttributes) {
        userService.save(user);
        redirectAttributes.addFlashAttribute("message", "ç”¨æˆ·åˆ›å»ºæˆåŠŸ");
        return "redirect:/users";
    }
}

// 2. è‡ªå®šä¹‰HandlerMapping
@Component
public class CustomHandlerMapping extends AbstractHandlerMapping {
    
    @Override
    protected Object getHandlerInternal(HttpServletRequest request) {
        String path = request.getRequestURI();
        if (path.startsWith("/custom/")) {
            return new CustomHandler();
        }
        return null;
    }
}

// 3. è‡ªå®šä¹‰HandlerAdapter
@Component
public class CustomHandlerAdapter implements HandlerAdapter {
    
    @Override
    public boolean supports(Object handler) {
        return handler instanceof CustomHandler;
    }
    
    @Override
    public ModelAndView handle(HttpServletRequest request, 
                              HttpServletResponse response, 
                              Object handler) throws Exception {
        CustomHandler customHandler = (CustomHandler) handler;
        String result = customHandler.handleRequest(request);
        
        ModelAndView mv = new ModelAndView();
        mv.addObject("result", result);
        mv.setViewName("custom/result");
        return mv;
    }
}

// 4. é…ç½®ç±»
@Configuration
@EnableWebMvc
@ComponentScan("com.example.controller")
public class WebMvcConfig implements WebMvcConfigurer {
    
    // é…ç½®è§†å›¾è§£æå™¨
    @Bean
    public InternalResourceViewResolver viewResolver() {
        InternalResourceViewResolver resolver = new InternalResourceViewResolver();
        resolver.setPrefix("/WEB-INF/views/");
        resolver.setSuffix(".jsp");
        return resolver;
    }
    
    // é…ç½®æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoggingInterceptor())
                .addPathPatterns("/**")
                .excludePathPatterns("/static/**");
    }
    
    // é…ç½®é™æ€èµ„æº
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**")
                .addResourceLocations("classpath:/static/");
    }
}

// 5. æ‹¦æˆªå™¨ç¤ºä¾‹
public class LoggingInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        System.out.println("è¯·æ±‚å‰ç½®å¤„ç†: " + request.getRequestURI());
        return true;
    }
    
    @Override
    public void postHandle(HttpServletRequest request, 
                          HttpServletResponse response, 
                          Object handler, 
                          ModelAndView modelAndView) {
        System.out.println("è¯·æ±‚åç½®å¤„ç†");
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, 
                               HttpServletResponse response, 
                               Object handler, 
                               Exception ex) {
        System.out.println("è¯·æ±‚å®Œæˆå¤„ç†");
    }
}
```

### ğŸ¯ Spring MVCçš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ

"Spring MVCåŸºäºç»„ä»¶åŒ–è®¾è®¡ï¼Œæ¯ä¸ªç»„ä»¶å„å¸å…¶èŒï¼ŒååŒå®Œæˆè¯·æ±‚å¤„ç†ï¼š

**æ ¸å¿ƒç»„ä»¶è¯¦è§£**ï¼š

**1. DispatcherServlet**ï¼š
- **ä½œç”¨**ï¼šå‰ç«¯æ§åˆ¶å™¨ï¼Œç»Ÿä¸€æ¥æ”¶å’Œåˆ†å‘è¯·æ±‚
- **èŒè´£**ï¼šåè°ƒå…¶ä»–ç»„ä»¶å®Œæˆè¯·æ±‚å¤„ç†
- **ç‰¹ç‚¹**ï¼šç»§æ‰¿HttpServletï¼Œæ˜¯MVCçš„å…¥å£ç‚¹

**2. HandlerMapping**ï¼š
- **ä½œç”¨**ï¼šå»ºç«‹URLä¸Handlerçš„æ˜ å°„å…³ç³»
- **å®ç°ç±»**ï¼šRequestMappingHandlerMappingã€BeanNameUrlHandlerMapping
- **ç‰¹ç‚¹**ï¼šæ”¯æŒæ³¨è§£ã€XMLã€ç¼–ç¨‹å¼é…ç½®

**3. HandlerAdapter**ï¼š
- **ä½œç”¨**ï¼šé€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨
- **å®ç°ç±»**ï¼šRequestMappingHandlerAdapterã€HttpRequestHandlerAdapter
- **ç‰¹ç‚¹**ï¼šä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œæ”¯æŒæ‰©å±•

**4. Controller**ï¼š
- **ä½œç”¨**ï¼šä¸šåŠ¡å¤„ç†å™¨ï¼Œæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘
- **ç±»å‹**ï¼š@Controlleræ³¨è§£ç±»ã€Controlleræ¥å£å®ç°
- **ç‰¹ç‚¹**ï¼šPOJOé£æ ¼ï¼Œæ”¯æŒä¾èµ–æ³¨å…¥

**5. ViewResolver**ï¼š
- **ä½œç”¨**ï¼šå°†é€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“è§†å›¾å¯¹è±¡
- **å®ç°ç±»**ï¼šInternalResourceViewResolverã€ThymeleafViewResolver
- **ç‰¹ç‚¹**ï¼šæ”¯æŒå¤šç§è§†å›¾æŠ€æœ¯

**6. View**ï¼š
- **ä½œç”¨**ï¼šæ¸²æŸ“æ¨¡å‹æ•°æ®ï¼Œç”Ÿæˆå“åº”å†…å®¹
- **ç±»å‹**ï¼šJSPã€Thymeleafã€JSONã€XMLç­‰
- **ç‰¹ç‚¹**ï¼šè´Ÿè´£æœ€ç»ˆçš„å†…å®¹è¾“å‡º

**7. HandlerExceptionResolver**ï¼š
- **ä½œç”¨**ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†
- **å®ç°æ–¹å¼**ï¼š@ExceptionHandlerã€@ControllerAdvice
- **ç‰¹ç‚¹**ï¼šæ”¯æŒå…¨å±€å’Œå±€éƒ¨å¼‚å¸¸å¤„ç†

**8. MultipartResolver**ï¼š
- **ä½œç”¨**ï¼šæ–‡ä»¶ä¸Šä¼ è§£æå™¨
- **å®ç°ç±»**ï¼šCommonsMultipartResolverã€StandardServletMultipartResolver
- **ç‰¹ç‚¹**ï¼šå¤„ç†multipart/form-dataè¯·æ±‚"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// 1. è‡ªå®šä¹‰ViewResolver
@Component
public class JsonViewResolver implements ViewResolver {
    
    @Override
    public View resolveViewName(String viewName, Locale locale) {
        if (viewName.startsWith("json:")) {
            return new MappingJackson2JsonView();
        }
        return null;
    }
}

// 2. å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(ValidationException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    @ResponseBody
    public ErrorResponse handleValidation(ValidationException e) {
        return new ErrorResponse(400, e.getMessage());
    }
    
    @ExceptionHandler(ResourceNotFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public String handleNotFound(ResourceNotFoundException e, Model model) {
        model.addAttribute("error", e.getMessage());
        return "error/404";
    }
    
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ResponseBody
    public ErrorResponse handleGeneral(Exception e) {
        return new ErrorResponse(500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");
    }
}

// 3. æ–‡ä»¶ä¸Šä¼ Controller
@Controller
@RequestMapping("/files")
public class FileUploadController {
    
    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file,
                           RedirectAttributes redirectAttributes) {
        if (file.isEmpty()) {
            redirectAttributes.addFlashAttribute("error", "è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶");
            return "redirect:/files";
        }
        
        try {
            // ä¿å­˜æ–‡ä»¶é€»è¾‘
            String fileName = file.getOriginalFilename();
            file.transferTo(new File("/upload/" + fileName));
            
            redirectAttributes.addFlashAttribute("success", "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: " + fileName);
        } catch (IOException e) {
            redirectAttributes.addFlashAttribute("error", "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
        
        return "redirect:/files";
    }
}

// 4. è‡ªå®šä¹‰æ‹¦æˆªå™¨é“¾
@Configuration
public class InterceptorConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // è®¤è¯æ‹¦æˆªå™¨
        registry.addInterceptor(new AuthInterceptor())
                .addPathPatterns("/admin/**")
                .excludePathPatterns("/admin/login");
        
        // æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨
        registry.addInterceptor(new PerformanceInterceptor())
                .addPathPatterns("/**");
        
        // å›½é™…åŒ–æ‹¦æˆªå™¨
        registry.addInterceptor(new LocaleChangeInterceptor())
                .addPathPatterns("/**");
    }
}

// 5. å‚æ•°è§£æå™¨
@Component
public class CurrentUserArgumentResolver implements HandlerMethodArgumentResolver {
    
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return parameter.hasParameterAnnotation(CurrentUser.class) 
            && parameter.getParameterType().equals(User.class);
    }
    
    @Override
    public Object resolveArgument(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory) {
        // ä»Sessionæˆ–JWT Tokenä¸­è·å–å½“å‰ç”¨æˆ·
        HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);
        return getCurrentUserFromSession(request);
    }
    
    private User getCurrentUserFromSession(HttpServletRequest request) {
        return (User) request.getSession().getAttribute("currentUser");
    }
}

// 6. ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°è§£æå™¨
@RestController
public class UserController {
    
    @GetMapping("/profile")
    public User getProfile(@CurrentUser User currentUser) {
        return currentUser; // currentUserç”±å‚æ•°è§£æå™¨æ³¨å…¥
    }
}
```

### ğŸ¯ @RequestMappingæ³¨è§£æœ‰å“ªäº›å±æ€§ï¼Ÿ



"@RequestMappingæ˜¯Spring MVCæœ€æ ¸å¿ƒçš„æ³¨è§£ï¼Œç”¨äºæ˜ å°„HTTPè¯·æ±‚åˆ°å¤„ç†æ–¹æ³•ï¼š

**æ ¸å¿ƒå±æ€§è¯¦è§£**ï¼š

**1. value/path**ï¼š
- æŒ‡å®šè¯·æ±‚çš„URLè·¯å¾„
- æ”¯æŒAnté£æ ¼çš„è·¯å¾„æ¨¡å¼
- å¯ä»¥æŒ‡å®šå¤šä¸ªURL

**2. method**ï¼š
- é™å®šHTTPè¯·æ±‚æ–¹æ³•
- å–å€¼ï¼šGETã€POSTã€PUTã€DELETEç­‰
- ä¸æŒ‡å®šåˆ™æ¥å—æ‰€æœ‰æ–¹æ³•

**3. params**ï¼š
- é™å®šè¯·æ±‚å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°
- æ”¯æŒå‚æ•°å­˜åœ¨æ€§å’Œå€¼åŒ¹é…
- æ ¼å¼ï¼š'param1', 'param1=value1'

**4. headers**ï¼š
- é™å®šè¯·æ±‚å¿…é¡»åŒ…å«æŒ‡å®šè¯·æ±‚å¤´
- æ”¯æŒè¯·æ±‚å¤´å­˜åœ¨æ€§å’Œå€¼åŒ¹é…
- æ ¼å¼ï¼š'header1', 'header1=value1'

**5. consumes**ï¼š
- é™å®šè¯·æ±‚çš„Content-Type
- æŒ‡å®šèƒ½å¤Ÿå¤„ç†çš„åª’ä½“ç±»å‹
- å¸¸ç”¨å€¼ï¼šapplication/json, application/xml

**6. produces**ï¼š
- é™å®šå“åº”çš„Content-Type
- æŒ‡å®šèƒ½å¤Ÿäº§ç”Ÿçš„åª’ä½“ç±»å‹
- å½±å“Acceptå¤´çš„å¤„ç†

**ç®€åŒ–æ³¨è§£**ï¼š
- @GetMapping = @RequestMapping(method = GET)
- @PostMapping = @RequestMapping(method = POST)
- @PutMapping = @RequestMapping(method = PUT)
- @DeleteMapping = @RequestMapping(method = DELETE)
- @PatchMapping = @RequestMapping(method = PATCH)"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Controller
@RequestMapping("/api/users")
public class UserController {
    
    // åŸºæœ¬æ˜ å°„
    @RequestMapping("/list")
    public String listUsers() {
        return "users/list";
    }
    
    // æŒ‡å®šè¯·æ±‚æ–¹æ³•
    @RequestMapping(value = "/save", method = RequestMethod.POST)
    public String saveUser() {
        return "redirect:/api/users/list";
    }
    
    // è·¯å¾„å˜é‡
    @RequestMapping("/detail/{id}")
    public String getUserDetail(@PathVariable Long id, Model model) {
        model.addAttribute("userId", id);
        return "users/detail";
    }
    
    // å‚æ•°é™å®š
    @RequestMapping(value = "/search", params = {"name", "age"})
    public String searchUsers(@RequestParam String name, 
                             @RequestParam int age) {
        return "users/search-result";
    }
    
    // è¯·æ±‚å¤´é™å®š
    @RequestMapping(value = "/api/data", 
                   headers = {"Accept=application/json", "X-API-Version=1.0"})
    @ResponseBody
    public List<User> getApiData() {
        return userService.findAll();
    }
    
    // Content-Typeé™å®š
    @RequestMapping(value = "/api/users", 
                   method = RequestMethod.POST,
                   consumes = "application/json",
                   produces = "application/json")
    @ResponseBody
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
    
    // ä½¿ç”¨ç®€åŒ–æ³¨è§£
    @GetMapping("/api/users/{id}")
    @ResponseBody
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    @PostMapping(value = "/api/users", 
                consumes = MediaType.APPLICATION_JSON_VALUE,
                produces = MediaType.APPLICATION_JSON_VALUE)
    @ResponseBody
    public ResponseEntity<User> createUserRest(@RequestBody @Valid User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(savedUser);
    }
    
    @PutMapping("/api/users/{id}")
    @ResponseBody
    public ResponseEntity<User> updateUser(@PathVariable Long id, 
                                          @RequestBody @Valid User user) {
        user.setId(id);
        User updatedUser = userService.update(user);
        return ResponseEntity.ok(updatedUser);
    }
    
    @DeleteMapping("/api/users/{id}")
    @ResponseBody
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return ResponseEntity.noContent().build();
    }
    
    // å¤æ‚è·¯å¾„åŒ¹é…
    @GetMapping("/files/**")
    public ResponseEntity<Resource> getFile(HttpServletRequest request) {
        String filePath = request.getRequestURI().substring("/files/".length());
        Resource resource = resourceLoader.getResource("classpath:static/" + filePath);
        return ResponseEntity.ok().body(resource);
    }
    
    // æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„
    @GetMapping("/users/{id:[0-9]+}")
    @ResponseBody
    public User getUserByNumericId(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // çŸ©é˜µå˜é‡
    @GetMapping("/users/{id}/books/{isbn}")
    @ResponseBody
    public Book getBook(@PathVariable Long id,
                       @PathVariable String isbn,
                       @MatrixVariable(name = "edition", pathVar = "isbn") String edition) {
        return bookService.findByIsbnAndEdition(isbn, edition);
    }
}
```

### ğŸ¯ å¦‚ä½•å¤„ç†JSONæ•°æ®å’Œæ–‡ä»¶ä¸Šä¼ ï¼Ÿ

"Spring MVCæä¾›äº†ä¸°å¯Œçš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œæ”¯æŒJSONæ•°æ®å’Œæ–‡ä»¶ä¸Šä¼ çš„æ— ç¼å¤„ç†ï¼š

**JSONæ•°æ®å¤„ç†**ï¼š

**1. æ¥æ”¶JSONæ•°æ®**ï¼š
- ä½¿ç”¨@RequestBodyæ³¨è§£è‡ªåŠ¨ååºåˆ—åŒ–
- éœ€è¦é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆé»˜è®¤å·²é…ç½®Jacksonï¼‰
- æ”¯æŒå¯¹è±¡ã€Listã€Mapç­‰å¤æ‚ç±»å‹

**2. è¿”å›JSONæ•°æ®**ï¼š
- ä½¿ç”¨@ResponseBodyæ³¨è§£è‡ªåŠ¨åºåˆ—åŒ–
- ä½¿ç”¨@RestControllerè‡ªåŠ¨åº”ç”¨äºæ‰€æœ‰æ–¹æ³•
- æ”¯æŒResponseEntityè¿›è¡Œæ›´ç»†ç²’åº¦æ§åˆ¶

**3. æ¶ˆæ¯è½¬æ¢å™¨é…ç½®**ï¼š
- MappingJackson2HttpMessageConverterå¤„ç†JSON
- å¯è‡ªå®šä¹‰ObjectMapperé…ç½®
- æ”¯æŒæ—¥æœŸæ ¼å¼ã€nullå€¼å¤„ç†ç­‰

**æ–‡ä»¶ä¸Šä¼ å¤„ç†**ï¼š

**1. å•æ–‡ä»¶ä¸Šä¼ **ï¼š
- ä½¿ç”¨MultipartFileæ¥æ”¶æ–‡ä»¶
- æ”¯æŒæ–‡ä»¶å…ƒä¿¡æ¯è·å–
- æä¾›transferToæ–¹æ³•ä¿å­˜æ–‡ä»¶

**2. å¤šæ–‡ä»¶ä¸Šä¼ **ï¼š
- ä½¿ç”¨MultipartFile[]æˆ–List<MultipartFile>
- éå†å¤„ç†æ¯ä¸ªæ–‡ä»¶

**3. é…ç½®è¦æ±‚**ï¼š
- éœ€è¦é…ç½®MultipartResolver
- è®¾ç½®æ–‡ä»¶å¤§å°é™åˆ¶
- æŒ‡å®šä¸´æ—¶ç›®å½•"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// 1. JSONæ•°æ®å¤„ç†Controller
@RestController
@RequestMapping("/api")
public class JsonController {
    
    // æ¥æ”¶JSONå¯¹è±¡
    @PostMapping("/users")
    public ResponseEntity<User> createUser(@RequestBody @Valid User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(savedUser);
    }
    
    // æ¥æ”¶JSONæ•°ç»„
    @PostMapping("/users/batch")
    public ResponseEntity<List<User>> createUsers(@RequestBody @Valid List<User> users) {
        List<User> savedUsers = userService.saveAll(users);
        return ResponseEntity.ok(savedUsers);
    }
    
    // è¿”å›JSONå¯¹è±¡
    @GetMapping("/users/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user != null) {
            return ResponseEntity.ok(user);
        } else {
            return ResponseEntity.notFound().build();
        }
    }
    
    // è¿”å›JSONæ•°ç»„
    @GetMapping("/users")
    public List<User> getUsers(@RequestParam(defaultValue = "0") int page,
                              @RequestParam(defaultValue = "10") int size) {
        return userService.findAll(PageRequest.of(page, size)).getContent();
    }
    
    // å¤„ç†å¤æ‚JSONç»“æ„
    @PostMapping("/orders")
    public ResponseEntity<ApiResponse<Order>> createOrder(@RequestBody OrderRequest request) {
        Order order = orderService.createOrder(request);
        ApiResponse<Order> response = ApiResponse.success(order);
        return ResponseEntity.ok(response);
    }
}

// 2. æ–‡ä»¶ä¸Šä¼ Controller
@Controller
@RequestMapping("/files")
public class FileUploadController {
    
    private final String uploadDir = "/tmp/uploads";
    
    // å•æ–‡ä»¶ä¸Šä¼ 
    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file,
                           RedirectAttributes redirectAttributes) {
        
        if (file.isEmpty()) {
            redirectAttributes.addFlashAttribute("error", "è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶");
            return "redirect:/files";
        }
        
        try {
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            String contentType = file.getContentType();
            if (!isValidFileType(contentType)) {
                redirectAttributes.addFlashAttribute("error", "ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹");
                return "redirect:/files";
            }
            
            // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
            String originalFilename = file.getOriginalFilename();
            String extension = getFileExtension(originalFilename);
            String newFilename = UUID.randomUUID().toString() + extension;
            
            // ä¿å­˜æ–‡ä»¶
            Path uploadPath = Paths.get(uploadDir);
            if (!Files.exists(uploadPath)) {
                Files.createDirectories(uploadPath);
            }
            
            Path filePath = uploadPath.resolve(newFilename);
            file.transferTo(filePath.toFile());
            
            redirectAttributes.addFlashAttribute("success", 
                "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: " + originalFilename);
            
        } catch (IOException e) {
            redirectAttributes.addFlashAttribute("error", 
                "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
        
        return "redirect:/files";
    }
    
    // å¤šæ–‡ä»¶ä¸Šä¼ 
    @PostMapping("/upload/multiple")
    public String uploadMultipleFiles(@RequestParam("files") MultipartFile[] files,
                                    RedirectAttributes redirectAttributes) {
        
        List<String> uploadedFiles = new ArrayList<>();
        List<String> failedFiles = new ArrayList<>();
        
        for (MultipartFile file : files) {
            if (!file.isEmpty()) {
                try {
                    String filename = saveFile(file);
                    uploadedFiles.add(filename);
                } catch (IOException e) {
                    failedFiles.add(file.getOriginalFilename());
                }
            }
        }
        
        if (!uploadedFiles.isEmpty()) {
            redirectAttributes.addFlashAttribute("success", 
                "æˆåŠŸä¸Šä¼  " + uploadedFiles.size() + " ä¸ªæ–‡ä»¶");
        }
        if (!failedFiles.isEmpty()) {
            redirectAttributes.addFlashAttribute("error", 
                "ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + String.join(", ", failedFiles));
        }
        
        return "redirect:/files";
    }
    
    // RESTful APIæ–‡ä»¶ä¸Šä¼ 
    @PostMapping("/api/upload")
    @ResponseBody
    public ResponseEntity<UploadResponse> apiUploadFile(@RequestParam("file") MultipartFile file) {
        
        if (file.isEmpty()) {
            return ResponseEntity.badRequest()
                .body(new UploadResponse(false, "æ–‡ä»¶ä¸èƒ½ä¸ºç©º", null));
        }
        
        try {
            String filename = saveFile(file);
            String fileUrl = "/files/" + filename;
            
            return ResponseEntity.ok(
                new UploadResponse(true, "ä¸Šä¼ æˆåŠŸ", fileUrl));
                
        } catch (IOException e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(new UploadResponse(false, "ä¸Šä¼ å¤±è´¥: " + e.getMessage(), null));
        }
    }
    
    // æ–‡ä»¶ä¸‹è½½
    @GetMapping("/download/{filename}")
    public ResponseEntity<Resource> downloadFile(@PathVariable String filename) {
        
        try {
            Path filePath = Paths.get(uploadDir).resolve(filename);
            Resource resource = new UrlResource(filePath.toUri());
            
            if (resource.exists() && resource.isReadable()) {
                return ResponseEntity.ok()
                    .header(HttpHeaders.CONTENT_DISPOSITION, 
                           "attachment; filename=\"" + filename + "\"")
                    .body(resource);
            } else {
                return ResponseEntity.notFound().build();
            }
            
        } catch (IOException e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();
        }
    }
    
    private String saveFile(MultipartFile file) throws IOException {
        String originalFilename = file.getOriginalFilename();
        String extension = getFileExtension(originalFilename);
        String newFilename = UUID.randomUUID().toString() + extension;
        
        Path uploadPath = Paths.get(uploadDir);
        if (!Files.exists(uploadPath)) {
            Files.createDirectories(uploadPath);
        }
        
        Path filePath = uploadPath.resolve(newFilename);
        file.transferTo(filePath.toFile());
        
        return newFilename;
    }
    
    private boolean isValidFileType(String contentType) {
        return contentType != null && (
            contentType.startsWith("image/") ||
            contentType.equals("application/pdf") ||
            contentType.equals("text/plain")
        );
    }
    
    private String getFileExtension(String filename) {
        if (filename != null && filename.lastIndexOf('.') > 0) {
            return filename.substring(filename.lastIndexOf('.'));
        }
        return "";
    }
}

// 3. é…ç½®ç±»
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    // JSONé…ç½®
    @Override
    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
        Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder()
            .indentOutput(true)
            .dateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"))
            .simpleDateFormat("yyyy-MM-dd HH:mm:ss");
        
        converters.add(new MappingJackson2HttpMessageConverter(builder.build()));
    }
    
    // æ–‡ä»¶ä¸Šä¼ é…ç½®
    @Bean
    public MultipartResolver multipartResolver() {
        CommonsMultipartResolver resolver = new CommonsMultipartResolver();
        resolver.setMaxUploadSize(50 * 1024 * 1024); // 50MB
        resolver.setMaxInMemorySize(1024 * 1024); // 1MB
        resolver.setDefaultEncoding("UTF-8");
        return resolver;
    }
}

// 4. å“åº”å®ä½“ç±»
@Data
@AllArgsConstructor
public class UploadResponse {
    private boolean success;
    private String message;
    private String fileUrl;
}

@Data
@AllArgsConstructor
public class ApiResponse<T> {
    private int code;
    private String message;
    private T data;
    
    public static <T> ApiResponse<T> success(T data) {
        return new ApiResponse<>(200, "æˆåŠŸ", data);
    }
    
    public static <T> ApiResponse<T> error(String message) {
        return new ApiResponse<>(500, message, null);
    }
}
```



### ğŸ¯ Spring MVC å¦‚ä½•å¤„ç†è·¨åŸŸè¯·æ±‚ï¼ˆCORSï¼‰ï¼Ÿ

- é…ç½® `@CrossOrigin`

  ```java
  @RestController
  @CrossOrigin(origins = "http://localhost:8080", maxAge = 3600)
  public class ApiController { ... }
  ```

- æˆ–é€šè¿‡ `WebMvcConfigurer`å…¨å±€é…ç½®ï¼š

  ```java
  @Configuration
  public class WebConfig implements WebMvcConfigurer {
      @Override
      public void addCorsMappings(CorsRegistry registry) {
          registry.addMapping("/api/**").allowedOrigins("*");
      }
  }
  ```

  

---

## ğŸš€ å››ã€Spring Bootæ ¸å¿ƒç‰¹æ€§

**æ ¸å¿ƒç†å¿µ**ï¼šçº¦å®šå¤§äºé…ç½®ï¼Œæä¾›å¼€ç®±å³ç”¨çš„å¿«é€Ÿå¼€å‘ä½“éªŒï¼Œç®€åŒ–Springåº”ç”¨çš„æ­å»ºå’Œéƒ¨ç½²ã€‚

### ğŸ¯ ä»€ä¹ˆæ˜¯Spring Bootï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

"Spring Bootæ˜¯Springå›¢é˜Ÿæä¾›çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–Springåº”ç”¨çš„åˆå§‹æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ï¼š

**Spring Bootè§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

**1. é…ç½®å¤æ‚æ€§é—®é¢˜**ï¼š

- ä¼ ç»ŸSpringéœ€è¦å¤§é‡XMLæˆ–Javaé…ç½®
- Spring Bootæä¾›è‡ªåŠ¨é…ç½®ï¼Œé›¶é…ç½®å¯åŠ¨
- åŸºäºçº¦å®šå¤§äºé…ç½®åŸåˆ™

**2. ä¾èµ–ç®¡ç†é—®é¢˜**ï¼š

- ä¼ ç»Ÿé¡¹ç›®éœ€æ‰‹åŠ¨ç®¡ç†ç‰ˆæœ¬å…¼å®¹æ€§
- Spring Bootæä¾›starterä¾èµ–ï¼Œä¸€é”®è§£å†³åœºæ™¯
- å†…ç½®ç‰ˆæœ¬ä»²è£ï¼Œé¿å…ä¾èµ–å†²çª

**3. éƒ¨ç½²è¿ç»´é—®é¢˜**ï¼š

- ä¼ ç»Ÿåº”ç”¨éœ€è¦å¤–éƒ¨Webå®¹å™¨
- Spring Bootå†…åµŒTomcat/Jettyï¼ŒjaråŒ…ç›´æ¥è¿è¡Œ
- æä¾›Actuatorç›‘æ§ç«¯ç‚¹

**4. å¼€å‘æ•ˆç‡é—®é¢˜**ï¼š

- ä¼ ç»Ÿå¼€å‘éœ€è¦æ­å»ºå¤æ‚é¡¹ç›®ç»“æ„
- Spring Bootæä¾›å¿«é€Ÿé¡¹ç›®ç”Ÿæˆå·¥å…·
- æ”¯æŒçƒ­éƒ¨ç½²å’Œå¼€å‘è€…å·¥å…·

**æ ¸å¿ƒç‰¹æ€§**ï¼š

- **è‡ªåŠ¨é…ç½®**ï¼šæ ¹æ®classpathè‡ªåŠ¨é…ç½®Bean
- **èµ·æ­¥ä¾èµ–**ï¼šstarterç®€åŒ–ä¾èµ–ç®¡ç†
- **åµŒå…¥å¼æœåŠ¡å™¨**ï¼šæ— éœ€å¤–éƒ¨å®¹å™¨éƒ¨ç½²
- **ç”Ÿäº§å°±ç»ª**ï¼šæä¾›ç›‘æ§ã€å¥åº·æ£€æŸ¥ç­‰ç‰¹æ€§
- **æ— ä»£ç ç”Ÿæˆ**ï¼šä¸ç”Ÿæˆä»£ç ï¼Œä¸éœ€è¦XMLé…ç½®"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// ä¼ ç»ŸSpringé…ç½®ï¼ˆå¤æ‚ï¼‰
@Configuration
@EnableWebMvc
@EnableTransactionManagement
@ComponentScan("com.example")
public class WebConfig implements WebMvcConfigurer {
    
    @Bean
    public DataSource dataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/test");
        dataSource.setUsername("root");
        dataSource.setPassword("password");
        return dataSource;
    }
    
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
    
    // è¿˜éœ€è¦é…ç½®è§†å›¾è§£æå™¨ã€äº‹åŠ¡ç®¡ç†å™¨ç­‰...
}

// Spring Bootæ–¹å¼ï¼ˆç®€æ´ï¼‰
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}

// application.ymlé…ç½®å³å¯
/*
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test
    username: root
    password: password
*/
```

### ğŸ¯è¯´è¯´ Spring Boot å’Œ Spring çš„å…³ç³»ï¼Ÿ

Spring Boot æ˜¯ Spring å¼€æºç»„ç»‡ä¸‹çš„å­é¡¹ç›®ï¼Œæ˜¯ Spring ç»„ä»¶ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ç®€åŒ–äº†ä½¿ç”¨ Spring çš„éš¾åº¦ï¼Œç®€çœäº†ç¹é‡çš„é…ç½®ï¼Œæä¾›äº†å„ç§å¯åŠ¨å™¨ï¼Œå¼€å‘è€…èƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚

Spring Boot ä¸»è¦æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

1. å®¹æ˜“ä¸Šæ‰‹ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œä¸º Spring å¼€å‘æä¾›ä¸€ä¸ªæ›´å¿«ã€æ›´å¹¿æ³›çš„å…¥é—¨ä½“éªŒã€‚
2. å¼€ç®±å³ç”¨ï¼Œè¿œç¦»ç¹ççš„é…ç½®ã€‚
3. æä¾›äº†ä¸€ç³»åˆ—å¤§å‹é¡¹ç›®é€šç”¨çš„éä¸šåŠ¡æ€§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå†…åµŒæœåŠ¡å™¨ã€å®‰å…¨ç®¡ç†ã€è¿è¡Œæ•°æ®ç›‘æ§ã€è¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œå¤–éƒ¨åŒ–é…ç½®ç­‰ã€‚
4. æ²¡æœ‰ä»£ç ç”Ÿæˆï¼Œä¹Ÿä¸éœ€è¦XMLé…ç½®ã€‚
5. é¿å…å¤§é‡çš„ Maven å¯¼å…¥å’Œå„ç§ç‰ˆæœ¬å†²çªã€‚

> Spring Boot æˆ‘ç†è§£å°±æ˜¯æŠŠ spring spring mvc spring data jpa ç­‰ç­‰çš„ä¸€äº›å¸¸ç”¨çš„å¸¸ç”¨çš„åŸºç¡€æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œæä¾›é»˜è®¤çš„é…ç½®ï¼Œç„¶åæä¾›å¯æ’æ‹”çš„è®¾è®¡ï¼Œå°±æ˜¯å„ç§ starter ï¼Œæ¥æ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨è¿™ä¸€ç³»åˆ—çš„æŠ€æœ¯ï¼Œå¥—ç”¨å®˜æ–¹çš„ä¸€å¥è¯ï¼Œ spring å®¶æ—å‘å±•åˆ°ä»Šå¤©ï¼Œå·²ç»å¾ˆåºå¤§äº†ï¼Œä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ spring å®¶æ—ä¸€ç³»åˆ—çš„æŠ€æœ¯ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æé…ç½®ï¼Œç„¶åè¿˜æœ‰ä¸ªç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œå…¶å®æŒºéº»çƒ¦çš„ï¼Œå¶å°”ä¹Ÿä¼šæœ‰å°å‘å‡ºç°ï¼Œå…¶å®æŒºå½±å“å¼€å‘è¿›åº¦ï¼Œ spring boot å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå§ï¼Œå¯ä»¥å…ˆä¸å…³å¿ƒå¦‚ä½•é…ç½®ï¼Œå¯ä»¥å¿«é€Ÿçš„å¯åŠ¨å¼€å‘ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘ç¼–å†™ï¼Œå„ç§éœ€è¦çš„æŠ€æœ¯ï¼ŒåŠ å…¥ starter å°±é…ç½®å¥½äº†ï¼Œç›´æ¥ä½¿ç”¨ï¼Œå¯ä»¥è¯´è¿½æ±‚å¼€ç®±å³ç”¨çš„æ•ˆæœå§.

> å¦‚æœè¯´ Spring æ˜¯ä¸€ä¸ªå®¶æ—ï¼Œå…¶å®å°±æ˜¯ï¼›å®ƒåŒ…å« spring core, spring mvcï¼Œspring bootä¸spring Cloud ç­‰ç­‰ï¼›
>
> é‚£ spring boot å°±åƒæ˜¯è¿™ä¸ªå®¶æ—ä¸­çš„å¤§ç®¡å®¶



### ğŸ¯ Spring Boot å¯åŠ¨æµç¨‹ï¼Ÿ

Spring Boot çš„å¯åŠ¨æµç¨‹å›´ç»• `SpringApplication.run()` æ–¹æ³•å±•å¼€ï¼Œåˆ†ä¸º **åˆå§‹åŒ–é˜¶æ®µã€ç¯å¢ƒå‡†å¤‡ã€ä¸Šä¸‹æ–‡åˆ›å»ºä¸åˆ·æ–°ã€è‡ªåŠ¨é…ç½®** ç­‰æ­¥éª¤ã€‚æ•´ä½“æµç¨‹å¯æ¦‚æ‹¬ä¸ºï¼š

```wiki
å¯åŠ¨ç±» main() â†’ SpringApplication.run()
â”œâ”€ åˆå§‹åŒ–é˜¶æ®µï¼šæ¨æ–­åº”ç”¨ç±»å‹ã€åŠ è½½åˆå§‹åŒ–å™¨/ç›‘å¬å™¨
â”œâ”€ ç¯å¢ƒå‡†å¤‡ï¼šåŠ è½½é…ç½®ã€åˆ›å»ºç›‘å¬å™¨é›†åˆ
â”œâ”€ ä¸Šä¸‹æ–‡åˆ›å»ºï¼šå®ä¾‹åŒ– ApplicationContext
â”œâ”€ ä¸Šä¸‹æ–‡åˆ·æ–°ï¼šåŠ è½½ Beanã€è‡ªåŠ¨é…ç½®ã€å¯åŠ¨å®¹å™¨
â””â”€ åç½®å¤„ç†ï¼šæ‰§è¡Œ Runnerã€å‘å¸ƒå®Œæˆäº‹ä»¶
```

 **1. åˆå§‹åŒ–é˜¶æ®µï¼ˆSpringApplication æ„é€ ï¼‰**

- æ¨æ–­åº”ç”¨ç±»å‹ï¼šé€šè¿‡ç±»è·¯å¾„åˆ¤æ–­æ˜¯ Webï¼ˆServlet/Reactiveï¼‰æˆ–é Web åº”ç”¨ï¼Œå†³å®šåç»­åˆ›å»ºå“ªç§ `ApplicationContext`

  ï¼ˆå¦‚ `AnnotationConfigServletWebServerApplicationContext`ï¼‰ã€‚

- åŠ è½½åˆå§‹åŒ–å™¨ä¸ç›‘å¬å™¨ï¼šä» `META-INF/spring.factories` åŠ è½½ `ApplicationContextInitializer`ï¼ˆç”¨äºè‡ªå®šä¹‰ä¸Šä¸‹æ–‡åˆå§‹åŒ–é€»è¾‘ï¼‰å’Œ `ApplicationListener`ï¼ˆç›‘å¬å¯åŠ¨äº‹ä»¶ï¼Œå¦‚ `ConfigFileApplicationListener` åŠ è½½é…ç½®æ–‡ä»¶ï¼‰ã€‚

- ç¡®å®šä¸»ç±»ï¼šé€šè¿‡å †æ ˆä¿¡æ¯è§£æåŒ…å« `main()`çš„å¯åŠ¨ç±»ï¼Œç”¨äºç»„ä»¶æ‰«æã€‚

**2. ç¯å¢ƒå‡†å¤‡ï¼ˆ`run()` æ–¹æ³•å‰åŠæ®µï¼‰**

- åˆ›å»ºç›‘å¬å™¨é›†åˆï¼šåˆå§‹åŒ– `SpringApplicationRunListeners`ï¼ˆå¦‚ `EventPublishingRunListener`ï¼‰ï¼Œå‘å¸ƒ `ApplicationStartingEvent`äº‹ä»¶ã€‚
- åŠ è½½é…ç½®ç¯å¢ƒï¼š
  - æ„å»º `ConfigurableEnvironment`ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°å’Œ `application.properties/yml`æ–‡ä»¶ã€‚
  - é€šè¿‡ `EnvironmentPostProcessor` æ‰©å±•ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `RandomValuePropertySource` æ”¯æŒéšæœºå€¼ï¼‰ã€‚
- æ‰“å° Bannerï¼šåŠ è½½å¹¶æ˜¾ç¤ºå¯åŠ¨ Bannerï¼Œæ”¯æŒè‡ªå®šä¹‰æ–‡æœ¬æˆ–å›¾ç‰‡ã€‚

**3. ä¸Šä¸‹æ–‡åˆ›å»ºä¸åˆ·æ–°ï¼ˆæ ¸å¿ƒé˜¶æ®µï¼‰**

**è°ƒç”¨ `SpringApplication.run()` æ–¹æ³•**ï¼š

- åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡ï¼šæ ¹æ®åº”ç”¨ç±»å‹å®ä¾‹åŒ– `ApplicationContext`ï¼ˆå¦‚ Web åº”ç”¨ä½¿ç”¨ `AnnotationConfigServletWebServerApplicationContext`ï¼‰ã€‚
- å‡†å¤‡ä¸Šä¸‹æ–‡ï¼šå…³è”ç¯å¢ƒå˜é‡ã€æ³¨å†Œåˆå§‹ Beanï¼ˆå¦‚ `BeanDefinitionLoader` åŠ è½½å¯åŠ¨ç±»ï¼‰ã€‚
- åˆ·æ–°ä¸Šä¸‹æ–‡ï¼ˆ`ApplicationContext.refresh()` æ–¹æ³•ï¼‰ï¼š
  1. åŠ è½½ Bean å®šä¹‰ï¼šæ‰«æ `@Component`ã€`@Configuration` ç­‰æ³¨è§£ï¼Œæ³¨å†Œ Beanã€‚
  2. æ‰§è¡Œè‡ªåŠ¨é…ç½®ï¼šé€šè¿‡ `@EnableAutoConfiguration` åŠ è½½ `spring.factories` ä¸­çš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆå¦‚ `DataSourceAutoConfiguration`ï¼‰ï¼Œç»“åˆæ¡ä»¶æ³¨è§£ï¼ˆ`@ConditionalOnClass`ï¼‰æŒ‰éœ€åŠ è½½ã€‚
  3. å¯åŠ¨å†…åµŒå®¹å™¨ï¼šWeb åº”ç”¨åˆå§‹åŒ– Tomcat/Jetty æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£
  4. å®Œæˆå•ä¾‹ Bean åˆå§‹åŒ–ï¼šè°ƒç”¨ `finishBeanFactoryInitialization()` å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„å•ä¾‹ Bean

**4. åç½®å¤„ç†ä¸å¯åŠ¨å®Œæˆ**

- æ‰§è¡Œ Runner æ¥å£ï¼šè°ƒç”¨æ‰€æœ‰ `CommandLineRunner` å’Œ `ApplicationListener` ï¼Œæ‰§è¡Œå¯åŠ¨åè‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚åˆå§‹åŒ–æ•°æ®ï¼‰ã€‚
- **å‘å¸ƒå®Œæˆäº‹ä»¶**ï¼šè§¦å‘ `ApplicationReadyEvent`ï¼Œé€šçŸ¥åº”ç”¨å·²å°±ç»ª



### ğŸ¯ `CommandLineRunner` æˆ– `ApplicationRunner`æ¥å£åŒºåˆ«

`CommandLineRunner` å’Œ `ApplicationRunner` æ˜¯ Spring Boot æä¾›çš„ä¸¤ä¸ªæ¥å£ï¼Œç”¨äºåœ¨ Spring Boot åº”ç”¨å¯åŠ¨å®Œæˆåè¿è¡Œç‰¹å®šä»£ç ã€‚è¿™ä¸¤ä¸ªæ¥å£çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬çš„ `run` æ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚

1. **CommandLineRunner**ï¼š

   - `CommandLineRunner`æ¥å£åŒ…å«ä¸€ä¸ª`run`æ–¹æ³•ï¼Œå…¶å‚æ•°æ˜¯`String... args`ï¼Œå³å‘½ä»¤è¡Œå‚æ•°çš„æ•°ç»„ã€‚

   - è¿™ä¸ªæ¥å£é€‚åˆäºå‘½ä»¤è¡Œå·¥å…·æˆ–éœ€è¦è®¿é—®å‘½ä»¤è¡Œå‚æ•°çš„åº”ç”¨åœºæ™¯ã€‚

     ```java
     @Component
     public class MyCommandLineRunner implements CommandLineRunner {
         @Override
         public void run(String... args) throws Exception {
             // å¯ä»¥è®¿é—®å‘½ä»¤è¡Œå‚æ•°args
         }
     }
     ```

2. **ApplicationRunner**ï¼š

   - `ApplicationRunner`æ¥å£åŒæ ·åŒ…å«ä¸€ä¸ª`run`æ–¹æ³•ï¼Œä½†å…¶å‚æ•°æ˜¯`ApplicationArguments`ç±»å‹çš„å®ä¾‹ã€‚

   - `ApplicationArguments`æä¾›äº†æ›´å¤šå…³äºå‘½ä»¤è¡Œå‚æ•°çš„é«˜çº§å¤„ç†èƒ½åŠ›ï¼Œä¾‹å¦‚èƒ½å¤ŸåŒºåˆ†é€‰é¡¹å’Œéé€‰é¡¹å‚æ•°ï¼Œæˆ–è€…è·å–æ‰€æœ‰çš„é€‰é¡¹å€¼ç­‰ã€‚

   - è¿™ä¸ªæ¥å£é€‚åˆäºéœ€è¦æ›´ç»†è‡´æ§åˆ¶å‘½ä»¤è¡Œå‚æ•°è§£æçš„åº”ç”¨åœºæ™¯ã€‚

     ```java
     @Component
     public class MyApplicationRunner implements ApplicationRunner {
         @Override
         public void run(ApplicationArguments args) throws Exception {
             // ä½¿ç”¨ApplicationArgumentsæ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°
         }
     }
     ```

ä¸¤è€…éƒ½æ˜¯åœ¨Springåº”ç”¨çš„`ApplicationContext`å®Œå…¨åˆå§‹åŒ–ä¹‹åï¼Œä¸”æ‰€æœ‰çš„`@PostConstruct`æ³¨è§£çš„æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè°ƒç”¨çš„ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ¥å£å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ï¼Œå¦‚æœä½ åªéœ€è¦ç®€å•çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œ`CommandLineRunner`å¯èƒ½å°±è¶³å¤Ÿäº†ã€‚å¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„å‚æ•°è§£æåŠŸèƒ½ï¼Œé‚£ä¹ˆ`ApplicationRunner`ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œä½ å¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£ï¼Œå®ƒä»¬å¹¶ä¸äº’ç›¸æ’æ–¥ã€‚



### ğŸ¯ Spring Bootè‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> - æ ¸å¿ƒæœºåˆ¶ï¼š
>   1. `@SpringBootApplication`ç»„åˆ`@EnableAutoConfiguration`ï¼Œæ‰«æ`META-INF/spring.factories`æ–‡ä»¶ï¼›
>   2. æ ¹æ®ç±»è·¯å¾„ä¸­çš„ä¾èµ–ï¼ˆå¦‚`spring-boot-starter-web`ï¼‰è‡ªåŠ¨é…ç½® Beanï¼ˆå¦‚ Tomcatã€MVC ç»„ä»¶ï¼‰ï¼›
>   3. å¯é€šè¿‡`application.properties/yaml`æˆ–`@Conditional`æ³¨è§£è¦†ç›–é»˜è®¤é…ç½®ã€‚

Spring Boot è‡ªåŠ¨é…ç½®ï¼ˆAuto-Configurationï¼‰æ˜¯ Spring Boot çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œæ—¨åœ¨æ ¹æ®é¡¹ç›®ä¸­çš„ä¾èµ–è‡ªåŠ¨é…ç½® Spring åº”ç”¨ã€‚é€šè¿‡è‡ªåŠ¨é…ç½®ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç¼–å†™å¤§é‡çš„é…ç½®ä»£ç ï¼Œå¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å¼€å‘ã€‚å…¶å®ç°åŸç†ä¸»è¦åŸºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **å¯åŠ¨ç±»æ³¨è§£çš„å¤åˆç»“æ„**

   Spring Boot åº”ç”¨é€šå¸¸ä½¿ç”¨ `@SpringBootApplication` æ³¨è§£æ¥å¯åŠ¨ï¼Œè¯¥æ³¨è§£æœ¬è´¨ä¸Šæ˜¯ä»¥ä¸‹ä¸‰ä¸ªæ³¨è§£çš„ç»„åˆï¼š

   - @SpringBootConfigurationï¼šæ ‡è¯†å½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œç»§æ‰¿è‡ª `@Configuration`ï¼Œæ”¯æŒ Java Config é…ç½®æ–¹å¼ã€‚

   - @ComponentScanï¼šè‡ªåŠ¨æ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç»„ä»¶ï¼ˆå¦‚ `@Controller`ã€`@Service`ç­‰ï¼‰ï¼Œå°†å…¶æ³¨å†Œä¸º Beanã€‚

   - **@EnableAutoConfiguration**ï¼š**è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒå…¥å£**ï¼Œé€šè¿‡ `@Import` å¯¼å…¥ `AutoConfigurationImportSelector` ç±»ï¼Œè§¦å‘è‡ªåŠ¨é…ç½®æµç¨‹

   ```java
   @SpringBootApplication
   public class MyApplication {
       public static void main(String[] args) {
           SpringApplication.run(MyApplication.class, args);
       }
   }
   -------------
   @Target(ElementType.TYPE)
   @Retention(RetentionPolicy.RUNTIME)
   @Documented
   @Inherited
   @SpringBootConfiguration
   @EnableAutoConfiguration
   @ComponentScan
   public @interface SpringBootApplication {
   }
   ```

2. **è‡ªåŠ¨é…ç½®çš„è§¦å‘æœºåˆ¶**

   `@EnableAutoConfiguration` é€šè¿‡ `AutoConfigurationImportSelector` ç±»åŠ è½½é…ç½®ï¼š

   - è¯»å– `spring.factories` æ–‡ä»¶ï¼šä»æ‰€æœ‰ä¾èµ–çš„ `META-INF/spring.factories` æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ `org.springframework.boot.autoconfigure.EnableAutoConfiguration` é”®å€¼å¯¹åº”çš„å…¨ç±»ååˆ—è¡¨ã€‚

     ```
     # Auto Configure
     org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
     org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
     org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
     org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
     ...
     ```

   - æ¡ä»¶åŒ–ç­›é€‰é…ç½®ç±»ï¼šé€šè¿‡æ¡ä»¶æ³¨è§£ï¼ˆå¦‚ `@ConditionalOnClass`ã€`@ConditionalOnMissingBean`ï¼‰è¿‡æ»¤æ‰ä¸æ»¡è¶³å½“å‰ç¯å¢ƒçš„é…ç½®ç±»ï¼Œä¾‹å¦‚ï¼š

     - ç±»è·¯å¾„ä¸­ç¼ºå°‘æŸä¸ªç±»æ—¶ç¦ç”¨ç›¸å…³é…ç½®ï¼ˆ`@ConditionalOnClass`ï¼‰ã€‚
     - å®¹å™¨ä¸­å·²å­˜åœ¨æŸä¸ª Bean æ—¶è·³è¿‡é‡å¤æ³¨å†Œï¼ˆ`@ConditionalOnMissingBean`ï¼‰ã€‚

   - **åŠ è½½æœ‰æ•ˆé…ç½®ç±»**ï¼šç­›é€‰åçš„é…ç½®ç±»é€šè¿‡åå°„å®ä¾‹åŒ–ï¼Œå¹¶æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­

3. **è‡ªåŠ¨é…ç½®ç±»çš„å®ç°é€»è¾‘**

   è‡ªåŠ¨é…ç½®ç±»é€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

   - æ¡ä»¶æ³¨è§£æ§åˆ¶ï¼šä¾‹å¦‚ï¼Œ`DataSourceAutoConfiguration` ä»…åœ¨ç±»è·¯å¾„å­˜åœ¨ `javax.sql.DataSource` æ—¶ç”Ÿæ•ˆã€‚

   - é»˜è®¤ Bean å®šä¹‰ï¼šé€šè¿‡ `@Bean` æ–¹æ³•å®šä¹‰é»˜è®¤ç»„ä»¶ï¼ˆå¦‚ `JdbcTemplate`ï¼‰ï¼Œå¼€å‘è€…å¯é€šè¿‡é…ç½®æ–‡ä»¶è¦†ç›–é»˜è®¤å€¼ã€‚

   - **å¤–éƒ¨åŒ–é…ç½®æ”¯æŒ**ï¼šç»“åˆ `@ConfigurationProperties` å°† `application.properties` ä¸­çš„å±æ€§æ³¨å…¥åˆ° Bean ä¸­

4. **æ¡ä»¶æ³¨è§£çš„ä½œç”¨**

   Spring Boot æä¾›ä¸°å¯Œçš„æ¡ä»¶æ³¨è§£ï¼Œç”¨äºåŠ¨æ€æ§åˆ¶é…ç½®ç±»çš„åŠ è½½å’Œ Bean çš„æ³¨å†Œï¼š

   - @ConditionalOnClassï¼šç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»æ—¶ç”Ÿæ•ˆã€‚

   - @ConditionalOnMissingBeanï¼šå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®š Bean æ—¶ç”Ÿæ•ˆã€‚

   - @ConditionalOnPropertyï¼šæ ¹æ®é…ç½®æ–‡ä»¶å±æ€§å€¼å†³å®šæ˜¯å¦åŠ è½½ã€‚
   - **@ConditionalOnWebApplication**ï¼šä»…åœ¨ Web åº”ç”¨ç¯å¢ƒä¸‹ç”Ÿæ•ˆ

5. **è‡ªåŠ¨é…ç½®çš„ä¼˜åŒ–ä¸æ‰©å±•**

- æŒ‰éœ€åŠ è½½ï¼šé€šè¿‡æ¡ä»¶ç­›é€‰é¿å…åŠ è½½æœªä½¿ç”¨çš„ç»„ä»¶ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚
- è‡ªå®šä¹‰ Starterï¼šå¼€å‘è€…å¯å°è£…è‡ªå®šä¹‰ Starterï¼Œéµå¾ªç›¸åŒæœºåˆ¶ï¼ˆ`spring.factories` \+ æ¡ä»¶æ³¨è§£ï¼‰å®ç°æ¨¡å—åŒ–è‡ªåŠ¨é…ç½®ã€‚
- **é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§**ï¼šé€šè¿‡ `spring.autoconfigure.exclude` æ˜¾å¼æ’é™¤ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®ç±»

Spring Boot çš„è‡ªåŠ¨é…ç½®æœ¬è´¨ä¸Šæ˜¯ **åŸºäºçº¦å®šå’Œæ¡ä»¶åˆ¤æ–­çš„ Bean æ³¨å†Œæœºåˆ¶**ï¼Œé€šè¿‡ä»¥ä¸‹æµç¨‹å®ç°â€œå¼€ç®±å³ç”¨â€ï¼š

```
å¯åŠ¨ç±»æ³¨è§£ â†’ åŠ è½½ spring.factories â†’ æ¡ä»¶ç­›é€‰ â†’ æ³¨å†Œæœ‰æ•ˆ Bean
```

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// è‡ªåŠ¨é…ç½®ç±»ç¤ºä¾‹
@Configuration
@ConditionalOnClass(DataSource.class)
@ConditionalOnProperty(prefix = "spring.datasource", name = "url")
@EnableConfigurationProperties(DataSourceProperties.class)
public class DataSourceAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean(DataSource.class)
    public DataSource dataSource(DataSourceProperties properties) {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(properties.getUrl());
        dataSource.setUsername(properties.getUsername());
        dataSource.setPassword(properties.getPassword());
        return dataSource;
    }
}

// é…ç½®å±æ€§ç±»
@ConfigurationProperties(prefix = "spring.datasource")
public class DataSourceProperties {
    private String url;
    private String username;
    private String password;
    // getter/setter...
}

// spring.factoriesæ–‡ä»¶å†…å®¹
/*
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.autoconfigure.DataSourceAutoConfiguration,\
com.example.autoconfigure.WebMvcAutoConfiguration
*/

// è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£
@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Conditional(OnRedisCondition.class)
public @interface ConditionalOnRedis {
}

public class OnRedisCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        try {
            context.getClassLoader().loadClass("redis.clients.jedis.Jedis");
            return context.getEnvironment().getProperty("spring.redis.host") != null;
        } catch (ClassNotFoundException e) {
            return false;
        }
    }
}
```



### ğŸ¯ ä»€ä¹ˆæ˜¯Starterï¼Ÿ

é¦–å…ˆï¼Œè¿™ä¸ª Starter å¹¶éä»€ä¹ˆæ–°çš„æŠ€æœ¯ç‚¹ï¼ŒåŸºæœ¬ä¸Šè¿˜æ˜¯åŸºäº Spring å·²æœ‰åŠŸèƒ½æ¥å®ç°çš„ã€‚é¦–å…ˆå®ƒæä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œä¸€èˆ¬å‘½åä¸º `XXXAutoConfiguration` ï¼Œåœ¨è¿™ä¸ªé…ç½®ç±»ä¸­é€šè¿‡æ¡ä»¶æ³¨è§£æ¥å†³å®šä¸€ä¸ªé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼ˆæ¡ä»¶æ³¨è§£å°±æ˜¯ Spring ä¸­åŸæœ¬å°±æœ‰çš„ï¼‰ï¼Œç„¶åå®ƒè¿˜ä¼šæä¾›ä¸€ç³»åˆ—çš„é»˜è®¤é…ç½®ï¼Œä¹Ÿå…è®¸å¼€å‘è€…æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰ç›¸å…³é…ç½®ï¼Œç„¶åé€šè¿‡ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥å°†è¿™äº›é…ç½®å±æ€§æ³¨å…¥è¿›æ¥ï¼Œæ–°æ³¨å…¥çš„å±æ€§ä¼šä»£æ›¿æ‰é»˜è®¤å±æ€§ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Starter

"Starteræ˜¯Spring Bootæä¾›çš„ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®æœºåˆ¶ï¼š

**Starteræ ¸å¿ƒæ¦‚å¿µ**ï¼š

- ä¸€ä¸ªStarter = ä¾èµ–ç®¡ç† + è‡ªåŠ¨é…ç½®
- éµå¾ª'çº¦å®šå¤§äºé…ç½®'åŸåˆ™
- æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½é›†æˆ
- ç®€åŒ–ç¬¬ä¸‰æ–¹åº“çš„é›†æˆå¤æ‚åº¦

**å®˜æ–¹Starterç‰¹ç‚¹**ï¼š

- ä»¥spring-boot-starter-*å‘½å
- åŒ…å«ç›¸å…³ä¾èµ–çš„å®Œæ•´é›†åˆ
- æä¾›é»˜è®¤é…ç½®å’Œè‡ªåŠ¨é…ç½®ç±»
- æ”¯æŒé…ç½®å±æ€§å¤–éƒ¨åŒ–



### ğŸ¯ è®©ä½ è®¾è®¡ä¸€ä¸ªspring-boot-starterä½ ä¼šæ€ä¹ˆè®¾è®¡ï¼Ÿ

è®¾è®¡ä¸€ä¸ª Spring Boot Starter éœ€è¦è€ƒè™‘å…¶ç›®çš„ã€åŠŸèƒ½ã€æ˜“ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚ä»¥ä¸‹æ˜¯è®¾è®¡ä¸€ä¸ª Spring Boot Starter çš„ä¸€èˆ¬æ­¥éª¤ï¼š

1. **å®šä¹‰ Starter çš„ç›®çš„å’ŒåŠŸèƒ½**ï¼š
   - ç¡®å®š Starter è¦è§£å†³çš„é—®é¢˜æˆ–è¦æä¾›çš„åŠŸèƒ½ã€‚
   - ä¾‹å¦‚ï¼Œå¯èƒ½æ˜¯ä¸ºäº†ç®€åŒ–æ•°æ®åº“æ“ä½œã€æä¾›ç¼“å­˜è§£å†³æ–¹æ¡ˆã€å®ç°ç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ç­‰ã€‚
2. **åˆ›å»º Maven é¡¹ç›®**ï¼š
   - ä½¿ç”¨ Spring Initializr æˆ–è€…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ã€‚
   - åŒ…å«å¿…è¦çš„ä¾èµ–ï¼Œå¦‚ Spring Boot å’Œå…¶ä»–ç›¸å…³åº“ã€‚
3. **è®¾è®¡è‡ªåŠ¨é…ç½®**ï¼š
   - åˆ›å»º `@Configuration` ç±»æ¥å®šä¹‰è‡ªåŠ¨é…ç½®ã€‚
   - ä½¿ç”¨ `@EnableAutoConfiguration` å’Œ `@ComponentScan` æ³¨è§£æ¥å¯ç”¨è‡ªåŠ¨é…ç½®å’Œç»„ä»¶æ‰«æã€‚
   - é€šè¿‡ `@ConditionalOnClass`ã€`@ConditionalOnMissingBean` ç­‰æ¡ä»¶æ³¨è§£æ¥æ§åˆ¶é…ç½®çš„ç”Ÿæ•ˆæ¡ä»¶ã€‚
4. **å®šä¹‰é»˜è®¤é…ç½®å±æ€§**ï¼š
   - åœ¨ `application.properties` æˆ– `application.yml` ä¸­å®šä¹‰é»˜è®¤é…ç½®å±æ€§ã€‚
   - åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œä½¿ç”¨ `@ConfigurationProperties` æ³¨è§£æ¥ç»‘å®šè¿™äº›å±æ€§ã€‚
5. **åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£**ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£æ¥è¿›ä¸€æ­¥ç®€åŒ–é…ç½®ã€‚
6. **å®ç°ä¾èµ–ç®¡ç†**ï¼šåœ¨ `pom.xml` ä¸­å®šä¹‰ `<dependencyManagement>` æ ‡ç­¾ï¼Œç®¡ç† Starter ä¾èµ–çš„ç‰ˆæœ¬ã€‚
7. **ç¼–å†™æ–‡æ¡£**ï¼šæä¾›æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨ Starterï¼ŒåŒ…æ‹¬é…ç½®å±æ€§çš„è¯¦ç»†è¯´æ˜ã€‚
8. **æ‰“åŒ…å’Œå‘½å**ï¼š
   - æŒ‰ç…§ `spring-boot-starter-xxx` çš„æ ¼å¼å‘½åä½ çš„ Starterã€‚
   - åœ¨ `pom.xml` ä¸­é…ç½® `<groupId>`ã€`<artifactId>` å’Œ `<version>`ã€‚
9. **æµ‹è¯•**ï¼šç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ¥éªŒè¯è‡ªåŠ¨é…ç½®çš„æ­£ç¡®æ€§ã€‚
10. **å‘å¸ƒ**ï¼šå°† Starter å‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“æˆ–ç§æœ‰ä»“åº“ï¼Œä»¥ä¾¿å…¶ä»–é¡¹ç›®å¯ä»¥ä¾èµ–ã€‚
11. **æä¾›ç¤ºä¾‹**ï¼šæä¾›ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ä½ çš„ Starterã€‚



**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// 1. è‡ªåŠ¨é…ç½®ç±»
@Configuration
@ConditionalOnClass(SmsService.class)
@ConditionalOnProperty(prefix = "sms", name = "enabled", havingValue = "true")
@EnableConfigurationProperties(SmsProperties.class)
public class SmsAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean
    public SmsService smsService(SmsProperties properties) {
        return new SmsService(properties.getApiKey(), properties.getSecret());
    }
}

// 2. é…ç½®å±æ€§ç±»
@ConfigurationProperties(prefix = "sms")
@Data
public class SmsProperties {
    
    private boolean enabled = false;
    private String apiKey;
    private String secret;
    private String templateId;
    private int timeout = 5000;
}

// 3. æ ¸å¿ƒæœåŠ¡ç±»
public class SmsService {
    
    private final String apiKey;
    private final String secret;
    
    public SmsService(String apiKey, String secret) {
        this.apiKey = apiKey;
        this.secret = secret;
    }
    
    public boolean sendSms(String phone, String message) {
        // å‘é€çŸ­ä¿¡çš„å…·ä½“å®ç°
        System.out.println("å‘é€çŸ­ä¿¡åˆ°: " + phone + ", å†…å®¹: " + message);
        return true;
    }
}

// 4. META-INF/spring.factoriesæ–‡ä»¶
/*
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.starter.SmsAutoConfiguration
*/

// 5. pom.xmlä¾èµ–ç®¡ç†ï¼ˆStarteræ¨¡å—ï¼‰
/*
<dependency>
    <groupId>com.example</groupId>
    <artifactId>sms-spring-boot-autoconfigure</artifactId>
</dependency>
*/

// 6. ä½¿ç”¨è‡ªå®šä¹‰Starter
@RestController
public class SmsController {
    
    @Autowired
    private SmsService smsService;
    
    @PostMapping("/send")
    public String sendSms(@RequestParam String phone, @RequestParam String message) {
        boolean success = smsService.sendSms(phone, message);
        return success ? "å‘é€æˆåŠŸ" : "å‘é€å¤±è´¥";
    }
}

// 7. application.ymlé…ç½®
/*
sms:
  enabled: true
  api-key: your-api-key
  secret: your-secret
  template-id: SMS_001
  timeout: 10000
*/
```

### ğŸ¯ Spring Bootçš„é…ç½®ä¼˜å…ˆçº§æ˜¯æ€æ ·çš„ï¼Ÿ

"Spring Bootéµå¾ªçº¦å®šå¤§äºé…ç½®åŸåˆ™ï¼Œæ”¯æŒå¤šç§é…ç½®æ–¹å¼ï¼Œå…·æœ‰æ˜ç¡®çš„ä¼˜å…ˆçº§é¡ºåºï¼š

**é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰**ï¼š

**1. å‘½ä»¤è¡Œå‚æ•°**ï¼š

- java -jar app.jar --server.port=8081
- ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯è¦†ç›–ä»»ä½•é…ç½®

**2. ç³»ç»Ÿç¯å¢ƒå˜é‡**ï¼š

- export SERVER_PORT=8081
- é€šè¿‡æ“ä½œç³»ç»Ÿè®¾ç½®çš„ç¯å¢ƒå˜é‡

**3. Javaç³»ç»Ÿå±æ€§**ï¼š

- -Dserver.port=8081
- JVMå¯åŠ¨å‚æ•°è®¾ç½®çš„ç³»ç»Ÿå±æ€§

**4. JNDIå±æ€§**ï¼š

- java:comp/env/server.port
- ä»JNDIè·å–çš„å±æ€§

**5. éšæœºå€¼å±æ€§**ï¼š

- RandomValuePropertySourceæ”¯æŒçš„å±æ€§

**6. jaråŒ…å¤–çš„é…ç½®æ–‡ä»¶**ï¼š

- application-{profile}.properties/yml
- æ”¾åœ¨jaråŒ…åŒçº§ç›®å½•

**7. jaråŒ…å†…çš„é…ç½®æ–‡ä»¶**ï¼š

- classpathä¸­çš„application-{profile}.properties/yml

**8. @PropertySourceæ³¨è§£**ï¼š

- é€šè¿‡@PropertySourceåŠ è½½çš„å±æ€§æ–‡ä»¶

**9. é»˜è®¤å±æ€§**ï¼š

- SpringApplication.setDefaultProperties()

**é…ç½®æ–‡ä»¶æœç´¢é¡ºåº**ï¼š

1. file:./config/ (å½“å‰ç›®å½•configå­ç›®å½•)
2. file:./ (å½“å‰ç›®å½•)
3. classpath:/config/ (classpath configç›®å½•)
4. classpath:/ (classpathæ ¹ç›®å½•)

**Profileé…ç½®**ï¼š

- application.yml (é€šç”¨é…ç½®)
- application-dev.yml (å¼€å‘ç¯å¢ƒ)
- application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// 1. é…ç½®ç±»è¯»å–ä¼˜å…ˆçº§ç¤ºä¾‹
@Component
@ConfigurationProperties(prefix = "app")
@Data
public class AppProperties {
    private String name;
    private int port;
    private boolean enabled;
}

// 2. å¤šç¯å¢ƒé…ç½®ç¤ºä¾‹
// application.yml (åŸºç¡€é…ç½®)
/*
app:
  name: MyApp
  port: 8080
  
spring:
  profiles:
    active: dev
*/

// application-dev.yml (å¼€å‘ç¯å¢ƒ)
/*
app:
  port: 8081
  enabled: true
  
logging:
  level:
    root: DEBUG
*/

// application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)  
/*
app:
  port: 8080
  enabled: false
  
logging:
  level:
    root: WARN
*/

// 3. @Valueæ³¨è§£è¯»å–é…ç½®
@RestController
public class ConfigController {
    
    @Value("${app.name:DefaultApp}")
    private String appName;
    
    @Value("${server.port:8080}")
    private int serverPort;
    
    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        config.put("appName", appName);
        config.put("serverPort", serverPort);
        return config;
    }
}

// 4. æ¡ä»¶é…ç½®ç¤ºä¾‹
@Configuration
public class ConditionalConfig {
    
    @Bean
    @ConditionalOnProperty(name = "app.enabled", havingValue = "true")
    public MyService myService() {
        return new MyService();
    }
    
    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        return new H2DataSource();
    }
    
    @Bean
    @Profile("prod") 
    public DataSource prodDataSource() {
        return new MySQLDataSource();
    }
}

// 5. å¯åŠ¨æ—¶æŒ‡å®šé…ç½®
/*
å‘½ä»¤è¡Œæ–¹å¼ï¼š
java -jar app.jar --spring.profiles.active=prod --server.port=8081

ç¯å¢ƒå˜é‡æ–¹å¼ï¼š
export SPRING_PROFILES_ACTIVE=prod
export SERVER_PORT=8081

IDEé…ç½®ï¼š
-Dspring.profiles.active=dev
*/
```



### spring-boot-starter-parent æœ‰ä»€ä¹ˆç”¨ ?

`spring-boot-starter-parent` æ˜¯ Spring Boot æä¾›çš„ä¸€ä¸ªçˆ¶ POMï¼ˆé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼‰ï¼Œç”¨äºç®€åŒ– Spring Boot é¡¹ç›®çš„æ„å»ºå’Œä¾èµ–ç®¡ç†ã€‚å®ƒä½œä¸ºçˆ¶çº§ POMï¼Œä¸»è¦æä¾›äº†è®¸å¤šæ–¹ä¾¿çš„é…ç½®ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ç®¡ç†ã€æ’ä»¶é…ç½®ã€ä¾èµ–ç®¡ç†ç­‰ã€‚ä½¿ç”¨ `spring-boot-starter-parent` å¯ä»¥å‡å°‘å¾ˆå¤šæ‰‹åŠ¨é…ç½®çš„å·¥ä½œï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºåº”ç”¨ç¨‹åºçš„å¼€å‘è€Œéæ„å»ºè¿‡ç¨‹ï¼š

1. **ä¾èµ–ç®¡ç†**ï¼š`spring-boot-starter-parent` é¢„å®šä¹‰äº† Spring Boot ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨æ¯ä¸ªæ¨¡å—çš„ `pom.xml` ä¸­æ˜¾å¼æŒ‡å®šç‰ˆæœ¬å·ï¼Œå¯ä»¥é¿å…ç‰ˆæœ¬å†²çªå’Œå…¼å®¹æ€§é—®é¢˜ã€‚
2. **æ’ä»¶ç®¡ç†**ï¼šå®ƒæä¾›äº†ä¸€äº›é¢„å…ˆé…ç½®çš„ Maven æ’ä»¶ï¼Œä¾‹å¦‚ `maven-compiler-plugin`ï¼ˆç”¨äºJavaç¼–è¯‘ï¼‰ã€`maven-surefire-plugin`ï¼ˆç”¨äºå•å…ƒæµ‹è¯•ï¼‰ç­‰ï¼Œè¿™äº›æ’ä»¶éƒ½å·²ç»é…ç½®å¥½äº†é€‚åˆå¤§å¤šæ•°Spring Bootåº”ç”¨çš„å‚æ•°ã€‚
3. **èµ„æºè¿‡æ»¤å’Œå±æ€§æ›¿æ¢**ï¼šé€šè¿‡åœ¨çˆ¶ POM ä¸­å®šä¹‰èµ„æºè¿‡æ»¤å’Œå±æ€§æ›¿æ¢è§„åˆ™ï¼Œå¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `application.properties`ï¼‰åœ¨ä¸åŒç¯å¢ƒé—´æ­£ç¡®åˆ‡æ¢ã€‚
4. **Spring Boot åº”ç”¨çš„æ‰“åŒ…ä¼˜åŒ–**ï¼šå®ƒé…ç½®äº† `maven-war-plugin` æ’ä»¶ï¼Œä½¿å¾—æ‰“åŒ…çš„ WAR æ–‡ä»¶ä¸­ä¸åŒ…å« `META-INF` ç›®å½•ä¸‹çš„ `pom.xml` å’Œ `pom.properties` æ–‡ä»¶ï¼Œè¿™å¯¹äºéƒ¨ç½²åˆ° Servlet å®¹å™¨æ˜¯æœ‰ç›Šçš„ã€‚
5. **è‡ªåŠ¨é…ç½®çš„ä¾èµ–**ï¼šå¯ä»¥æ–¹ä¾¿åœ°å¼•å…¥ Spring Boot çš„è‡ªåŠ¨é…ç½®ä¾èµ–ï¼Œä¾‹å¦‚ `spring-boot-starter`ï¼Œè¿™å¯ä»¥è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†è®¾ç½®ã€‚
6. **ç‰ˆæœ¬ä¸€è‡´æ€§**ï¼šç¡®ä¿æ‰€æœ‰ Spring Boot ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ä¸€è‡´ï¼Œé¿å…ä¸åŒåº“ä¹‹é—´çš„ç‰ˆæœ¬å†²çªã€‚
7. **å¿«é€Ÿå¼€å§‹**ï¼šå¯¹äºæ–°é¡¹ç›®ï¼Œä½¿ç”¨ `spring-boot-starter-parent` å¯ä»¥å¿«é€Ÿå¼€å§‹ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¤§é‡çš„ Maven è®¾ç½®ã€‚
8. **ç»§æ‰¿å’Œè‡ªå®šä¹‰**ï¼šå¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥ç»§æ‰¿ `spring-boot-starter-parent` å¹¶æ ¹æ®é¡¹ç›®éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚



### ğŸ¯ Spring Boot æ‰“æˆçš„ jar å’Œæ™®é€šçš„ jar æœ‰ä»€ä¹ˆåŒºåˆ« ?

Spring Boot é¡¹ç›®æœ€ç»ˆæ‰“åŒ…æˆçš„ jar æ˜¯å¯æ‰§è¡Œ jar ï¼Œè¿™ç§ jar å¯ä»¥ç›´æ¥é€šè¿‡ `java -jar xxx.jar` å‘½ä»¤æ¥è¿è¡Œï¼Œè¿™ç§ jar ä¸å¯ä»¥ä½œä¸ºæ™®é€šçš„ jar è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ï¼Œå³ä½¿ä¾èµ–äº†ä¹Ÿæ— æ³•ä½¿ç”¨å…¶ä¸­çš„ç±»ã€‚

Spring Boot çš„ jar æ— æ³•è¢«å…¶ä»–é¡¹ç›®ä¾èµ–ï¼Œä¸»è¦è¿˜æ˜¯ä»–å’Œæ™®é€š jar çš„ç»“æ„ä¸åŒã€‚æ™®é€šçš„ jar åŒ…ï¼Œè§£å‹åç›´æ¥å°±æ˜¯åŒ…åï¼ŒåŒ…é‡Œå°±æ˜¯æˆ‘ä»¬çš„ä»£ç ï¼Œè€Œ Spring Boot æ‰“åŒ…æˆçš„å¯æ‰§è¡Œ jar è§£å‹åï¼Œåœ¨ `\BOOT-INF\classes` ç›®å½•ä¸‹æ‰æ˜¯æˆ‘ä»¬çš„ä»£ç ï¼Œå› æ­¤æ— æ³•è¢«ç›´æ¥å¼•ç”¨ã€‚å¦‚æœéè¦å¼•ç”¨ï¼Œå¯ä»¥åœ¨ pom.xml æ–‡ä»¶ä¸­å¢åŠ é…ç½®ï¼Œå°† Spring Boot é¡¹ç›®æ‰“åŒ…æˆä¸¤ä¸ª jar ï¼Œä¸€ä¸ªå¯æ‰§è¡Œï¼Œä¸€ä¸ªå¯å¼•ç”¨ã€‚



### ğŸ¯ å¦‚ä½•ä½¿ç”¨ Spring Boot å®ç°å¼‚å¸¸å¤„ç†ï¼Ÿ

Spring Boot æä¾›äº†å¼‚å¸¸å¤„ç†çš„å¤šç§æ–¹å¼ï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ç§æ‰‹æ®µå®ç°ï¼š

- ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†ç±»ï¼ˆ`@ControllerAdvice` å’Œ `@ExceptionHandler`ï¼‰ã€‚
- é…ç½®è‡ªå®šä¹‰é”™è¯¯é¡µé¢æˆ–è¿”å›ç»Ÿä¸€çš„ JSON å“åº”ã€‚
- åˆ©ç”¨ Spring Boot è‡ªå¸¦çš„ `ErrorController` æ¥å£æ‰©å±•é»˜è®¤å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚



### ğŸ¯ Spring Boot Actuatoræœ‰ä»€ä¹ˆç”¨ï¼Ÿ

"Spring Boot Actuatoræä¾›äº†ç”Ÿäº§çº§åˆ«çš„ç›‘æ§å’Œç®¡ç†åŠŸèƒ½ï¼Œæ˜¯è¿ç»´å¿…å¤‡ç»„ä»¶ï¼š

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

**1. å¥åº·æ£€æŸ¥**ï¼š

- /healthç«¯ç‚¹æ˜¾ç¤ºåº”ç”¨å¥åº·çŠ¶æ€
- æ”¯æŒè‡ªå®šä¹‰å¥åº·æŒ‡ç¤ºå™¨
- å¯é›†æˆæ•°æ®åº“ã€Redisç­‰ç»„ä»¶æ£€æŸ¥

**2. æŒ‡æ ‡ç›‘æ§**ï¼š

- /metricsç«¯ç‚¹æä¾›JVMã€HTTPç­‰æŒ‡æ ‡
- é›†æˆMicrometeræŒ‡æ ‡åº“
- æ”¯æŒPrometheusã€InfluxDBç­‰ç›‘æ§ç³»ç»Ÿ

**3. åº”ç”¨ä¿¡æ¯**ï¼š

- /infoç«¯ç‚¹æ˜¾ç¤ºåº”ç”¨ç‰ˆæœ¬ã€Gitä¿¡æ¯
- /envç«¯ç‚¹æ˜¾ç¤ºç¯å¢ƒå˜é‡å’Œé…ç½®
- /configpropsæ˜¾ç¤ºé…ç½®å±æ€§

**4. è¿è¡Œæ—¶ç®¡ç†**ï¼š

- /shutdownç«¯ç‚¹ä¼˜é›…å…³é—­åº”ç”¨
- /loggersç«¯ç‚¹åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«
- /threaddumpè·å–çº¿ç¨‹è½¬å‚¨

**å¸¸ç”¨ç«¯ç‚¹**ï¼š

- /health - å¥åº·æ£€æŸ¥
- /metrics - åº”ç”¨æŒ‡æ ‡
- /info - åº”ç”¨ä¿¡æ¯
- /env - ç¯å¢ƒå˜é‡
- /loggers - æ—¥å¿—é…ç½®
- /heapdump - å †è½¬å‚¨
- /threaddump - çº¿ç¨‹è½¬å‚¨
- /shutdown - å…³é—­åº”ç”¨

**å®‰å…¨é…ç½®**ï¼š

- é»˜è®¤æƒ…å†µä¸‹å¤§éƒ¨åˆ†ç«¯ç‚¹éœ€è¦è®¤è¯
- å¯é€šè¿‡management.endpoints.web.exposure.includeé…ç½®æš´éœ²ç«¯ç‚¹
- å»ºè®®ç”Ÿäº§ç¯å¢ƒé…ç½®å®‰å…¨è®¿é—®æ§åˆ¶"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// 1. æ·»åŠ Actuatorä¾èµ–
/*
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
*/

// 2. Actuatoré…ç½®
// application.yml
/*
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,info,env
      base-path: /actuator
  endpoint:
    health:
      show-details: always
    shutdown:
      enabled: true
  server:
    port: 8081  # ç®¡ç†ç«¯å£ä¸åº”ç”¨ç«¯å£åˆ†ç¦»
    
info:
  app:
    name: @project.name@
    version: @project.version@
    description: Demo Application
*/

// 3. è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
@Component
public class CustomHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘
        boolean isHealthy = checkExternalService();
        
        if (isHealthy) {
            return Health.up()
                    .withDetail("status", "æœåŠ¡æ­£å¸¸")
                    .withDetail("timestamp", System.currentTimeMillis())
                    .build();
        } else {
            return Health.down()
                    .withDetail("status", "å¤–éƒ¨æœåŠ¡ä¸å¯ç”¨")
                    .withDetail("error", "è¿æ¥è¶…æ—¶")
                    .build();
        }
    }
    
    private boolean checkExternalService() {
        // æ£€æŸ¥å¤–éƒ¨æœåŠ¡çŠ¶æ€
        return Math.random() > 0.2;
    }
}

// 4. è‡ªå®šä¹‰æŒ‡æ ‡
@RestController
public class MetricsController {
    
    private final Counter requestCounter;
    private final Timer requestTimer;
    
    public MetricsController(MeterRegistry meterRegistry) {
        this.requestCounter = Counter.builder("http_requests_total")
                .description("Total HTTP requests")
                .tag("method", "GET")
                .register(meterRegistry);
                
        this.requestTimer = Timer.builder("http_request_duration")
                .description("HTTP request duration")
                .register(meterRegistry);
    }
    
    @GetMapping("/api/data")
    public String getData() {
        return requestTimer.recordCallable(() -> {
            requestCounter.increment();
            // æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘
            try {
                Thread.sleep(100);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            return "æ•°æ®è¿”å›æˆåŠŸ";
        });
    }
}

// 5. å®‰å…¨é…ç½®
@Configuration
public class ActuatorSecurityConfig {
    
    @Bean
    public SecurityFilterChain actuatorSecurityFilterChain(HttpSecurity http) throws Exception {
        return http
                .requestMatcher(EndpointRequest.toAnyEndpoint())
                .authorizeHttpRequests(authz -> authz
                    .requestMatchers(EndpointRequest.to("health")).permitAll()
                    .anyRequest().hasRole("ADMIN")
                )
                .httpBasic(Customizer.withDefaults())
                .build();
    }
}

// 6. ç›‘æ§é›†æˆç¤ºä¾‹
// Prometheusé…ç½®
/*
management:
  metrics:
    export:
      prometheus:
        enabled: true
  endpoints:
    web:
      exposure:
        include: prometheus
*/

// è®¿é—®ç›‘æ§ç«¯ç‚¹ç¤ºä¾‹
/*
curl http://localhost:8080/actuator/health
curl http://localhost:8080/actuator/metrics
curl http://localhost:8080/actuator/info
curl http://localhost:8080/actuator/env
*/
```



### ğŸ¯spring boot æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿbootstrap.properties å’Œ application.properties æœ‰ä½•åŒºåˆ« ?

å•çº¯åš Spring Boot å¼€å‘ï¼Œå¯èƒ½ä¸å¤ªå®¹æ˜“é‡åˆ° bootstrap.properties é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨ç»“åˆ Spring Cloud æ—¶ï¼Œè¿™ä¸ªé…ç½®å°±ä¼šç»å¸¸é‡åˆ°äº†ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŠ è½½ä¸€äº›è¿œç¨‹é…ç½®æ–‡ä»¶çš„æ—¶ä¾¯ã€‚

spring boot æ ¸å¿ƒçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š

- bootstrap (. yml æˆ–è€… . properties)ï¼šboostrap ç”±çˆ¶ ApplicationContext åŠ è½½çš„ï¼Œæ¯” applicaton ä¼˜å…ˆåŠ è½½ï¼Œé…ç½®åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µç”Ÿæ•ˆã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬åœ¨ Spring Cloud Config æˆ–è€… Nacos ä¸­ä¼šç”¨åˆ°å®ƒã€‚ä¸” boostrap é‡Œé¢çš„å±æ€§ä¸èƒ½è¢«è¦†ç›–ï¼›
- application (. yml æˆ–è€… . properties)ï¼š ç”± ApplicatonContext åŠ è½½ï¼Œç”¨äº spring boot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚



### ğŸ¯Spring Boot çš„æ ¸å¿ƒæ³¨è§£æ˜¯å“ªä¸ªï¼Ÿå®ƒä¸»è¦ç”±å“ªå‡ ä¸ªæ³¨è§£ç»„æˆçš„ï¼Ÿ

å¯åŠ¨ç±»ä¸Šé¢çš„æ³¨è§£æ˜¯@SpringBootApplicationï¼Œå®ƒä¹Ÿæ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ï¼Œä¸»è¦ç»„åˆåŒ…å«äº†ä»¥ä¸‹ 3 ä¸ªæ³¨è§£ï¼š

- @SpringBootConfigurationï¼šç»„åˆäº† @Configuration æ³¨è§£ï¼Œå®ç°é…ç½®æ–‡ä»¶çš„åŠŸèƒ½ã€‚
- @EnableAutoConfigurationï¼šæ‰“å¼€è‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å…³é—­æŸä¸ªè‡ªåŠ¨é…ç½®çš„é€‰é¡¹ï¼Œå¦‚å…³é—­æ•°æ®æºè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼š @SpringBootApplication(exclude = { DataSourceAutoConfiguration.class })ã€‚
- @ComponentScanï¼šSpringç»„ä»¶æ‰«æã€‚



---

## 

## ğŸ’¾ äº”ã€æ•°æ®è®¿é—®ä¸äº‹åŠ¡ï¼ˆTransactionæ ¸å¿ƒï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šSpringæä¾›ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†æŠ½è±¡ï¼Œæ”¯æŒå£°æ˜å¼äº‹åŠ¡ï¼Œç®€åŒ–æ•°æ®è®¿é—®å±‚å¼€å‘ã€‚

### ğŸ¯ Springäº‹åŠ¡ç®¡ç†æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ

"Springäº‹åŠ¡ç®¡ç†æä¾›äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ”¯æŒå¤šç§äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼š

**äº‹åŠ¡ç®¡ç†æ–¹å¼**ï¼š

**ç¼–ç¨‹å¼äº‹åŠ¡**ï¼š
- é€šè¿‡TransactionTemplateæˆ–PlatformTransactionManageræ‰‹åŠ¨ç®¡ç†
- ä»£ç ä¾µå…¥æ€§å¼ºï¼Œä½†æ§åˆ¶ç²¾ç¡®
- é€‚ç”¨äºå¤æ‚çš„äº‹åŠ¡é€»è¾‘

**å£°æ˜å¼äº‹åŠ¡**ï¼š
- åŸºäºAOPå®ç°ï¼Œä½¿ç”¨@Transactionalæ³¨è§£
- ä»£ç æ— ä¾µå…¥ï¼Œé…ç½®ç®€å•
- æ˜¯ä¼ä¸šå¼€å‘çš„é¦–é€‰æ–¹æ¡ˆ

**æ ¸å¿ƒç»„ä»¶**ï¼š
- PlatformTransactionManagerï¼šäº‹åŠ¡ç®¡ç†å™¨æ¥å£
- TransactionDefinitionï¼šäº‹åŠ¡å®šä¹‰ä¿¡æ¯
- TransactionStatusï¼šäº‹åŠ¡è¿è¡ŒçŠ¶æ€
- TransactionTemplateï¼šç¼–ç¨‹å¼äº‹åŠ¡æ¨¡æ¿

**äº‹åŠ¡å±æ€§**ï¼š
- ä¼ æ’­è¡Œä¸ºï¼šå®šä¹‰äº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„è¡Œä¸º
- éš”ç¦»çº§åˆ«ï¼šæ§åˆ¶å¹¶å‘äº‹åŠ¡çš„éš”ç¦»ç¨‹åº¦
- è¶…æ—¶æ—¶é—´ï¼šäº‹åŠ¡æ‰§è¡Œçš„æœ€å¤§æ—¶é—´
- åªè¯»å±æ€§ï¼šä¼˜åŒ–åªè¯»æ“ä½œçš„æ€§èƒ½
- å›æ»šè§„åˆ™ï¼šå®šä¹‰å“ªäº›å¼‚å¸¸å¯¼è‡´å›æ»š"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
@Transactional
public class UserService {
    
    // å£°æ˜å¼äº‹åŠ¡ - é»˜è®¤é…ç½®
    public void saveUser(User user) {
        userRepository.save(user);
        // è¿è¡Œæ—¶å¼‚å¸¸è‡ªåŠ¨å›æ»š
    }
    
    // æŒ‡å®šä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«
    @Transactional(
        propagation = Propagation.REQUIRES_NEW,
        isolation = Isolation.READ_COMMITTED,
        timeout = 30,
        rollbackFor = Exception.class
    )
    public void processOrder(Order order) {
        orderRepository.save(order);
        updateInventory(order);
    }
    
    // åªè¯»äº‹åŠ¡ä¼˜åŒ–
    @Transactional(readOnly = true)
    public List<User> findActiveUsers() {
        return userRepository.findByStatus("ACTIVE");
    }
}
```

### ğŸ¯ Springäº‹åŠ¡ä¼ æ’­è¡Œä¸ºæœ‰å“ªäº›ï¼Ÿ

"Springå®šä¹‰äº†7ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œæ§åˆ¶äº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„äº‹åŠ¡è¾¹ç•Œï¼š

**æ”¯æŒå½“å‰äº‹åŠ¡**ï¼š

**REQUIREDï¼ˆé»˜è®¤ï¼‰**ï¼š
- æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º
- æœ€å¸¸ç”¨çš„ä¼ æ’­è¡Œä¸º

**SUPPORTS**ï¼š
- æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ä»¥éäº‹åŠ¡æ‰§è¡Œ
- é€‚ç”¨äºæŸ¥è¯¢æ–¹æ³•

**MANDATORY**ï¼š
- å¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™æŠ›å¼‚å¸¸
- å¼ºåˆ¶è¦æ±‚è°ƒç”¨æ–¹æä¾›äº‹åŠ¡

**ä¸æ”¯æŒå½“å‰äº‹åŠ¡**ï¼š

**REQUIRES_NEW**ï¼š
- æ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡
- é€‚ç”¨äºç‹¬ç«‹çš„å­äº‹åŠ¡

**NOT_SUPPORTED**ï¼š
- ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡
- é€‚ç”¨äºä¸éœ€è¦äº‹åŠ¡çš„æ“ä½œ

**NEVER**ï¼š
- ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œæœ‰äº‹åŠ¡å°±æŠ›å¼‚å¸¸
- å¼ºåˆ¶éäº‹åŠ¡æ‰§è¡Œ

**åµŒå¥—äº‹åŠ¡**ï¼š

**NESTED**ï¼š
- åµŒå¥—äº‹åŠ¡ï¼ŒåŸºäºä¿å­˜ç‚¹å®ç°
- å†…å±‚äº‹åŠ¡å›æ»šä¸å½±å“å¤–å±‚äº‹åŠ¡"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private PaymentService paymentService;
    @Autowired
    private LogService logService;
    
    @Transactional
    public void processOrder(Order order) {
        // ä¸»äº‹åŠ¡
        orderRepository.save(order);
        
        // REQUIRES_NEWï¼šç‹¬ç«‹äº‹åŠ¡ï¼Œä¸å—ä¸»äº‹åŠ¡å½±å“
        paymentService.processPayment(order);
        
        // NESTEDï¼šåµŒå¥—äº‹åŠ¡ï¼Œå¯ä»¥ç‹¬ç«‹å›æ»š
        logService.logOrder(order);
    }
}

@Service
public class PaymentService {
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void processPayment(Order order) {
        // æ–°çš„ç‹¬ç«‹äº‹åŠ¡
        Payment payment = new Payment(order);
        paymentRepository.save(payment);
        // å³ä½¿ä¸»äº‹åŠ¡å›æ»šï¼Œæ”¯ä»˜è®°å½•ä¹Ÿä¼šä¿å­˜
    }
}

@Service  
public class LogService {
    
    @Transactional(propagation = Propagation.NESTED)
    public void logOrder(Order order) {
        // åµŒå¥—äº‹åŠ¡
        OrderLog log = new OrderLog(order);
        logRepository.save(log);
        // å¦‚æœæ—¥å¿—å¤±è´¥ï¼Œåªå›æ»šæ—¥å¿—æ“ä½œ
    }
}
```

### ğŸ¯ Springäº‹åŠ¡ä»€ä¹ˆæ—¶å€™ä¼šå¤±æ•ˆï¼Ÿ

"Springäº‹åŠ¡å¤±æ•ˆæ˜¯å¸¸è§é—®é¢˜ï¼Œä¸»è¦åŸå› åŒ…æ‹¬ï¼š

**AOPä»£ç†å¤±æ•ˆåœºæ™¯**ï¼š

**1. æ–¹æ³•ä¸æ˜¯public**ï¼š
- @Transactionalåªèƒ½ä½œç”¨äºpublicæ–¹æ³•
- private/protected/é»˜è®¤æ–¹æ³•äº‹åŠ¡ä¸ç”Ÿæ•ˆ

**2. å†…éƒ¨æ–¹æ³•è°ƒç”¨**ï¼š
- åŒä¸€ä¸ªç±»å†…éƒ¨æ–¹æ³•è°ƒç”¨ï¼Œä¸ç»è¿‡ä»£ç†
- è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡ApplicationContextè·å–ä»£ç†å¯¹è±¡

**3. æ–¹æ³•è¢«finalä¿®é¥°**ï¼š
- finalæ–¹æ³•æ— æ³•è¢«ä»£ç†é‡å†™
- staticæ–¹æ³•åŒæ ·æ— æ³•è¢«ä»£ç†

**å¼‚å¸¸å¤„ç†é—®é¢˜**ï¼š

**4. å¼‚å¸¸è¢«æ•è·**ï¼š
- try-catchæ•è·å¼‚å¸¸ä½†ä¸é‡æ–°æŠ›å‡º
- äº‹åŠ¡ç®¡ç†å™¨æ„ŸçŸ¥ä¸åˆ°å¼‚å¸¸

**5. å¼‚å¸¸ç±»å‹ä¸åŒ¹é…**ï¼š
- é»˜è®¤åªå›æ»šRuntimeException
- æ£€æŸ¥å¼‚å¸¸éœ€è¦æ˜¾å¼é…ç½®rollbackFor

**é…ç½®å’Œç¯å¢ƒé—®é¢˜**ï¼š

**6. äº‹åŠ¡ç®¡ç†å™¨æœªæ­£ç¡®é…ç½®**ï¼š
- æ•°æ®æºä¸äº‹åŠ¡ç®¡ç†å™¨ä¸åŒ¹é…
- å¤šæ•°æ®æºé…ç½®é”™è¯¯

**7. ä¼ æ’­è¡Œä¸ºé…ç½®é”™è¯¯**ï¼š
- NOT_SUPPORTEDã€NEVERç­‰ä¼ æ’­è¡Œä¸º
- å¯¼è‡´æ–¹æ³•ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class UserService {
    
    // âŒ é”™è¯¯ï¼šépublicæ–¹æ³•
    @Transactional
    private void updateUserInternal(User user) {
        userRepository.save(user);
    }
    
    // âŒ é”™è¯¯ï¼šå†…éƒ¨è°ƒç”¨ä¸ç»è¿‡ä»£ç†
    @Transactional
    public void updateUser(User user) {
        this.updateUserInternal(user); // äº‹åŠ¡å¤±æ•ˆ
    }
    
    // âŒ é”™è¯¯ï¼šå¼‚å¸¸è¢«æ•è·
    @Transactional
    public void saveUserWithCatch(User user) {
        try {
            userRepository.save(user);
            throw new RuntimeException("æµ‹è¯•å¼‚å¸¸");
        } catch (Exception e) {
            // å¼‚å¸¸è¢«æ•è·ï¼Œäº‹åŠ¡ä¸å›æ»š
            log.error("ä¿å­˜å¤±è´¥", e);
        }
    }
    
    // âœ… æ­£ç¡®ï¼šé‡æ–°æŠ›å‡ºå¼‚å¸¸
    @Transactional
    public void saveUserCorrect(User user) {
        try {
            userRepository.save(user);
        } catch (Exception e) {
            log.error("ä¿å­˜å¤±è´¥", e);
            throw e; // é‡æ–°æŠ›å‡ºå¼‚å¸¸
        }
    }
    
    // âœ… æ­£ç¡®ï¼šæŒ‡å®šå›æ»šå¼‚å¸¸ç±»å‹
    @Transactional(rollbackFor = Exception.class)
    public void saveUserWithCheckedException(User user) throws Exception {
        userRepository.save(user);
        if (user.getAge() < 0) {
            throw new Exception("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°");
        }
    }
}
```

### ğŸ¯ Spring Data JPAå’ŒMyBatisçš„åŒºåˆ«ï¼Ÿ

"Spring Data JPAå’ŒMyBatisæ˜¯ä¸¤ç§ä¸åŒçš„æ•°æ®è®¿é—®æŠ€æœ¯ï¼š

**Spring Data JPA**ï¼š
- åŸºäºJPAæ ‡å‡†çš„ORMæ¡†æ¶
- çº¦å®šå¤§äºé…ç½®ï¼Œè‡ªåŠ¨ç”ŸæˆSQL
- Repositoryæ¥å£è‡ªåŠ¨å®ç°CRUD
- é€‚åˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œå¯¹è±¡å…³ç³»æ˜ å°„
- å­¦ä¹ æˆæœ¬ä½ï¼Œå¼€å‘æ•ˆç‡é«˜

**MyBatis**ï¼š
- åŠè‡ªåŠ¨ORMæ¡†æ¶ï¼ŒSQLä¸Javaåˆ†ç¦»
- éœ€è¦æ‰‹å†™SQLï¼Œæ§åˆ¶ç²¾ç¡®
- æ”¯æŒåŠ¨æ€SQLï¼Œé€‚åˆå¤æ‚æŸ¥è¯¢
- é€‚åˆæ•°æ®åº“ä¼˜å…ˆè®¾è®¡
- æ€§èƒ½å¯æ§ï¼Œä½†å¼€å‘å·¥ä½œé‡å¤§

**é€‰æ‹©å»ºè®®**ï¼š
- ç®€å•CRUDï¼Œå¿«é€Ÿå¼€å‘ï¼šSpring Data JPA
- å¤æ‚æŸ¥è¯¢ï¼Œæ€§èƒ½è¦æ±‚é«˜ï¼šMyBatis
- å›¢é˜Ÿç†Ÿæ‚‰SQLï¼šMyBatis
- å›¢é˜Ÿåå‘å¯¹è±¡æ¨¡å‹ï¼šSpring Data JPA"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// Spring Data JPAæ–¹å¼
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    // æ–¹æ³•åè‡ªåŠ¨ç”ŸæˆSQL
    List<User> findByNameAndAge(String name, Integer age);
    
    // è‡ªå®šä¹‰æŸ¥è¯¢
    @Query("SELECT u FROM User u WHERE u.email = ?1")
    User findByEmail(String email);
    
    // åˆ†é¡µæŸ¥è¯¢
    Page<User> findByNameContaining(String name, Pageable pageable);
}

// MyBatisæ–¹å¼
@Mapper
public interface UserMapper {
    @Select("SELECT * FROM user WHERE name = #{name} AND age = #{age}")
    List<User> findByNameAndAge(@Param("name") String name, @Param("age") Integer age);
    
    @Insert("INSERT INTO user(name, email, age) VALUES(#{name}, #{email}, #{age})")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insertUser(User user);
    
    // XMLé…ç½®å¤æ‚æŸ¥è¯¢
    List<User> findUsersWithConditions(UserQueryCondition condition);
}
```



### ğŸ¯ Spring ä¸­çš„äº‹åŠ¡ç®¡ç†

ä½œä¸ºä¼ä¸šçº§åº”ç”¨ç¨‹åºæ¡†æ¶,ï¼ŒSpring åœ¨ä¸åŒçš„äº‹åŠ¡ç®¡ç† API ä¹‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè€Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ä¸å¿…äº†è§£åº•å±‚çš„äº‹åŠ¡ç®¡ç† APIï¼Œå°±å¯ä»¥ä½¿ç”¨ Spring çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶

Spring æ—¢æ”¯æŒ**ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†**ï¼Œä¹Ÿæ”¯æŒ**å£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†**

- ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼šå°†äº‹åŠ¡ç®¡ç†ä»£ç åµŒå…¥åˆ°ä¸šåŠ¡æ–¹æ³•ä¸­æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼Œåœ¨ç¼–ç¨‹å¼ç®¡ç†äº‹åŠ¡æ—¶ï¼Œå¿…é¡»åœ¨æ¯ä¸ªäº‹åŠ¡æ“ä½œä¸­åŒ…å«é¢å¤–çš„äº‹åŠ¡ç®¡ç†ä»£ç ï¼Œå±äºç¡¬ç¼–ç 
- å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹æ¯”ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†æ›´å¥½ç”¨ã€‚å®ƒå°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡æ–¹æ³•ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»¥å£°æ˜çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚äº‹åŠ¡ç®¡ç†ä½œä¸ºä¸€ç§æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå¯ä»¥é€šè¿‡ AOP æ–¹æ³•æ¨¡å—åŒ–ã€‚Spring é€šè¿‡ Spring AOP æ¡†æ¶æ”¯æŒå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œ**å£°æ˜å¼äº‹åŠ¡åˆåˆ†ä¸ºä¸¤ç§ï¼š**
  - åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡
  - åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡



### ğŸ¯ Spring Boot çš„äº‹åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

Spring Boot çš„äº‹åŠ¡ç®¡ç†æ˜¯åŸºäº **Spring Framework** çš„äº‹åŠ¡æŠ½è±¡å®ç°çš„ï¼Œåˆ©ç”¨äº† Spring çš„ **å£°æ˜å¼äº‹åŠ¡**ï¼ˆåŸºäº AOPï¼‰å’Œ **ç¼–ç¨‹å¼äº‹åŠ¡**ï¼ˆé€šè¿‡ `PlatformTransactionManager`ï¼‰æ¥è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚åœ¨ Spring Boot ä¸­ï¼Œäº‹åŠ¡çš„å®ç°æœ¬è´¨ä¸Šæ˜¯ Spring æä¾›çš„äº‹åŠ¡ç®¡ç†åŠŸèƒ½çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œé€šè¿‡è‡ªåŠ¨é…ç½®æœºåˆ¶æ¥ç®€åŒ–äº‹åŠ¡ç®¡ç†çš„é…ç½®ã€‚

ä¸‹é¢æˆ‘ä»¬è¯¦ç»†æ¢è®¨ Spring Boot å¦‚ä½•å®ç°äº‹åŠ¡ç®¡ç†ã€‚

1. **Spring äº‹åŠ¡ç®¡ç†çš„æ ¸å¿ƒç»„ä»¶**

   Spring çš„äº‹åŠ¡ç®¡ç†ä¸»è¦ä¾èµ–äºä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š

   - **`PlatformTransactionManager`**ï¼šè¿™æ˜¯ Spring æä¾›çš„äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œæ”¯æŒå„ç§ç±»å‹çš„äº‹åŠ¡ç®¡ç†ã€‚å¸¸ç”¨çš„å®ç°ç±»åŒ…æ‹¬ï¼š
     - `DataSourceTransactionManager`ï¼šç”¨äº JDBC æ•°æ®æºçš„äº‹åŠ¡ç®¡ç†ã€‚
     - `JpaTransactionManager`ï¼šç”¨äº JPAï¼ˆJava Persistence APIï¼‰æŒä¹…åŒ–æ¡†æ¶çš„äº‹åŠ¡ç®¡ç†ã€‚
     - `HibernateTransactionManager`ï¼šç”¨äº Hibernate çš„äº‹åŠ¡ç®¡ç†ã€‚

   - **`TransactionDefinition`**ï¼šå®šä¹‰äº†äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€å›æ»šè§„åˆ™ç­‰äº‹åŠ¡å±æ€§ã€‚

   - **`TransactionStatus`**ï¼šä»£è¡¨äº‹åŠ¡çš„çŠ¶æ€ï¼Œè®°å½•äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚

2. **Spring Boot å¦‚ä½•è‡ªåŠ¨é…ç½®äº‹åŠ¡ç®¡ç†**

   Spring Boot ä¼šè‡ªåŠ¨æ ¹æ®é¡¹ç›®ä¸­åŒ…å«çš„åº“æ¥é…ç½®åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ **JPA**ï¼ˆé€šè¿‡ `spring-boot-starter-data-jpa`ï¼‰ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® `JpaTransactionManager`ï¼›å¦‚æœä½¿ç”¨çš„æ˜¯ **JDBC**ï¼Œåˆ™ä¼šè‡ªåŠ¨é…ç½® `DataSourceTransactionManager`ã€‚

   Spring Boot çš„è‡ªåŠ¨é…ç½®åŸºäº **Spring Framework** çš„ `@EnableTransactionManagement` å’Œ **AOP**ï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æœºåˆ¶ã€‚

- **è‡ªåŠ¨é…ç½®äº‹åŠ¡ç®¡ç†å™¨**

  Spring Boot ä¼šæ ¹æ® `application.properties` æˆ– `application.yml` ä¸­çš„é…ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ `PlatformTransactionManager`ï¼Œå¹¶ä¸”ä¸ºä½ é…ç½®ä¸€ä¸ª `@Transactional` æ³¨è§£æ‰€éœ€çš„ä»£ç†ã€‚

  ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨äº† JPA å’Œ Spring Data JPAï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® `JpaTransactionManager`ã€‚

  ```java
  @Configuration
  @EnableTransactionManagement
  public class DataSourceConfig {
      // é…ç½®äº‹åŠ¡ç®¡ç†å™¨
      @Bean
      public PlatformTransactionManager transactionManager(EntityManagerFactory entityManagerFactory) {
          return new JpaTransactionManager(entityManagerFactory);
      }
  }
  ```

  Spring Boot ä¼šæ ¹æ®è‡ªåŠ¨é…ç½®ä¸ºæˆ‘ä»¬ç”Ÿæˆè¿™ä¸ª `transactionManager`ï¼Œä»è€Œç®€åŒ–äº†é…ç½®è¿‡ç¨‹ã€‚

- **äº‹åŠ¡ä»£ç†å’Œ AOP**

  Spring Boot çš„äº‹åŠ¡ç®¡ç†åŸºäº **AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰** å®ç°çš„ã€‚å½“ä½ åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ `@Transactional` æ³¨è§£æ—¶ï¼ŒSpring ä¼šåœ¨åº•å±‚åˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œè¿™ä¸ªä»£ç†ä¼šæ‹¦æˆªæ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œäº‹åŠ¡ç›¸å…³çš„æ“ä½œï¼ˆå¦‚å¼€å¯ã€æäº¤ã€å›æ»šäº‹åŠ¡ï¼‰ã€‚

  å…·ä½“æ¥è¯´ï¼ŒSpring é€šè¿‡ `@Transactional` æ³¨è§£åˆ›å»ºçš„ä»£ç†ç±»ä¼šé€šè¿‡ **åŠ¨æ€ä»£ç†ï¼ˆJDK åŠ¨æ€ä»£ç†æˆ– CGLIB ä»£ç†ï¼‰** æ¥æ‹¦æˆªç›®æ ‡æ–¹æ³•çš„è°ƒç”¨ï¼Œæ‰§è¡Œäº‹åŠ¡ç®¡ç†é€»è¾‘ï¼š

  - åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œä»£ç†ä¼šå…ˆå¼€å¯äº‹åŠ¡ã€‚

  - åœ¨æ–¹æ³•æ‰§è¡Œåï¼Œä»£ç†ä¼šæ ¹æ®æ–¹æ³•æ‰§è¡Œçš„ç»“æœæ¥å†³å®šæ˜¯æäº¤äº‹åŠ¡è¿˜æ˜¯å›æ»šäº‹åŠ¡ï¼ˆå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼‰ã€‚

3. **Spring Boot äº‹åŠ¡ç®¡ç†çš„å·¥ä½œåŸç†**

- **å£°æ˜å¼äº‹åŠ¡ï¼ˆåŸºäº AOPï¼‰**

  Spring Boot é»˜è®¤ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚è¿™æ˜¯é€šè¿‡ **`@Transactional`** æ³¨è§£å®ç°çš„ã€‚Spring Boot çš„äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æŠ€æœ¯æ¥åŠ¨æ€å¤„ç†äº‹åŠ¡çš„ã€‚

  å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

  1. **æ–¹æ³•æ‰§è¡Œä¹‹å‰**ï¼šä»£ç†å¯¹è±¡ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰è°ƒç”¨ `PlatformTransactionManager` çš„ `begin()` æ–¹æ³•ï¼Œå¼€å¯äº‹åŠ¡ã€‚

  2. **æ–¹æ³•æ‰§è¡Œä¹‹å**ï¼šæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œä»£ç†å¯¹è±¡ä¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å’ŒæŠ›å‡ºçš„å¼‚å¸¸æ¥åˆ¤æ–­æ˜¯æäº¤äº‹åŠ¡è¿˜æ˜¯å›æ»šäº‹åŠ¡ï¼š

     - å¦‚æœæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæˆï¼Œäº‹åŠ¡ä¼šè¢«æäº¤ï¼ˆ`commit()`ï¼‰ã€‚

     - å¦‚æœæ–¹æ³•æŠ›å‡º `RuntimeException` æˆ–å…¶ä»–é…ç½®çš„å¼‚å¸¸ç±»å‹ï¼Œäº‹åŠ¡ä¼šè¢«å›æ»šï¼ˆ`rollback()`ï¼‰ã€‚

- **äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«**

  Spring äº‹åŠ¡è¿˜å¯ä»¥é€šè¿‡é…ç½® `@Transactional` æ³¨è§£çš„å±æ€§æ¥æŒ‡å®šäº‹åŠ¡çš„ **ä¼ æ’­è¡Œä¸º** å’Œ **éš”ç¦»çº§åˆ«**ï¼Œè¿™ä¹Ÿæ˜¯ Spring äº‹åŠ¡ç®¡ç†çš„ä¸€å¤§ç‰¹ç‚¹ã€‚

  - **ä¼ æ’­è¡Œä¸ºï¼ˆPropagationï¼‰**ï¼šæŒ‡å®šä¸€ä¸ªæ–¹æ³•å¦‚ä½•å‚ä¸å½“å‰äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼š

    - `REQUIRED`ï¼ˆé»˜è®¤ï¼‰ï¼šå¦‚æœå½“å‰æ–¹æ³•æœ‰äº‹åŠ¡ï¼ŒåŠ å…¥å½“å‰äº‹åŠ¡ï¼›å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚
    - `REQUIRES_NEW`ï¼šæ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡ã€‚
    - `NESTED`ï¼šåœ¨å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œä½†æ”¯æŒäº‹åŠ¡åµŒå¥—ã€‚

  - **éš”ç¦»çº§åˆ«ï¼ˆIsolationï¼‰**ï¼šæ§åˆ¶äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ã€‚ä¾‹å¦‚ï¼š

    - `READ_COMMITTED`ï¼šç¡®ä¿è¯»å–çš„æ•°æ®æ˜¯å·²æäº¤çš„æ•°æ®ã€‚

    - `READ_UNCOMMITTED`ï¼šå…è®¸è¯»å–æœªæäº¤çš„æ•°æ®ã€‚

    - `SERIALIZABLE`ï¼šæœ€ä¸¥æ ¼çš„éš”ç¦»çº§åˆ«ï¼Œä¿è¯äº‹åŠ¡å®Œå…¨éš”ç¦»ï¼Œé¿å…å¹¶å‘é—®é¢˜ã€‚

      ```java
      @Transactional(propagation = Propagation.REQUIRES_NEW, isolation = Isolation.READ_COMMITTED)
      public void someMethod() {
          // è¯¥æ–¹æ³•ä¼šå¼€å¯æ–°çš„äº‹åŠ¡å¹¶è®¾ç½®éš”ç¦»çº§åˆ«
      }
      ```

- **å›æ»šè§„åˆ™**

  é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring çš„äº‹åŠ¡ç®¡ç†ä¼šåœ¨å‘ç”Ÿ **è¿è¡Œæ—¶å¼‚å¸¸**ï¼ˆ`RuntimeException`ï¼‰æˆ– **Error** æ—¶è¿›è¡Œå›æ»šã€‚å¦‚æœæŠ›å‡ºçš„æ˜¯ **æ£€æŸ¥å‹å¼‚å¸¸**ï¼ˆ`CheckedException`ï¼‰ï¼Œåˆ™é»˜è®¤ä¸ä¼šå›æ»šï¼Œä½†å¯ä»¥é€šè¿‡ `@Transactional` æ³¨è§£çš„ `rollbackFor` å±æ€§æ¥ä¿®æ”¹è¿™ä¸€è¡Œä¸ºã€‚

  ```java
  @Transactional(rollbackFor = Exception.class)
  public void someMethod() throws Exception {
      // è¿™é‡Œå¦‚æœæŠ›å‡º Exception ç±»å‹çš„å¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šå›æ»š
  }
  ```

4. **ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†**

   é™¤äº†å£°æ˜å¼äº‹åŠ¡ï¼ˆé€šè¿‡ `@Transactional` æ³¨è§£ï¼‰ï¼ŒSpring è¿˜æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†é€šå¸¸ç”¨äºå¯¹äº‹åŠ¡è¿›è¡Œæ›´åŠ ç»†ç²’åº¦çš„æ§åˆ¶ã€‚Spring æä¾›äº† `PlatformTransactionManager` æ¥å£æ¥è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Œæœ€å¸¸ç”¨çš„å®ç°æ˜¯ `DataSourceTransactionManager` å’Œ `JpaTransactionManager`ã€‚

   ```java
   @Autowired
   private PlatformTransactionManager transactionManager;
   
   public void someMethod() {
       TransactionDefinition definition = new DefaultTransactionDefinition();
       TransactionStatus status = transactionManager.getTransaction(definition);
       
       try {
           // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
           transactionManager.commit(status);
       } catch (Exception e) {
           transactionManager.rollback(status);
       }
   }
   ```

5. **äº‹åŠ¡ç®¡ç†çš„ä¼˜ç‚¹å’Œç‰¹ç‚¹**

   - **ç®€åŒ–äº†é…ç½®**ï¼šSpring Boot è‡ªåŠ¨æ ¹æ®ä½¿ç”¨çš„æŒä¹…åŒ–æ¡†æ¶é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå‡å°‘äº†æ‰‹åŠ¨é…ç½®çš„å·¥ä½œé‡ã€‚

   - **åŸºäº AOP**ï¼šå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä½¿ç”¨ AOP æŠ€æœ¯åŠ¨æ€ä»£ç†ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œå®ç°äº‹åŠ¡çš„è‡ªåŠ¨æ§åˆ¶ã€‚

   - **çµæ´»çš„ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«**ï¼šSpring æä¾›äº†å¤šç§ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»é…ç½®ã€‚

   - **äº‹åŠ¡å›æ»š**ï¼šé€šè¿‡ `@Transactional` æ³¨è§£ï¼ŒSpring å¯ä»¥è‡ªåŠ¨æ ¹æ®å¼‚å¸¸ç±»å‹å†³å®šæ˜¯å¦å›æ»šäº‹åŠ¡ï¼Œæ”¯æŒè‡ªå®šä¹‰å›æ»šè§„åˆ™ã€‚

> **Spring Boot çš„äº‹åŠ¡ç®¡ç†æ˜¯åŸºäº Spring æ¡†æ¶çš„äº‹åŠ¡æŠ½è±¡å®ç°çš„**ã€‚Spring Boot è‡ªåŠ¨é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå…·ä½“äº‹åŠ¡ç®¡ç†å™¨ï¼ˆå¦‚ `JpaTransactionManager` æˆ– `DataSourceTransactionManager`ï¼‰ä¼šæ ¹æ®é¡¹ç›®ä¸­ä½¿ç”¨çš„æŒä¹…åŒ–æ¡†æ¶è‡ªåŠ¨é€‰æ‹©ã€‚äº‹åŠ¡ç®¡ç†ä¸»è¦é€šè¿‡ **å£°æ˜å¼äº‹åŠ¡** å’Œ **ç¼–ç¨‹å¼äº‹åŠ¡** æ¥å®ç°ã€‚
>
> - **å£°æ˜å¼äº‹åŠ¡**ï¼šé€šè¿‡ `@Transactional` æ³¨è§£æ¥ç®¡ç†äº‹åŠ¡ï¼ŒSpring ä¼šé€šè¿‡ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æŠ€æœ¯ï¼Œæ‹¦æˆªæ ‡æ³¨äº† `@Transactional` æ³¨è§£çš„æ–¹æ³•ï¼Œè‡ªåŠ¨å¤„ç†äº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šã€‚
> - **ç¼–ç¨‹å¼äº‹åŠ¡**ï¼šé€šè¿‡ `PlatformTransactionManager` å’Œ `TransactionStatus` æ¥æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼Œé€‚ç”¨äºæ›´åŠ çµæ´»çš„åœºæ™¯ã€‚
>
> Spring Boot é»˜è®¤æ”¯æŒå¸¸è§çš„ä¼ æ’­è¡Œä¸ºï¼ˆå¦‚ `REQUIRED`ã€`REQUIRES_NEW`ï¼‰å’Œéš”ç¦»çº§åˆ«ï¼ˆå¦‚ `READ_COMMITTED`ã€`SERIALIZABLE`ï¼‰ï¼Œå¹¶å…è®¸è‡ªå®šä¹‰äº‹åŠ¡å›æ»šè§„åˆ™ï¼ˆé»˜è®¤å›æ»š `RuntimeException` å’Œ `Error`ï¼‰ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾— Spring Boot çš„äº‹åŠ¡ç®¡ç†æ—¢çµæ´»åˆé«˜æ•ˆã€‚



### ğŸ¯ äº‹åŠ¡å¤±æ•ˆçš„å¸¸è§åŸå› æœ‰å“ªäº›ï¼Ÿ

- **æ–¹æ³•é public**ï¼šSpring äº‹åŠ¡åŸºäºä»£ç†ï¼Œé public æ–¹æ³•æ— æ³•ä»£ç†ï¼›
- **è‡ªè°ƒç”¨é—®é¢˜**ï¼š`this.xxx()`è°ƒç”¨æœ¬ç±»æ–¹æ³•ï¼Œç»•è¿‡ä»£ç†å¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼›
- **å¼‚å¸¸æœªè¢«æ•è·**ï¼šæœªå£°æ˜`rollbackFor`çš„å¼‚å¸¸ä¸ä¼šå›æ»šï¼›
- **ä¼ æ’­è¡Œä¸ºè®¾ç½®é”™è¯¯**ï¼šå¦‚å­æ–¹æ³•è®¾ç½®`NOT_SUPPORTED`è„±ç¦»ä¸»äº‹åŠ¡ã€‚



### ğŸ¯ äº‹åŠ¡ç®¡ç†å™¨

Spring å¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨ï¼Œä»–ä»¬å°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™ Hibernate æˆ–è€… JTA ç­‰æŒä¹…åŒ–æœºåˆ¶æ‰€æä¾›çš„ç›¸å…³å¹³å°æ¡†æ¶çš„äº‹åŠ¡æ¥å®ç°ã€‚

Spring äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ˜¯ `org.springframework.transaction.PlatformTransactionManager`ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpring ä¸ºå„ä¸ªå¹³å°å¦‚ JDBCã€Hibernate ç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚

#### Spring ä¸­çš„äº‹åŠ¡ç®¡ç†å™¨çš„ä¸åŒå®ç°

**äº‹åŠ¡ç®¡ç†å™¨ä»¥æ™®é€šçš„ Bean å½¢å¼å£°æ˜åœ¨ Spring IOC å®¹å™¨ä¸­**

- åœ¨åº”ç”¨ç¨‹åºä¸­åªéœ€è¦å¤„ç†ä¸€ä¸ªæ•°æ®æº, è€Œä¸”é€šè¿‡ JDBC å­˜å–

  ```java
  org.springframework.jdbc.datasource.DataSourceTransactionManager
  ```

- åœ¨ JavaEE åº”ç”¨æœåŠ¡å™¨ä¸Šç”¨ JTA(Java Transaction API) è¿›è¡Œäº‹åŠ¡ç®¡ç†

  ```
  org.springframework.transaction.jta.JtaTransactionManager
  ```

- ç”¨ Hibernate æ¡†æ¶å­˜å–æ•°æ®åº“

  ```
  org.springframework.orm.hibernate3.HibernateTransactionManager
  ```

**äº‹åŠ¡ç®¡ç†å™¨ä»¥æ™®é€šçš„ Bean å½¢å¼å£°æ˜åœ¨ Spring IOC å®¹å™¨ä¸­**



### ğŸ¯ ç”¨äº‹åŠ¡é€šçŸ¥å£°æ˜å¼åœ°ç®¡ç†äº‹åŠ¡

- äº‹åŠ¡ç®¡ç†æ˜¯ä¸€ç§æ¨ªåˆ‡å…³æ³¨ç‚¹
- ä¸ºäº†åœ¨ Spring 2.x ä¸­å¯ç”¨å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œå¯ä»¥é€šè¿‡ tx Schema ä¸­å®šä¹‰çš„ \<tx:advice> å…ƒç´ å£°æ˜äº‹åŠ¡é€šçŸ¥ï¼Œä¸ºæ­¤å¿…é¡»äº‹å…ˆå°†è¿™ä¸ª Schema å®šä¹‰æ·»åŠ åˆ° \<beans> æ ¹å…ƒç´ ä¸­å»
- å£°æ˜äº†äº‹åŠ¡é€šçŸ¥åï¼Œå°±éœ€è¦å°†å®ƒä¸åˆ‡å…¥ç‚¹å…³è”èµ·æ¥ã€‚ç”±äºäº‹åŠ¡é€šçŸ¥æ˜¯åœ¨ \<aop:config> å…ƒç´ å¤–éƒ¨å£°æ˜çš„, æ‰€ä»¥å®ƒæ— æ³•ç›´æ¥ä¸åˆ‡å…¥ç‚¹äº§ç”Ÿå…³è”ï¼Œæ‰€ä»¥å¿…é¡»åœ¨ \<aop:config> å…ƒç´ ä¸­å£°æ˜ä¸€ä¸ªå¢å¼ºå™¨é€šçŸ¥ä¸åˆ‡å…¥ç‚¹å…³è”èµ·æ¥.
- ç”±äº Spring AOP æ˜¯åŸºäºä»£ç†çš„æ–¹æ³•ï¼Œæ‰€ä»¥åªèƒ½å¢å¼ºå…¬å…±æ–¹æ³•ã€‚å› æ­¤, åªæœ‰å…¬æœ‰æ–¹æ³•æ‰èƒ½é€šè¿‡ Spring AOP è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚



### ğŸ¯ ç”¨ @Transactional æ³¨è§£å£°æ˜å¼åœ°ç®¡ç†äº‹åŠ¡

- é™¤äº†åœ¨å¸¦æœ‰åˆ‡å…¥ç‚¹ï¼Œé€šçŸ¥å’Œå¢å¼ºå™¨çš„ Bean é…ç½®æ–‡ä»¶ä¸­å£°æ˜äº‹åŠ¡å¤–ï¼ŒSpring è¿˜å…è®¸ç®€å•åœ°ç”¨ @Transactional æ³¨è§£æ¥æ ‡æ³¨äº‹åŠ¡æ–¹æ³•
- ä¸ºäº†å°†æ–¹æ³•å®šä¹‰ä¸ºæ”¯æŒäº‹åŠ¡å¤„ç†çš„ï¼Œå¯ä»¥ä¸ºæ–¹æ³•æ·»åŠ  @Transactional æ³¨è§£ï¼Œæ ¹æ® Spring AOP åŸºäºä»£ç†æœºåˆ¶ï¼Œ**åªèƒ½æ ‡æ³¨å…¬æœ‰æ–¹æ³•.**
- å¯ä»¥åœ¨æ–¹æ³•æˆ–è€…ç±»çº§åˆ«ä¸Šæ·»åŠ  @Transactional æ³¨è§£ã€‚å½“æŠŠè¿™ä¸ªæ³¨è§£åº”ç”¨åˆ°ç±»ä¸Šæ—¶ï¼Œ è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ä¼šè¢«å®šä¹‰æˆæ”¯æŒäº‹åŠ¡å¤„ç†çš„
- åœ¨ Bean é…ç½®æ–‡ä»¶ä¸­åªéœ€è¦å¯ç”¨ `<tx:annotation-driven>`å…ƒç´ , å¹¶ä¸ºä¹‹æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨å°±å¯ä»¥äº†
- å¦‚æœäº‹åŠ¡å¤„ç†å™¨çš„åç§°æ˜¯ transactionManager, å°±å¯ä»¥åœ¨ `<tx:annotation-driven>` å…ƒç´ ä¸­çœç•¥ `transaction-manager` å±æ€§ï¼Œè¿™ä¸ªå…ƒç´ ä¼šè‡ªåŠ¨æ£€æµ‹è¯¥åç§°çš„äº‹åŠ¡å¤„ç†å™¨



### ğŸ¯ @Transactional ä¸ºä»€ä¹ˆä¸èƒ½ç”¨åœ¨ç§æœ‰æ–¹æ³•ä¸Šï¼Ÿ

`@Transactional` æ³¨è§£æ˜¯ Spring æä¾›çš„ä¸€ç§å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œå®ƒç”¨äºæŒ‡å®šæŸä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶éœ€è¦è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚é€šå¸¸ï¼Œè¿™ä¸ªæ³¨è§£è¢«ç”¨åœ¨å…¬æœ‰ï¼ˆpublicï¼‰æ–¹æ³•ä¸Šï¼ŒåŸå› åŒ…æ‹¬ï¼š

1. **ä»£ç†æœºåˆ¶**ï¼šSpring çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯åŸºäº AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å®ç°çš„ã€‚å½“ä½¿ç”¨ `@Transactional` æ³¨è§£æ—¶ï¼ŒSpring ä¼šä¸ºè¢«æ³¨è§£çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å¯¹äºéå…¬æœ‰æ–¹æ³•ï¼ŒSpring æ— æ³•åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä»£ç†ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•ä¸èƒ½è¢«ä»£ç†å¯¹è±¡æ‰€è°ƒç”¨ã€‚
2. **äº‹åŠ¡ä¼ æ’­**ï¼šäº‹åŠ¡çš„ä¼ æ’­ä¾èµ–äºæ–¹æ³•è°ƒç”¨é“¾ã€‚`@Transactional` æ³¨è§£é€šå¸¸ç”¨äºæœåŠ¡å±‚æˆ–å¯¹å¤–çš„ API æ–¹æ³•ä¸Šï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä¸šåŠ¡é€»è¾‘çš„å¼€å§‹å¤„å°±å¼€å¯äº‹åŠ¡ï¼Œå¹¶åœ¨ä¸šåŠ¡é€»è¾‘ç»“æŸæ—¶æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚å¦‚æœå°† `@Transactional` æ³¨è§£ç”¨åœ¨ç§æœ‰æ–¹æ³•ä¸Šï¼Œé‚£ä¹ˆäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼ˆå¦‚ä¼ æ’­çº§åˆ«ã€äº‹åŠ¡çš„ä¿å­˜ç‚¹ç­‰ï¼‰å¯èƒ½ä¸ä¼šæŒ‰é¢„æœŸå·¥ä½œã€‚
3. **ä»£ç è®¾è®¡**ï¼šä»è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œå°† `@Transactional` æ³¨è§£ç”¨åœ¨å…¬æœ‰æ–¹æ³•ä¸Šæ›´ç¬¦åˆä¸šåŠ¡é€»è¾‘çš„å°è£…å’Œåˆ†å±‚ã€‚ç§æœ‰æ–¹æ³•é€šå¸¸è¢«è®¾è®¡ä¸ºè¾…åŠ©æ–¹æ³•ï¼Œä¸åº”è¯¥ç‹¬ç«‹æ‰¿æ‹…äº‹åŠ¡ç®¡ç†çš„è´£ä»»ã€‚
4. **äº‹åŠ¡çš„å¯è§æ€§**ï¼šå°† `@Transactional` æ³¨è§£ç”¨åœ¨å…¬æœ‰æ–¹æ³•ä¸Šå¯ä»¥æ¸…æ™°åœ°è¡¨æ˜äº‹åŠ¡çš„è¾¹ç•Œï¼Œè¿™å¯¹äºç†è§£å’Œç»´æŠ¤ä»£ç éƒ½æ˜¯æœ‰ç›Šçš„ã€‚å¦‚æœç”¨åœ¨ç§æœ‰æ–¹æ³•ä¸Šï¼Œå¯èƒ½ä¼šéšè—äº‹åŠ¡çš„è¾¹ç•Œï¼Œä½¿å¾—å…¶ä»–å¼€å‘è€…éš¾ä»¥ç†è§£äº‹åŠ¡çš„èŒƒå›´ã€‚
5. **äº‹åŠ¡çš„ç²’åº¦**ï¼šäº‹åŠ¡åº”è¯¥åœ¨ä¸šåŠ¡é€»è¾‘çš„é€‚å½“ç²’åº¦ä¸Šè¿›è¡Œç®¡ç†ã€‚é€šå¸¸ï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œä¼šè·¨è¶Šå¤šä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå°† `@Transactional` æ³¨è§£ç”¨åœ¨ç§æœ‰æ–¹æ³•ä¸Šå¯èƒ½ä¼šå¯¼è‡´è¿‡ç»†çš„äº‹åŠ¡ç²’åº¦ï¼Œè¿™ä¸åˆ©äºäº‹åŠ¡ç®¡ç†ã€‚
6. **Spring ç‰ˆæœ¬é™åˆ¶**ï¼šåœ¨ Spring 5 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ`@Transactional` æ³¨è§£ç¡®å®ä¸èƒ½ç”¨äºéå…¬æœ‰æ–¹æ³•ã€‚ä» Spring 5 å¼€å§‹ï¼Œå¼•å…¥äº†å¯¹éå…¬æœ‰æ–¹æ³•çš„æ”¯æŒï¼Œä½†æ˜¯ä»ç„¶æ¨èå°† `@Transactional` æ³¨è§£ç”¨åœ¨å…¬æœ‰æ–¹æ³•ä¸Šã€‚



### ğŸ¯ äº‹åŠ¡ä¼ æ’­å±æ€§

- å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œ å¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œ
- äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå¯ä»¥ç”±ä¼ æ’­å±æ€§æŒ‡å®šï¼ŒSpring å®šä¹‰äº† 7  ç§ç±»ä¼ æ’­è¡Œä¸ºï¼š

| ä¼ æ’­è¡Œä¸º                  | æ„ä¹‰                                                         |
| ------------------------- | ------------------------------------------------------------ |
| PROPAGATION_MANDATORY     | è¡¨ç¤ºè¯¥æ–¹æ³•å¿…é¡»è¿è¡Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡æ­£åœ¨å‘ç”Ÿï¼Œå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ |
| PROPAGATION_NESTED        | è¡¨ç¤ºå¦‚æœå½“å‰æ­£æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿›è¡Œä¸­ï¼Œåˆ™è¯¥æ–¹æ³•åº”å½“è¿è¡Œåœ¨ä¸€ä¸ªåµŒå¥—å¼äº‹åŠ¡ä¸­ã€‚è¢«åµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹äºå°è£…äº‹åŠ¡è¿›è¡Œæäº¤æˆ–å›æ»šã€‚å¦‚æœå°è£…äº‹åŠ¡ä¸å­˜åœ¨ï¼Œè¡Œä¸ºå°±åƒPROPAGATION_REQUIRESä¸€æ ·ã€‚ |
| PROPAGATION_NEVER         | è¡¨ç¤ºå½“å‰çš„æ–¹æ³•ä¸åº”è¯¥åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è¿›è¡Œï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ |
| PROPAGATION_NOT_SUPPORTED | è¡¨ç¤ºè¯¥æ–¹æ³•ä¸åº”è¯¥åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç°æœ‰äº‹åŠ¡æ­£åœ¨è¿›è¡Œä¸­ï¼Œå®ƒå°†åœ¨è¯¥æ–¹æ³•çš„è¿è¡ŒæœŸé—´è¢«æŒ‚èµ·ã€‚ |
| PROPAGATION_SUPPORTS      | è¡¨ç¤ºå½“å‰æ–¹æ³•ä¸éœ€è¦äº‹åŠ¡æ€§ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡å·²ç»åœ¨è¿è¡Œçš„è¯ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªäº‹åŠ¡é‡Œè¿è¡Œã€‚ |
| PROPAGATION_REQUIRES_NEW  | è¡¨ç¤ºå½“å‰æ–¹æ³•å¿…é¡»åœ¨å®ƒè‡ªå·±çš„äº‹åŠ¡é‡Œè¿è¡Œã€‚ä¸€ä¸ªæ–°çš„äº‹åŠ¡å°†è¢«å¯åŠ¨ï¼Œè€Œä¸”å¦‚æœæœ‰ä¸€ä¸ªç°æœ‰äº‹åŠ¡åœ¨è¿è¡Œçš„è¯ï¼Œåˆ™å°†åœ¨è¿™ä¸ªæ–¹æ³•è¿è¡ŒæœŸé—´è¢«æŒ‚èµ·ã€‚ |
| PROPAGATION_REQUIRES      | è¡¨ç¤ºå½“å‰æ–¹æ³•å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚å¦‚æœä¸€ä¸ªç°æœ‰äº‹åŠ¡æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯¥æ–¹æ³•å°†åœ¨é‚£ä¸ªäº‹åŠ¡ä¸­è¿è¡Œï¼Œå¦åˆ™å°±è¦å¼€å§‹ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚ |



### ğŸ¯ Spring æ”¯æŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«

| éš”ç¦»çº§åˆ«                   | å«ä¹‰                                                         |
| -------------------------- | ------------------------------------------------------------ |
| ISOLATION_DEFAULT          | ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚                               |
| ISOLATION_READ_UNCOMMITTED | å…è®¸è¯»å–å°šæœªæäº¤çš„æ›´æ”¹ã€‚å¯èƒ½å¯¼è‡´è„è¯»ã€å¹»å½±è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚   |
| ISOLATION_READ_COMMITTED   | å…è®¸ä»å·²ç»æäº¤çš„å¹¶å‘äº‹åŠ¡è¯»å–ã€‚å¯é˜²æ­¢è„è¯»ï¼Œä½†å¹»å½±è¯»å’Œä¸å¯é‡å¤è¯»ä»å¯èƒ½ä¼šå‘ç”Ÿã€‚ |
| ISOLATION_REPEATABLE_READ  | å¯¹ç›¸åŒå­—æ®µçš„å¤šæ¬¡è¯»å–çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®è¢«å½“å‰äº‹åŠ¡æœ¬èº«æ”¹å˜ã€‚å¯é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»å½±è¯»ä»å¯èƒ½å‘ç”Ÿã€‚ |
| ISOLATION_SERIALIZABLE     | å®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ï¼Œç¡®ä¿ä¸å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»å½±è¯»ã€‚è¿™åœ¨æ‰€æœ‰éš”ç¦»çº§åˆ«ä¸­ä¹Ÿæ˜¯æœ€æ…¢çš„ï¼Œå› ä¸ºå®ƒé€šå¸¸æ˜¯é€šè¿‡å®Œå…¨é”å®šå½“å‰äº‹åŠ¡æ‰€æ¶‰åŠçš„æ•°æ®è¡¨æ¥å®Œæˆçš„ã€‚ |

äº‹åŠ¡çš„éš”ç¦»çº§åˆ«è¦å¾—åˆ°åº•å±‚æ•°æ®åº“å¼•æ“çš„æ”¯æŒï¼Œè€Œä¸æ˜¯åº”ç”¨ç¨‹åºæˆ–è€…æ¡†æ¶çš„æ”¯æŒï¼›

Oracle æ”¯æŒçš„ 2 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒMysqlæ”¯æŒ 4 ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚



### ğŸ¯ è®¾ç½®éš”ç¦»äº‹åŠ¡å±æ€§

ç”¨ @Transactional æ³¨è§£å£°æ˜å¼åœ°ç®¡ç†äº‹åŠ¡æ—¶å¯ä»¥åœ¨ @Transactional çš„ isolation å±æ€§ä¸­è®¾ç½®éš”ç¦»çº§åˆ«

åœ¨ Spring äº‹åŠ¡é€šçŸ¥ä¸­, å¯ä»¥åœ¨ `<tx:method>` å…ƒç´ ä¸­æŒ‡å®šéš”ç¦»çº§åˆ«

### ğŸ¯ è®¾ç½®å›æ»šäº‹åŠ¡å±æ€§

- é»˜è®¤æƒ…å†µä¸‹åªæœ‰æœªæ£€æŸ¥å¼‚å¸¸(RuntimeExceptionå’ŒErrorç±»å‹çš„å¼‚å¸¸)ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œè€Œå—æ£€æŸ¥å¼‚å¸¸ä¸ä¼šã€‚
- äº‹åŠ¡çš„å›æ»šè§„åˆ™å¯ä»¥é€šè¿‡ @Transactional æ³¨è§£çš„ rollbackForå’Œ noRollbackForå±æ€§æ¥å®šä¹‰ï¼Œè¿™ä¸¤ä¸ªå±æ€§è¢«å£°æ˜ä¸º Class[] ç±»å‹çš„ï¼Œå› æ­¤å¯ä»¥ä¸ºè¿™ä¸¤ä¸ªå±æ€§æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»ã€‚

  - rollbackForï¼šé‡åˆ°æ—¶å¿…é¡»è¿›è¡Œå›æ»š
  - noRollbackForï¼š ä¸€ç»„å¼‚å¸¸ç±»ï¼Œé‡åˆ°æ—¶å¿…é¡»ä¸å›æ»š

###  ğŸ¯ è¶…æ—¶å’Œåªè¯»å±æ€§

- ç”±äºäº‹åŠ¡å¯ä»¥åœ¨è¡Œå’Œè¡¨ä¸Šè·å¾—é”ï¼Œ å› æ­¤é•¿äº‹åŠ¡ä¼šå ç”¨èµ„æºï¼Œå¹¶å¯¹æ•´ä½“æ€§èƒ½äº§ç”Ÿå½±å“
- å¦‚æœä¸€ä¸ªäº‹ç‰©åªè¯»å–æ•°æ®ä½†ä¸åšä¿®æ”¹ï¼Œæ•°æ®åº“å¼•æ“å¯ä»¥å¯¹è¿™ä¸ªäº‹åŠ¡è¿›è¡Œä¼˜åŒ–
- è¶…æ—¶äº‹åŠ¡å±æ€§ï¼šäº‹åŠ¡åœ¨å¼ºåˆ¶å›æ»šä¹‹å‰å¯ä»¥ä¿æŒå¤šä¹…ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢é•¿æœŸè¿è¡Œçš„äº‹åŠ¡å ç”¨èµ„æº
- åªè¯»äº‹åŠ¡å±æ€§ï¼šè¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡åªè¯»å–æ•°æ®ä½†ä¸æ›´æ–°æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©æ•°æ®åº“å¼•æ“ä¼˜åŒ–äº‹åŠ¡

**è®¾ç½®è¶…æ—¶å’Œåªè¯»äº‹åŠ¡å±æ€§**

- è¶…æ—¶å’Œåªè¯»å±æ€§å¯ä»¥åœ¨ @Transactional æ³¨è§£ä¸­å®šä¹‰ï¼Œè¶…æ—¶å±æ€§ä»¥ç§’ä¸ºå•ä½æ¥è®¡ç®—

åˆ—å‡ºä¸¤ç§æ–¹å¼çš„ç¤ºä¾‹ï¼š

```java
@Transactional(propagation = Propagation.NESTED, timeout = 1000, isolation = Isolation.READ_COMMITTED, rollbackFor = Exception.class)
```

```xml
	<tx:advice id="txAdvice" transaction-manager="txManager">
		<!-- the transactional semantics... -->
		<tx:attributes>
			<!-- all methods starting with 'get' are read-only -->
			<tx:method name="get*" read-only="true" propagation="REQUIRES_NEW" isolation="READ_COMMITTED" timeout="30" no-rollback-for="java.lang.ArithmeticException"/>
			<!-- other methods use the default transaction settings (see below) -->
			<tx:method name="*"/>
		</tx:attributes>
	</tx:advice>

    <!-- ensure that the above transactional advice runs for any execution
        of an operation defined by the FooService interface -->
    <aop:config>
        <aop:pointcut id="fooServiceOperation" expression="execution(* x.y.service.FooService.*(..))"/>
        <aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceOperation"/>
    </aop:config>
```

---

## ğŸ”’ å…­ã€Spring Securityå®‰å…¨æ¡†æ¶

**æ ¸å¿ƒç†å¿µ**ï¼šSpring Securityæä¾›å…¨é¢çš„å®‰å…¨è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è®¤è¯ã€æˆæƒã€æ”»å‡»é˜²æŠ¤ç­‰ä¼ä¸šçº§å®‰å…¨åŠŸèƒ½ã€‚

### ğŸ¯ Spring Securityçš„æ ¸å¿ƒæ¦‚å¿µï¼Ÿ



"Spring Securityæ˜¯åŸºäºè¿‡æ»¤å™¨é“¾çš„å®‰å…¨æ¡†æ¶ï¼š

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

**Authenticationï¼ˆè®¤è¯ï¼‰**ï¼š
- éªŒè¯ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹
- åŒ…å«ç”¨æˆ·å‡­è¯å’Œæƒé™ä¿¡æ¯
- å­˜å‚¨åœ¨SecurityContextä¸­

**Authorizationï¼ˆæˆæƒï¼‰**ï¼š
- æ§åˆ¶ç”¨æˆ·å¯¹èµ„æºçš„è®¿é—®æƒé™
- åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶
- æ”¯æŒæ–¹æ³•çº§å’ŒURLçº§æˆæƒ

**SecurityContext**ï¼š
- å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨å½“å‰ç”¨æˆ·çš„å®‰å…¨ä¿¡æ¯
- é€šè¿‡ThreadLocalå®ç°çº¿ç¨‹éš”ç¦»
- SecurityContextHolderæä¾›è®¿é—®æ¥å£

**æ ¸å¿ƒç»„ä»¶**ï¼š

**AuthenticationManager**ï¼š
- è®¤è¯ç®¡ç†å™¨ï¼Œå¤„ç†è®¤è¯è¯·æ±‚
- é€šå¸¸ä½¿ç”¨ProviderManagerå®ç°

**UserDetailsService**ï¼š
- ç”¨æˆ·è¯¦æƒ…æœåŠ¡ï¼ŒåŠ è½½ç”¨æˆ·ä¿¡æ¯
- è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®æºçš„å…³é”®æ¥å£

**PasswordEncoder**ï¼š
- å¯†ç ç¼–ç å™¨ï¼Œå¤„ç†å¯†ç åŠ å¯†
- æ¨èä½¿ç”¨BCryptPasswordEncoder

**è¿‡æ»¤å™¨é“¾**ï¼š
- SecurityFilterChainå¤„ç†HTTPè¯·æ±‚
- åŒ…å«è®¤è¯ã€æˆæƒã€CSRFé˜²æŠ¤ç­‰è¿‡æ»¤å™¨"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()
                .requestMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .defaultSuccessUrl("/dashboard")
            )
            .logout(logout -> logout
                .logoutSuccessUrl("/login?logout")
            );
        return http.build();
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    @Bean
    public UserDetailsService userDetailsService(PasswordEncoder encoder) {
        UserDetails admin = User.builder()
            .username("admin")
            .password(encoder.encode("admin123"))
            .roles("ADMIN")
            .build();
        return new InMemoryUserDetailsManager(admin);
    }
}
```

### ğŸ¯ Spring Securityå¦‚ä½•å®ç°JWTè®¤è¯ï¼Ÿ



"JWTè®¤è¯æ˜¯æ— çŠ¶æ€çš„è®¤è¯æ–¹å¼ï¼ŒSpring Securityå¯ä»¥å¾ˆå¥½åœ°é›†æˆï¼š

**JWTè®¤è¯æµç¨‹**ï¼š
1. ç”¨æˆ·ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·åå¯†ç 
2. ç”ŸæˆJWT Tokenè¿”å›ç»™å®¢æˆ·ç«¯
3. å®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Token
4. æœåŠ¡å™¨éªŒè¯Tokenå¹¶æå–ç”¨æˆ·ä¿¡æ¯
5. åŸºäºç”¨æˆ·ä¿¡æ¯è¿›è¡Œæˆæƒå†³ç­–

**å®ç°è¦ç‚¹**ï¼š

**JWTå·¥å…·ç±»**ï¼š
- ç”ŸæˆTokenï¼šåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œè¿‡æœŸæ—¶é—´
- éªŒè¯Tokenï¼šæ£€æŸ¥ç­¾åå’Œè¿‡æœŸçŠ¶æ€
- è§£æTokenï¼šæå–ç”¨æˆ·èº«ä»½ä¿¡æ¯

**JWTè¿‡æ»¤å™¨**ï¼š
- ç»§æ‰¿OncePerRequestFilter
- ä»è¯·æ±‚å¤´æå–Token
- éªŒè¯Tokenå¹¶è®¾ç½®SecurityContext

**è®¤è¯ç«¯ç‚¹**ï¼š
- å¤„ç†ç™»å½•è¯·æ±‚
- éªŒè¯ç”¨æˆ·å‡­è¯
- ç”Ÿæˆå¹¶è¿”å›JWT Token

**ä¼˜åŠ¿**ï¼šæ— çŠ¶æ€ã€è·¨åŸŸå‹å¥½ã€æ˜“äºæ‰©å±•
**æ³¨æ„**ï¼šTokenå®‰å…¨å­˜å‚¨ã€åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@RestController
public class AuthController {
    
    @Autowired
    private AuthenticationManager authManager;
    @Autowired
    private JwtUtil jwtUtil;
    
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest request) {
        Authentication auth = authManager.authenticate(
            new UsernamePasswordAuthenticationToken(
                request.getUsername(), request.getPassword())
        );
        
        UserDetails user = (UserDetails) auth.getPrincipal();
        String token = jwtUtil.generateToken(user.getUsername());
        
        return ResponseEntity.ok(new JwtResponse(token));
    }
}

@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                   HttpServletResponse response, 
                                   FilterChain chain) throws ServletException, IOException {
        String token = extractToken(request);
        
        if (token != null && jwtUtil.validateToken(token)) {
            String username = jwtUtil.getUsernameFromToken(token);
            UserDetails user = userDetailsService.loadUserByUsername(username);
            
            Authentication auth = new UsernamePasswordAuthenticationToken(
                user, null, user.getAuthorities());
            SecurityContextHolder.getContext().setAuthentication(auth);
        }
        
        chain.doFilter(request, response);
    }
}
```

### ğŸ¯ Spring Securityæ–¹æ³•çº§å®‰å…¨æ€ä¹ˆä½¿ç”¨ï¼Ÿ

"Spring Securityæä¾›äº†æ–¹æ³•çº§çš„å®‰å…¨æ§åˆ¶ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸Šç›´æ¥é…ç½®æƒé™ï¼š

**å¯ç”¨æ–¹æ³•å®‰å…¨**ï¼š
- @EnableGlobalMethodSecurityæ³¨è§£
- @EnableMethodSecurityï¼ˆSpring Security 6+ï¼‰
- æ”¯æŒå¤šç§æ³¨è§£æ–¹å¼

**å®‰å…¨æ³¨è§£ç±»å‹**ï¼š

**@PreAuthorize**ï¼š
- æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™æ£€æŸ¥
- æ”¯æŒSpELè¡¨è¾¾å¼
- æœ€å¸¸ç”¨çš„æ–¹æ³•çº§å®‰å…¨æ³¨è§£

**@PostAuthorize**ï¼š
- æ–¹æ³•æ‰§è¡Œåè¿›è¡Œæƒé™æ£€æŸ¥
- å¯ä»¥åŸºäºè¿”å›å€¼è¿›è¡Œæƒé™æ§åˆ¶

**@Secured**ï¼š
- ç®€å•çš„è§’è‰²æ£€æŸ¥
- åªæ”¯æŒè§’è‰²åç§°ï¼Œä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼

**@RolesAllowed**ï¼š
- JSR-250æ ‡å‡†æ³¨è§£
- åŠŸèƒ½ç±»ä¼¼@Secured

**SpELè¡¨è¾¾å¼**ï¼š
- hasRole('ROLE_USER')ï¼šæ£€æŸ¥è§’è‰²
- hasAuthority('READ_USER')ï¼šæ£€æŸ¥æƒé™
- authentication.name == #usernameï¼šå¤æ‚æƒé™é€»è¾‘"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Configuration
@EnableMethodSecurity(prePostEnabled = true)
public class MethodSecurityConfig {
}

@Service
public class UserService {
    
    // åªæœ‰ADMINè§’è‰²å¯ä»¥è®¿é—®
    @PreAuthorize("hasRole('ADMIN')")
    public void deleteUser(Long userId) {
        userRepository.deleteById(userId);
    }
    
    // ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ä¿¡æ¯
    @PreAuthorize("hasRole('ADMIN') or authentication.name == #username")
    public User getUserInfo(String username) {
        return userRepository.findByUsername(username);
    }
    
    // åŸºäºè¿”å›å€¼çš„æƒé™æ£€æŸ¥
    @PostAuthorize("hasRole('ADMIN') or returnObject.username == authentication.name")
    public User findUserById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
    
    // å¤šä¸ªæƒé™æ£€æŸ¥
    @PreAuthorize("hasAnyRole('ADMIN', 'MANAGER') and hasAuthority('USER_READ')")
    public List<User> getAllUsers() {
        return userRepository.findAll();
    }
}
```



### ğŸ¯ æ¯”è¾ƒä¸€ä¸‹ Spring Security å’Œ Shiro å„è‡ªçš„ä¼˜ç¼ºç‚¹ ?

ç”±äº Spring Boot å®˜æ–¹æä¾›äº†å¤§é‡çš„éå¸¸æ–¹ä¾¿çš„å¼€ç®±å³ç”¨çš„ Starter ï¼ŒåŒ…æ‹¬ Spring Security çš„ Starter ï¼Œä½¿å¾—åœ¨ Spring Boot ä¸­ä½¿ç”¨ Spring Security å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œç”šè‡³åªéœ€è¦æ·»åŠ ä¸€ä¸ªä¾èµ–å°±å¯ä»¥ä¿æŠ¤æ‰€æœ‰çš„æ¥å£ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ˜¯ Spring Boot é¡¹ç›®ï¼Œä¸€èˆ¬é€‰æ‹© Spring Security ã€‚å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªå»ºè®®çš„ç»„åˆï¼Œå•çº¯ä»æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œæ— è®ºæ€ä¹ˆç»„åˆï¼Œéƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚Shiro å’Œ Spring Security ç›¸æ¯”ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸€äº›ç‰¹ç‚¹ï¼š

1. Spring Security æ˜¯ä¸€ä¸ªé‡é‡çº§çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼›Shiro åˆ™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®‰å…¨ç®¡ç†æ¡†æ¶
2. Spring Security æ¦‚å¿µå¤æ‚ï¼Œé…ç½®ç¹çï¼›Shiro æ¦‚å¿µç®€å•ã€é…ç½®ç®€å•
3. Spring Security åŠŸèƒ½å¼ºå¤§ï¼›Shiro åŠŸèƒ½ç®€å•



---

## â˜ï¸ ä¸ƒã€Spring Cloudå¾®æœåŠ¡

**æ ¸å¿ƒç†å¿µ**ï¼šSpring Cloudä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘æä¾›å·¥å…·é›†ï¼Œç®€åŒ–å¾®æœåŠ¡æ¶æ„çš„å®ç°å’Œè¿ç»´ã€‚

### ğŸ¯ Spring Cloud æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿå„è‡ªä½œç”¨ï¼Ÿ

- **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šEureka/Nacosï¼ˆæœåŠ¡å®ä¾‹è‡ªåŠ¨æ³¨å†Œä¸å‘ç°ï¼‰ï¼›
- **æœåŠ¡è°ƒç”¨**ï¼šFeignï¼ˆåŸºäºæ¥å£çš„å£°æ˜å¼ REST è°ƒç”¨ï¼‰ï¼›
- **è´Ÿè½½å‡è¡¡**ï¼šRibbonï¼ˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼‰ï¼›
- **ç†”æ–­é™çº§**ï¼šHystrix/Sentinelï¼ˆé˜²æ­¢çº§è”æ•…éšœï¼‰ï¼›
- **ç½‘å…³**ï¼šGatewayï¼ˆç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±ã€é™æµã€è®¤è¯ï¼‰ã€‚

ğŸ’» ä»£ç ç¤ºä¾‹
```java
// æœåŠ¡æä¾›è€…
@RestController
@EnableEurekaClient
public class UserController {
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
}

// æœåŠ¡æ¶ˆè´¹è€… - Feignå®¢æˆ·ç«¯
@FeignClient(name = "user-service", fallback = UserServiceFallback.class)
public interface UserServiceClient {
    @GetMapping("/users/{id}")
    User getUser(@PathVariable Long id);
}

// æ–­è·¯å™¨é™çº§
@Component
public class UserServiceFallback implements UserServiceClient {
    @Override
    public User getUser(Long id) {
        return new User(id, "é»˜è®¤ç”¨æˆ·", "æœåŠ¡é™çº§");
    }
}

// Gatewayç½‘å…³é…ç½®
@Configuration
public class GatewayConfig {
    
    @Bean
    public RouteLocator customRoutes(RouteLocatorBuilder builder) {
        return builder.routes()
            .route("user-service", r -> r.path("/users/**")
                .uri("lb://user-service"))
            .route("order-service", r -> r.path("/orders/**")
                .uri("lb://order-service"))
            .build();
    }
}
```

### ğŸ¯ å¾®æœåŠ¡ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ



"å¾®æœåŠ¡é—´é€šä¿¡æœ‰å¤šç§æ–¹å¼ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ï¼š

**åŒæ­¥é€šä¿¡**ï¼š

**HTTP/REST**ï¼š
- æœ€å¸¸ç”¨çš„é€šä¿¡æ–¹å¼
- åŸºäºHTTPåè®®ï¼Œç®€å•æ˜“ç†è§£
- ä½¿ç”¨JSONæ ¼å¼ä¼ è¾“æ•°æ®
- å·¥å…·ï¼šRestTemplateã€OpenFeign

**RPCè°ƒç”¨**ï¼š
- è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ€§èƒ½è¾ƒå¥½
- æ”¯æŒå¤šç§åè®®ï¼šgRPCã€Dubbo
- å¼ºç±»å‹æ¥å£ï¼Œå¼€å‘æ•ˆç‡é«˜

**å¼‚æ­¥é€šä¿¡**ï¼š

**æ¶ˆæ¯é˜Ÿåˆ—**ï¼š
- åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶ï¼šRabbitMQã€Kafka
- è§£è€¦æœåŠ¡é—´ä¾èµ–å…³ç³»
- æ”¯æŒå‰Šå³°å¡«è°·ã€äº‹ä»¶é©±åŠ¨

**äº‹ä»¶é©±åŠ¨**ï¼š
- åŸºäºäº‹ä»¶çš„å¼‚æ­¥é€šä¿¡
- æœåŠ¡å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶
- å®ç°æœ€ç»ˆä¸€è‡´æ€§

**é€‰æ‹©åŸåˆ™**ï¼š
- å®æ—¶æ€§è¦æ±‚é«˜ï¼šåŒæ­¥é€šä¿¡
- è§£è€¦è¦æ±‚é«˜ï¼šå¼‚æ­¥é€šä¿¡
- æ€§èƒ½è¦æ±‚é«˜ï¼šRPCè°ƒç”¨
- ç®€å•åœºæ™¯ï¼šHTTP/REST"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// HTTPé€šä¿¡ - RestTemplate
@Service
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public User getUserInfo(Long userId) {
        String url = "http://user-service/users/" + userId;
        return restTemplate.getForObject(url, User.class);
    }
}

// HTTPé€šä¿¡ - OpenFeign
@FeignClient("user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUser(@PathVariable Long id);
}

// æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡
@Component
public class OrderEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishOrderCreated(Order order) {
        OrderCreatedEvent event = new OrderCreatedEvent(order);
        rabbitTemplate.convertAndSend("order.exchange", 
                                     "order.created", event);
    }
}

@RabbitListener(queues = "inventory.queue")
public void handleOrderCreated(OrderCreatedEvent event) {
    // å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶ï¼Œæ›´æ–°åº“å­˜
    inventoryService.updateInventory(event.getOrder());
}
```

### ğŸ¯ å¾®æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡æ€ä¹ˆå¤„ç†ï¼Ÿ

"åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œæœ‰å¤šç§è§£å†³æ–¹æ¡ˆï¼š

**ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰**ï¼š
- ä¼ ç»Ÿçš„å¼ºä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ
- åè°ƒè€…å’Œå‚ä¸è€…æ¨¡å¼
- å­˜åœ¨æ€§èƒ½å’Œå¯ç”¨æ€§é—®é¢˜ï¼Œä¸é€‚åˆå¾®æœåŠ¡

**TCCæ¨¡å¼**ï¼š
- Try-Confirm-Cancelä¸‰ä¸ªé˜¶æ®µ
- ä¸šåŠ¡å±‚é¢çš„è¡¥å¿æœºåˆ¶
- å®ç°å¤æ‚ä½†æ§åˆ¶ç²¾ç¡®

**Sagaæ¨¡å¼**ï¼š
- é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªçŸ­äº‹åŠ¡
- æ¯ä¸ªäº‹åŠ¡æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ
- é€‚åˆä¸šåŠ¡æµç¨‹å¤æ‚çš„åœºæ™¯

**æœ€ç»ˆä¸€è‡´æ€§**ï¼š
- åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥å¤„ç†
- é€šè¿‡é‡è¯•å’Œè¡¥å¿è¾¾åˆ°æœ€ç»ˆä¸€è‡´
- æ€§èƒ½å¥½ï¼Œä½†éœ€è¦å¤„ç†ä¸­é—´çŠ¶æ€

**åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶**ï¼š
- Seataï¼šé˜¿é‡Œå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ
- æ”¯æŒATã€TCCã€Sagaç­‰æ¨¡å¼
- å¯¹ä¸šåŠ¡ä»£ç ä¾µå…¥æ€§å°

**æœ€ä½³å®è·µ**ï¼š
- é¿å…åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šè¿‡è®¾è®¡è§„é¿
- ä¼˜å…ˆè€ƒè™‘æœ€ç»ˆä¸€è‡´æ€§
- é‡è¦ä¸šåŠ¡åœºæ™¯ä½¿ç”¨TCCæˆ–Saga"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// Sagaæ¨¡å¼ç¤ºä¾‹
@SagaOrchestrationStart
@Transactional
public class OrderSagaService {
    
    public void processOrder(Order order) {
        // 1. åˆ›å»ºè®¢å•
        orderService.createOrder(order);
        
        // 2. æ‰£å‡åº“å­˜
        inventoryService.decreaseStock(order.getItems());
        
        // 3. æ‰£å‡ç§¯åˆ†
        pointService.decreasePoints(order.getUserId(), order.getPoints());
        
        // 4. å‘é€é€šçŸ¥
        notificationService.sendOrderNotification(order);
    }
    
    // è¡¥å¿æ–¹æ³•
    @SagaOrchestrationCancel
    public void cancelOrder(Order order) {
        notificationService.cancelNotification(order);
        pointService.compensatePoints(order.getUserId(), order.getPoints());
        inventoryService.compensateStock(order.getItems());
        orderService.cancelOrder(order);
    }
}

// åŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§
@Service
public class OrderService {
    
    @Transactional
    public void createOrder(Order order) {
        // 1. ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        // 2. å‘é€äº‹ä»¶æ¶ˆæ¯
        OrderCreatedEvent event = new OrderCreatedEvent(order);
        messageProducer.send("order.created", event);
    }
}

@EventListener
public class InventoryEventHandler {
    
    @RabbitListener(queues = "inventory.order.queue")
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            inventoryService.decreaseStock(event.getOrder().getItems());
            // å‘é€åº“å­˜æ‰£å‡æˆåŠŸäº‹ä»¶
            messageProducer.send("inventory.decreased", 
                                new InventoryDecreasedEvent(event.getOrder()));
        } catch (Exception e) {
            // å‘é€åº“å­˜æ‰£å‡å¤±è´¥äº‹ä»¶
            messageProducer.send("inventory.decrease.failed", 
                                new InventoryDecreaseFailedEvent(event.getOrder()));
        }
    }
}
```

---

## ğŸ“ å…«ã€æ³¨è§£ä¸é…ç½®

**æ ¸å¿ƒç†å¿µ**ï¼šSpringæ³¨è§£ç®€åŒ–é…ç½®ï¼Œæä¾›å£°æ˜å¼ç¼–ç¨‹æ¨¡å‹ï¼Œå®ç°çº¦å®šå¤§äºé…ç½®çš„è®¾è®¡ç†å¿µã€‚

### ğŸ¯ Springå¸¸ç”¨æ³¨è§£æœ‰å“ªäº›ï¼Ÿ

"Springæä¾›äº†ä¸°å¯Œçš„æ³¨è§£ç®€åŒ–å¼€å‘é…ç½®ï¼š

**æ ¸å¿ƒæ³¨è§£**ï¼š

**@ComponentåŠå…¶æ´¾ç”Ÿ**ï¼š
- @Componentï¼šé€šç”¨ç»„ä»¶æ³¨è§£
- @Serviceï¼šæœåŠ¡å±‚ç»„ä»¶
- @Repositoryï¼šæ•°æ®è®¿é—®å±‚ç»„ä»¶
- @Controllerï¼šæ§åˆ¶å™¨ç»„ä»¶
- @RestControllerï¼šRESTæ§åˆ¶å™¨ï¼ˆ@Controller + @ResponseBodyï¼‰

**ä¾èµ–æ³¨å…¥æ³¨è§£**ï¼š
- @Autowiredï¼šè‡ªåŠ¨è£…é…ï¼ŒæŒ‰ç±»å‹æ³¨å…¥
- @Qualifierï¼šæŒ‡å®šå…·ä½“å®ç°ç±»
- @Resourceï¼šæŒ‰åç§°æ³¨å…¥ï¼ˆJSR-250ï¼‰
- @Valueï¼šæ³¨å…¥é…ç½®å€¼

**é…ç½®ç›¸å…³æ³¨è§£**ï¼š
- @Configurationï¼šé…ç½®ç±»
- @Beanï¼šå®šä¹‰Bean
- @Importï¼šå¯¼å…¥å…¶ä»–é…ç½®
- @ComponentScanï¼šç»„ä»¶æ‰«æ
- @Profileï¼šç¯å¢ƒé…ç½®

**Webç›¸å…³æ³¨è§£**ï¼š
- @RequestMappingï¼šè¯·æ±‚æ˜ å°„
- @GetMapping/@PostMappingï¼šHTTPæ–¹æ³•æ˜ å°„
- @RequestParamï¼šè¯·æ±‚å‚æ•°
- @PathVariableï¼šè·¯å¾„å˜é‡
- @RequestBody/@ResponseBodyï¼šè¯·æ±‚/å“åº”ä½“

**AOPæ³¨è§£**ï¼š
- @Aspectï¼šåˆ‡é¢
- @Pointcutï¼šåˆ‡ç‚¹
- @Before/@After/@Aroundï¼šé€šçŸ¥ç±»å‹

**äº‹åŠ¡æ³¨è§£**ï¼š
- @Transactionalï¼šå£°æ˜å¼äº‹åŠ¡
- @EnableTransactionManagementï¼šå¯ç”¨äº‹åŠ¡ç®¡ç†"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// ç»„ä»¶æ³¨è§£
@Service
@Transactional
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Value("${app.default.page-size:10}")
    private int defaultPageSize;
    
    public Page<User> findUsers(Pageable pageable) {
        return userRepository.findAll(pageable);
    }
}

// Webæ³¨è§£
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return ResponseEntity.ok(user);
    }
    
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody @Valid User user) {
        User saved = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(saved);
    }
}

// é…ç½®æ³¨è§£
@Configuration
@EnableWebMvc
@ComponentScan("com.example")
public class WebConfig implements WebMvcConfigurer {
    
    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        return new H2DataSource();
    }
    
    @Bean
    @Profile("prod")
    public DataSource prodDataSource() {
        return new MySQLDataSource();
    }
}
```

### ğŸ¯ @Autowiredå’Œ@Resourceçš„åŒºåˆ«ï¼Ÿ

"@Autowiredå’Œ@Resourceéƒ½ç”¨äºä¾èµ–æ³¨å…¥ï¼Œä½†æœ‰é‡è¦åŒºåˆ«ï¼š

**@Autowiredï¼ˆSpringæ³¨è§£ï¼‰**ï¼š
- æŒ‰ç±»å‹ï¼ˆbyTypeï¼‰è‡ªåŠ¨è£…é…
- å¯ä»¥é…åˆ@QualifieræŒ‰åç§°è£…é…
- å¯ä»¥æ ‡æ³¨åœ¨æ„é€ å™¨ã€å­—æ®µã€æ–¹æ³•ä¸Š
- requiredå±æ€§æ§åˆ¶æ˜¯å¦å¿…é¡»æ³¨å…¥
- Springæ¡†æ¶ä¸“æœ‰æ³¨è§£

**@Resourceï¼ˆJSR-250æ ‡å‡†ï¼‰**ï¼š
- æŒ‰åç§°ï¼ˆbyNameï¼‰è‡ªåŠ¨è£…é…
- nameå±æ€§æŒ‡å®šBeanåç§°
- typeå±æ€§æŒ‡å®šBeanç±»å‹
- åªèƒ½æ ‡æ³¨åœ¨å­—æ®µå’Œsetteræ–¹æ³•ä¸Š
- Javaæ ‡å‡†æ³¨è§£ï¼Œè·¨æ¡†æ¶

**è£…é…é¡ºåº**ï¼š
- @Resourceï¼šå…ˆæŒ‰åç§°ï¼Œå†æŒ‰ç±»å‹
- @Autowiredï¼šå…ˆæŒ‰ç±»å‹ï¼Œå†æŒ‰åç§°ï¼ˆé…åˆ@Qualifierï¼‰

**ä½¿ç”¨å»ºè®®**ï¼š
- æ¨èä½¿ç”¨@Autowired + æ„é€ å™¨æ³¨å…¥
- éœ€è¦æŒ‰åç§°æ³¨å…¥æ—¶ä½¿ç”¨@Qualifier
- è·¨æ¡†æ¶å…¼å®¹æ—¶è€ƒè™‘@Resource"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class UserService {
    
    // @AutowiredæŒ‰ç±»å‹æ³¨å…¥
    @Autowired
    private UserRepository userRepository;
    
    // @Autowired + @QualifieræŒ‰åç§°æ³¨å…¥
    @Autowired
    @Qualifier("cacheUserRepository")
    private UserRepository cacheRepository;
    
    // @ResourceæŒ‰åç§°æ³¨å…¥
    @Resource(name = "jdbcUserRepository")
    private UserRepository jdbcRepository;
    
    // æ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
    private final EmailService emailService;
    
    @Autowired
    public UserService(EmailService emailService) {
        this.emailService = emailService;
    }
    
    // å¯é€‰ä¾èµ–æ³¨å…¥
    @Autowired(required = false)
    private SmsService smsService;
    
    public void notifyUser(User user, String message) {
        emailService.send(user.getEmail(), message);
        if (smsService != null) {
            smsService.send(user.getPhone(), message);
        }
    }
}
```

### ğŸ¯ Springä¸­å¦‚ä½•è‡ªå®šä¹‰æ³¨è§£ï¼Ÿ

"Springæ”¯æŒè‡ªå®šä¹‰æ³¨è§£æ¥ç®€åŒ–é‡å¤é…ç½®ï¼š

**è‡ªå®šä¹‰æ³¨è§£æ­¥éª¤**ï¼š

**1. å®šä¹‰æ³¨è§£**ï¼š
- ä½¿ç”¨@interfaceå…³é”®å­—
- æ·»åŠ @TargetæŒ‡å®šä½œç”¨èŒƒå›´
- æ·»åŠ @RetentionæŒ‡å®šç”Ÿå‘½å‘¨æœŸ
- å®šä¹‰æ³¨è§£å±æ€§

**2. æ³¨è§£å¤„ç†**ï¼š
- AOPæ–¹å¼ï¼šé€šè¿‡åˆ‡é¢å¤„ç†
- BeanPostProcessorï¼šBeanåå¤„ç†å™¨
- åå°„æœºåˆ¶ï¼šè¿è¡Œæ—¶å¤„ç†

**3. ä¸Springé›†æˆ**ï¼š
- ç»“åˆSpring AOPå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹
- åˆ©ç”¨Springçš„ä¾èµ–æ³¨å…¥èƒ½åŠ›
- é…åˆäº‹ä»¶æœºåˆ¶å®ç°è§£è€¦

**å¸¸è§åº”ç”¨åœºæ™¯**ï¼š
- æ—¥å¿—è®°å½•ï¼š@Log
- ç¼“å­˜æ§åˆ¶ï¼š@Cache
- æƒé™æ£€æŸ¥ï¼š@RequireRole
- é‡è¯•æœºåˆ¶ï¼š@Retry
- é™æµæ§åˆ¶ï¼š@RateLimit

**æœ€ä½³å®è·µ**ï¼š
- æ³¨è§£è¯­ä¹‰æ¸…æ™°ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- æä¾›åˆç†çš„é»˜è®¤å€¼
- è€ƒè™‘æ³¨è§£çš„ç»„åˆä½¿ç”¨
- å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// è‡ªå®šä¹‰æ—¥å¿—æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Log {
    String value() default "";
    LogLevel level() default LogLevel.INFO;
    boolean logParams() default true;
    boolean logResult() default true;
}

// æ—¥å¿—å¤„ç†åˆ‡é¢
@Aspect
@Component
public class LogAspect {
    
    private static final Logger logger = LoggerFactory.getLogger(LogAspect.class);
    
    @Around("@annotation(log)")
    public Object doLog(ProceedingJoinPoint point, Log log) throws Throwable {
        String methodName = point.getSignature().getName();
        Object[] args = point.getArgs();
        
        // è®°å½•æ–¹æ³•è°ƒç”¨
        if (log.logParams()) {
            logger.info("è°ƒç”¨æ–¹æ³•: {}, å‚æ•°: {}", methodName, args);
        }
        
        long startTime = System.currentTimeMillis();
        Object result = point.proceed();
        long endTime = System.currentTimeMillis();
        
        // è®°å½•æ–¹æ³•ç»“æœ
        if (log.logResult()) {
            logger.info("æ–¹æ³•: {} æ‰§è¡Œå®Œæˆ, è€—æ—¶: {}ms, ç»“æœ: {}", 
                       methodName, endTime - startTime, result);
        }
        
        return result;
    }
}

// è‡ªå®šä¹‰ç¼“å­˜æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Cache {
    String key() default "";
    int expire() default 300; // 5åˆ†é’Ÿ
    TimeUnit timeUnit() default TimeUnit.SECONDS;
}

// ç¼“å­˜å¤„ç†å™¨
@Component
public class CacheAnnotationProcessor implements BeanPostProcessor {
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) {
        Class<?> clazz = bean.getClass();
        for (Method method : clazz.getDeclaredMethods()) {
            if (method.isAnnotationPresent(Cache.class)) {
                // åˆ›å»ºç¼“å­˜ä»£ç†
                return createCacheProxy(bean, method);
            }
        }
        return bean;
    }
    
    private Object createCacheProxy(Object bean, Method method) {
        return Proxy.newProxyInstance(
            bean.getClass().getClassLoader(),
            bean.getClass().getInterfaces(),
            new CacheInvocationHandler(bean, method)
        );
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
@Service
public class UserService {
    
    @Log("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯")
    @Cache(key = "user:#{args[0]}", expire = 600)
    public User findById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
    
    @Log(value = "åˆ›å»ºç”¨æˆ·", logResult = false)
    public User createUser(User user) {
        return userRepository.save(user);
    }
}
```



### ğŸ¯ Spring Boot æ³¨è§£ åŸç†?

**Spring Boot** æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ– Spring åº”ç”¨ç¨‹åºçš„é…ç½®å’Œéƒ¨ç½²ã€‚Spring Boot åˆ©ç”¨äº†å¤§é‡çš„è‡ªåŠ¨é…ç½®å’Œå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œå…¶ä¸­è®¸å¤šåŠŸèƒ½éƒ½é€šè¿‡æ³¨è§£æ¥å®ç°ã€‚ç†è§£ Spring Boot çš„æ³¨è§£åŸç†ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å…¶è‡ªåŠ¨åŒ–é…ç½®çš„è¿‡ç¨‹ï¼Œä»¥åŠå¦‚ä½•æ‰©å±•å’Œè‡ªå®šä¹‰ Spring Boot åº”ç”¨ã€‚

**å¸¸è§çš„ Spring Boot æ³¨è§£åŠå…¶åŸç†**

1. `@SpringBootApplicationï¼šå¤åˆæ³¨è§£ï¼Œé€šå¸¸ç”¨åœ¨ä¸»ç±»ä¸Šï¼Œå¯åŠ¨ Spring Boot åº”ç”¨ç¨‹åºã€‚å®ƒå®é™…ä¸ŠåŒ…å«äº†ä¸‰ä¸ªæ³¨è§£ï¼š

   - `@SpringBootConfiguration`ï¼šæ ‡è¯†å½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œç±»ä¼¼äº `@Configuration`ï¼Œè¡¨ç¤ºè¯¥ç±»æ˜¯ Spring é…ç½®ç±»ï¼Œä¼šè¢« Spring å®¹å™¨åŠ è½½ã€‚

   - `@EnableAutoConfiguration`ï¼šå¯ç”¨ Spring Boot çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œè®© Spring Boot æ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œé…ç½®è‡ªåŠ¨åšå‡ºé…ç½®é€‰æ‹©ã€‚

   - `@ComponentScan`ï¼šå¯ç”¨ç»„ä»¶æ‰«æï¼Œé»˜è®¤ä¼šæ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ Spring ç»„ä»¶ï¼ˆåŒ…æ‹¬ `@Component`ã€`@Service`ã€`@Repository`ã€`@Controller` ç­‰æ³¨è§£ï¼‰ã€‚

   **åŸç†**ï¼š`@SpringBootApplication` é€šè¿‡ç»„åˆè¿™äº›æ³¨è§£ï¼Œå®ç°äº†è‡ªåŠ¨é…ç½®ã€ç»„ä»¶æ‰«æå’Œ Spring é…ç½®çš„åŠŸèƒ½ï¼Œç®€åŒ–äº†å¼€å‘äººå‘˜çš„é…ç½®å·¥ä½œã€‚

2. `@EnableAutoConfigurationï¼šå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚å®ƒå‘Šè¯‰ Spring Boot è‡ªåŠ¨ä¸ºåº”ç”¨ç¨‹åºé…ç½®æ‰€éœ€è¦çš„ç»„ä»¶ï¼Œé¿å…äº†æ‰‹åŠ¨é…ç½®å¤§é‡çš„ Beanã€‚

   **åŸç†**ï¼š`@EnableAutoConfiguration` æ˜¯é€šè¿‡ **æ¡ä»¶åŒ–æ³¨è§£** (`@Conditional` ç³»åˆ—æ³¨è§£) æ¥å®ç°çš„ï¼ŒSpring Boot ä¼šæ ¹æ®é¡¹ç›®çš„ä¾èµ–ï¼ˆå¦‚ç±»è·¯å¾„ä¸­çš„ jar åŒ…ï¼‰æ¥åˆ¤æ–­æ˜¯å¦å¯ç”¨ç›¸åº”çš„è‡ªåŠ¨é…ç½®ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰ `spring-boot-starter-web` ä¾èµ–ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Tomcatã€DispatcherServlet ç­‰ Web ç›¸å…³ç»„ä»¶ã€‚

3. `@Configurationï¼šæ ‡è®°è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç±»ä¼¼äºä¼ ç»Ÿçš„ XML é…ç½®æ–‡ä»¶ï¼Œç”¨äºå£°æ˜å’Œå®šä¹‰ Spring Beanã€‚

   **åŸç†**ï¼šSpring åœ¨ç±»ä¸Šä½¿ç”¨ `@Configuration` æ—¶ï¼Œä¼šå°†è¯¥ç±»ä½œä¸ºä¸€ä¸ªé…ç½®ç±»å¤„ç†ã€‚é€šè¿‡è§£æè¯¥ç±»ä¸­çš„ `@Bean` æ³¨è§£æ¥ç”Ÿæˆ Spring Beanã€‚`@Configuration` å®é™…ä¸Šæ˜¯ `@Component` æ³¨è§£çš„æ‰©å±•ï¼Œæ„å‘³ç€é…ç½®ç±»ä¹Ÿä¼šè¢« Spring å®¹å™¨ç®¡ç†ã€‚

4. `@ComponentScan`ï¼šç”¨äºå‘Šè¯‰ Spring æ¡†æ¶å»æ‰«ææŒ‡å®šåŒ…ï¼ˆåŠå…¶å­åŒ…ï¼‰ä¸­çš„ç±»ï¼Œå¹¶å°†å…¶ä½œä¸º Spring Bean è¿›è¡Œæ³¨å†Œã€‚é€šå¸¸è¯¥æ³¨è§£ä¸ `@Configuration` ä¸€èµ·ä½¿ç”¨ã€‚

   **åŸç†**ï¼šSpring Boot å¯åŠ¨ç±»ä½¿ç”¨ `@ComponentScan` é»˜è®¤æ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…ï¼ŒæŸ¥æ‰¾ `@Component`ã€`@Service`ã€`@Repository` ç­‰æ³¨è§£æ ‡æ³¨çš„ç±»ï¼Œå°†å®ƒä»¬åŠ å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚å¦‚æœéœ€è¦æ›´æ”¹æ‰«æè·¯å¾„ï¼Œå¯ä»¥åœ¨æ³¨è§£ä¸­æŒ‡å®š `basePackages` å±æ€§ã€‚

5. `@Conditional` ï¼šæ˜¯ä¸€ç§æ ¹æ®æŸäº›æ¡ä»¶å†³å®šæ˜¯å¦åŠ è½½ Bean çš„æœºåˆ¶ã€‚åœ¨ Spring Boot ä¸­ï¼Œè‡ªåŠ¨é…ç½®å¤§é‡ä½¿ç”¨äº† `@Conditional` æ³¨è§£ï¼Œä»¥å®ç°åŸºäºç¯å¢ƒæˆ–é…ç½®çš„æ¡ä»¶åŠ è½½ã€‚

   **åŸç†**ï¼šSpring Boot ä½¿ç”¨ `@Conditional` æ³¨è§£å’Œå¤šä¸ªå…·ä½“çš„æ¡ä»¶ç±»ï¼ˆå¦‚ `@ConditionalOnProperty`ã€`@ConditionalOnClass`ã€`@ConditionalOnMissingBean` ç­‰ï¼‰æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºæŸäº› Beanã€‚ä¾‹å¦‚ï¼Œ`@ConditionalOnClass` ä¼šæ£€æŸ¥ç±»è·¯å¾„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ï¼Œä»è€Œå†³å®šæ˜¯å¦å¯ç”¨æŸä¸ªé…ç½®ã€‚

#### Spring Boot æ³¨è§£çš„å·¥ä½œåŸç†æ€»ç»“

1. **è‡ªåŠ¨é…ç½®ï¼ˆ`@EnableAutoConfiguration`ï¼‰**ï¼šé€šè¿‡æ¡ä»¶åŒ–æ³¨è§£ï¼ŒSpring Boot æ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œé…ç½®ï¼Œè‡ªåŠ¨é€‰æ‹©å¹¶åŠ è½½åˆé€‚çš„é…ç½®ç±»ã€‚æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»é€šå¸¸éƒ½æœ‰ä¸€ä¸ª `@Conditional` æ³¨è§£ï¼Œç¡®ä¿ä»…åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰ä¼šåŠ è½½ã€‚
2. **ç»„ä»¶æ‰«æï¼ˆ`@ComponentScan`ï¼‰**ï¼šSpring Boot é»˜è®¤æ‰«æä¸»åº”ç”¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ï¼Œè‡ªåŠ¨å°†ç¬¦åˆæ¡ä»¶çš„ç±»ï¼ˆå¦‚ `@Component` æ³¨è§£çš„ç±»ï¼‰æ³¨å†Œä¸º Spring Beanã€‚
3. **é…ç½®ç»‘å®šï¼ˆ`@Value` å’Œ `@ConfigurationProperties`ï¼‰**ï¼šSpring Boot æä¾›çš„æ³¨è§£å…è®¸å°†é…ç½®æ–‡ä»¶ä¸­çš„å€¼è‡ªåŠ¨æ³¨å…¥åˆ° Java ç±»ä¸­ï¼Œä½¿å¾—é…ç½®ç®¡ç†æ›´åŠ æ–¹ä¾¿ã€‚
4. **Web æ§åˆ¶ï¼ˆ`@RestController`ï¼‰**ï¼š`@RestController` æ³¨è§£ç»“åˆäº† `@Controller` å’Œ `@ResponseBody`ï¼Œä½¿å¾—å¼€å‘ RESTful API æ›´åŠ ç®€æ´ã€‚

> **Spring Boot æ³¨è§£** åœ¨ Spring Boot ä¸­å‘æŒ¥äº†é‡è¦ä½œç”¨ï¼Œç®€åŒ–äº†å¼€å‘æµç¨‹ã€‚æœ€æ ¸å¿ƒçš„æ³¨è§£åŒ…æ‹¬ï¼š
>
> - **@SpringBootApplication**ï¼šå¤åˆæ³¨è§£ï¼ŒåŒ…å«äº† `@Configuration`ã€`@EnableAutoConfiguration` å’Œ `@ComponentScan`ï¼Œè´Ÿè´£é…ç½®ç±»çš„å®šä¹‰ã€è‡ªåŠ¨é…ç½®çš„å¯ç”¨å’Œç»„ä»¶æ‰«æçš„å¼€å¯ã€‚
> - **@EnableAutoConfiguration**ï¼šå¯ç”¨ Spring Boot è‡ªåŠ¨é…ç½®ï¼Œæ ¹æ®ç±»è·¯å¾„ã€ç¯å¢ƒç­‰ä¿¡æ¯è‡ªåŠ¨é…ç½®åº”ç”¨æ‰€éœ€çš„ç»„ä»¶ã€‚
> - **@ConfigurationProperties** å’Œ **@Value**ï¼šç”¨äºå°†å¤–éƒ¨é…ç½®ï¼ˆå¦‚ `application.properties`ï¼‰æ³¨å…¥åˆ° Java ç±»ä¸­ï¼Œ`@ConfigurationProperties` é€‚åˆæ‰¹é‡æ³¨å…¥å¤æ‚é…ç½®ï¼Œè€Œ `@Value` æ›´é€‚ç”¨äºç®€å•çš„å•ä¸ªå€¼æ³¨å…¥ã€‚
> - **@RestController**ï¼šç®€åŒ– REST API å¼€å‘ï¼Œç»“åˆäº† `@Controller` å’Œ `@ResponseBody` æ³¨è§£ï¼Œä½¿å¾—æ–¹æ³•è¿”å›çš„å¯¹è±¡ç›´æ¥ä½œä¸º HTTP å“åº”çš„å†…å®¹ã€‚
>
> è¿™äº›æ³¨è§£å…±åŒä½œç”¨ï¼Œé€šè¿‡è‡ªåŠ¨é…ç½®å’Œæ¡ä»¶åŒ–åŠ è½½ï¼Œä¸ºå¼€å‘è€…æä¾›äº†é«˜æ•ˆã€ç®€ä¾¿çš„é…ç½®å’Œå¼€å‘ä½“éªŒã€‚

---

## ğŸ”§ ä¹ã€é«˜çº§ç‰¹æ€§ä¸å®è·µ

**æ ¸å¿ƒç†å¿µ**ï¼šSpringæä¾›äº†ä¸°å¯Œçš„é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬äº‹ä»¶æœºåˆ¶ã€ç¼“å­˜æŠ½è±¡ã€å›½é™…åŒ–æ”¯æŒç­‰ï¼ŒåŠ©åŠ›ä¼ä¸šçº§åº”ç”¨å¼€å‘ã€‚

### ğŸ¯ Springçš„äº‹ä»¶æœºåˆ¶æ€ä¹ˆä½¿ç”¨ï¼Ÿ



"Springäº‹ä»¶æœºåˆ¶åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ç°ç»„ä»¶é—´çš„è§£è€¦é€šä¿¡ï¼š

**æ ¸å¿ƒç»„ä»¶**ï¼š

**ApplicationEvent**ï¼š
- äº‹ä»¶åŸºç±»ï¼Œæ‰€æœ‰è‡ªå®šä¹‰äº‹ä»¶éœ€ç»§æ‰¿
- åŒ…å«äº‹ä»¶æºå’Œæ—¶é—´æˆ³ä¿¡æ¯
- å¯ä»¥æºå¸¦è‡ªå®šä¹‰æ•°æ®

**ApplicationEventPublisher**ï¼š
- äº‹ä»¶å‘å¸ƒå™¨æ¥å£
- ApplicationContextå®ç°äº†æ­¤æ¥å£
- é€šè¿‡publishEventæ–¹æ³•å‘å¸ƒäº‹ä»¶

**ApplicationListener**ï¼š
- äº‹ä»¶ç›‘å¬å™¨æ¥å£
- æ³›å‹æŒ‡å®šç›‘å¬çš„äº‹ä»¶ç±»å‹
- å¯ä»¥ä½¿ç”¨@EventListeneræ³¨è§£ç®€åŒ–

**äº‹ä»¶å¤„ç†ç‰¹ç‚¹**ï¼š
- é»˜è®¤åŒæ­¥æ‰§è¡Œï¼Œå¯é…ç½®å¼‚æ­¥
- æ”¯æŒäº‹ä»¶è¿‡æ»¤å’Œæ¡ä»¶ç›‘å¬
- è‡ªåŠ¨ç±»å‹åŒ¹é…ï¼Œæ”¯æŒç»§æ‰¿å…³ç³»
- å¯ä»¥è®¾ç½®ç›‘å¬å™¨ä¼˜å…ˆçº§

**åº”ç”¨åœºæ™¯**ï¼š
- ä¸šåŠ¡è§£è€¦ï¼šè®¢å•åˆ›å»ºåé€šçŸ¥åº“å­˜ã€ç§¯åˆ†ç­‰
- ç³»ç»Ÿç›‘æ§ï¼šæ€§èƒ½æŒ‡æ ‡æ”¶é›†
- ç¼“å­˜æ›´æ–°ï¼šæ•°æ®å˜æ›´åç¼“å­˜å¤±æ•ˆ
- æ—¥å¿—å®¡è®¡ï¼šæ“ä½œè®°å½•å’Œå®¡è®¡æ—¥å¿—"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// è‡ªå®šä¹‰äº‹ä»¶
public class OrderCreatedEvent extends ApplicationEvent {
    private final Order order;
    
    public OrderCreatedEvent(Object source, Order order) {
        super(source);
        this.order = order;
    }
    
    public Order getOrder() {
        return order;
    }
}

// äº‹ä»¶å‘å¸ƒ
@Service
public class OrderService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    @Transactional
    public Order createOrder(Order order) {
        Order savedOrder = orderRepository.save(order);
        
        // å‘å¸ƒäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(this, savedOrder);
        eventPublisher.publishEvent(event);
        
        return savedOrder;
    }
}

// äº‹ä»¶ç›‘å¬
@Component
public class OrderEventListener {
    
    // åº“å­˜å¤„ç†
    @EventListener
    @Async
    public void handleOrderCreated(OrderCreatedEvent event) {
        Order order = event.getOrder();
        inventoryService.reserveStock(order.getItems());
    }
    
    // ç§¯åˆ†å¤„ç†
    @EventListener
    @Order(1) // è®¾ç½®ä¼˜å…ˆçº§
    public void handlePointsCalculation(OrderCreatedEvent event) {
        Order order = event.getOrder();
        pointService.calculatePoints(order);
    }
    
    // æ¡ä»¶ç›‘å¬
    @EventListener(condition = "#event.order.amount > 1000")
    public void handleVipOrder(OrderCreatedEvent event) {
        // å¤„ç†VIPè®¢å•é€»è¾‘
        vipService.processVipOrder(event.getOrder());
    }
}

// å¼‚æ­¥äº‹ä»¶é…ç½®
@Configuration
@EnableAsync
public class AsyncEventConfig {
    
    @Bean
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(25);
        executor.setThreadNamePrefix("Event-");
        executor.initialize();
        return executor;
    }
}
```

### ğŸ¯ Spring Cacheç¼“å­˜æŠ½è±¡æ€ä¹ˆä½¿ç”¨ï¼Ÿ



"Spring Cacheæä¾›äº†å£°æ˜å¼ç¼“å­˜æŠ½è±¡ï¼Œæ”¯æŒå¤šç§ç¼“å­˜å®ç°ï¼š

**æ ¸å¿ƒæ³¨è§£**ï¼š

**@Cacheable**ï¼š
- æ–¹æ³•ç»“æœç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨ç›´æ¥è¿”å›
- é€‚ç”¨äºæŸ¥è¯¢æ–¹æ³•
- æ”¯æŒæ¡ä»¶ç¼“å­˜å’ŒSpELè¡¨è¾¾å¼

**@CacheEvict**ï¼š
- ç¼“å­˜æ¸…é™¤ï¼Œåˆ é™¤æŒ‡å®šç¼“å­˜
- é€‚ç”¨äºæ›´æ–°ã€åˆ é™¤æ“ä½œ
- æ”¯æŒæ‰¹é‡æ¸…é™¤å’Œæ¡ä»¶æ¸…é™¤

**@CachePut**ï¼š
- ç¼“å­˜æ›´æ–°ï¼Œæ€»æ˜¯æ‰§è¡Œæ–¹æ³•å¹¶æ›´æ–°ç¼“å­˜
- é€‚ç”¨äºæ›´æ–°æ“ä½œ

**@Caching**ï¼š
- ç»„åˆç¼“å­˜æ“ä½œ
- æ”¯æŒåŒæ—¶ä½¿ç”¨å¤šä¸ªç¼“å­˜æ³¨è§£

**ç¼“å­˜å®ç°**ï¼š
- ConcurrentHashMapï¼šç®€å•å†…å­˜ç¼“å­˜
- Redisï¼šåˆ†å¸ƒå¼ç¼“å­˜
- Ehcacheï¼šæœ¬åœ°ç¼“å­˜
- Caffeineï¼šé«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜

**é«˜çº§ç‰¹æ€§**ï¼š
- ç¼“å­˜ç©¿é€ä¿æŠ¤
- ç¼“å­˜é›ªå´©ä¿æŠ¤
- è‡ªå®šä¹‰ç¼“å­˜é”®ç”Ÿæˆç­–ç•¥
- ç¼“å­˜ç»Ÿè®¡å’Œç›‘æ§"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// å¯ç”¨ç¼“å­˜
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager() {
        RedisCacheManager.Builder builder = RedisCacheManager
            .RedisCacheManagerBuilder
            .fromConnectionFactory(jedisConnectionFactory())
            .cacheDefaults(cacheConfiguration());
        return builder.build();
    }
    
    private RedisCacheConfiguration cacheConfiguration() {
        return RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .disableCachingNullValues();
    }
}

@Service
public class UserService {
    
    // ç¼“å­˜æŸ¥è¯¢ç»“æœ
    @Cacheable(value = "users", key = "#id")
    public User findById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
    
    // æ¡ä»¶ç¼“å­˜
    @Cacheable(value = "users", key = "#username", condition = "#username.length() > 3")
    public User findByUsername(String username) {
        return userRepository.findByUsername(username);
    }
    
    // ç¼“å­˜æ›´æ–°
    @CachePut(value = "users", key = "#user.id")
    public User updateUser(User user) {
        return userRepository.save(user);
    }
    
    // ç¼“å­˜æ¸…é™¤
    @CacheEvict(value = "users", key = "#id")
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
    
    // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
    @CacheEvict(value = "users", allEntries = true)
    public void clearAllUserCache() {
        // æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·ç¼“å­˜
    }
    
    // ç»„åˆç¼“å­˜æ“ä½œ
    @Caching(
        put = @CachePut(value = "users", key = "#user.id"),
        evict = @CacheEvict(value = "userStats", allEntries = true)
    )
    public User saveUser(User user) {
        return userRepository.save(user);
    }
}
```

### ğŸ¯ Springå¦‚ä½•å®ç°å›½é™…åŒ–ï¼Ÿ



"Springæä¾›äº†å®Œæ•´çš„å›½é™…åŒ–ï¼ˆi18nï¼‰æ”¯æŒï¼š

**æ ¸å¿ƒç»„ä»¶**ï¼š

**MessageSource**ï¼š
- æ¶ˆæ¯èµ„æºæ¥å£ï¼Œç®¡ç†å›½é™…åŒ–æ¶ˆæ¯
- ResourceBundleMessageSourceï¼šåŸºäºpropertiesæ–‡ä»¶
- ReloadableResourceBundleMessageSourceï¼šæ”¯æŒçƒ­åŠ è½½

**LocaleResolver**ï¼š
- è¯­è¨€ç¯å¢ƒè§£æå™¨ï¼Œç¡®å®šç”¨æˆ·çš„Locale
- AcceptHeaderLocaleResolverï¼šåŸºäºHTTPå¤´
- SessionLocaleResolverï¼šåŸºäºSession
- CookieLocaleResolverï¼šåŸºäºCookie

**LocaleChangeInterceptor**ï¼š
- è¯­è¨€åˆ‡æ¢æ‹¦æˆªå™¨
- ç›‘å¬è¯­è¨€åˆ‡æ¢è¯·æ±‚å‚æ•°

**å®ç°æ­¥éª¤**ï¼š
1. é…ç½®MessageSourceå’ŒLocaleResolver
2. åˆ›å»ºä¸åŒè¯­è¨€çš„èµ„æºæ–‡ä»¶
3. æ·»åŠ è¯­è¨€åˆ‡æ¢æ‹¦æˆªå™¨
4. åœ¨ä»£ç ä¸­ä½¿ç”¨MessageSourceè·å–æ¶ˆæ¯
5. åœ¨JSP/Thymeleafæ¨¡æ¿ä¸­ä½¿ç”¨å›½é™…åŒ–æ ‡ç­¾

**æœ€ä½³å®è·µ**ï¼š
- ç»Ÿä¸€çš„èµ„æºæ–‡ä»¶å‘½åè§„èŒƒ
- ä½¿ç”¨é”®å€¼å¯¹ç®¡ç†æ¶ˆæ¯
- æ”¯æŒå‚æ•°åŒ–æ¶ˆæ¯
- æä¾›å‹å¥½çš„è¯­è¨€åˆ‡æ¢ç•Œé¢"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// å›½é™…åŒ–é…ç½®
@Configuration
public class I18nConfig implements WebMvcConfigurer {
    
    @Bean
    public MessageSource messageSource() {
        ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();
        messageSource.setBasename("messages");
        messageSource.setDefaultEncoding("UTF-8");
        return messageSource;
    }
    
    @Bean
    public LocaleResolver localeResolver() {
        SessionLocaleResolver resolver = new SessionLocaleResolver();
        resolver.setDefaultLocale(Locale.CHINA);
        return resolver;
    }
    
    @Bean
    public LocaleChangeInterceptor localeChangeInterceptor() {
        LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
        interceptor.setParamName("lang");
        return interceptor;
    }
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(localeChangeInterceptor());
    }
}

// èµ„æºæ–‡ä»¶
// messages_zh_CN.properties
user.name=ç”¨æˆ·å
user.age=å¹´é¾„
welcome.message=æ¬¢è¿ {0}!

// messages_en_US.properties
user.name=Username
user.age=Age
welcome.message=Welcome {0}!

// æ§åˆ¶å™¨ä½¿ç”¨
@Controller
public class HomeController {
    
    @Autowired
    private MessageSource messageSource;
    
    @GetMapping("/welcome")
    public String welcome(@RequestParam String username, 
                         Model model, HttpServletRequest request) {
        Locale locale = RequestContextUtils.getLocale(request);
        String message = messageSource.getMessage("welcome.message", 
                                                 new Object[]{username}, locale);
        model.addAttribute("message", message);
        return "welcome";
    }
}

// å·¥å…·ç±»
@Component
public class I18nUtil {
    
    @Autowired
    private MessageSource messageSource;
    
    public String getMessage(String key, Object... args) {
        Locale locale = LocaleContextHolder.getLocale();
        return messageSource.getMessage(key, args, locale);
    }
}
```

### ğŸ¯ Spring WebFluxå“åº”å¼ç¼–ç¨‹æ€ä¹ˆä½¿ç”¨ï¼Ÿ

"Spring WebFluxæ˜¯Spring 5å¼•å…¥çš„å“åº”å¼Webæ¡†æ¶ï¼ŒåŸºäºReactorå®ç°ï¼š

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

**å“åº”å¼ç¼–ç¨‹**ï¼š
- åŸºäºå¼‚æ­¥æ•°æ®æµçš„ç¼–ç¨‹æ¨¡å¼
- é‡‡ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ•°æ®æµé©±åŠ¨
- éé˜»å¡I/Oï¼Œæé«˜ç³»ç»Ÿååé‡
- æ”¯æŒèƒŒå‹ï¼ˆBackpressureï¼‰å¤„ç†

**Reactoræ ¸å¿ƒç±»å‹**ï¼š
- Monoï¼šè¡¨ç¤º0åˆ°1ä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—
- Fluxï¼šè¡¨ç¤º0åˆ°Nä¸ªå…ƒç´ çš„å¼‚æ­¥åºåˆ—
- æ”¯æŒé“¾å¼æ“ä½œå’Œå‡½æ•°å¼ç¼–ç¨‹

**WebFlux vs Spring MVC**ï¼š

**Spring MVC**ï¼š
- åŸºäºServlet APIï¼ŒåŒæ­¥é˜»å¡æ¨¡å‹
- æ¯ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹
- é€‚åˆä¼ ç»Ÿçš„CRUDåº”ç”¨
- æˆç†Ÿç¨³å®šï¼Œç”Ÿæ€å®Œå–„

**Spring WebFlux**ï¼š
- åŸºäºReactive Streamsï¼Œå¼‚æ­¥éé˜»å¡
- å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¯·æ±‚
- é€‚åˆé«˜å¹¶å‘ã€I/Oå¯†é›†å‹åº”ç”¨
- æ”¯æŒå‡½æ•°å¼å’Œæ³¨è§£å¼ç¼–ç¨‹

**é€‚ç”¨åœºæ™¯**ï¼š
- é«˜å¹¶å‘çš„å¾®æœåŠ¡åº”ç”¨
- å®æ—¶æ•°æ®æµå¤„ç†
- æœåŠ¡é—´å¼‚æ­¥é€šä¿¡
- SSEï¼ˆServer-Sent Eventsï¼‰å’ŒWebSocket

**æŠ€æœ¯æ ˆæ”¯æŒ**ï¼š
- Nettyã€Undertowç­‰éé˜»å¡æœåŠ¡å™¨
- R2DBCå“åº”å¼æ•°æ®åº“è®¿é—®
- Spring Cloud Gatewayå“åº”å¼ç½‘å…³
- Redis Reactiveã€MongoDB Reactiveç­‰"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š

```java
// WebFluxæ§åˆ¶å™¨
@RestController
public class ReactiveUserController {
    
    @Autowired
    private ReactiveUserService userService;
    
    // è¿”å›å•ä¸ªç”¨æˆ·
    @GetMapping("/users/{id}")
    public Mono<User> getUser(@PathVariable String id) {
        return userService.findById(id)
                .switchIfEmpty(Mono.error(new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨")));
    }
    
    // è¿”å›ç”¨æˆ·åˆ—è¡¨
    @GetMapping("/users")
    public Flux<User> getUsers() {
        return userService.findAll()
                .delayElements(Duration.ofMillis(100)); // æ¨¡æ‹Ÿå»¶è¿Ÿ
    }
    
    // åˆ›å»ºç”¨æˆ·
    @PostMapping("/users")
    public Mono<User> createUser(@RequestBody Mono<User> userMono) {
        return userMono
                .flatMap(userService::save)
                .doOnSuccess(user -> log.info("ç”¨æˆ·åˆ›å»ºæˆåŠŸ: {}", user.getId()));
    }
    
    // æµå¼å¤„ç†
    @GetMapping(value = "/users/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<User> streamUsers() {
        return userService.findAll()
                .delayElements(Duration.ofSeconds(1))
                .repeat();
    }
}

// å“åº”å¼Service
@Service
public class ReactiveUserService {
    
    @Autowired
    private ReactiveUserRepository userRepository;
    
    public Mono<User> findById(String id) {
        return userRepository.findById(id)
                .doOnNext(user -> log.debug("æ‰¾åˆ°ç”¨æˆ·: {}", user))
                .doOnError(error -> log.error("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥: {}", error.getMessage()));
    }
    
    public Flux<User> findAll() {
        return userRepository.findAll()
                .filter(user -> user.isActive())
                .sort((u1, u2) -> u1.getName().compareTo(u2.getName()));
    }
    
    public Mono<User> save(User user) {
        return Mono.just(user)
                .filter(u -> StringUtils.hasText(u.getName()))
                .switchIfEmpty(Mono.error(new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º")))
                .flatMap(userRepository::save);
    }
    
    // æ‰¹é‡å¤„ç†
    public Flux<User> saveAll(Flux<User> users) {
        return users
                .filter(user -> StringUtils.hasText(user.getName()))
                .flatMap(this::save)
                .onErrorContinue((error, user) -> 
                    log.error("ä¿å­˜ç”¨æˆ·å¤±è´¥: {}, é”™è¯¯: {}", user, error.getMessage()));
    }
}

// å‡½æ•°å¼ç¼–ç¨‹é£æ ¼
@Configuration
public class RouterConfig {
    
    @Bean
    public RouterFunction<ServerResponse> userRoutes(UserHandler userHandler) {
        return RouterFunctions.route()
                .GET("/api/users", userHandler::getAllUsers)
                .GET("/api/users/{id}", userHandler::getUser)
                .POST("/api/users", userHandler::createUser)
                .PUT("/api/users/{id}", userHandler::updateUser)
                .DELETE("/api/users/{id}", userHandler::deleteUser)
                .build();
    }
}

@Component
public class UserHandler {
    
    @Autowired
    private ReactiveUserService userService;
    
    public Mono<ServerResponse> getAllUsers(ServerRequest request) {
        return ServerResponse.ok()
                .contentType(MediaType.APPLICATION_JSON)
                .body(userService.findAll(), User.class);
    }
    
    public Mono<ServerResponse> getUser(ServerRequest request) {
        String id = request.pathVariable("id");
        return userService.findById(id)
                .flatMap(user -> ServerResponse.ok().bodyValue(user))
                .switchIfEmpty(ServerResponse.notFound().build());
    }
    
    public Mono<ServerResponse> createUser(ServerRequest request) {
        return request.bodyToMono(User.class)
                .flatMap(userService::save)
                .flatMap(user -> ServerResponse.status(HttpStatus.CREATED).bodyValue(user))
                .onErrorResume(error -> ServerResponse.badRequest().bodyValue(error.getMessage()));
    }
}

// WebClientå“åº”å¼HTTPå®¢æˆ·ç«¯
@Service
public class ExternalApiService {
    
    private final WebClient webClient;
    
    public ExternalApiService() {
        this.webClient = WebClient.builder()
                .baseUrl("https://api.example.com")
                .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                .codecs(configurer -> configurer.defaultCodecs().maxInMemorySize(1024 * 1024))
                .build();
    }
    
    public Mono<UserInfo> getUserInfo(String userId) {
        return webClient.get()
                .uri("/users/{id}", userId)
                .retrieve()
                .onStatus(HttpStatus::is4xxClientError, 
                    response -> Mono.error(new RuntimeException("å®¢æˆ·ç«¯é”™è¯¯")))
                .onStatus(HttpStatus::is5xxServerError,
                    response -> Mono.error(new RuntimeException("æœåŠ¡å™¨é”™è¯¯")))
                .bodyToMono(UserInfo.class)
                .timeout(Duration.ofSeconds(5))
                .retry(3);
    }
    
    public Flux<UserInfo> getAllUsers() {
        return webClient.get()
                .uri("/users")
                .retrieve()
                .bodyToFlux(UserInfo.class)
                .onErrorReturn(Collections.emptyList())
                .flatMapIterable(list -> list);
    }
}
```



### ğŸ¯ springMVC  å’Œ spring WebFlux åŒºåˆ«ï¼Ÿ

`Spring MVC` å’Œ `Spring WebFlux` éƒ½æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºçš„æ¨¡å—ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›æ ¹æœ¬æ€§çš„åŒºåˆ«ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†è¯·æ±‚çš„æ–¹å¼å’Œæ”¯æŒçš„ç¼–ç¨‹æ¨¡å‹ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«å’Œå·¥ä½œåŸç†çš„è¯¦ç»†è¯´æ˜ï¼š

1. **ç¼–ç¨‹æ¨¡å‹å’Œæ¶æ„**

- Spring MVCï¼ˆåŒæ­¥é˜»å¡å¼ï¼‰

  Spring MVC æ˜¯ä¸€ä¸ªåŸºäº Servlet çš„ Web æ¡†æ¶ï¼Œéµå¾ªç»å…¸çš„è¯·æ±‚-å“åº”æ¨¡å‹ã€‚å®ƒæ˜¯ä¸€ä¸ª **åŒæ­¥é˜»å¡** çš„æ¡†æ¶ï¼Œå³æ¯ä¸ªè¯·æ±‚éƒ½ç”±ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹å¤„ç†ï¼Œç›´åˆ°è¯·æ±‚å®Œæˆï¼Œçº¿ç¨‹æ‰ä¼šè¢«é‡Šæ”¾ã€‚å…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

  1. **è¯·æ±‚åˆ°è¾¾**ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒTomcat æ¥æ”¶è¯·æ±‚å¹¶äº¤ç»™ Spring MVC å¤„ç†ã€‚
  2. **è¯·æ±‚åˆ†å‘**ï¼šDispatcherServlet å°†è¯·æ±‚ä¼ é€’ç»™åˆé€‚çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚
  3. **å¤„ç†è¯·æ±‚**ï¼šæ§åˆ¶å™¨å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚ç­‰ã€‚
  4. **è§†å›¾è§£æ**ï¼šè¿”å›æ¨¡å‹å’Œè§†å›¾ï¼ˆModelAndViewï¼‰ï¼Œç„¶åäº¤ç”±è§†å›¾è§£æå™¨ï¼ˆå¦‚ JSPï¼‰æ¸²æŸ“æˆæœ€ç»ˆçš„ HTMLã€‚
  5. **å“åº”è¿”å›**ï¼šæœ€ç»ˆçš„å“åº”é€šè¿‡ Tomcat è¿”å›åˆ°å®¢æˆ·ç«¯ã€‚

â€‹	Spring MVC é€‚ç”¨äºä¼ ç»Ÿçš„åŸºäº Servlet çš„ Web åº”ç”¨ï¼Œé€šå¸¸ç”¨äºåŒæ­¥åœºæ™¯ï¼Œåƒè¡¨å•æäº¤ã€å¤„ç†é‡å®šå‘ç­‰ã€‚

2. **Spring WebFluxï¼ˆå¼‚æ­¥éé˜»å¡å¼ï¼‰**

   Spring WebFlux æ˜¯ä¸€ä¸ª **å¼‚æ­¥éé˜»å¡** çš„ Web æ¡†æ¶ï¼Œå¯ä»¥æ›´å¥½åœ°å¤„ç†é«˜å¹¶å‘åœºæ™¯å’Œ I/O å¯†é›†å‹æ“ä½œã€‚Spring WebFlux é€‚ç”¨äºå“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œé€šè¿‡ä½¿ç”¨ **Reactor**ï¼ˆä¸€ä¸ªå“åº”å¼ç¼–ç¨‹åº“ï¼‰æä¾›çš„æ”¯æŒï¼Œèƒ½å¤Ÿä»¥å¼‚æ­¥å’Œéé˜»å¡çš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚

   Spring WebFlux å¯ä»¥è¿è¡Œåœ¨å¤šç§å®¹å™¨ä¸Šï¼Œé™¤äº†ä¼ ç»Ÿçš„ Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰ï¼Œå®ƒè¿˜æ”¯æŒåŸºäº Netty ç­‰é Servlet å®¹å™¨çš„è¿è¡Œæ¨¡å¼ã€‚å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

   1. **è¯·æ±‚åˆ°è¾¾**ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒTomcat æˆ– Netty æ¥æ”¶è¯·æ±‚ã€‚
   2. **è¯·æ±‚åˆ†å‘**ï¼šDispatcherHandler å°†è¯·æ±‚ä¼ é€’ç»™åˆé€‚çš„æ§åˆ¶å™¨ã€‚
   3. **å¼‚æ­¥å¤„ç†**ï¼šæ§åˆ¶å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼Œé€šå¸¸ä¼šè¿”å›ä¸€ä¸ª `Mono` æˆ– `Flux`ï¼ˆReactor åº“çš„å¼‚æ­¥æ•°æ®æµç±»å‹ï¼‰ï¼Œè¿™äº›ç±»å‹ä»£è¡¨äº†ä¸€ä¸ªå•ä¸€å…ƒç´ ï¼ˆMonoï¼‰æˆ–è€…å¤šä¸ªå…ƒç´ ï¼ˆFluxï¼‰çš„å¼‚æ­¥å“åº”ã€‚
   4. **å“åº”è¿”å›**ï¼šé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ï¼Œæœ€ç»ˆå“åº”å¼‚æ­¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

â€‹	Spring WebFlux é€‚åˆé«˜å¹¶å‘ã€I/O å¯†é›†å‹å’Œå®æ—¶æ•°æ®æµåœºæ™¯ï¼ŒåƒèŠå¤©ç³»ç»Ÿã€å®æ—¶é€šçŸ¥ã€æ•°æ®æµå¤„ç†ç­‰ã€‚

| ç‰¹æ€§                | Spring MVC                                      | Spring WebFlux                                         |
| ------------------- | ----------------------------------------------- | ------------------------------------------------------ |
| **ç¼–ç¨‹æ¨¡å‹**        | åŒæ­¥é˜»å¡æ¨¡å‹ï¼ˆä¼ ç»Ÿçš„è¯·æ±‚-å“åº”æ¨¡å‹ï¼‰             | å¼‚æ­¥éé˜»å¡æ¨¡å‹ï¼ˆå“åº”å¼ç¼–ç¨‹ï¼‰                           |
| **çº¿ç¨‹æ¨¡å‹**        | æ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œé˜»å¡ç­‰å¾…å“åº”              | è¯·æ±‚é€šè¿‡äº‹ä»¶å¾ªç¯å¤„ç†ï¼Œå¼‚æ­¥è¿”å›ç»“æœ                     |
| **è¯·æ±‚å¤„ç†æ–¹å¼**    | é˜»å¡ï¼Œå¤„ç†è¯·æ±‚æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å ç”¨                  | éé˜»å¡ï¼Œçº¿ç¨‹å¯ä»¥ç”¨äºå…¶ä»–ä»»åŠ¡ï¼Œç›´åˆ°ç»“æœè¿”å›             |
| **I/O æ¨¡å‹**        | é˜»å¡å¼ I/O                                      | éé˜»å¡å¼ I/O                                           |
| **é€‚ç”¨åœºæ™¯**        | å¯¹åŒæ­¥è¯·æ±‚è¾ƒä¸ºé€‚åˆï¼Œä¾‹å¦‚è¡¨å•æäº¤ï¼Œä¼ ç»Ÿ Web åº”ç”¨ | é«˜å¹¶å‘ã€å®æ—¶æ•°æ®æµå¤„ç†ï¼ŒI/O å¯†é›†å‹åœºæ™¯ï¼Œå¾®æœåŠ¡         |
| **æ”¯æŒçš„å®¹å™¨**      | Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰                       | Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰åŠé Servlet å®¹å™¨ï¼ˆå¦‚ Nettyï¼‰ |
| **å“åº”ä½“ç±»å‹**      | `ModelAndView`ï¼ˆåŒæ­¥è¿”å›ï¼‰                      | `Mono` å’Œ `Flux`ï¼ˆå¼‚æ­¥è¿”å›ï¼‰                           |
| **æ‰©å±•æ€§ä¸æ€§èƒ½**    | é«˜å¹¶å‘æ—¶æ€§èƒ½è¾ƒå·®ï¼Œå®¹æ˜“å‡ºç°çº¿ç¨‹é¥±å’Œ              | é«˜å¹¶å‘æ—¶æ€§èƒ½æ›´ä¼˜ï¼Œçº¿ç¨‹åˆ©ç”¨ç‡æ›´é«˜                       |
| **å­¦ä¹ æ›²çº¿**        | æ›´æ˜“ä¸Šæ‰‹ï¼Œç†Ÿæ‚‰çš„ç¼–ç¨‹æ¨¡å‹                        | å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œéœ€è¦ç†è§£å¼‚æ­¥ç¼–ç¨‹å’Œå“åº”å¼æµ               |
| **æ”¯æŒçš„ API ç±»å‹** | REST APIã€Web åº”ç”¨                              | æ”¯æŒ REST APIï¼Œä¸”æ›´é€‚åˆé•¿è¿æ¥å’Œå®æ—¶é€šä¿¡                |



### ğŸ¯ Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ

- **å·¥å‚è®¾è®¡æ¨¡å¼** : Springä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ `BeanFactory`ã€`ApplicationContext` åˆ›å»º bean å¯¹è±¡ã€‚
- **ä»£ç†è®¾è®¡æ¨¡å¼** : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚
- **å•ä¾‹è®¾è®¡æ¨¡å¼** : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚
- **æ¨¡æ¿æ–¹æ³•æ¨¡å¼** : Spring ä¸­ `jdbcTemplate`ã€`hibernateTemplate` ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚
- **åŒ…è£…å™¨è®¾è®¡æ¨¡å¼** : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚
- **è§‚å¯Ÿè€…æ¨¡å¼:** Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚
- **é€‚é…å™¨æ¨¡å¼** :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…`Controller`ã€‚



---

## ğŸ¯ åã€é¢è¯•é‡ç‚¹ä¸å®è·µ

**æ ¸å¿ƒç†å¿µ**ï¼šæŒæ¡Springé¢è¯•çš„å…³é”®æŠ€å·§å’Œå¸¸è§é™·é˜±ï¼Œç»“åˆå®é™…é¡¹ç›®ç»éªŒå±•ç°æŠ€æœ¯æ·±åº¦ã€‚

### ğŸ¯ Springé¢è¯•å¸¸è§é™·é˜±å’Œæ³¨æ„äº‹é¡¹ï¼Ÿ

"Springé¢è¯•ä¸­æœ‰ä¸€äº›å¸¸è§çš„é™·é˜±å’Œéœ€è¦æ³¨æ„çš„ç‚¹ï¼š

**æ¦‚å¿µæ··æ·†é™·é˜±**ï¼š
- BeanFactory vs ApplicationContextï¼šåŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯åŒºåˆ«
- @Component vs @Beanï¼šæ³¨è§£é©±åŠ¨ vs Javaé…ç½®
- AOP vs è¿‡æ»¤å™¨ï¼šå®ç°æœºåˆ¶å’Œé€‚ç”¨åœºæ™¯ä¸åŒ

**ç”Ÿå‘½å‘¨æœŸç†è§£é™·é˜±**ï¼š
- Beanç”Ÿå‘½å‘¨æœŸçš„å®Œæ•´æµç¨‹è¦å‡†ç¡®
- å¾ªç¯ä¾èµ–çš„è§£å†³æœºåˆ¶è¦æ¸…æ¥š
- äº‹åŠ¡å¤±æ•ˆçš„å¸¸è§åœºæ™¯è¦ç†Ÿæ‚‰

**æ€§èƒ½ç›¸å…³é™·é˜±**ï¼š
- å•ä¾‹Beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜
- @Transactionalçš„æ€§èƒ½å½±å“
- AOPä»£ç†çš„åˆ›å»ºå¼€é”€

**é…ç½®ç›¸å…³é™·é˜±**ï¼š
- æ³¨è§£æ‰«æèŒƒå›´è¦åˆç†
- é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§é¡ºåº
- Profileç¯å¢ƒé…ç½®çš„ä½¿ç”¨

**å®è·µç»éªŒé™·é˜±**ï¼š
- ä¸è¦åªåœç•™åœ¨ç†è®ºå±‚é¢
- è¦èƒ½ç»“åˆå…·ä½“é¡¹ç›®åœºæ™¯
- è¦äº†è§£Springåœ¨å¾®æœåŠ¡ä¸­çš„åº”ç”¨

**å›ç­”æŠ€å·§**ï¼š
- å…ˆå›ç­”æ ¸å¿ƒæ¦‚å¿µï¼Œå†å±•å¼€ç»†èŠ‚
- ç»“åˆä»£ç ç¤ºä¾‹è¯´æ˜
- æåŠæ€§èƒ½å’Œæœ€ä½³å®è·µ
- å±•ç°è§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›"

### ğŸ¯ Spring Boot vs Spring Frameworkçš„åŒºåˆ«ï¼Ÿ

"Spring Bootå’ŒSpring Frameworkæ˜¯åŒ…å«å…³ç³»ï¼Œä¸æ˜¯æ›¿ä»£å…³ç³»ï¼š

**Spring Framework**ï¼š
- Springç”Ÿæ€çš„æ ¸å¿ƒåŸºç¡€æ¡†æ¶
- æä¾›IoCã€AOPã€äº‹åŠ¡ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½
- éœ€è¦å¤§é‡XMLæˆ–Javaé…ç½®
- å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­ï¼Œé…ç½®å¤æ‚

**Spring Boot**ï¼š
- åŸºäºSpring Frameworkçš„å¿«é€Ÿå¼€å‘æ¡†æ¶
- æä¾›è‡ªåŠ¨é…ç½®å’Œèµ·æ­¥ä¾èµ–
- çº¦å®šå¤§äºé…ç½®ï¼Œé›¶é…ç½®å¯åŠ¨
- å†…åµŒWebæœåŠ¡å™¨ï¼Œç®€åŒ–éƒ¨ç½²

**æ ¸å¿ƒåŒºåˆ«**ï¼š

**é…ç½®æ–¹å¼**ï¼š
- Spring Frameworkï¼šéœ€è¦æ˜¾å¼é…ç½®Bean
- Spring Bootï¼šè‡ªåŠ¨é…ç½®ï¼ŒæŒ‰éœ€è¦†ç›–

**ä¾èµ–ç®¡ç†**ï¼š
- Spring Frameworkï¼šæ‰‹åŠ¨ç®¡ç†ç‰ˆæœ¬å…¼å®¹
- Spring Bootï¼šStarterä¾èµ–ï¼Œç‰ˆæœ¬ä»²è£

**éƒ¨ç½²æ–¹å¼**ï¼š
- Spring Frameworkï¼šéœ€è¦å¤–éƒ¨Webå®¹å™¨
- Spring Bootï¼šå†…åµŒå®¹å™¨ï¼ŒjaråŒ…ç›´æ¥è¿è¡Œ

**å¼€å‘æ•ˆç‡**ï¼š
- Spring Frameworkï¼šé…ç½®ç¹çï¼Œå¼€å‘æ…¢
- Spring Bootï¼šå¿«é€Ÿå¯åŠ¨ï¼Œå¼€å‘æ•ˆç‡é«˜

**é€‚ç”¨åœºæ™¯**ï¼š
- Spring Frameworkï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶é…ç½®çš„åœºæ™¯
- Spring Bootï¼šå¿«é€Ÿå¼€å‘ï¼Œå¾®æœåŠ¡æ¶æ„"

### ğŸ¯ å¦‚ä½•è®¾è®¡ä¸€ä¸ªSpringåº”ç”¨çš„æ•´ä½“æ¶æ„ï¼Ÿ



"è®¾è®¡Springåº”ç”¨æ¶æ„éœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼š

**åˆ†å±‚æ¶æ„è®¾è®¡**ï¼š

**è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰**ï¼š
- ä½¿ç”¨Spring MVCå¤„ç†HTTPè¯·æ±‚
- RestControlleræä¾›RESTful API
- å‚æ•°æ ¡éªŒå’Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†

**ä¸šåŠ¡å±‚ï¼ˆBusiness Layerï¼‰**ï¼š
- Serviceå±‚å°è£…ä¸šåŠ¡é€»è¾‘
- ä½¿ç”¨@Transactionalç®¡ç†äº‹åŠ¡
- ä¸šåŠ¡è§„åˆ™éªŒè¯å’Œæµç¨‹æ§åˆ¶

**æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰**ï¼š
- Repositoryæ¨¡å¼å°è£…æ•°æ®è®¿é—®
- Spring Data JPAç®€åŒ–CRUDæ“ä½œ
- å¤šæ•°æ®æºé…ç½®å’Œè¯»å†™åˆ†ç¦»

**æŠ€æœ¯æ¶æ„é€‰å‹**ï¼š

**é…ç½®ç®¡ç†**ï¼š
- Spring Bootçš„å¤–éƒ¨åŒ–é…ç½®
- Config Serveré›†ä¸­é…ç½®ç®¡ç†
- Profileç¯å¢ƒåŒºåˆ†

**å®‰å…¨æ¡†æ¶**ï¼š
- Spring Securityç»Ÿä¸€å®‰å…¨ç®¡ç†
- JWTæ— çŠ¶æ€è®¤è¯
- æ–¹æ³•çº§æƒé™æ§åˆ¶

**ç¼“å­˜ç­–ç•¥**ï¼š
- Spring CacheæŠ½è±¡å±‚
- Redisåˆ†å¸ƒå¼ç¼“å­˜
- å¤šçº§ç¼“å­˜è®¾è®¡

**ç›‘æ§è¿ç»´**ï¼š
- Spring Boot Actuatorå¥åº·æ£€æŸ¥
- MicrometeræŒ‡æ ‡æ”¶é›†
- åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

**å¾®æœåŠ¡æ¶æ„**ï¼š
- Spring CloudæœåŠ¡æ²»ç†
- APIç½‘å…³ç»Ÿä¸€å…¥å£
- æœåŠ¡é—´é€šä¿¡å’Œå®¹é”™

**æœ€ä½³å®è·µ**ï¼š
- éµå¾ªSOLIDè®¾è®¡åŸåˆ™
- åˆç†çš„åŒ…ç»“æ„ç»„ç»‡
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- å®Œå–„çš„å•å…ƒæµ‹è¯•è¦†ç›–"

**ğŸ’» ä»£ç ç¤ºä¾‹**ï¼š
```java
// åˆ†å±‚æ¶æ„ç¤ºä¾‹
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity<UserDTO> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        UserDTO dto = UserMapper.toDTO(user);
        return ResponseEntity.ok(dto);
    }
    
    @PostMapping
    public ResponseEntity<UserDTO> createUser(@RequestBody @Valid CreateUserRequest request) {
        User user = userService.createUser(request);
        UserDTO dto = UserMapper.toDTO(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(dto);
    }
}

@Service
@Transactional
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    @Autowired
    private EmailService emailService;
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public User createUser(CreateUserRequest request) {
        // ä¸šåŠ¡é€»è¾‘éªŒè¯
        validateUserRequest(request);
        
        // åˆ›å»ºç”¨æˆ·
        User user = User.builder()
            .username(request.getUsername())
            .email(request.getEmail())
            .build();
        
        User savedUser = userRepository.save(user);
        
        // å‘é€æ¬¢è¿é‚®ä»¶
        emailService.sendWelcomeEmail(savedUser);
        
        // å‘å¸ƒç”¨æˆ·åˆ›å»ºäº‹ä»¶
        eventPublisher.publishEvent(new UserCreatedEvent(savedUser));
        
        return savedUser;
    }
    
    private void validateUserRequest(CreateUserRequest request) {
        if (userRepository.existsByUsername(request.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new BusinessException("é‚®ç®±å·²å­˜åœ¨");
        }
    }
}

@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    boolean existsByUsername(String username);
    boolean existsByEmail(String email);
    
    @Query("SELECT u FROM User u WHERE u.status = 'ACTIVE'")
    List<User> findActiveUsers();
}

// å…¨å±€å¼‚å¸¸å¤„ç†
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ErrorResponse handleBusinessException(BusinessException e) {
        return ErrorResponse.builder()
            .code("BUSINESS_ERROR")
            .message(e.getMessage())
            .build();
    }
    
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ErrorResponse handleValidationException(MethodArgumentNotValidException e) {
        Map<String, String> errors = new HashMap<>();
        e.getBindingResult().getFieldErrors().forEach(error -> 
            errors.put(error.getField(), error.getDefaultMessage()));
        
        return ErrorResponse.builder()
            .code("VALIDATION_ERROR")
            .message("å‚æ•°æ ¡éªŒå¤±è´¥")
            .errors(errors)
            .build();
    }
}
```

---

## ğŸ“š æ€»ç»“ä¸è¿›é˜¶

### ğŸ¯ Springå­¦ä¹ è·¯å¾„å»ºè®®

**åŸºç¡€é˜¶æ®µ**ï¼š
1. **Spring Frameworkæ ¸å¿ƒ**ï¼šIoCã€DIã€AOPåŸºç¡€æ¦‚å¿µ
2. **Spring MVC**ï¼šWebå¼€å‘åŸºç¡€ï¼Œè¯·æ±‚å¤„ç†æµç¨‹
3. **Spring Data**ï¼šæ•°æ®è®¿é—®å’Œäº‹åŠ¡ç®¡ç†
4. **Spring Security**ï¼šå®‰å…¨æ¡†æ¶åŸºç¡€

**è¿›é˜¶é˜¶æ®µ**ï¼š
1. **Spring Boot**ï¼šè‡ªåŠ¨é…ç½®ã€Starteræœºåˆ¶ã€ç›‘æ§
2. **Spring Cloud**ï¼šå¾®æœåŠ¡æ¶æ„ã€æœåŠ¡æ²»ç†
3. **å“åº”å¼ç¼–ç¨‹**ï¼šWebFluxã€Reactive Streams
4. **Nativeç¼–è¯‘**ï¼šGraalVM Native Image

**å®æˆ˜é˜¶æ®µ**ï¼š
1. **ä¼ä¸šçº§é¡¹ç›®**ï¼šå®Œæ•´çš„ä¸šåŠ¡ç³»ç»Ÿå¼€å‘
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šJVMè°ƒä¼˜ã€ç¼“å­˜ç­–ç•¥ã€æ•°æ®åº“ä¼˜åŒ–
3. **æ¶æ„è®¾è®¡**ï¼šå¾®æœåŠ¡æ‹†åˆ†ã€åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡
4. **DevOpså®è·µ**ï¼šCI/CDã€å®¹å™¨åŒ–ã€äº‘åŸç”Ÿéƒ¨ç½²

### âš¡ é¢è¯•å‡†å¤‡æ¸…å•

- [ ] Spring Frameworkæ ¸å¿ƒåŸç†ï¼ˆIoCã€AOPã€Beanç”Ÿå‘½å‘¨æœŸï¼‰
- [ ] Spring Bootè‡ªåŠ¨é…ç½®å’ŒStarteræœºåˆ¶
- [ ] Spring MVCè¯·æ±‚å¤„ç†æµç¨‹å’Œæ ¸å¿ƒç»„ä»¶
- [ ] Springäº‹åŠ¡ç®¡ç†å’Œä¼ æ’­æœºåˆ¶
- [ ] Spring Securityè®¤è¯æˆæƒæµç¨‹
- [ ] Spring Cloudå¾®æœåŠ¡ç»„ä»¶
- [ ] å¸¸ç”¨æ³¨è§£çš„ä½œç”¨å’ŒåŸç†
- [ ] å®é™…é¡¹ç›®ä¸­Springçš„åº”ç”¨ç»éªŒ
- [ ] Springç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–å®è·µ
- [ ] Springç”Ÿæ€çš„å‘å±•è¶‹åŠ¿

### ğŸš€ æŠ€æœ¯å‘å±•è¶‹åŠ¿

**äº‘åŸç”Ÿæ—¶ä»£**ï¼š
- Spring Boot 3.xå’ŒSpring Framework 6.x
- åŸºäºGraalVMçš„Nativeç¼–è¯‘
- KubernetesåŸç”Ÿæ”¯æŒ
- Serverlessæ¶æ„é€‚é…

**å“åº”å¼ç¼–ç¨‹**ï¼š
- Spring WebFluxå¼‚æ­¥éé˜»å¡
- R2DBCå“åº”å¼æ•°æ®åº“è®¿é—®
- äº‹ä»¶é©±åŠ¨æ¶æ„è®¾è®¡

**äººå·¥æ™ºèƒ½é›†æˆ**ï¼š
- Spring AIé¡¹ç›®
- å‘é‡æ•°æ®åº“é›†æˆ
- æœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡åŒ–

---

**ğŸ¯ é¢è¯•æˆåŠŸç§˜è¯€**ï¼šä¸ä»…è¦æŒæ¡Springçš„ç†è®ºçŸ¥è¯†ï¼Œæ›´è¦ç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œå±•ç°è§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ã€‚å‡†å¤‡å¥½è¯¦ç»†çš„é¡¹ç›®æ¡ˆä¾‹ï¼Œèƒ½å¤Ÿæ·±å…¥è®²è§£Springåœ¨é¡¹ç›®ä¸­çš„åº”ç”¨å’Œé‡åˆ°çš„æŒ‘æˆ˜åŠè§£å†³æ–¹æ¡ˆã€‚è®°ä½ï¼š**æŠ€æœ¯æ·±åº¦ + å®æˆ˜ç»éªŒ + æ¸…æ™°è¡¨è¾¾ = é¢è¯•æˆåŠŸ**ï¼

**ğŸ”¥ æœ€åæé†’**ï¼šSpringç”Ÿæ€åºå¤§ä¸”å‘å±•è¿…é€Ÿï¼Œä¿æŒæŒç»­å­¦ä¹ çš„å¿ƒæ€ï¼Œå…³æ³¨å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºåŠ¨æ€ï¼Œåœ¨å®è·µä¸­ä¸æ–­æå‡æŠ€æœ¯æ·±åº¦å’Œå¹¿åº¦ã€‚ç¥ä½ é¢è¯•é¡ºåˆ©ï¼Œofferæ»¡æ»¡ï¼ ğŸ‰